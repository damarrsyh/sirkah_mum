<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Laporan_to_excel extends GMN_Controller {

	public function __construct()
	{
		parent::__construct(true,'main','back');
		$this->load->model("model_laporan_to_pdf");
		$this->load->model("model_laporan");
		$this->load->model("model_cif");
		$this->load->library('phpexcel');
		$CI =& get_instance();
		
        set_time_limit(900);
        ini_set('memory_limit', '-1');
	}


	/****************************************************************************************/	
	// BEGIN SALDO KAS PERUGAS
	/****************************************************************************************/
	public function export_saldo_kas_petugas()
	{
		$tanggal = $this->uri->segment(3);
		$tanggal2 = substr($tanggal,4,4).'-'.substr($tanggal,2,2).'-'.substr($tanggal,0,2);
		$cabang = $this->uri->segment(4);
		$account_cash_code = $this->uri->segment(5);

		if ($cabang=="") 
        {            
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        } 
        else if ($tanggal=="")
        {
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        }
        else
        {
		
				$datas = $this->model_laporan_to_pdf->export_saldo_kas_petugas($cabang,$tanggal2);
				$cabang_ = $this->model_laporan_to_pdf->get_cabang($cabang);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");
										 
			$objPHPExcel->setActiveSheetIndex(0); 

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',"LAPORAN TRANSAKSI KAS PETUGAS");
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B2',':  '.$cabang_);
			$objPHPExcel->getActiveSheet()->setCellValue('B3',':  '.$tanggal2);
			$objPHPExcel->getActiveSheet()->setCellValue('B5',"Kas Petugas");
			$objPHPExcel->getActiveSheet()->setCellValue('C5',"Pemegang Kas");
			$objPHPExcel->getActiveSheet()->setCellValue('D5',"Saldo Awal");
			$objPHPExcel->getActiveSheet()->setCellValue('E5',"Mutasi Debet");
			$objPHPExcel->getActiveSheet()->setCellValue('F5',"Mutasi Credit");
			$objPHPExcel->getActiveSheet()->setCellValue('G5',"Saldo Akhir");

			//$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getStyle('A5:G5')->getFont()->setBold(true);

					
			$ii = 6;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
				$saldoakhir = $datas[$i]['saldoawal']+$datas[$i]['mutasi_debet']-$datas[$i]['mutasi_credit'];

				//$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['account_cash_code']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['fa_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($datas[$i]['saldoawal'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['mutasi_debet']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['mutasi_credit']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$saldoakhir);



				$ii++;
			
			}//END FOR

		



			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_SALDO_KAS_PERUGAS.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}
	/****************************************************************************************/	
	// END SALDO KAS PERUGAS
	/****************************************************************************************/


	/****************************************************************************************/	
	// BEGIN TRANSAKSI KAS PERUGAS
	/****************************************************************************************/
	public function export_transaksi_kas_petugas()
	{

        $account_cash_name  = $this->uri->segment(3);
        $account_cash_name_ = str_replace("%20"," ", $account_cash_name); 
        $pemegeng_kas       = $this->uri->segment(4);
        $pemegeng_kas_ = str_replace("%20"," ", $pemegeng_kas); 
        $tanggal            = $this->uri->segment(5);
        $tanggal_ = substr($tanggal,4,4).'-'.substr($tanggal,2,2).'-'.substr($tanggal,0,2);
        $tanggal2           = $this->uri->segment(6); 
        $tanggal2_ = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
        $account_cash_code  = $this->uri->segment(7); 
		
        if ($account_cash_name=="") 
        {            
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        } 
        else if ($tanggal=="")
        {
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        }
        else if ($tanggal2=="")
        {
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        }
        else
        {
			
				$datas = $this->model_laporan_to_pdf->export_transaksi_kas_petugas($tanggal_,$tanggal2_,$account_cash_code);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");
										 
			$objPHPExcel->setActiveSheetIndex(0); 

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',"LAPORAN TRANSAKSI KAS PETUGAS");
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Kode Kas");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Pemegang KAs");
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B2',':  	'.$account_cash_name_);
			$objPHPExcel->getActiveSheet()->setCellValue('B3',':  	'.$pemegeng_kas_);
			$objPHPExcel->getActiveSheet()->setCellValue('B4',':  	'.$tanggal_.' sd '.$tanggal2_);
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Debet");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Credit");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Saldo ");

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(13);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(40);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getStyle('A6:G6')->getFont()->setBold(true);

					
			$ii = 7;
			$saldo = (isset($datas[0]['saldoawal']))?$datas[0]['saldoawal']:0;
			for( $i = 0 ; $i < count($datas) ; $i++ ){

				if($datas[$i]['flag_debet_credit']=='D'){
					$saldo += $datas[$i]['trx_debet'];
				}
				if($datas[$i]['flag_debet_credit']=='C'){
					$saldo -= $datas[$i]['trx_credit'];
				}

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$this->format_date_detail($datas[$i]['trx_date'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['description']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($datas[$i]['trx_debet'],0,',','.').' ');
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($datas[$i]['trx_credit'],0,',','.').' ');
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($saldo,0,',','.').' ');
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);



				$ii++;
			
			}//END FOR

		



			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_TRANSAKSI_KAS_PERUGAS.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}
	/****************************************************************************************/	
	// END TRANSAKSI KAS PETUGAS
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LAPORAN CASHFLOW TRANSAKSI REMBUG
	/****************************************************************************************/
	function export_cashflow_transaksi_rembug(){
        $branch_code = $this->uri->segment(3);
        $from_trx_date = $this->datepicker_convert(false,$this->uri->segment(4));
        $thru_trx_date = $this->datepicker_convert(false,$this->uri->segment(5));
        $fa_code = $this->uri->segment(6);
        $cm_code = $this->uri->segment(7);
        $branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);

		if ($branch_code !='0000'){
			$cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($branch_code));
		} else {
			$cabang = "SEMUA CABANG";
		}
		
		if($fa_code == '0000'){
			$petugas = 'Semua Petugas';
		} else {
			$data_fa = $this->model_laporan->show_fa_name($fa_code);
			$petugas = $data_fa['fa_name'];
		}

        if($cm_code == '0000'){
            $rembug = 'SEMUA REMBUG';
        }else{
            $data_cm = $this->model_cif->get_cm_by_cm_code($cm_code);
            $rembug = $data_cm['cm_name'];
        }

        $datas = $this->model_laporan->export_cashflow_transaksi_rembug($branch_code,$cm_code,$fa_code,$from_trx_date,$thru_trx_date);
		$datadropingbyproduk = $this->model_laporan->export_rekap_pencairan_pembiayaan_by_produk($branch_code,$fa_code,$from_trx_date,$thru_trx_date,$cm_code);
		$datadropingbyperuntukan = $this->model_laporan->export_rekap_pencairan_pembiayaan_by_peruntukan($branch_code,$fa_code,$from_trx_date,$thru_trx_date,$cm_code);
        $datadropingbysektor = $this->model_laporan->export_rekap_pencairan_pembiayaan_by_sektor($branch_code,$fa_code,$from_trx_date,$thru_trx_date,$cm_code);
		
        if(count($datas)==0){
            echo '<script>alert("Data Tidak ditemukan");</script>';
            echo '<script>window.close();</script>';
            die();
        }
		
		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									->setLastModifiedBy("MICROFINANCE")
									->setTitle("Office 2007 XLSX Test Document")
									->setSubject("Office 2007 XLSX Test Document")
									->setDescription("REPORT, generated using PHP classes.")
									->setKeywords("REPORT")
									->setCategory("Test result file");
		$objPHPExcel->setActiveSheetIndex(0);

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:J1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(20);
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('A2:J2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',strtoupper($cabang));
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(20);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('A3:J3');
		$objPHPExcel->getActiveSheet()->setCellValue('A3','Laporan Cashflow Transaksi Majelis');
		$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setSize(16);
		$objPHPExcel->getActiveSheet()->getStyle('A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->setCellValue('A5','Majelis');
		$objPHPExcel->getActiveSheet()->setCellValue('A6','Petugas');
		$objPHPExcel->getActiveSheet()->setCellValue('A7','Tanggal');
		
		$objPHPExcel->getActiveSheet()->mergeCells('B5:D5');
		$objPHPExcel->getActiveSheet()->setCellValue('B5',': '.strtoupper($rembug));

		$objPHPExcel->getActiveSheet()->mergeCells('B6:D6');
		$objPHPExcel->getActiveSheet()->setCellValue('B6',': '.strtoupper($petugas));

		$objPHPExcel->getActiveSheet()->mergeCells('B7:D7');
		$objPHPExcel->getActiveSheet()->setCellValue('B7',': '.$this->format_date_detail($from_trx_date,'id',false,'-').' s/d '.$this->format_date_detail($thru_trx_date,'id',false,'-'));
		
		$objPHPExcel->getActiveSheet()->mergeCells('C9:H9');
		$objPHPExcel->getActiveSheet()->getStyle('C9:H9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C9:H9')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C9','Cash In');
		
		$objPHPExcel->getActiveSheet()->mergeCells('C10:E10');
		$objPHPExcel->getActiveSheet()->getStyle('C10:E10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C10','Angs Pokok');
		$objPHPExcel->getActiveSheet()->mergeCells('F10:H10');
		$objPHPExcel->getActiveSheet()->getStyle('F10:H10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F10',$datas['angsuran_pokok']);

		$objPHPExcel->getActiveSheet()->mergeCells('C11:E11');
		$objPHPExcel->getActiveSheet()->getStyle('C11:E11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C11','Angs Margin');
		$objPHPExcel->getActiveSheet()->mergeCells('F11:H11');
		$objPHPExcel->getActiveSheet()->getStyle('F11:H11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F11',$datas['angsuran_margin']);

		$objPHPExcel->getActiveSheet()->mergeCells('C12:E12');
		$objPHPExcel->getActiveSheet()->getStyle('C12:E12')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C12','Angs Catab');
		$objPHPExcel->getActiveSheet()->mergeCells('F12:H12');
		$objPHPExcel->getActiveSheet()->getStyle('F12:H12')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F12',$datas['angsuran_catab']);

		$objPHPExcel->getActiveSheet()->mergeCells('C13:E13');
		$objPHPExcel->getActiveSheet()->getStyle('C13:E13')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C13','Tab Wajib');
		$objPHPExcel->getActiveSheet()->mergeCells('F13:H13');
		$objPHPExcel->getActiveSheet()->getStyle('F13:H13')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F13',$datas['tab_wajib_cr']);

		$objPHPExcel->getActiveSheet()->mergeCells('C14:E14');
		$objPHPExcel->getActiveSheet()->getStyle('C14:E14')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C14','Tab Kelompok');
		$objPHPExcel->getActiveSheet()->mergeCells('F14:H14');
		$objPHPExcel->getActiveSheet()->getStyle('F14:H14')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F14',$datas['tab_kelompok_cr']);

		$objPHPExcel->getActiveSheet()->mergeCells('C15:E15');
		$objPHPExcel->getActiveSheet()->getStyle('C15:E15')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C15','Tab Sukarela');
		$objPHPExcel->getActiveSheet()->mergeCells('F15:H15');
		$objPHPExcel->getActiveSheet()->getStyle('F15:H15')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F15',$datas['tab_sukarela_cr']);

		$objPHPExcel->getActiveSheet()->mergeCells('C16:E16');
		$objPHPExcel->getActiveSheet()->getStyle('C16:E16')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C16','Infaq');
		$objPHPExcel->getActiveSheet()->mergeCells('F16:H16');
		$objPHPExcel->getActiveSheet()->getStyle('F16:H16')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F16',$datas['infaq_kelompok']);

		$objPHPExcel->getActiveSheet()->mergeCells('C17:E17');
		$objPHPExcel->getActiveSheet()->getStyle('C17:E17')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C17','Administrasi');
		$objPHPExcel->getActiveSheet()->mergeCells('F17:H17');
		$objPHPExcel->getActiveSheet()->getStyle('F17:H17')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F17',$datas['administrasi']);

		$objPHPExcel->getActiveSheet()->mergeCells('C18:E18');
		$objPHPExcel->getActiveSheet()->getStyle('C18:E18')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C18','Asuransi');
		$objPHPExcel->getActiveSheet()->mergeCells('F18:H18');
		$objPHPExcel->getActiveSheet()->getStyle('F18:H18')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F18',$datas['asuransi']);

		$objPHPExcel->getActiveSheet()->mergeCells('C19:E19');
		$objPHPExcel->getActiveSheet()->getStyle('C19:E19')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C19:H19')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C19','Total Cash In');
		$objPHPExcel->getActiveSheet()->mergeCells('F19:H19');
		$objPHPExcel->getActiveSheet()->getStyle('F19:H19')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F19:H19')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('F19',$datas['cash_in']);

		$objPHPExcel->getActiveSheet()->mergeCells('C21:H21');
		$objPHPExcel->getActiveSheet()->getStyle('C21:H21')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C21:H21')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C21','Cash Out');

		$objPHPExcel->getActiveSheet()->mergeCells('C22:E22');
		$objPHPExcel->getActiveSheet()->getStyle('C22:E22')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C22','Tab Kelompok');
		$objPHPExcel->getActiveSheet()->mergeCells('F22:H22');
		$objPHPExcel->getActiveSheet()->getStyle('F22:H22')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F22',$datas['tab_kelompok_db']);

		$objPHPExcel->getActiveSheet()->mergeCells('C23:E23');
		$objPHPExcel->getActiveSheet()->getStyle('C23:E23')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C23','Tab Wajib');
		$objPHPExcel->getActiveSheet()->mergeCells('F23:H23');
		$objPHPExcel->getActiveSheet()->getStyle('F23:H23')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F23',$datas['tab_wajib_db']);

		$objPHPExcel->getActiveSheet()->mergeCells('C24:E24');
		$objPHPExcel->getActiveSheet()->getStyle('C24:E24')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C24','Catab');
		$objPHPExcel->getActiveSheet()->mergeCells('F24:H24');
		$objPHPExcel->getActiveSheet()->getStyle('F24:H24')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F24',$datas['saldo_catab']);

		$objPHPExcel->getActiveSheet()->mergeCells('C25:E25');
		$objPHPExcel->getActiveSheet()->getStyle('C25:E25')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C25','Tab Sukarela');
		$objPHPExcel->getActiveSheet()->mergeCells('F25:H25');
		$objPHPExcel->getActiveSheet()->getStyle('F25:H25')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F25',$datas['tab_sukarela']);

		$objPHPExcel->getActiveSheet()->mergeCells('C26:E26');
		$objPHPExcel->getActiveSheet()->getStyle('C26:E26')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('C26','Droping');
		$objPHPExcel->getActiveSheet()->mergeCells('F26:H26');
		$objPHPExcel->getActiveSheet()->getStyle('F26:H26')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->setCellValue('F26',$datas['droping']);

		$objPHPExcel->getActiveSheet()->mergeCells('C27:E27');
		$objPHPExcel->getActiveSheet()->getStyle('C27:E27')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C27:E27')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C27','Total Cash Out');
		$objPHPExcel->getActiveSheet()->mergeCells('F27:H27');
		$objPHPExcel->getActiveSheet()->getStyle('F27:H27')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F27:H27')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('F27',$datas['cash_out']);

		$objPHPExcel->getActiveSheet()->mergeCells('C29:H29');
		$objPHPExcel->getActiveSheet()->getStyle('C29:H29')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C29:H29')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C29','Droping by Produk');

		$idp = 30;
		$total_drop_byproduk = 0;
		for($i = 0; $i < count($datadropingbyproduk); $i++){
			$total_drop_byproduk +=$datadropingbyproduk[$i]['amount'];

			$objPHPExcel->getActiveSheet()->mergeCells('C'.$idp.':E'.$idp);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$idp.':E'.$idp)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$idp.':E'.$idp);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$idp,$datadropingbyproduk[$i]['product_name']);

			$objPHPExcel->getActiveSheet()->mergeCells('F'.$idp.':H'.$idp);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$idp.':H'.$idp)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$idp.':H'.$idp);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$idp,$datadropingbyproduk[$i]['amount']);
			
			$idp++;
		}

		$objPHPExcel->getActiveSheet()->mergeCells('C'.$idp.':E'.$idp);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$idp.':E'.$idp)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$idp.':E'.$idp)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$idp,'Total Droping');

		$objPHPExcel->getActiveSheet()->mergeCells('F'.$idp.':H'.$idp);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$idp.':H'.$idp)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$idp.':H'.$idp)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('F'.$idp,$total_drop_byproduk);
		
		$ipr = $idp + 2;
		
		$objPHPExcel->getActiveSheet()->mergeCells('C'.$ipr.':H'.$ipr);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$ipr.':H'.$ipr)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$ipr.':H'.$ipr)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ipr,'Droping by Peruntukan');
		
		$nipr = $ipr + 1;
		$total_drop_byperuntukan = 0;
		for($i = 0; $i < count($datadropingbyperuntukan); $i++){
			$total_drop_byperuntukan +=$datadropingbyperuntukan[$i]['amount'];

			$objPHPExcel->getActiveSheet()->mergeCells('C'.$nipr.':E'.$nipr);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$nipr.':E'.$nipr)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$nipr.':E'.$nipr);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$nipr,$datadropingbyperuntukan[$i]['tujuan_pembiayaan']);

			$objPHPExcel->getActiveSheet()->mergeCells('F'.$nipr.':H'.$nipr);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$nipr.':H'.$nipr)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$nipr.':H'.$nipr);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$nipr,$datadropingbyperuntukan[$i]['amount']);
			
			$nipr++;
		}

		$objPHPExcel->getActiveSheet()->mergeCells('C'.$nipr.':E'.$nipr);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$nipr.':E'.$nipr)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$nipr.':E'.$nipr)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$nipr,'Total Droping');

		$objPHPExcel->getActiveSheet()->mergeCells('F'.$nipr.':H'.$nipr);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$nipr.':H'.$nipr)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$nipr.':H'.$nipr)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('F'.$nipr,$total_drop_byperuntukan);

		$isu = $nipr + 2;
		
		$objPHPExcel->getActiveSheet()->mergeCells('C'.$isu.':H'.$isu);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$isu.':H'.$isu)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$isu.':H'.$isu)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$isu,'Droping by Sektor Usaha');

		$nisu = $isu + 1;
		$total_drop_bysektor = 0;
		for($i = 0; $i < count($datadropingbysektor); $i++){
			$total_drop_bysektor +=$datadropingbysektor[$i]['amount'];

			$objPHPExcel->getActiveSheet()->mergeCells('C'.$nisu.':E'.$nisu);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$nisu.':E'.$nisu)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$nisu.':E'.$nisu);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$nisu,$datadropingbysektor[$i]['sektor_usaha']);

			$objPHPExcel->getActiveSheet()->mergeCells('F'.$nisu.':H'.$nisu);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$nisu.':H'.$nisu)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$nisu.':H'.$nisu);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$nisu,$datadropingbysektor[$i]['amount']);
			
			$nisu++;
		}

		$objPHPExcel->getActiveSheet()->mergeCells('C'.$nisu.':E'.$nisu);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$nisu.':E'.$nisu)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$nisu.':E'.$nisu)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$nisu,'Total Droping');

		$objPHPExcel->getActiveSheet()->mergeCells('F'.$nisu.':H'.$nisu);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$nisu.':H'.$nisu)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$nisu.':H'.$nisu)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('F'.$nisu,$total_drop_bysektor);

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_CASHFLOW_TRANSAKSI_REMBUG_'.$cabang.'_'.$from_trx_date.'_'.$thru_trx_date.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');
	}
	/****************************************************************************************/	
	// END LAPORAN CASHFLOW TRANSAKSI REMBUG
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LAPORAN DROPING PEMBIAYAAN
	/****************************************************************************************/
	function export_lap_droping_pembiayaan(){
        $from = $this->uri->segment(3);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(4);
        $thru = $this->datepicker_convert(true,$thru,'/');
        $cabang = $this->uri->segment(5);
        $majelis = $this->uri->segment(6);
        $pembiayaan = $this->uri->segment(7);
        $petugas = $this->uri->segment(8);
        $peruntukan = $this->uri->segment(9);
        $sektor = $this->uri->segment(10);
        $produk = $this->uri->segment(11);

        if($pembiayaan == 1){
            $jenis = 'Individu';
            $jenis2 = strtoupper($jenis);
            $majelis = '00000';
            $petugas = '00000';
        } else if($pembiayaan == 0) {
            $jenis = 'Kelompok';
            $jenis2 = strtoupper($jenis);
        } else {
            $jenis = 'Semua';
            $jenis2 = strtoupper($jenis);
        }

        if($petugas == '00000'){
            $fa = 'SEMUA PETUGAS';
        } else {
            $getPetugas = $this->model_cif->get_fa_by_fa_code($petugas);
            $fa = $getPetugas['fa_name'];
        }

		$datas = $this->model_laporan_to_pdf->export_lap_droping_pembiayaan($cabang,$majelis,$from,$thru,$pembiayaan,$petugas,$peruntukan,$sektor,$produk);

        if($cabang != '00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }

		// ----------------------------------------------------------
		// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
								 ->setLastModifiedBy("MICROFINANCE")
								 ->setTitle("Office 2007 XLSX Test Document")
								 ->setSubject("Office 2007 XLSX Test Document")
								 ->setDescription("REPORT, generated using PHP classes.")
								 ->setKeywords("REPORT")
								 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
			'borders' => array(
		         'outline' => array(
		                'style' => PHPExcel_Style_Border::BORDER_THIN,
		                'color' => array('rgb' => '000000'),
		         ),
		   ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('B2:R2');
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('B2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B3:Q3');
		$objPHPExcel->getActiveSheet()->setCellValue('B3',$data_cabang);
		$objPHPExcel->getActiveSheet()->getStyle('B3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B4:Q4');
		$objPHPExcel->getActiveSheet()->setCellValue('B4','LAPORAN PENCAIRAN PEMBIAYAAN');
		$objPHPExcel->getActiveSheet()->getStyle('B4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('B5:Q5');
		$objPHPExcel->getActiveSheet()->setCellValue('B5','TANGGAL : '.$this->format_date_detail($from,'id',false,'/').' s.d '.$this->format_date_detail($thru,'id',false,'/'));
		$objPHPExcel->getActiveSheet()->getStyle('B5')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B6:Q6');
		$objPHPExcel->getActiveSheet()->setCellValue('B6','PETUGAS : '.$fa);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B7:B8');
		$objPHPExcel->getActiveSheet()->setCellValue('B7','No');

		$objPHPExcel->getActiveSheet()->mergeCells('C7:C8');
		$objPHPExcel->getActiveSheet()->setCellValue('C7','Tanggal');

		$objPHPExcel->getActiveSheet()->mergeCells('D7:E7');
		$objPHPExcel->getActiveSheet()->setCellValue('D7','Anggota');
		$objPHPExcel->getActiveSheet()->setCellValue('D8','Rekening');
		$objPHPExcel->getActiveSheet()->setCellValue('E8','Nama');

		$objPHPExcel->getActiveSheet()->mergeCells('F7:F8');
		$objPHPExcel->getActiveSheet()->setCellValue('F7','Pembiayaan');

		$objPHPExcel->getActiveSheet()->mergeCells('G7:G8');
		$objPHPExcel->getActiveSheet()->setCellValue('G7','Mejelis');

		$objPHPExcel->getActiveSheet()->mergeCells('H7:H8');
		$objPHPExcel->getActiveSheet()->setCellValue('H7','PYD');

		$objPHPExcel->getActiveSheet()->mergeCells('I7:I8');
		$objPHPExcel->getActiveSheet()->setCellValue('I7','Produk');

		$objPHPExcel->getActiveSheet()->mergeCells('J7:J8');
		$objPHPExcel->getActiveSheet()->setCellValue('J7','Plafon');

		$objPHPExcel->getActiveSheet()->mergeCells('K7:K8');
		$objPHPExcel->getActiveSheet()->setCellValue('K7','Margin');

		$objPHPExcel->getActiveSheet()->mergeCells('L7:L8');
		$objPHPExcel->getActiveSheet()->setCellValue('L7','Margin');

		$objPHPExcel->getActiveSheet()->mergeCells('L7:L8');
		$objPHPExcel->getActiveSheet()->setCellValue('L7','Periode');

		$objPHPExcel->getActiveSheet()->mergeCells('M7:M8');
		$objPHPExcel->getActiveSheet()->setCellValue('M7','Jangka Waktu');

		$objPHPExcel->getActiveSheet()->mergeCells('N7:N8');
		$objPHPExcel->getActiveSheet()->setCellValue('N7','Plafon Sebelumnya');

		$objPHPExcel->getActiveSheet()->mergeCells('O7:O8');
		$objPHPExcel->getActiveSheet()->setCellValue('O7','Keterangan');

		$objPHPExcel->getActiveSheet()->mergeCells('P7:P8');
		$objPHPExcel->getActiveSheet()->setCellValue('P7','Pengguna Dana');

		$objPHPExcel->getActiveSheet()->mergeCells('Q7:Q8');
		$objPHPExcel->getActiveSheet()->setCellValue('Q7','Peruntukan');

		$objPHPExcel->getActiveSheet()->mergeCells('R7:R8');
		$objPHPExcel->getActiveSheet()->setCellValue('R7','Sektor');

		$objPHPExcel->getActiveSheet()->getStyle('B2:B8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B2:B8')->getFont()->setSize(13);
		$objPHPExcel->getActiveSheet()->getStyle('B7:R8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B7:R8')->getFont()->setSize(11);
		$objPHPExcel->getActiveSheet()->getStyle('B7:R7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B7:R7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B8:R8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B8:R8')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B7:B8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7:C8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7:E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7:F8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7:G8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7:H8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7:I8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7:J8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7:K8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L7:L8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M7:M8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N7:N8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O7:O8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P7:P8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q7:Q8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R7:R8')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(8);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(80);
		$objPHPExcel->getActiveSheet()->getColumnDimension('Q')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('R')->setWidth(20);
				
		$ii = 9;
		$row_total = count($datas)+9;

	    $total_pokok = 0;
		$total_margin = 0;
		$total_pokok_persen = 0;

		for($i = 0; $i < count($datas); $i++){
			$result = $datas[$i];

			$pokok = $result['pokok'];
			$margin = $result['margin'];
			$periode = $result['periode_jangka_waktu'];
			$pyd = $result['pembiayaan_ke'];
			$s_pokok = $result['pokok_sebelum'];
			$pembiayaan = $result['financing_type'];
			$droping_date = $result['droping_date'];
			$rekening = $result['account_financing_no'];
			$nama = $result['nama'];
			$majelis = $result['cm_name'];
			$nick = $result['nick_name'];
			$jangka_waktu = $result['jangka_waktu'];
			$dtp = $result['dtp'];
			$dts = $result['dts'];
			$description = $result['description'];
			$pengguna_dana = $result['pengguna_dana'];

			$total_pokok += $pokok;
	        $total_margin += $margin;

	        $total_pokok_persen += 0.05 * $pokok;

			if($periode == 0){
				$periode_jangka_waktu = 'Harian';
	        } else if($periode == 1){
				$periode_jangka_waktu = 'Mingguan';
	        } else if($periode == 2){
				$periode_jangka_waktu = 'Bulanan';
	        } else{
				$periode_jangka_waktu = 'Jatuh Tempo';
	        }

			if($pyd == 1){
				$keterangan = 'Droping Baru';
	        } else if($pokok == $s_pokok){
				$keterangan = 'Droping Tetap';
			} else if($pokok > $s_pokok){
				$keterangan = 'Droping Naik';
			} else {
				$keterangan = 'Droping Turun';
			}
			
			if($pembiayaan == 0){
				$jenis = 'Kelompok';
			} else {
				$jenis = 'Individu';
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,($i+1));
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$this->format_date_detail($droping_date,'id',false,'/'));
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,"'".$rekening);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$nama);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$jenis);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$majelis);
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$pyd);
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$nick);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$pokok);
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,$margin);
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,$periode_jangka_waktu);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,$jangka_waktu);
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,$s_pokok);
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,$keterangan);
			$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii,$pengguna_dana);
			$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii,$dtp.' - '.$description);
			$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii,$dts);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':M'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$ii++;
		}

		$objPHPExcel->getActiveSheet()->getStyle('J'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$objPHPExcel->getActiveSheet()->getStyle('K'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		$objPHPExcel->getActiveSheet()->getStyle('J'.$row_total)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K'.$row_total)->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getStyle('J'.$row_total.':K'.$row_total)->getFont()->setBold(true);

		$objPHPExcel->getActiveSheet()->setCellValue('J'.$row_total," ".$total_pokok);
		$objPHPExcel->getActiveSheet()->setCellValue('K'.$row_total," ".$total_margin);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN PENCAIRAN PEMBIAYAAN ('.$jenis2.') '.$from.' - '.$thru.' '.$data_cabang.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN DROPING PEMBIAYAAN
	/****************************************************************************************/


	/****************************************************************************************/	
	// BEGIN LIST PENGAJUAN PEMBIAYAAN
	/****************************************************************************************/
	function export_list_pengajuan_pembiayaan(){
        $from = $this->uri->segment(3);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(4);
        $thru = $this->datepicker_convert(true,$thru,'/');
        $cabang = $this->uri->segment(5);
        $majelis = $this->uri->segment(6);
        $pembiayaan = $this->uri->segment(7);
        $petugas = $this->uri->segment(8);

        if($pembiayaan == 1){
            $jenis = 'Individu';
            $jenis2 = strtoupper($jenis);
            $majelis = '00000';
            $petugas = '00000';
        } else if($pembiayaan == 0) {
            $jenis = 'Kelompok';
            $jenis2 = strtoupper($jenis);
        } else {
            $jenis = 'Semua';
            $jenis2 = strtoupper($jenis);
        }

        if($petugas == '00000'){
            $fa = 'SEMUA PETUGAS';
        } else {
            $getPetugas = $this->model_cif->get_fa_by_fa_code($petugas);
            $fa = $getPetugas['fa_name'];
        }

        $datas = $this->model_laporan_to_pdf->export_list_pengajuan_pembiayaan($cabang,$from,$thru,$majelis,$pembiayaan,$petugas);

        if($cabang !='00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }
				
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('B2:J2');
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('B2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B3:J3');
		$objPHPExcel->getActiveSheet()->setCellValue('B3',$data_cabang);
		$objPHPExcel->getActiveSheet()->getStyle('B3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('B4:J4');
		$objPHPExcel->getActiveSheet()->setCellValue('B4','LAPORAN PENGAJUAN PEMBIAYAAN');
		$objPHPExcel->getActiveSheet()->getStyle('B4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('B5:J5');
		$objPHPExcel->getActiveSheet()->setCellValue('B5','TANGGAL : '.$this->format_date_detail($from,'id',false,'/').' s.d '.$this->format_date_detail($thru,'id',false,'/'));
		$objPHPExcel->getActiveSheet()->getStyle('B5')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B6:J6');
		$objPHPExcel->getActiveSheet()->setCellValue('B6','PETUGAS : '.$fa);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B7:B8');
		$objPHPExcel->getActiveSheet()->setCellValue('B7','No');
		$objPHPExcel->getActiveSheet()->mergeCells('C7:C8');
		$objPHPExcel->getActiveSheet()->setCellValue('C7','No Registrasi');

		$objPHPExcel->getActiveSheet()->mergeCells('D7:E7');
		$objPHPExcel->getActiveSheet()->setCellValue('D7','Anggota');
		$objPHPExcel->getActiveSheet()->setCellValue('D8','Nama');
		$objPHPExcel->getActiveSheet()->setCellValue('E8','Majelis');

		$objPHPExcel->getActiveSheet()->mergeCells('F7:F8');
		$objPHPExcel->getActiveSheet()->setCellValue('F7','Pembiayaan');

		$objPHPExcel->getActiveSheet()->mergeCells('G7:H7');
		$objPHPExcel->getActiveSheet()->setCellValue('G7','Tanggal');
		$objPHPExcel->getActiveSheet()->setCellValue('G8','Pengajuan');
		$objPHPExcel->getActiveSheet()->setCellValue('H8','Rencana Cair');

		$objPHPExcel->getActiveSheet()->mergeCells('I7:I8');
		$objPHPExcel->getActiveSheet()->setCellValue('I7','Jumlah');

		$objPHPExcel->getActiveSheet()->mergeCells('J7:J8');
		$objPHPExcel->getActiveSheet()->setCellValue('J7','Status');

		$objPHPExcel->getActiveSheet()->getStyle('B7:J7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B7:J7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B8:J8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B8:J8')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B7:B8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7:C8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7:E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7:C8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7:F8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7:H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7:I8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7:J8')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getFont()->setSize(12);

		$objPHPExcel->getActiveSheet()->getStyle('B7:J8')->getFont()->setBold(true);

		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);

		$ii = 9;
		$row_total = count($datas) + 9;
        $total_amount = 0;

        for($i = 0; $i < count($datas); $i++){
        	$amount = $datas[$i]['amount'];
        	$stat = $datas[$i]['status'];
        	$financing = $datas[$i]['financing_type'];
        	$registration_no = $datas[$i]['registration_no'];
        	$nama = $datas[$i]['nama'];
        	$cm_name = $datas[$i]['cm_name'];

        	$tanggal_pengajuan = $datas[$i]['tanggal_pengajuan'];
        	$tanggal_pengajuan = $this->format_date_detail($tanggal_pengajuan,'id',false,'/');

        	$rencana_droping = $datas[$i]['rencana_droping'];
        	$rencana_droping = $this->format_date_detail($rencana_droping,'id',false,'/');

        	$total_amount += $amount;

		    if($stat == 0){
		    	$status = 'Registrasi';
		    } else if($stat == 1){
		    	$status = 'Aktivasi';
		    } else if($stat == 2){
		    	$status = 'Ditolak';
		    } else if($stat == 3){
		    	$status = 'Batal';
		    }

		    if($financing == 0){
		    	$jenis = 'Kelompok';
		    } else {
		    	$jenis = 'Individu';
		    }

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,($i+1));
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$registration_no);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$nama);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$cm_name);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$jenis);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$tanggal_pengajuan);
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$rencana_droping);
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$amount);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$status);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':J'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':L'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

			$ii++;
			
		}

		$objPHPExcel->getActiveSheet()->getStyle('B'.$row_total.':J'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$objPHPExcel->getActiveSheet()->getStyle('B'.$row_total.':J'.$row_total)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('I'.$row_total)->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getStyle('I'.$row_total)->getFont()->setBold(true);

		$objPHPExcel->getActiveSheet()->setCellValue('I'.$row_total,$total_amount);

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN PENGAJUAN PEMBIAYAAN ('.$jenis2.') '.$data_cabang.' '.$from.' - '.$thru.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');
	}
	/****************************************************************************************/	
	// END LAPORAN PENGAJUAN PEMBIAYAAN
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LAPORAN AGING
	/****************************************************************************************/
	public function export_lap_aging()
	{

		$branch_id = $this->uri->segment(3);
		$date = $this->uri->segment(4);
		$kol = $this->uri->segment(5);
		$kol = urldecode($kol);
		$desc_date = substr($date,0,2).'/'.substr($date,2,2).'/'.substr($date,4,4);
		$date = substr($date,4,4).'-'.substr($date,2,2).'-'.substr($date,0,2);
		if($branch_id=="00000"){
			$branch_id = '';
		}
		$branch_data = $this->model_cif->get_branch_by_branch_id($branch_id);
		$branch_code = $branch_data['branch_code'];
		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		/*set header*/
		$sheet = $objPHPExcel->getActiveSheet();
		$sheet->mergeCells('A1:Q1');
		$sheet->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$sheet->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('A2:Q2');
		$sheet->setCellValue('A2',$branch_data['branch_name']);
		$sheet->getStyle('A2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$sheet->mergeCells('A3:Q3');
		$sheet->setCellValue('A3',"Laporan Portofolio At Risk");
		$sheet->getStyle('A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('A4:Q4');
		$sheet->setCellValue('A4',"Tanggal ".$desc_date);
		$sheet->getStyle('A4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->getStyle('A1:A3')->getFont()->setBold(true);
		$sheet->getStyle('A1:A3')->getFont()->setSize(14);
		$sheet->getStyle('A4')->getFont()->setBold(true);
		$sheet->getStyle('A4')->getFont()->setSize(12);

		/* margined cell of header title */
		$sheet->mergeCells('A6:A7');
		$sheet->setCellValue('A6',"NO");
		$sheet->mergeCells('B6:D6');
		$sheet->setCellValue('B6',"ANGGOTA");
		$sheet->mergeCells('E6:I6');
		$sheet->setCellValue('E6',"PENCAIRAN");
		$sheet->mergeCells('J6:M6');
		$sheet->setCellValue('J6',"ANGSURAN");
		$sheet->mergeCells('N6:O6');
		$sheet->setCellValue('N6',"OUTSTANDING");
		$sheet->mergeCells('P6:S6');
		$sheet->setCellValue('P6',"TUNGGAKKAN");
		$sheet->mergeCells('T6:T7');
		$sheet->setCellValue('T6',"PAR");
		$sheet->mergeCells('U6:V6');
		$sheet->setCellValue('U6',"CPP");

		/* unmargined cell of header title */
		$sheet->setCellValue('B7',"No. Rekening");
		$sheet->setCellValue('C7',"Rembug");
		$sheet->setCellValue('D7',"Nama");
		$sheet->setCellValue('E7',"Pokok");
		$sheet->setCellValue('F7',"Margin");
		$sheet->setCellValue('G7',"Jangka Waktu");
		$sheet->setCellValue('H7',"Tanggal");
		$sheet->setCellValue('I7',"Mulai Angsur");
		$sheet->setCellValue('J7',"Pokok");
		$sheet->setCellValue('K7',"Margin");
		$sheet->setCellValue('L7',"Terbayar");
		$sheet->setCellValue('M7',"Seharusnya");
		$sheet->setCellValue('N7',"Pokok");
		$sheet->setCellValue('O7',"Margin");
		$sheet->setCellValue('P7',"Hari");
		$sheet->setCellValue('Q7',"Jml");
		$sheet->setCellValue('R7',"Pokok");
		$sheet->setCellValue('S7',"Margin");
		$sheet->setCellValue('U7',"%");
		$sheet->setCellValue('V7',"Nominal");
		
		$sheet->getStyle('A6:V7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('A6:V7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$sheet->getStyle('A6:V7')->getFont()->setBold(true);
		$sheet->getStyle('A6:V7')->getFont()->setSize(10);
		
		/* set border header title */

		$sheet->getColumnDimension('A')->setWidth(4);
		$sheet->getColumnDimension('B')->setWidth(20);
		$sheet->getColumnDimension('C')->setWidth(16);
		$sheet->getColumnDimension('D')->setWidth(20);
		$sheet->getColumnDimension('E')->setWidth(13);
		$sheet->getColumnDimension('F')->setWidth(13);
		$sheet->getColumnDimension('G')->setWidth(13);
		$sheet->getColumnDimension('H')->setWidth(13);
		$sheet->getColumnDimension('I')->setWidth(13);
		$sheet->getColumnDimension('J')->setWidth(13);
		$sheet->getColumnDimension('K')->setWidth(13);
		$sheet->getColumnDimension('L')->setWidth(13);
		$sheet->getColumnDimension('M')->setWidth(13);
		$sheet->getColumnDimension('N')->setWidth(13);
		$sheet->getColumnDimension('O')->setWidth(13);
		$sheet->getColumnDimension('P')->setWidth(8);
		$sheet->getColumnDimension('Q')->setWidth(5);
		$sheet->getColumnDimension('R')->setWidth(13);
		$sheet->getColumnDimension('S')->setWidth(13);
		$sheet->getColumnDimension('T')->setWidth(4);
		$sheet->getColumnDimension('U')->setWidth(13);
		$sheet->getColumnDimension('V')->setWidth(13);

		/**
		* [BEGIN] INSERT DATA TO CELL
		*/

		$data = $this->model_laporan_to_pdf->get_laporan_par_terhitung($date,$branch_code,$kol);
		$no = 0;
		$row = 7;

		/* declare total */
		$total_pokok=0;
		$total_margin=0;
		$total_saldo_pokok=0;
		$total_saldo_margin=0;
		$total_tunggakan_pokok=0;
		$total_tunggakan_margin=0;
		$total_cadangan_piutang=0;

		for ( $i = 0 ; $i < count($data) ; $i++ )
		{
			$result = $data[$i];
			$no++;
			$row++;

			/* akumulasi total */
			$total_pokok+=$result['pokok'];
			$total_margin+=$result['margin'];
			$total_saldo_pokok+=$result['saldo_pokok'];
			$total_saldo_margin+=$result['saldo_margin'];
			$total_tunggakan_pokok+=$result['tunggakan_pokok'];
			$total_tunggakan_margin+=$result['tunggakan_margin'];
			$total_cadangan_piutang+=$result['cadangan_piutang'];

			/* set row value */
			$sheet->setCellValue('A'.$row,$no);
			$sheet->setCellValue('B'.$row,$result['account_financing_no'].' ');
			$sheet->setCellValue('C'.$row,$result['cm_name']);
			$sheet->setCellValue('D'.$row,$result['nama']);
			$sheet->setCellValue('E'.$row,number_format($result['pokok'],0,',','.').' ');
			$sheet->setCellValue('F'.$row,number_format($result['margin'],0,',','.').' ');
			$sheet->setCellValue('G'.$row,$result['jangka_waktu'].' ');
			$sheet->setCellValue('H'.$row,date('d-m-Y',strtotime($result['droping_date'])));
			$sheet->setCellValue('I'.$row,date('d-m-Y',strtotime($result['tanggal_mulai_angsur'])));
			$sheet->setCellValue('J'.$row,number_format($result['angsuran_pokok'],0,',','.').' ');
			$sheet->setCellValue('K'.$row,number_format($result['angsuran_margin'],0,',','.').' ');
			$sheet->setCellValue('L'.$row,$result['terbayar'].' ');
			$sheet->setCellValue('M'.$row,$result['seharusnya'].' ');
			$sheet->setCellValue('N'.$row,number_format($result['saldo_pokok'],0,',','.').' ');
			$sheet->setCellValue('O'.$row,number_format($result['saldo_margin'],0,',','.').' ');
			$sheet->setCellValue('P'.$row,$result['hari_nunggak']);
			$sheet->setCellValue('Q'.$row,$result['freq_tunggakan']);
			$sheet->setCellValue('R'.$row,number_format($result['tunggakan_pokok'],0,',','.').' ');
			$sheet->setCellValue('S'.$row,number_format($result['tunggakan_margin'],0,',','.').' ');
			$sheet->setCellValue('T'.$row,$result['par_desc']);
			$sheet->setCellValue('U'.$row,$result['par']);
			$sheet->setCellValue('V'.$row,number_format($result['cadangan_piutang'],0,',','.').' ');
			
			/* set align right for currency */
			$sheet->getStyle('E'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('F'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('J'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('K'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('N'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('O'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('R'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('S'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('V'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			/* set align center */
			$sheet->getStyle('A'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('G'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('I'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('L'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('M'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('P'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('Q'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('T'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			/* set font size */
			$sheet->getStyle('A'.$row.':V'.$row)->getFont()->setSize(10);

			/* set border */
		}

		/**
		* [END] INSERT DATA TO CELL
		*/

		$row++;

		/**
		* [BEGIN] INSERT TOTAL DATA TO CELL
		*/

		/* set row value */
		$sheet->setCellValue('E'.$row,number_format($total_pokok,0,',','.').' ');
		$sheet->setCellValue('F'.$row,number_format($total_margin,0,',','.').' ');
		$sheet->setCellValue('N'.$row,number_format($total_saldo_pokok,0,',','.').' ');
		$sheet->setCellValue('O'.$row,number_format($total_saldo_margin,0,',','.').' ');
		$sheet->setCellValue('R'.$row,number_format($total_tunggakan_pokok,0,',','.').' ');
		$sheet->setCellValue('S'.$row,number_format($total_tunggakan_margin,0,',','.').' ');
		$sheet->setCellValue('V'.$row,number_format($total_cadangan_piutang,0,',','.').' ');
		
		/* set align right for currency */
		$sheet->getStyle('E'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$sheet->getStyle('F'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$sheet->getStyle('N'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$sheet->getStyle('O'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$sheet->getStyle('R'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$sheet->getStyle('S'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$sheet->getStyle('V'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		/* set font size */
		$sheet->getStyle('A'.$row.':V'.$row)->getFont()->setSize(10);

		/* set border */


		/**
		* [END] INSERT TOTAL DATA TO CELL
		*/

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT-AGING.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN AGING
	/****************************************************************************************/


	/****************************************************************************************/	
	// BEGIN LIST SALDO TABUNGAN (PEMBIAYAAN)
	/****************************************************************************************/

	public function export_list_saldo_tabungan()
	{
		$branch_code = $this->uri->segment(3);
		$cm_code = $this->uri->segment(4);
		// $datas = $this->model_laporan_to_pdf->export_transaksi_kas_petugas($tanggal_,$tanggal2_,$account_cash_code);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$sheet = $objPHPExcel->getActiveSheet();
		$sheet->mergeCells('A1:L1');
		$sheet->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$sheet->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('A2:L2');
		$sheet->setCellValue('A2',$this->model_laporan->get_branch_name_by_branch_code($branch_code));
		$sheet->getStyle('A2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$sheet->mergeCells('A3:L3');
		$sheet->setCellValue('A3',"Daftar Saldo Rekening Anggota");
		$sheet->getStyle('A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('A6:B6');
		$sheet->setCellValue('A6',"Anggota");
		$sheet->setCellValue('A7',"ID");
		$sheet->setCellValue('B7',"Nama");

		$sheet->mergeCells('C6:C7');
		$sheet->setCellValue('C6',"Rembug Pusat");

		$sheet->mergeCells('D6:D7');
		$sheet->setCellValue('D6',"Desa");

		$sheet->mergeCells('E6:E7');
		$sheet->setCellValue('E6',"Pembiayaan Pokok");

		$sheet->mergeCells('F6:F7');
		$sheet->setCellValue('F6',"Pembiayaan Margin");

		$sheet->mergeCells('G6:J6');
		$sheet->setCellValue('G6',"Saldo Simpanan");

		$sheet->setCellValue('G7',"LWK");
		$sheet->setCellValue('H7',"Wajib");
		$sheet->setCellValue('I7',"Kelompok");
		$sheet->setCellValue('J7',"Sukarela");

		$sheet->mergeCells('K6:L6');
		$sheet->setCellValue('K6',"Saldo Pembiayaan");

		$sheet->setCellValue('K7',"Pokok");
		$sheet->setCellValue('L7',"Margin");

		$sheet->getStyle('A1:A4')->getFont()->setBold(true);
		$sheet->getStyle('A1:A4')->getFont()->setSize(12);
		$sheet->getStyle('A6:L6')->getFont()->setSize(9);
		$sheet->getStyle('A7:L7')->getFont()->setSize(9);
		$sheet->getStyle('A6:L6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('A6:L6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$sheet->getStyle('A7:L7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('A7:L7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		
		$sheet->getColumnDimension('A')->setWidth(25);
		$sheet->getColumnDimension('B')->setWidth(25);
		$sheet->getColumnDimension('C')->setWidth(25);
		$sheet->getColumnDimension('D')->setWidth(25);
		$sheet->getColumnDimension('E')->setWidth(25);
		$sheet->getColumnDimension('F')->setWidth(25);
		$sheet->getColumnDimension('G')->setWidth(25);
		$sheet->getColumnDimension('H')->setWidth(25);
		$sheet->getColumnDimension('I')->setWidth(25);
		$sheet->getColumnDimension('J')->setWidth(25);
		$sheet->getColumnDimension('K')->setWidth(25);
		$sheet->getColumnDimension('L')->setWidth(25);

		$datas = $this->model_laporan->export_list_saldo_tabungan($branch_code,$cm_code);

		$ii=8;
		$total_pokok = 0;
		$total_margin = 0;
		$total_setoran_lwk = 0;
		$total_simpanan_pokok = 0;
		$total_tabungan_minggon = 0;
		$total_tabungan_sukarela = 0;
		$total_tabungan_kelompok = 0;
		$total_saldo_pokok = 0;
		$total_saldo_margin = 0;
		for ( $i = 0 ; $i < count($datas) ; $i++ )
		{

			if (@$datas[$i]['periode_jangka_waktu']=="0") 
			{
				$periode = "Hari";
			} 
			else if (@$datas[$i]['periode_jangka_waktu']=="1") 
			{
				$periode = "Minggu";
			}
			else if (@$datas[$i]['periode_jangka_waktu']=="2") 
			{
				$periode = "Bulan";
			}
			else if (@$datas[$i]['periode_jangka_waktu']=="3") 
			{
				$periode = "Jatuh Tempo";
			}
			else
			{
				$periode = "";
			}
			$total_pokok += $datas[$i]['pokok'];
			$total_margin += $datas[$i]['margin'];
			$total_setoran_lwk += $datas[$i]['setoran_lwk'];
			$total_simpanan_pokok += $datas[$i]['simpanan_pokok'];
			$total_tabungan_minggon += $datas[$i]['tabungan_minggon'];
			$total_tabungan_sukarela += $datas[$i]['tabungan_sukarela'];
			$total_tabungan_kelompok += $datas[$i]['tabungan_kelompok'];
			$total_saldo_pokok += $datas[$i]['saldo_pokok'];
			$total_saldo_margin += $datas[$i]['saldo_margin'];

			$sheet->setCellValue('A'.$ii,' '.$datas[$i]['cif_no']);
			$sheet->setCellValue('B'.$ii,$datas[$i]['nama']);
			$sheet->setCellValue('C'.$ii,$datas[$i]['cm_name']);
			$sheet->setCellValue('D'.$ii,$datas[$i]['desa']);
			$sheet->setCellValue('E'.$ii,' '.number_format($datas[$i]['pokok'],0,',','.'));
			$sheet->setCellValue('F'.$ii,' '.number_format($datas[$i]['margin'],0,',','.'));
			$sheet->setCellValue('G'.$ii,' '.number_format($datas[$i]['setoran_lwk'],0,',','.'));
			$sheet->setCellValue('H'.$ii,' '.number_format($datas[$i]['tabungan_minggon'],0,',','.'));
			$sheet->setCellValue('I'.$ii,' '.number_format($datas[$i]['tabungan_kelompok'],0,',','.'));
			$sheet->setCellValue('J'.$ii,' '.number_format($datas[$i]['tabungan_sukarela'],0,',','.'));
			$sheet->setCellValue('K'.$ii,' '.number_format($datas[$i]['saldo_pokok'],0,',','.'));
			$sheet->setCellValue('L'.$ii,' '.number_format($datas[$i]['saldo_margin'],0,',','.'));

			$sheet->getStyle('E'.$ii.':L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			
			$sheet->getStyle('E'.$ii.':L'.$ii)->getFont()->setSize(9);

			
			$ii++;
		}

		$sheet->setCellValue('E'.$ii,' '.number_format($total_pokok,0,',','.'));
		$sheet->setCellValue('F'.$ii,' '.number_format($total_margin,0,',','.'));
		$sheet->setCellValue('G'.$ii,' '.number_format($total_setoran_lwk,0,',','.'));
		$sheet->setCellValue('H'.$ii,' '.number_format($total_tabungan_minggon,0,',','.'));
		$sheet->setCellValue('I'.$ii,' '.number_format($total_tabungan_kelompok,0,',','.'));
		$sheet->setCellValue('J'.$ii,' '.number_format($total_tabungan_sukarela,0,',','.'));
		$sheet->setCellValue('K'.$ii,' '.number_format($total_saldo_pokok,0,',','.'));
		$sheet->setCellValue('L'.$ii,' '.number_format($total_saldo_margin,0,',','.'));

		$sheet->getStyle('E'.$ii.':L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		
		$sheet->getStyle('A'.$ii.':L'.$ii)->getFont()->setSize(9);

		$sheet->getStyle('A'.$ii.':L'.$ii)->getFont()->setBold(true);

	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="DAFTAR SALDO REKENING ANGGOTA.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	/****************************************************************************************/	
	// END LIST SALDO TABUNGAN (PEMBIAYAAN)
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LIST SALDO TABUNGAN (PEMBIAYAAN)
	/****************************************************************************************/

	public function export_simpanan_pokok()
	{
		$branch_code = $this->uri->segment(3);
		$cm_code = $this->uri->segment(4);
		// $datas = $this->model_laporan_to_pdf->export_transaksi_kas_petugas($tanggal_,$tanggal2_,$account_cash_code);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$sheet = $objPHPExcel->getActiveSheet();
		$sheet->mergeCells('A1:G1');
		$sheet->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$sheet->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('A2:G2');
		$sheet->setCellValue('A2',$this->model_laporan->get_branch_name_by_branch_code($branch_code));
		$sheet->getStyle('A2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$sheet->mergeCells('A3:G3');
		$sheet->setCellValue('A3',"DAFTAR SIMPANAN POKOK");
		$sheet->getStyle('A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('A6:B6');
		$sheet->setCellValue('A6',"Anggota");
		$sheet->setCellValue('A7',"ID");
		$sheet->setCellValue('B7',"Nama");

		$sheet->mergeCells('C6:C7');
		$sheet->setCellValue('C6',"Rembug Pusat");

		$sheet->mergeCells('D6:D7');
		$sheet->setCellValue('D6',"Tabungan Wajib");

		$sheet->mergeCells('E6:E7');
		$sheet->setCellValue('E6',"Tabungan Kelompok");

		$sheet->mergeCells('F6:F7');
		$sheet->setCellValue('F6',"Simpanan Pokok");

		$sheet->mergeCells('G6:G7');
		$sheet->setCellValue('G6',"SMK");
		
		$sheet->getStyle('A1:G4')->getFont()->setBold(true);
		$sheet->getStyle('A1:G4')->getFont()->setSize(12);
		$sheet->getStyle('A6:G6')->getFont()->setSize(9);
		$sheet->getStyle('A7:G7')->getFont()->setSize(9);
		$sheet->getStyle('A6:G6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('A6:G6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$sheet->getStyle('A7:G7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('A7:G7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		
		$sheet->getColumnDimension('A')->setWidth(10);
		$sheet->getColumnDimension('B')->setWidth(17);
		$sheet->getColumnDimension('C')->setWidth(15);
		$sheet->getColumnDimension('D')->setWidth(15);
		$sheet->getColumnDimension('E')->setWidth(15);
		$sheet->getColumnDimension('F')->setWidth(16);
		$sheet->getColumnDimension('G')->setWidth(16);

		$datas = $this->model_laporan->export_simpanan_pokok($branch_code,$cm_code);

		$ii=8;
		$total_tabungan_wajib = 0;
		$total_tabungan_kelompok = 0;
		$total_simpanan_pokok = 0;
		$total_smk = 0;
		for ( $i = 0 ; $i < count($datas) ; $i++ )
		{

			$total_tabungan_wajib += $datas[$i]['tabungan_wajib'];
	        $total_tabungan_kelompok += $datas[$i]['tabungan_kelompok'];
	        $total_simpanan_pokok += $datas[$i]['simpanan_pokok'];
	        $total_smk += $datas[$i]['smk'];

			$sheet->setCellValue('A'.$ii,' '.$datas[$i]['cif_no']);
			$sheet->setCellValue('B'.$ii,$datas[$i]['nama']);
			$sheet->setCellValue('C'.$ii,$datas[$i]['cm_name']);
			$sheet->setCellValue('D'.$ii,' '.number_format($datas[$i]['tabungan_wajib'],0,',','.'));
			$sheet->setCellValue('E'.$ii,' '.number_format($datas[$i]['tabungan_kelompok'],0,',','.'));
			$sheet->setCellValue('F'.$ii,' '.number_format($datas[$i]['simpanan_pokok'],0,',','.'));
			$sheet->setCellValue('G'.$ii,' '.number_format($datas[$i]['smk'],0,',','.'));

			$sheet->getStyle('D'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			
			$sheet->getStyle('A'.$ii.':O'.$ii)->getFont()->setSize(9);

			
			$ii++;
		}

		$sheet->setCellValue('C'.$ii,'Total :');
		$sheet->setCellValue('D'.$ii,' '.number_format($total_tabungan_wajib,0,',','.'));
		$sheet->setCellValue('E'.$ii,' '.number_format($total_tabungan_kelompok,0,',','.'));
		$sheet->setCellValue('F'.$ii,' '.number_format($total_simpanan_pokok,0,',','.'));
		$sheet->setCellValue('G'.$ii,' '.number_format($total_smk,0,',','.'));

		$sheet->getStyle('D'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		
		$sheet->getStyle('A'.$ii.':O'.$ii)->getFont()->setSize(9);

		$sheet->getStyle('A'.$ii.':O'.$ii)->getFont()->setBold(true);

	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="DAFTAR SIMPANAN POKOK.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	/****************************************************************************************/	
	// END LIST SALDO TABUNGAN (PEMBIAYAAN)
	/****************************************************************************************/
	
	
	


	/****************************************************************************************/	
	// BEGIN LIST OUTSTANDING (PEMBIAYAAN)
	/****************************************************************************************/

	function export_lap_list_outstanding_pembiayaan(){		
        $cabang = $this->uri->segment(3);
        $pembiayaan = $this->uri->segment(4);
        $petugas = $this->uri->segment(5);
        $majelis = $this->uri->segment(6);
        $produk = $this->uri->segment(7);
        $peruntukan = $this->uri->segment(8);
        $sektor = $this->uri->segment(9);
        $tanggal = date('Y-m-d');

        if($pembiayaan == 1){
            $jenis = 'Individu';
            $jenis2 = strtoupper($jenis);
            $majelis = '00000';
            $petugas = '00000';
        } else if($pembiayaan == 0) {
            $jenis = 'Kelompok';
            $jenis2 = strtoupper($jenis);
        } else {
            $jenis = 'Semua';
            $jenis2 = strtoupper($jenis);
        }

        if($petugas == '00000'){
            $fa = 'SEMUA PETUGAS';
        } else {
            $getPetugas = $this->model_cif->get_fa_by_fa_code($petugas);
            $fa = $getPetugas['fa_name'];
        }

		$datas = $this->model_laporan_to_pdf->export_lap_list_outstanding_pembiayaan($cabang,$pembiayaan,$petugas,$majelis,$produk,$peruntukan,$sektor,$tanggal);

        if($cabang != '00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }

		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

        $sheet = $objPHPExcel->getActiveSheet();

		$sheet->mergeCells('B2:Q2');
		$sheet->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));

		$sheet->mergeCells('B3:Q3');
		$sheet->setCellValue('B3',$data_cabang);

		$sheet->mergeCells('B4:Q4');
		$sheet->setCellValue('B4','LAPORAN OUTSTANDING PEMBIAYAAN');
		
		$sheet->mergeCells('B5:Q5');
		$sheet->setCellValue('B5','TANGGAL : '.$this->format_date_detail($tanggal,'id',false,'-'));

		$sheet->mergeCells('B6:Q6');
		$sheet->setCellValue('B6','PETUGAS : '.$fa);

		$sheet->getStyle('B2:B6')->getFont()->setBold(true);
		$sheet->getStyle('B2:B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('B8:B9');
		$sheet->setCellValue('B8','No');

		$sheet->mergeCells('C8:F8');
		$sheet->setCellValue('C8','Anggota');
		$sheet->setCellValue('C9','Rekening');
		$sheet->setCellValue('D9','Nama');
		$sheet->setCellValue('E9','No. KTP');
		$sheet->setCellValue('F9','Jenis');

		$sheet->mergeCells('G8:G9');
		$sheet->setCellValue('G8','Majelis');

		$sheet->mergeCells('H8:H9');
		$sheet->setCellValue('H8','Produk');

		$sheet->mergeCells('I8:I9');
		$sheet->setCellValue('I8','Sektor');

		$sheet->mergeCells('J8:J9');
		$sheet->setCellValue('J8','Peruntukan');

		$sheet->mergeCells('K8:K9');
		$sheet->setCellValue('K8','Droping');
		
		$sheet->mergeCells('L8:L9');
		$sheet->setCellValue('L8','Pokok');

		$sheet->mergeCells('M8:M9');
		$sheet->setCellValue('M8','Margin');

		$sheet->mergeCells('N8:N9');
		$sheet->setCellValue('N8','Bayar');

		$sheet->mergeCells('O8:Q8');
		$sheet->setCellValue('O8','Saldo');
		$sheet->setCellValue('O9','Freq');
		$sheet->setCellValue('P9','Pokok');
		$sheet->setCellValue('Q9','Margin');

		$sheet->getStyle('B8:Q8')->getFont()->setBold(TRUE);
		$sheet->getStyle('B8:Q8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('B8:Q8')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$sheet->getStyle('B9:Q9')->getFont()->setBold(TRUE);
		$sheet->getStyle('B9:Q9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('B9:Q9')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$sheet->getStyle('B8:B9')->applyFromArray($styleArray);
		$sheet->getStyle('C8:F8')->applyFromArray($styleArray);
		$sheet->getStyle('C9')->applyFromArray($styleArray);
		$sheet->getStyle('D9')->applyFromArray($styleArray);
		$sheet->getStyle('E9')->applyFromArray($styleArray);
		$sheet->getStyle('F9')->applyFromArray($styleArray);
		$sheet->getStyle('G8:G9')->applyFromArray($styleArray);
		$sheet->getStyle('H8:H9')->applyFromArray($styleArray);
		$sheet->getStyle('I8:I9')->applyFromArray($styleArray);
		$sheet->getStyle('J8:J9')->applyFromArray($styleArray);
		$sheet->getStyle('K8:K9')->applyFromArray($styleArray);
		$sheet->getStyle('L8:L9')->applyFromArray($styleArray);
		$sheet->getStyle('M8:M9')->applyFromArray($styleArray);
		$sheet->getStyle('N8:N9')->applyFromArray($styleArray);
		$sheet->getStyle('O8:Q8')->applyFromArray($styleArray);
		$sheet->getStyle('O9')->applyFromArray($styleArray);
		$sheet->getStyle('P9')->applyFromArray($styleArray);
		$sheet->getStyle('Q9')->applyFromArray($styleArray);

		$sheet->getColumnDimension('B')->setWidth(10);
		$sheet->getColumnDimension('C')->setWidth(30);
		$sheet->getColumnDimension('D')->setWidth(30);
		$sheet->getColumnDimension('E')->setWidth(25);
		$sheet->getColumnDimension('F')->setWidth(20);
		$sheet->getColumnDimension('G')->setWidth(25);
		$sheet->getColumnDimension('H')->setWidth(15);
		$sheet->getColumnDimension('I')->setWidth(25);
		$sheet->getColumnDimension('J')->setWidth(25);
		$sheet->getColumnDimension('K')->setWidth(20);
		$sheet->getColumnDimension('L')->setWidth(15);
		$sheet->getColumnDimension('M')->setWidth(15);
		$sheet->getColumnDimension('N')->setWidth(15);
		$sheet->getColumnDimension('O')->setWidth(15);
		$sheet->getColumnDimension('P')->setWidth(15);
		$sheet->getColumnDimension('Q')->setWidth(15);

		$ii = 10;
		$total_pokok = 0;
        $total_margin = 0;
        $total_saldo_pokok = 0;
        $total_saldo_margin = 0;
        $total_saldo_catab = 0;

        $row_total = count($datas) + $ii;

		for($i = 0; $i < count($datas); $i++){
			$rekening = $datas[$i]['account_financing_no'];
			$nama = $datas[$i]['nama'];
			$ktp = $datas[$i]['no_ktp'];
			$jenis = $datas[$i]['financing_type'];
			$majelis = $datas[$i]['cm_name'];
			$produk = $datas[$i]['nick_name'];
			$sektor = $datas[$i]['sektor'];
			$peruntukan = $datas[$i]['peruntukan'];
			$droping = $datas[$i]['droping_date'];
			$pokok = $datas[$i]['pokok'];
			$margin = $datas[$i]['margin'];
			$bayar = $datas[$i]['freq_bayar_pokok'];
			$saldo = $datas[$i]['freq_bayar_saldo'];
			$saldo_pokok = $datas[$i]['saldo_pokok'];
			$saldo_margin = $datas[$i]['saldo_margin'];

			$total_pokok += $pokok;
	        $total_margin += $margin;
	        $total_saldo_pokok += $saldo_pokok;
	        $total_saldo_margin += $saldo_margin;

			if($jenis == '0'){
				$pembiayaan = 'Kelompok';
			} else {
				$pembiayaan = 'Individu';
			}

			$sheet->setCellValue('B'.$ii,($i+1));
			$sheet->setCellValue('C'.$ii,"'".$rekening);
			$sheet->setCellValue('D'.$ii,$nama);
			$sheet->setCellValue('E'.$ii,"'".$ktp);
			$sheet->setCellValue('F'.$ii,$pembiayaan);
			$sheet->setCellValue('G'.$ii,$majelis);
			$sheet->setCellValue('H'.$ii,$produk);
			$sheet->setCellValue('I'.$ii,$sektor);
			$sheet->setCellValue('J'.$ii,$peruntukan);
			$sheet->setCellValue('K'.$ii,$droping);
			$sheet->setCellValue('L'.$ii,$pokok);
			$sheet->setCellValue('M'.$ii,$margin);
			$sheet->setCellValue('N'.$ii,$bayar);
			$sheet->setCellValue('O'.$ii,$saldo);
			$sheet->setCellValue('P'.$ii,$saldo_pokok);
			$sheet->setCellValue('Q'.$ii,$saldo_margin);

			$sheet->getStyle('B'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('C'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('D'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('E'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('F'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('G'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('H'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('I'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('J'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('K'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('L'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('M'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('N'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('O'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('P'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('Q'.$ii)->applyFromArray($styleArray);

			$sheet->getStyle('B'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('L'.$ii.':M'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('N'.$ii.':O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$ii++;
		}

		$sheet->getStyle('L'.$row_total.':M'.$row_total)->getFont()->setBold(TRUE);
		$sheet->getStyle('L'.$row_total)->applyFromArray($styleArray);
		$sheet->setCellValue('L'.$row_total,$total_pokok);
		$sheet->setCellValue('M'.$row_total,$total_margin);
		$sheet->getStyle('M'.$row_total)->applyFromArray($styleArray);

		$sheet->getStyle('P'.$row_total.':Q'.$row_total)->getFont()->setBold(TRUE);
		$sheet->getStyle('P'.$row_total)->applyFromArray($styleArray);
		$sheet->setCellValue('P'.$row_total,$total_saldo_pokok);
		$sheet->getStyle('Q'.$row_total)->applyFromArray($styleArray);
		$sheet->setCellValue('Q'.$row_total,$total_saldo_margin);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN OUTSTANDING PEMBIAYAAN ('.$jenis2.') '.$tanggal.' '.$data_cabang.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');
	}

	/****************************************************************************************/	
	// END LIST SALDO TABUNGAN (PEMBIAYAAN)
	/****************************************************************************************/
		
	
	/****************************************************************************************/	
	// BEGIN LIST PREMI ANGGOTA 
	/****************************************************************************************/

	function export_lap_list_premi_anggota(){		
        $cabang = $this->uri->segment(3);
        $rembug = $this->uri->segment(4);
        $product_code = $this->uri->segment(5);
        $financing_type = $this->uri->segment(6);

        if($product_code != '00000'){
            $product_financing=$this->model_laporan->get_product_financing_by_code($product_code);
            $product_name = $product_financing['product_name'];
        } else {
            $product_name = 'SEMUA PRODUK';
        }

        if($financing_type == 1){
            $rembug = '00000';
            $jenis = 'INDIVIDU';
        } else {
        	$jenis = 'KELOMPOK';
        }

		$datas = $this->model_laporan_to_pdf->export_lap_list_premi_anggota($cabang,$rembug,$product_code,$financing_type);

        if($cabang !='0000'){
            $data_cabang = $this->model_laporan_to_pdf->get_cabang($cabang);
        } else {
            $data_cabang = "SEMUA CABANG";
        }

		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------
		$month = array('','Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember');

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0);

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:L1');
		$objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:L2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',$data_cabang);
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E3:L3');
		$objPHPExcel->getActiveSheet()->setCellValue('E3',"Laporan List Biaya Asuransi Anggota");
		$objPHPExcel->getActiveSheet()->getStyle('E3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		
		$objPHPExcel->getActiveSheet()->mergeCells('E5:L5');
		$objPHPExcel->getActiveSheet()->setCellValue('E5',$product_name);
		$objPHPExcel->getActiveSheet()->getStyle('E5')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('A1:P7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1:P6')->getFont()->setSize(12);

		$objPHPExcel->getActiveSheet()->setCellValue('A7',"No");
		$objPHPExcel->getActiveSheet()->setCellValue('B7',"No Rekening");
		$objPHPExcel->getActiveSheet()->setCellValue('C7',"Nama Anggota");
		$objPHPExcel->getActiveSheet()->setCellValue('D7',"Rembug Pusat");
		$objPHPExcel->getActiveSheet()->setCellValue('E7',"Tg Lahir");
		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Usia ");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Nama Pasangan");
		$objPHPExcel->getActiveSheet()->setCellValue('H7',"Tg Lahir Pasangan");
		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Usia Pasangan");
		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Pokok");		
		$objPHPExcel->getActiveSheet()->setCellValue('K7',"Tgl Droping");
		$objPHPExcel->getActiveSheet()->setCellValue('L7',"Jangka Waktu");
		$objPHPExcel->getActiveSheet()->setCellValue('M7',"Tgl JTempo");				
		$objPHPExcel->getActiveSheet()->setCellValue('N7',"Saldo Pokok"); 
		$objPHPExcel->getActiveSheet()->setCellValue('O7',"Biaya Asuransi");
		

		$objPHPExcel->getActiveSheet()->getStyle('A7:P7')->getFont()->setSize(10);
		// $objPHPExcel->getActiveSheet()->getStyle('A7:L8')->getFont()->setSize(10);
		$objPHPExcel->getActiveSheet()->getStyle('A7:P7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A7:P7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O7')->applyFromArray($styleArray);

		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setAutoSize(true);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setAutoSize(true);

		$ii = 8;
		$total_pokok            = 0;
        $total_margin           = 0;
        $total_saldo_pokok      = 0;
        $total_saldo_margin     = 0;
        $total_premi_anggota = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

		        $total_pokok                  += $datas[$i]['pokok'];
		        $total_margin                 += $datas[$i]['margin'];
		        $total_saldo_pokok            += $datas[$i]['saldo_pokok'];
		        $total_saldo_margin           += $datas[$i]['saldo_margin'];
		        $total_premi_anggota          += $datas[$i]['biaya_asuransi_jiwa'];

				if($datas[$i]['usia']!=''){
					$a = explode(' ',$datas[$i]['usia']);
					$usia = $a[0].' Tahun '.@$a[2].' Bulan ';
				}else{
					$usia = ' ';
				}

				if($datas[$i]['p_usia']!=''){
					$b = explode(' ',$datas[$i]['p_usia']);
					$p_usia = $b[0].' Tahun '.@$b[2].' Bulan ';
				}else{
					$p_usia = ' ';
				}

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['account_financing_no'].' ');
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['cm_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,date('d/m/Y',strtotime($datas[$i]['tgl_lahir'])));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$usia);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$datas[$i]['p_nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$datas[$i]['tanggal_peserta_asuransi']);
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$p_usia);
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,date('d/m/Y',strtotime($datas[$i]['droping_date'])));
				$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,$datas[$i]['jangka_waktu']);
				$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,date('d/m/Y',strtotime($datas[$i]['tanggal_jtempo'])));
				$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii," ".number_format($datas[$i]['saldo_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii," ".number_format($datas[$i]['biaya_asuransi_jiwa'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':P'.$ii)->getFont()->setSize(9);	
				
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				

				$ii++;
			
			}//END FOR

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':P'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':P'.$ii)->getFont()->setSize(9);	
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':P'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':H'.$ii);
			$objPHPExcel->getActiveSheet()->mergeCells('K'.$ii.':M'.$ii);

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->applyFromArray($styleArray);
			

			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,'TOTAL :');
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,' '.number_format($total_pokok,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,'');
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,'');
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,'');
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,' '.number_format($total_saldo_pokok,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,' '.number_format($total_premi_anggota,0,',','.'));
			


		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LIST BIAYA ASURANSI ANGGOTA '.$data_cabang.' ('.$jenis.').xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}


	public function export_lap_list_premi_anggota_individu()
	{		
		$tanggal = $this->current_date();
		$cabang 	= $this->uri->segment(3);	
		$product_code 	= $this->uri->segment(4);	

		if ($cabang=="") 
        {            
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        }
        else
        {				
		$datas = $this->model_laporan_to_pdf->export_lap_list_premi_anggota_individu($cabang,$tanggal,$product_code);
        if ($cabang !='0000') 
        {
            $data_cabang = $this->model_laporan_to_pdf->get_cabang($cabang);
        } 
        else 
        {
            $data_cabang = "Semua Cabang";
        }

		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:K1');
		$objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:K2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',$data_cabang);
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E3:K3');
		$objPHPExcel->getActiveSheet()->setCellValue('E3',"Daftar Outstanding Pembiayaan Anggota");
		$objPHPExcel->getActiveSheet()->getStyle('E3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E4:K4');
		$objPHPExcel->getActiveSheet()->setCellValue('E4',"Tanggal ".$this->format_date_detail($tanggal,'id',false,'-'));
		$objPHPExcel->getActiveSheet()->getStyle('E4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('A6:C6');
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"Anggota");
		$objPHPExcel->getActiveSheet()->setCellValue('A7',"No Rekening");
		$objPHPExcel->getActiveSheet()->mergeCells('B7:C7');
		$objPHPExcel->getActiveSheet()->setCellValue('B7',"Nama");

		$objPHPExcel->getActiveSheet()->mergeCells('E6:E7');
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Tanggal Droping");

		$objPHPExcel->getActiveSheet()->mergeCells('F6:F7');
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"Pokok");

		$objPHPExcel->getActiveSheet()->mergeCells('G6:G7');
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"Margin");

		$objPHPExcel->getActiveSheet()->mergeCells('I6:K6');
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"Saldo");

		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('K7',"Margin");

	
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('A6:O7')->getFont()->setSize(10);
		$objPHPExcel->getActiveSheet()->getStyle('A6:O6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:O6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A7:O7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A7:O7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:O6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A7:O7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6:G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6:H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6:I7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O6:O7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A6:B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6:K6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(17);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(12);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(10);

		// $objPHPExcel->getActiveSheet()->getColumnDimension('D')->setVisible(false);
		// $objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(10);

		// $objPHPExcel->getActiveSheet()->getColumnDimension('A')->setHeight(0);
		// $objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(true);
		// $objPHPExcel->getActiveSheet()->getStyle('A6:G6')->getFont()->setBold(true);
		// $objPHPExcel->getActiveSheet()->getStyle('A6:G6')->getFont()->setSize(12);

		$ii = 8;
		$total_pokok            = 0;
        $total_margin           = 0;
        $total_saldo_pokok      = 0;
        $total_saldo_margin     = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

		        $tunggakan_pokok      = $datas[$i]['freq_tunggakan']*$datas[$i]['angsuran_pokok'];
		        $tunggakan_margin     = $datas[$i]['freq_tunggakan']*$datas[$i]['angsuran_margin'];

		        $total_pokok                  += $datas[$i]['pokok'];
		        $total_margin                 += $datas[$i]['margin'];
		        $total_saldo_pokok            += $datas[$i]['saldo_pokok'];
		        $total_saldo_margin           += $datas[$i]['saldo_margin'];

				//$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['account_financing_no'].' ');
				$objPHPExcel->getActiveSheet()->mergeCells('B'.$ii.':C'.$ii);
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['desa']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,((isset($datas[$i]['droping_date'])==true)?$this->format_date_detail($datas[$i]['droping_date'],'id',false,'-'):''));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$datas[$i]['freq_bayar_pokok']);
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$datas[$i]['freq_bayar_margin']);
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".number_format($datas[$i]['saldo_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii," ".number_format($datas[$i]['saldo_margin'],0,',','.'));


				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);


				$ii++;
			
			}//END FOR

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':O'.$ii)->getFont()->setSize(9);	
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':O'.$ii)->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':E'.$ii);
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,'TOTAL :');
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,' '.number_format($total_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,' '.number_format($total_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,'');
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,'');
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,' '.number_format($total_saldo_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,' '.number_format($total_saldo_margin,0,',','.'));

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LIST-OUTSTANDING-PEMBIAYAAN.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');
	}

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	/****************************************************************************************/	
	// END LIST PREMI ANGGOTA 
	/****************************************************************************************/

	// BEGIN LIST JATUH TEMPO
	function export_list_jatuh_tempo(){
        $cabang = $this->uri->segment(3);
        $pembiayaan = $this->uri->segment(4);
        $petugas = $this->uri->segment(5);
        $majelis = $this->uri->segment(6);
        $from = $this->uri->segment(7);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(8);
        $thru = $this->datepicker_convert(true,$thru,'/');

        if($pembiayaan == 1){
            $jenis = 'Individu';
            $jenis2 = strtoupper($jenis);
            $majelis = '00000';
            $petugas = '00000';
        } else if($pembiayaan == 0) {
            $jenis = 'Kelompok';
            $jenis2 = strtoupper($jenis);
        } else {
            $jenis = 'Semua';
            $jenis2 = strtoupper($jenis);
        }

        if($petugas == '00000'){
            $fa = 'SEMUA PETUGAS';
        } else {
            $getPetugas = $this->model_cif->get_fa_by_fa_code($petugas);
            $fa = $getPetugas['fa_name'];
        }

		$datas = $this->model_laporan_to_pdf->export_list_jatuh_tempo($cabang,$pembiayaan,$petugas,$majelis,$from,$thru);

        if($cabang != '00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }
		
		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('B2:N2');
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));

		$objPHPExcel->getActiveSheet()->mergeCells('B3:N3');
		$objPHPExcel->getActiveSheet()->setCellValue('B3',$data_cabang);

		$objPHPExcel->getActiveSheet()->mergeCells('B4:N4');
		$objPHPExcel->getActiveSheet()->setCellValue('B4','LAPORAN JATUH TEMPO');
		
		$objPHPExcel->getActiveSheet()->mergeCells('B5:N5');
		$objPHPExcel->getActiveSheet()->setCellValue('B5','TANGGAL : '.$this->format_date_detail($from,'id',false,'-').' s.d '.$this->format_date_detail($thru,'id',false,'-'));

		$objPHPExcel->getActiveSheet()->mergeCells('B6:N6');
		$objPHPExcel->getActiveSheet()->setCellValue('B6','PETUGAS : '.$fa);

		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B8:B9');
		$objPHPExcel->getActiveSheet()->setCellValue('B8','No');

		$objPHPExcel->getActiveSheet()->mergeCells('C8:C9');
		$objPHPExcel->getActiveSheet()->setCellValue('C8','Tgl Droping');

		$objPHPExcel->getActiveSheet()->mergeCells('D8:E8');
		$objPHPExcel->getActiveSheet()->setCellValue('D8','Anggota');
		$objPHPExcel->getActiveSheet()->setCellValue('D9','Rekening');
		$objPHPExcel->getActiveSheet()->setCellValue('E9','Nama');

		$objPHPExcel->getActiveSheet()->mergeCells('F8:F9');
		$objPHPExcel->getActiveSheet()->setCellValue('F8','Majelis');

		$objPHPExcel->getActiveSheet()->mergeCells('G8:G9');
		$objPHPExcel->getActiveSheet()->setCellValue('G8','Jenis');

		$objPHPExcel->getActiveSheet()->mergeCells('H8:H9');
		$objPHPExcel->getActiveSheet()->setCellValue('H8','Desa');

		$objPHPExcel->getActiveSheet()->mergeCells('I8:L8');
		$objPHPExcel->getActiveSheet()->setCellValue('I8','Pembiayaan');
		$objPHPExcel->getActiveSheet()->setCellValue('I9','Ke');
		$objPHPExcel->getActiveSheet()->setCellValue('J9','Pokok');
		$objPHPExcel->getActiveSheet()->setCellValue('K9','Margin');
		$objPHPExcel->getActiveSheet()->setCellValue('L9','Sisa');
		
		$objPHPExcel->getActiveSheet()->mergeCells('M8:M9');
		$objPHPExcel->getActiveSheet()->setCellValue('M8','Jangka Waktu');
		
		$objPHPExcel->getActiveSheet()->mergeCells('N8:N9');
		$objPHPExcel->getActiveSheet()->setCellValue('N8','Tgl Jatuh Tempo');

		$objPHPExcel->getActiveSheet()->getStyle('B8:N8')->getFont()->setBold(TRUE);
		$objPHPExcel->getActiveSheet()->getStyle('B8:N8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B8:N8')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B9:N9')->getFont()->setBold(TRUE);
		$objPHPExcel->getActiveSheet()->getStyle('B9:N9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B9:N9')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B8:B9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C8:C9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D8:E8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F8:F9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G8:G9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H8:H9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I8:L8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M8:M9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N8:N9')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(15);
					
		$ii = 10;

        $row_total = count($datas) + $ii;

		for($i = 0; $i < count($datas); $i++){
			$tanggal_akad = $datas[$i]['tanggal_akad'];
			$rekening = $datas[$i]['account_financing_no'];
			$nama = $datas[$i]['nama'];
			$majelis = $datas[$i]['cm_name'];
			$desa = $datas[$i]['desa'];
			$ke = $datas[$i]['ke'];
			$pokok = $datas[$i]['pokok'];
			$margin = $datas[$i]['margin'];
			$jangka_waktu = $datas[$i]['jangka_waktu'];
			$jtempo = $datas[$i]['tanggal_jtempo'];
			$periode_jangka_waktu = $datas[$i]['periode_jangka_waktu'];
			$financing_type = $datas[$i]['financing_type'];
			$saldo_pokok = $datas[$i]['saldo_pokok'];
			$angsuran_pokok = $datas[$i]['angsuran_pokok'];

			if($periode_jangka_waktu == '0'){
				$periode = 'Hari';
			} else if($periode_jangka_waktu == '1'){
	            $periode = 'Minggu';
			} else if($periode_jangka_waktu == '2'){
	            $periode = 'Bulan';
			} else if($periode_jangka_waktu == '3'){
	            $periode = 'Jatuh Tempo';
			}
			
			if($financing_type == '0'){
				$pembiayaan = 'Kelompok';
			} else {
				$pembiayaan = 'Individu';
			}

			$sisa_angsuran = $saldo_pokok / $angsuran_pokok;
			$sisa = ceil($sisa_angsuran);

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,($i+1));
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$this->format_date_detail($tanggal_akad,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,"'".$rekening);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$nama);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$majelis);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$pembiayaan);
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$desa);
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$ke);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$pokok);
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,$margin);
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,$sisa.' '.$periode);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,$jangka_waktu.' '.$periode);
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,$this->format_date_detail($jtempo,'id',false,'-'));

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$ii++;
		}

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN JATUH TEMPO ('.$jenis2.') '.$from.' - '.$thru.' '.$data_cabang.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LIST JATUH TEMPO
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LIST PELUNASAN PEMBIAYAAN
	/****************************************************************************************/
	function list_pelunasan_pembiayaan(){
        $cabang = $this->uri->segment(3);
        $pembiayaan = $this->uri->segment(4);
        $petugas = $this->uri->segment(5);
        $majelis = $this->uri->segment(6);
        $from = $this->uri->segment(7);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(8);
        $thru = $this->datepicker_convert(true,$thru,'/');

        if($pembiayaan == 1){
            $jenis = 'Individu';
            $jenis2 = strtoupper($jenis);
            $majelis = '00000';
            $petugas = '00000';
        } else if($pembiayaan == 0) {
            $jenis = 'Kelompok';
            $jenis2 = strtoupper($jenis);
        } else {
            $jenis = 'Semua';
            $jenis2 = strtoupper($jenis);
        }

        if($petugas == '00000'){
            $fa = 'SEMUA PETUGAS';
        } else {
            $getPetugas = $this->model_cif->get_fa_by_fa_code($petugas);
            $fa = $getPetugas['fa_name'];
        }

		$datas = $this->model_laporan_to_pdf->list_pelunasan_pembiayaan($cabang,$pembiayaan,$petugas,$majelis,$from,$thru);

        if($cabang != '00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }
		
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('B2:N2');
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));

		$objPHPExcel->getActiveSheet()->mergeCells('B3:N3');
		$objPHPExcel->getActiveSheet()->setCellValue('B3',$data_cabang);

		$objPHPExcel->getActiveSheet()->mergeCells('B4:N4');
		$objPHPExcel->getActiveSheet()->setCellValue('B4','LAPORAN PELUNASAN PEMBIAYAAN');
		
		$objPHPExcel->getActiveSheet()->mergeCells('B5:N5');
		$objPHPExcel->getActiveSheet()->setCellValue('B5','TANGGAL : '.$this->format_date_detail($from,'id',false,'-').' s.d '.$this->format_date_detail($thru,'id',false,'-'));

		$objPHPExcel->getActiveSheet()->mergeCells('B6:N6');
		$objPHPExcel->getActiveSheet()->setCellValue('B6','PETUGAS : '.$fa);

		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B8:B9');
		$objPHPExcel->getActiveSheet()->setCellValue('B8','No');

		$objPHPExcel->getActiveSheet()->mergeCells('C8:C9');
		$objPHPExcel->getActiveSheet()->setCellValue('C8','Tanggal Lunas');

		$objPHPExcel->getActiveSheet()->mergeCells('D8:E8');
		$objPHPExcel->getActiveSheet()->setCellValue('D8','Anggota');
		$objPHPExcel->getActiveSheet()->setCellValue('D9','Rekening');
		$objPHPExcel->getActiveSheet()->setCellValue('E9','Nama');

		$objPHPExcel->getActiveSheet()->mergeCells('F8:F9');
		$objPHPExcel->getActiveSheet()->setCellValue('F8','Majelis');

		$objPHPExcel->getActiveSheet()->mergeCells('G8:G9');
		$objPHPExcel->getActiveSheet()->setCellValue('G8','Pembiayaan');

		$objPHPExcel->getActiveSheet()->mergeCells('H8:I8');
		$objPHPExcel->getActiveSheet()->setCellValue('H8','Jumlah');
		$objPHPExcel->getActiveSheet()->setCellValue('H9','Pokok');
		$objPHPExcel->getActiveSheet()->setCellValue('I9','Margin');

		$objPHPExcel->getActiveSheet()->mergeCells('J8:J9');
		$objPHPExcel->getActiveSheet()->setCellValue('J8','Jangka Waktu');

		$objPHPExcel->getActiveSheet()->mergeCells('K8:K9');
		$objPHPExcel->getActiveSheet()->setCellValue('K8','Jatuh Tempo');

		$objPHPExcel->getActiveSheet()->mergeCells('L8:N8');
		$objPHPExcel->getActiveSheet()->setCellValue('L8','Saldo Hutang');
		$objPHPExcel->getActiveSheet()->setCellValue('L9','Cnt');
		$objPHPExcel->getActiveSheet()->setCellValue('M9','Pokok');
		$objPHPExcel->getActiveSheet()->setCellValue('N9','Margin');

		$objPHPExcel->getActiveSheet()->getStyle('B8:N8')->getFont()->setBold(TRUE);
		$objPHPExcel->getActiveSheet()->getStyle('B8:N8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B8:N8')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B9:N9')->getFont()->setBold(TRUE);
		$objPHPExcel->getActiveSheet()->getStyle('B9:N9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B9:N9')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B8:B9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C8:C9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D8:E8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F8:F9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G8:G9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H8:I8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J8:J9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K8:K9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L8:N8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N9')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(15);
					
		$ii = 10;

        $row_total = count($datas) + $ii;

		for($i = 0; $i < count($datas); $i++){
			$tanggal_lunas = $datas[$i]['tanggal_lunas'];
			$rekening = $datas[$i]['account_financing_no'];
			$nama = $datas[$i]['nama'];
			$majelis = $datas[$i]['cm_name'];
			$pokok = $datas[$i]['pokok'];
			$margin = $datas[$i]['margin'];
			$jangka_waktu = $datas[$i]['jangka_waktu'];
			$jtempo = $datas[$i]['tanggal_jtempo'];
			$saldo_pokok = $datas[$i]['saldo_pokok'];
			$saldo_margin = $datas[$i]['saldo_margin'];
			$periode_jangka_waktu = $datas[$i]['periode_jangka_waktu'];
			$counter = $datas[$i]['counter_angsuran'];
			$financing_type = $datas[$i]['financing_type'];

			$sisa = $jangka_waktu - $counter;

			if($periode_jangka_waktu == '0'){
				$periode = 'Hari';
			} else if($periode_jangka_waktu == '1'){
	            $periode = 'Minggu';
			} else if($periode_jangka_waktu == '2'){
	            $periode = 'Bulan';
			} else if($periode_jangka_waktu == '3'){
	            $periode = 'Jatuh Tempo';
			}
			if($financing_type == '0'){
				$pembiayaan = 'Kelompok';
			} else {
				$pembiayaan = 'Individu';
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,($i+1));
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$this->format_date_detail($tanggal_lunas,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,"'".$rekening);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$nama);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$majelis);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$pembiayaan);
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$pokok);
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$margin);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$jangka_waktu.' '.$periode);
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,$this->format_date_detail($jtempo,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,$sisa);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,$saldo_pokok);
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,$saldo_margin);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$ii++;
		}

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN PELUNASAN PEMBIAYAAN ('.$jenis2.') '.$from.' - '.$thru.' '.$data_cabang.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LIST PELUNASAN PEMBIAYAAN
	/****************************************************************************************/



	/****************************************************************************************/	
	// BEGIN LIST REGISTRASI PEMBIAYAAN
	/****************************************************************************************/
	function export_list_registrasi_pembiayaan(){
        $from = $this->uri->segment(3);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(4);
        $thru = $this->datepicker_convert(true,$thru,'/');
        $cabang = $this->uri->segment(5);
        $majelis = $this->uri->segment(6);
        $pembiayaan = $this->uri->segment(7);
        $petugas = $this->uri->segment(8);
        $produk = $this->uri->segment(9);

        if($pembiayaan == 1){
            $jenis = 'Individu';
            $jenis2 = strtoupper($jenis);
            $majelis = '00000';
            $petugas = '00000';
        } else if($pembiayaan == 0) {
            $jenis = 'Kelompok';
            $jenis2 = strtoupper($jenis);
        } else {
            $jenis = 'Semua';
            $jenis2 = strtoupper($jenis);
        }

        if($petugas == '00000'){
            $fa = 'SEMUA PETUGAS';
        } else {
            $getPetugas = $this->model_cif->get_fa_by_fa_code($petugas);
            $fa = $getPetugas['fa_name'];
        }
		
        if($cabang !='00000'){
            $data_cabang = 'CABANG '.$this->model_laporan_to_pdf->get_cabang($cabang);
        } else {
            $data_cabang = 'SEMUA CABANG';
        }

		$datas = $this->model_laporan_to_pdf->export_list_registrasi_pembiayaan($from,$thru,$cabang,$majelis,$pembiayaan,$petugas,$produk);

		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('B2:P2');
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('B2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B3:P3');
		$objPHPExcel->getActiveSheet()->setCellValue('B3',$data_cabang);
		$objPHPExcel->getActiveSheet()->getStyle('B3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B4:P4');
		$objPHPExcel->getActiveSheet()->setCellValue('B4','LAPORAN REGISTRASI PEMBIAYAAN');
		$objPHPExcel->getActiveSheet()->getStyle('B4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('B5:P5');
		$objPHPExcel->getActiveSheet()->setCellValue('B5','TANGGAL : '.$this->format_date_detail($from,'id',false,'/').' s.d '.$this->format_date_detail($thru,'id',false,'/'));
		$objPHPExcel->getActiveSheet()->getStyle('B5')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B6:P6');
		$objPHPExcel->getActiveSheet()->setCellValue('B6','PETUGAS : '.$fa);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B7:B8');
		$objPHPExcel->getActiveSheet()->setCellValue('B7','No');

		$objPHPExcel->getActiveSheet()->mergeCells('C7:C8');
		$objPHPExcel->getActiveSheet()->setCellValue('C7','Nomor Rekening');

		$objPHPExcel->getActiveSheet()->mergeCells('D7:E7');
		$objPHPExcel->getActiveSheet()->setCellValue('D7','Anggota');
		$objPHPExcel->getActiveSheet()->setCellValue('D8','Nama');
		$objPHPExcel->getActiveSheet()->setCellValue('E8','Majelis');

		$objPHPExcel->getActiveSheet()->mergeCells('F7:F8');
		$objPHPExcel->getActiveSheet()->setCellValue('F7','Pembiayaan');

		$objPHPExcel->getActiveSheet()->mergeCells('G7:G8');
		$objPHPExcel->getActiveSheet()->setCellValue('G7','Produk');

		$objPHPExcel->getActiveSheet()->mergeCells('H7:H8');
		$objPHPExcel->getActiveSheet()->setCellValue('H7','Tanggal Registrasi');

		$objPHPExcel->getActiveSheet()->mergeCells('I7:I8');
		$objPHPExcel->getActiveSheet()->setCellValue('I7','Plafon');

		$objPHPExcel->getActiveSheet()->mergeCells('J7:J8');
		$objPHPExcel->getActiveSheet()->setCellValue('J7','Margin');

		$objPHPExcel->getActiveSheet()->mergeCells('K7:N7');
		$objPHPExcel->getActiveSheet()->setCellValue('K7','Angsuran');
		$objPHPExcel->getActiveSheet()->setCellValue('K8','Pokok');
		$objPHPExcel->getActiveSheet()->setCellValue('L8','Margin');
		$objPHPExcel->getActiveSheet()->setCellValue('M8','Catab');
		$objPHPExcel->getActiveSheet()->setCellValue('N8','Total');

		$objPHPExcel->getActiveSheet()->mergeCells('O7:O8');
		$objPHPExcel->getActiveSheet()->setCellValue('O7','Jangka Waktu');

		$objPHPExcel->getActiveSheet()->mergeCells('P7:P8');
		$objPHPExcel->getActiveSheet()->setCellValue('P7','Status');
		
		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getFont()->setSize(13);
		$objPHPExcel->getActiveSheet()->getStyle('B7:P8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B7:P8')->getFont()->setSize(11);
		$objPHPExcel->getActiveSheet()->getStyle('B7:P7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B7:P7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B8:P8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B8:P8')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B7:B8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7:C8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7:E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7:F8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7:G8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7:H8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7:I8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7:J8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7:N7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O7:O8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P7:P8')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(15);

		$ii = 9;

		for($i = 0; $i < count($datas); $i++){
			$periode_jangka_waktu = $datas[$i]['periode_jangka_waktu'];
			$pokok = $datas[$i]['pokok'];
			$status_rekening = $datas[$i]['status_rekening'];
			$financing = $datas[$i]['financing_type'];
			$rekening = $datas[$i]['account_financing_no'];
			$nama = $datas[$i]['nama'];
			$majelis = $datas[$i]['cm_name'];
			$tanggal_registrasi = $datas[$i]['tanggal_registrasi'];
			$pokok = $datas[$i]['pokok'];
			$margin = $datas[$i]['margin'];
			$angsuran_pokok = $datas[$i]['angsuran_pokok'];
			$angsuran_margin = $datas[$i]['angsuran_margin'];
			$angsuran_catab = $datas[$i]['angsuran_catab'];
			$jangka_waktu = $datas[$i]['jangka_waktu'];
			$product = $datas[$i]['nick_name'];

			$total = $angsuran_pokok + $angsuran_margin + $angsuran_catab;

			if($periode_jangka_waktu == 0){
				$periode = 'Hari';
	        } else if($periode_jangka_waktu == 1){
				$periode = 'Minggu';
	        } else if($periode_jangka_waktu == 2){
	            $periode = 'Bulan';
	        } else if($periode_jangka_waktu == 3){
	            $periode = 'Jatuh Tempo';
	        }

			$setor = $pokok * 0.05;

			if($status_rekening == 0){
				$status = 'Registrasi';
	        } else if($status_rekening == 1){
	            $status = 'Aktif';
	        } else if($status_rekening == 2){
	            $status = 'Lunas';
	        } else{
	            $status = 'Verifikasi';
	        }

			if($financing == 0){
				$jenis = 'Kelompok';
	        } else{
	            $jenis = 'Individu';
	        }

			if($tanggal_registrasi == ''){
				$tanggal = '-';
			} else {
				$tanggal = $this->format_date_detail($tanggal_registrasi,'id',false,'/');
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,($i+1));
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,"'".$rekening);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$nama);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$majelis);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$jenis);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$product);
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$tanggal);
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$pokok);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$margin);
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,$angsuran_pokok);
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,$angsuran_margin);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,$angsuran_catab);
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,$total);
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,$jangka_waktu.' '.$periode);
			$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii,$status);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':P'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$ii++;
		}

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN REGISTRASI PEMBIAYAAN ('.$jenis2.') '.$from.' - '.$thru.' '.$data_cabang.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LIST REGISTRASI PEMBIAYAAN
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN REKAP OUTSTANDING BY DESA
	/****************************************************************************************/
	public function export_rekap_outstanding_piutang_by_desa()
	{
		/*$desa_code = $this->uri->segment(3);

		if ($desa_code=="") 
        {            
         echo "<script>alert('Parameter Belum Lengkap !');javascript:window.close();</script>";
        } 
        else
        {*/
		
				$datas = $this->model_laporan->export_rekap_outstanding_piutang_by_desa();
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Berdasarkan DESA");
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"JUMLAH");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"POKOK");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"MARGIN");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(35);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['desa']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($datas[$i]['margin'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP OUTSTANDING BY DESA
	/****************************************************************************************/
	
	/****************************************************************************************/	
	// BEGIN REKAP JUMLAH ANGGOTA BY KOTA
	/****************************************************************************************/
	public function export_rekap_jumlah_anggota_kota()
	{		
				$cabang = $this->uri->segment(3);
				$datas = $this->model_laporan->export_pdf_rekap_jumlah_anggota_kota($cabang);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jumlah Anggota by Kota ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);


			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['kode']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['keterangan']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['jumlah']);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_JUMLAH ANGGOTA BY KOTA.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP JUMLAH ANGGOTA BY KOTA
	/****************************************************************************************/
	
	
	/****************************************************************************************/	
	// BEGIN REKAP JUMLAH ANGGOTA BY KECAMATAN
	/****************************************************************************************/
	public function export_rekap_jumlah_anggota_kecamatan()
	{		
				$cabang = $this->uri->segment(3);
				$datas = $this->model_laporan->export_pdf_rekap_jumlah_anggota_kecamatan($cabang);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jumlah Anggota by Kecamatan ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);


			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['kode']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['keterangan']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['jumlah']);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_JUMLAH ANGGOTA BY KECAMATAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP JUMLAH ANGGOTA BY KECAMATAN
	/****************************************************************************************/
	
	/****************************************************************************************/	
	// BEGIN REKAP JUMLAH ANGGOTA BY DESA
	/****************************************************************************************/
	public function export_rekap_jumlah_anggota_desa()
	{		
				$cabang = $this->uri->segment(3);
				$datas = $this->model_laporan->export_pdf_rekap_jumlah_anggota_desa($cabang);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jumlah Anggota by desa ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);


			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['kode']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['keterangan']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['jumlah']);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_JUMLAH ANGGOTA BY DESA.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP JUMLAH ANGGOTA BY DESA
	/****************************************************************************************/
	
	/****************************************************************************************/	
	// BEGIN REKAP JUMLAH ANGGOTA BY REMBUG
	/****************************************************************************************/
	public function export_rekap_jumlah_anggota_rembug()
	{		
				$cabang = $this->uri->segment(3);
				$datas = $this->model_laporan->export_pdf_rekap_jumlah_anggota_rembug($cabang);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jumlah Anggota by Majelis ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);


			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['kode']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['keterangan']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['jumlah']);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_JUMLAH ANGGOTA BY REMBUG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP JUMLAH ANGGOTA BY REMBUG
	/****************************************************************************************/
	
	/****************************************************************************************/	
	// BEGIN REKAP JUMLAH ANGGOTA BY PETUGAS
	/****************************************************************************************/
	public function export_rekap_jumlah_anggota_petugas()
	{		
				$cabang = $this->uri->segment(3);
				$datas = $this->model_laporan->export_pdf_rekap_jumlah_anggota_petugas($cabang);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jumlah Anggota by Petugas ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);


			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['kode']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['keterangan']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['jumlah']);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_JUMLAH ANGGOTA BY PETUGAS.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP JUMLAH ANGGOTA BY PETUGAS
	/****************************************************************************************/
	
	/****************************************************************************************/	
	// BEGIN REKAP JUMLAH ANGGOTA BY SEKTOR
	/****************************************************************************************/
	public function export_rekap_jumlah_anggota_sektor()
	{		
				$cabang = $this->uri->segment(3);
				$datas = $this->model_laporan->export_pdf_rekap_jumlah_anggota_sektor($cabang);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jumlah Anggota by Sektor Usaha ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);


			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['kode']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['keterangan']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['jumlah']);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_JUMLAH ANGGOTA BY SEKTOR USAHA.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP JUMLAH ANGGOTA BY SEKTOR
	/****************************************************************************************/
	
	/****************************************************************************************/	
	// REKAP ANGGOTA KELUAR BY CABANG
	/****************************************************************************************/
	public function export_rekap_anggota_keluar_semua_cabang()
	{		
				$datas = $this->model_laporan_to_pdf->export_rekap_anggota_keluar_semua_cabang($tanggal,$tanggal2);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Anggota Keluar by Cabang ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);



			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_code']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['branch_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['num']);


				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP ANGGOTA KELUAR BY CABANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP ANGGOTA KELUAR BY CABANG
	/****************************************************************************************/
	
	
	/****************************************************************************************/	
	// REKAP ANGGOTA KELUAR BY KECAMATAN
	/****************************************************************************************/
	public function export_rekap_anggota_keluar_kecamatan()
	{		
				$datas = $this->model_laporan_to_pdf->export_rekap_anggota_keluar_kecamatan($branch_code,$tanggal,$tanggal2);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Anggota Keluar by Kecamatan ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);



			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['kecamatan_code']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['kecamatan']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['num']);


				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP ANGGOTA KELUAR BY KECAMATAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP ANGGOTA KELUAR BY KECAMATAN
	/****************************************************************************************/
	
	/****************************************************************************************/	
	// REKAP ANGGOTA KELUAR BY PETUGAS
	/****************************************************************************************/
	public function export_rekap_anggota_keluar_petugas()
	{		
				$datas = $this->model_laporan_to_pdf->export_rekap_anggota_keluar_petugas($branch_code,$tanggal,$tanggal2);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Anggota Keluar by Petugas ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);



			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['fa_code']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['fa_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['num']);


				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP ANGGOTA KELUAR BY PEUTGAS.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP ANGGOTA KELUAR BY PETUGAS
	/****************************************************************************************/
	
	/****************************************************************************************/	
	// REKAP ANGGOTA KELUAR BY ALASAN
	/****************************************************************************************/
	public function export_rekap_anggota_keluar_alasan()
	{		
				$datas = $this->model_laporan_to_pdf->export_rekap_anggota_keluar_alasan($branch_code,$tanggal,$tanggal2);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Anggota Keluar by Alasan Keluar ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);



			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['code_value']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['display_text']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['num']);


				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP ANGGOTA KELUAR BY ALASAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP ANGGOTA KELUAR BY ALASAN
	/****************************************************************************************/
	

	/****************************************************************************************/	
	// BEGIN REKAP OUTSTANDING BY REMBUG
	/****************************************************************************************/
	public function export_rekap_outstanding_piutang_by_rembug()
	{
		/*$desa_code = $this->uri->segment(3);

		if ($desa_code=="") 
        {            
         echo "<script>alert('Parameter Belum Lengkap !');javascript:window.close();</script>";
        } 
        else
        {*/
		
				$datas = $this->model_laporan->export_rekap_outstanding_piutang_by_rembug();
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Berdasarkan REMBUG");
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"JUMLAH");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"POKOK");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"MARGIN");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(35);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['cm_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($datas[$i]['margin'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP OUTSTANDING BY REMBUG
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN REKAP OUTSTANDING BY PETUGAS
	/****************************************************************************************/
	public function export_rekap_outstanding_piutang_by_petugas()
	{
		/*$desa_code = $this->uri->segment(3);

		if ($desa_code=="") 
        {            
         echo "<script>alert('Parameter Belum Lengkap !');javascript:window.close();</script>";
        } 
        else
        {*/
		
				$datas = $this->model_laporan->export_rekap_outstanding_piutang_by_petugas();
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Berdasarkan PETUGAS");
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"JUMLAH");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"POKOK");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"MARGIN");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(35);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['fa_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($datas[$i]['margin'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP OUTSTANDING BY PETUGAS
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN REKAP OUTSTANDING BY PERUNTUKAN
	/****************************************************************************************/
	public function export_rekap_outstanding_piutang_by_peruntukan()
	{
		/*$desa_code = $this->uri->segment(3);

		if ($desa_code=="") 
        {            
         echo "<script>alert('Parameter Belum Lengkap !');javascript:window.close();</script>";
        } 
        else
        {*/
		
				$datas = $this->model_laporan->export_rekap_outstanding_piutang_by_peruntukan();
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Berdasarkan PERUNTUKAN");
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"JUMLAH");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"POKOK");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"MARGIN");

			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setBold(true);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(35);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);

			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				if($datas[$i]['peruntukan']=='1')
				{
					$peruntukan[$i]="Modal Kerja";
				}
				elseif($datas[$i]['peruntukan']=='2')
				{
					$peruntukan[$i]="Konsumtif";
				}
				elseif($datas[$i]['peruntukan']=='3')
				{
					$peruntukan[$i]="Investasi";
				}
				else
				{
					$peruntukan="-";
				}

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$peruntukan[$i]);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($datas[$i]['margin'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP OUTSTANDING BY PERUNTUKAN
	/****************************************************************************************/
	
	
	/****************************************************************************************/	
	// BEGIN REKAP SEBARAN ANGGOTA  
	/****************************************************************************************/
	public function export_rekap_sebaran_anggota_semua_cabang()
	{	
			$branch_code = $this->uri->segment(3);
			$datas = $this->model_laporan_to_pdf->export_rekap_sebaran_anggota_semua_cabang($branch_code);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			//$objPHPExcel->getActiveSheet()->mergeCells('A1:C1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Rekap SEBARAN ANGGOTA");
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"");
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"NO");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',"KODE");
			$objPHPExcel->getActiveSheet()->setCellValue('C4',"KETERANGAN");
			$objPHPExcel->getActiveSheet()->setCellValue('D4',"KECAMATAN");
			$objPHPExcel->getActiveSheet()->setCellValue('E4',"DESA");
			$objPHPExcel->getActiveSheet()->setCellValue('F4',"MAJELIS");
			$objPHPExcel->getActiveSheet()->setCellValue('G4',"ANGGOTA");

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setAutoSize(true);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setAutoSize(true);

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4:G4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A4')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B4')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C4')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D4')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E4')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F4')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G4')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('A4:G4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A4:G4')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 5;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['city_code']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['city']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($datas[$i]['kecamatan'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($datas[$i]['desa'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($datas[$i]['majelis'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($datas[$i]['anggota'],0,',','.'));
				
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_SEBARAN_ANGGOTA.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		/*}*/
	}
	/****************************************************************************************/	
	// END REKAP SEBARAN ANGGOTA 
	/****************************************************************************************/
	


	public function export_list_transaksi_rembug()
	{

		$branch_code = $this->uri->segment(3);
		$from_trx_date = $this->datepicker_convert(false,$this->uri->segment(4));
		$thru_trx_date = $this->datepicker_convert(false,$this->uri->segment(5));
		$cm_code = $this->uri->segment(6);
		$fa_code = $this->uri->segment(7);
		if($branch_code!='00000'){
			$branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
		}else{
			$branch_id = $branch_code;
		}

		$branch = $this->model_cif->get_branch_by_branch_id($branch_id);
		if($cm_code==false){
			$rembug['cm_code'] = false;
			$rembug['cm_name'] = 'Semua Rembug';
		}else{
			$rembug = $this->model_cif->get_cm_by_cm_code($cm_code);
		}

		$datas = $this->model_laporan->export_list_transaksi_rembug($branch_code,$cm_code,$from_trx_date,$thru_trx_date,$fa_code);
		
		// ----------------------------------------------------------
		// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
	   		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->getStyle('A6:O28')->getFont()->setSize(8);
		$objPHPExcel->getActiveSheet()->getStyle('A6:O7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:O7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:O7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('A3',"LAPORAN TRANSAKSI REMBUG");
		$objPHPExcel->getActiveSheet()->mergeCells('A3:C3');
		$objPHPExcel->getActiveSheet()->getStyle('A3:C4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A3:C4')->getFont()->setSize(10);
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"BRANCH");
		$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C4',$branch['branch_name']);
		
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"ID");
		$objPHPExcel->getActiveSheet()->mergeCells('A6:B6');
		$objPHPExcel->getActiveSheet()->getStyle('A6:B6')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('A7',"ANGGOTA");
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('B7',"PYD");
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('C6',"NAMA");
		$objPHPExcel->getActiveSheet()->mergeCells('C6:C7');
		$objPHPExcel->getActiveSheet()->getStyle('C6:C7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('D6',"ANGSURAN");
		$objPHPExcel->getActiveSheet()->mergeCells('D6:G6');
		$objPHPExcel->getActiveSheet()->getStyle('D6:G6')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('D7',"Freq");
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('E7',"Pokok");
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Margin");
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Catab");
		$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('H6',"Setoran");
		$objPHPExcel->getActiveSheet()->mergeCells('H6:K6');
		$objPHPExcel->getActiveSheet()->getStyle('H6:K6')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('H7',"LWK");
		$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Sukarela");
		$objPHPExcel->getActiveSheet()->getStyle('I7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Wajib");
		$objPHPExcel->getActiveSheet()->getStyle('J7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('K7',"Kelompok");
		$objPHPExcel->getActiveSheet()->getStyle('K7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('L6',"Penarikan");
		$objPHPExcel->getActiveSheet()->getStyle('L6')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('L7',"Sukarela");
		$objPHPExcel->getActiveSheet()->getStyle('L7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('M6',"REALISASI PEMBIAYAAN");
		$objPHPExcel->getActiveSheet()->mergeCells('M6:O6');
		$objPHPExcel->getActiveSheet()->getStyle('M6:O6')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('M7',"Plafon");
		$objPHPExcel->getActiveSheet()->getStyle('M7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('N7',"Adm.");
		$objPHPExcel->getActiveSheet()->getStyle('N7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('O7',"Asuransi");
		$objPHPExcel->getActiveSheet()->getStyle('O7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(11.29);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(5.57);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(12.43);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(5.14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(11.29);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(11.57);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(10.71);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(10.86);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(11.57);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(12.57);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(11.29);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(11.29);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(11.29);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(11.29);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(11.29);


		// $objPHPExcel->getActiveSheet()->getColumnDimension('D')->setAutoSize(true);

		// $objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getFont()->setBold(true);
		
		// $objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

		// $objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);

		// $objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);

		// $objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				
		$ii = 8;
		// echo "<pre>";
		// print_r($datas);
		// die();
		for( $i = 0 ; $i < count($datas) ; $i++ )
		{


			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,'Rembug');
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,': '.$datas[$i]['cm_name']);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,'Tanggal Bayar');
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,': '.$datas[$i]['trx_date']);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getFont()->setSize(8);
			$objPHPExcel->getActiveSheet()->mergeCells('B'.$ii.':C'.$ii);
			$objPHPExcel->getActiveSheet()->mergeCells('E'.$ii.':F'.$ii);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':O'.$ii)->applyFromArray(array(
	       		'borders' => array(
			             'right' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			             'left' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			));
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,'Petugas');
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,': '.$datas[$i]['fa_name']);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,'Tanggal');
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,': '.$this->format_date_detail($datas[$i]['created_date'],'id',false,'-'));
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getFont()->setSize(8);
			$objPHPExcel->getActiveSheet()->mergeCells('B'.$ii.':C'.$ii);
			$objPHPExcel->getActiveSheet()->mergeCells('E'.$ii.':F'.$ii);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':O'.$ii)->applyFromArray(array(
	       		'borders' => array(
			             'right' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			             'left' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			));
			$ii++;
			
			$datass = $this->model_laporan->export_list_transaksi_rembug_sub($datas[$i]['trx_cm_id'],$from_trx_date,$thru_trx_date,$datas[$i]['trx_date']);

			$total_angsuran_pokok = 0;
			$total_angsuran_margin = 0;
			$total_angsuran_catab = 0;
			$total_setoran_lwk = 0;
			$total_tab_sukarela_cr = 0;
			$total_minggon = 0;
			$total_tab_wajib_cr = 0;
			$total_kelompok = 0;
			$total_tab_sukarela_db = 0;
			$total_pokok = 0;
			$total_administrasi = 0;
			$total_asuransi = 0;

			for ( $j = 0 ; $j < count($datass) ; $j++ )
			{

				$total_angsuran_pokok += ($datass[$j]['freq']*$datass[$j]['angsuran_pokok']);
				$total_angsuran_margin += ($datass[$j]['freq']*$datass[$j]['angsuran_margin']);
				$total_angsuran_catab += ($datass[$j]['freq']*$datass[$j]['angsuran_catab']);
				$total_setoran_lwk += $datass[$j]['setoran_lwk'];
				$total_tab_sukarela_cr += $datass[$j]['tab_sukarela_cr'];
				$total_minggon += $datass[$j]['minggon'];
				$total_tab_wajib_cr += ($datass[$j]['freq']*$datass[$j]['tab_wajib_cr']);
				$total_kelompok += ($datass[$j]['freq']*$datass[$j]['tab_kelompok_cr']);
				$total_tab_sukarela_db += $datass[$j]['tab_sukarela_db'];
				$total_pokok += $datass[$j]['pokok'];
				$total_administrasi += $datass[$j]['administrasi']; 
				$total_asuransi += $datass[$j]['asuransi'];

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datass[$j]['cif_no'].' ');
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,'');
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datass[$j]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datass[$j]['freq']); 
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,' '.number_format($datass[$j]['angsuran_pokok'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,' '.number_format($datass[$j]['angsuran_margin'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,' '.number_format($datass[$j]['angsuran_catab'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,' '.number_format($datass[$j]['setoran_lwk'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,' '.number_format($datass[$j]['tab_sukarela_cr'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,' '.number_format($datass[$j]['tab_wajib_cr'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,' '.number_format($datass[$j]['tab_kelompok_cr'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,' '.number_format($datass[$j]['tab_sukarela_db'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,' '.number_format($datass[$j]['pokok'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,' '.number_format($datass[$j]['administrasi'],0,',','.'));   
				$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,' '.number_format($datass[$j]['asuransi'],0,',','.'));   

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':O'.$ii)->getFont()->setSize(8);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->applyFromArray($styleArray);
				$ii++;
			}

			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'Total');
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,' '.number_format($total_angsuran_pokok,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,' '.number_format($total_angsuran_margin,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,' '.number_format($total_angsuran_catab,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,' '.number_format($total_setoran_lwk,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,' '.number_format($total_tab_sukarela_cr,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,' '.number_format($total_tab_wajib_cr,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,' '.number_format($total_kelompok,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,' '.number_format($total_tab_sukarela_db,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,' '.number_format($total_pokok,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,' '.number_format($total_administrasi,0,',','.'));   
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,' '.number_format($total_asuransi,0,',','.'));  

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':O'.$ii)->getFont()->setSize(8);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':O'.$ii)->applyFromArray(array(
	       		'borders' => array(
			             'right' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			             'left' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			));
			// $objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			// $objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			// $objPHPExcel->getActiveSheet()->getStyle('A6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

			$ii++;
		
		}//END FOR

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAP_TRX_MAJELIS_'.$branch['branch_name'].'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}



	/****************************************************************************************/	
	// BEGIN REKAP JATUH TEMPO BY CABANG
	/****************************************************************************************/
		//semua cabang
		public function export_rekap_jatuh_tempo_semua_cabang()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_jatuh_tempo_semua_cabang($tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jatu Tempo Pembiayaan Berdasarkan Cabang");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"No");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['jumlah_anggota'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['jumlah_anggota'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
				 	$persen_jumlah = $datas[$i]['jumlah_anggota']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah_anggota']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);
				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="export_rekap_jatuh_tempo_cabang.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		//BY cabang
		public function export_rekap_jatuh_tempo_cabang()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_jatuh_tempo_cabang($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);


				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jatu Tempo Pembiayaan Berdasarkan Cabang");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"No");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Cabang");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"Persen Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['jumlah_anggota'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['jumlah_anggota'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
				 	$persen_jumlah = $datas[$i]['jumlah_anggota']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['cm_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah_anggota']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);
				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="export_rekap_jatuh_tempo_cabang.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		//BY rembug
		public function export_rekap_jatuh_tempo_rembug()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_jatuh_tempo_rembug($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jatu Tempo Pembiayaan Berdasarkan Rembug");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"No");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Rembug");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['jumlah_anggota'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}


				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['jumlah_anggota'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
	       			  $persen_jumlah = $datas[$i]['jumlah_anggota']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['cm_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah_anggota']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);
				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="export_rekap_jatuh_tempo_rembug.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		//BY Petugas
		public function export_rekap_jatuh_tempo_petugas()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_jatuh_tempo_petugas($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jatu Tempo Pembiayaan Berdasarkan Petugas");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"No");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Petugas");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['jumlah_anggota'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['jumlah_anggota'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
				 	$persen_jumlah = $datas[$i]['jumlah_anggota']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['fa_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah_anggota']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);
				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="export_rekap_jatuh_tempo_petugas.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		//BY Peruntukan
		public function export_rekap_jatuh_tempo_peruntukan()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_jatuh_tempo_peruntukan($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Jatu Tempo Pembiayaan Berdasarkan Cabang");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"No");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Peruntukan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['jumlah_anggota'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['jumlah_anggota'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
				 	$persen_jumlah = $datas[$i]['jumlah_anggota']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['display_text']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah_anggota']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);
				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="export_rekap_jatuh_tempo_peruntukan.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	/****************************************************************************************/	
	// END REKAP JATUH TEMPO BY CABANG
	/****************************************************************************************/

	// BEGIN LAPORAN REKAP PENGAJUAN PEMBIAYAAN
	function export_rekap_pengajuan_pembiayaan(){
        $cabang = $this->uri->segment(3);
        $pembiayaan = $this->uri->segment(4);
        $kategori = $this->uri->segment(5);
        $from = $this->uri->segment(6);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(7);
        $thru = $this->datepicker_convert(true,$thru,'/');

        if($pembiayaan == 1){
            $jenis = 'Individu';
            $jenis2 = strtoupper($jenis);
        } else if($pembiayaan == 0) {
            $jenis = 'Kelompok';
            $jenis2 = strtoupper($jenis);
        } else {
            $jenis = 'Semua';
            $jenis2 = strtoupper($jenis);
        }

        if($kategori == '1'){
            $by = 'Majelis';
        } else if($kategori == '2'){
            $by = 'Petugas';
        } else {
            $by = 'Peruntukan';
        }

		$datas = $this->model_laporan_to_pdf->export_rekap_pengajuan_pembiayaan($cabang,$pembiayaan,$kategori,$from,$thru);

        if($cabang != '00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('B2:H2');
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));

		$objPHPExcel->getActiveSheet()->mergeCells('B3:H3');
		$objPHPExcel->getActiveSheet()->setCellValue('B3',$data_cabang);

		$objPHPExcel->getActiveSheet()->mergeCells('B4:H4');
		$objPHPExcel->getActiveSheet()->setCellValue('B4','LAPORAN REKAP PENGAJUAN PEMBIAYAAN BERDASARKAN '.strtoupper($by));
		
		$objPHPExcel->getActiveSheet()->mergeCells('B5:H5');
		$objPHPExcel->getActiveSheet()->setCellValue('B5','TANGGAL : '.$this->format_date_detail($from,'id',false,'-').' s.d '.$this->format_date_detail($thru,'id',false,'-'));

		$objPHPExcel->getActiveSheet()->getStyle('B2:B5')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B2:B5')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('B7','No');
		$objPHPExcel->getActiveSheet()->setCellValue('C7',$by);
		$objPHPExcel->getActiveSheet()->setCellValue('D7','Jumlah');
		$objPHPExcel->getActiveSheet()->setCellValue('E7','Nominal');
		$objPHPExcel->getActiveSheet()->setCellValue('F7','Pembiayaan');
		$objPHPExcel->getActiveSheet()->setCellValue('G7','Persentase Jumlah');
		$objPHPExcel->getActiveSheet()->setCellValue('H7','Persentase Nominal');

		$objPHPExcel->getActiveSheet()->getStyle('B7:H7')->getFont()->setBold(TRUE);
		$objPHPExcel->getActiveSheet()->getStyle('B7:H7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B7:H7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

		$ii = 8;
		$total_anggota = 0;
		$total_pokok = 0;
	    $sum_anggota = 0;
	    $sum_pokok = 0;

        $row_total = count($datas) + $ii;

        for($i = 0; $i < count($datas); $i++){
			$sum_a = $datas[$i]['jumlah_anggota'];
			$sum_p = $datas[$i]['nominal'];

			$sum_anggota += $sum_a;
			$sum_pokok += $sum_p;
        }

		for($i = 0; $i < count($datas); $i++){
			$jumlah_anggota = $datas[$i]['jumlah_anggota'];
			$nominal = $datas[$i]['nominal'];
			$keterangan = $datas[$i]['keterangan'];
			$financing = $datas[$i]['financing_type'];

	        $persen_jumlah = ($jumlah_anggota / $sum_anggota) * 100;
	        $persen_nominal = ($nominal / $sum_pokok) * 100;

			$total_anggota += $jumlah_anggota;
	        $total_pokok += $nominal; 

			if($financing == '0'){
				$pembiayaan = 'Kelompok';
			} else {
				$pembiayaan = 'Individu';
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,($i+1));
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$keterangan);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$jumlah_anggota);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$nominal);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$pembiayaan);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.').'%');
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.').'%');

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$ii++;
		}

		$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		$objPHPExcel->getActiveSheet()->getStyle('D'.$row_total)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$row_total)->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getStyle('D'.$row_total.':E'.$row_total)->getFont()->setBold(TRUE);

		$objPHPExcel->getActiveSheet()->setCellValue('D'.$row_total,$sum_anggota);
		$objPHPExcel->getActiveSheet()->setCellValue('E'.$row_total,$sum_pokok);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN REKAP PENGAJUAN PEMBIAYAAN BERDASARKAN '.strtoupper($by).' '.$from.' - '.$thru.' '.$data_cabang.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

		/****************************************************************************************/	
		// BEGIN REKAP PENCAIRAN PEMBIAYAAN BY CABANG
		/****************************************************************************************/
		//semua cabang
		public function export_rekap_pencairan_pembiayaan_semua_cabang()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_pencairan_pembiayaan_semua_cabang($tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Pencairan Pembiayaan Berdasarkan Cabang");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Nominal");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(40);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;

	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['amount']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		$total_anggota+=$datas[$i]['num'];     
	       			$total_pokok+=$datas[$i]['amount'];   
			        $persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['amount']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['amount'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);

				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_PENCAIRAN_PEMBIAYAAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}



	/****************************************************************************************/	
	// BEGIN REKAP PENCAIRAN PEMBIAYAAN BY CABANG
	/****************************************************************************************/
		public function export_rekap_pencairan_pembiayaan_cabang()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_pencairan_pembiayaan_cabang($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Pencairan Pembiayaan Berdasarkan Cabang");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Nominal");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(40);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;

	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['amount']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['amount']; 
	       			$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['amount']/$sum_pokok*100; 

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['branch_code']);
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['amount'],0,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.').' ');

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':C'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);

				}
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_PENCAIRAN_PEMBIAYAAN_BY_CABANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	/****************************************************************************************/	
	// END REKAP PENCAIRAN BY CABANG 	
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN REKAP PENCAIRAN PEMBIAYAAN BY REMBUG
	/****************************************************************************************/
		public function export_rekap_pencairan_pembiayaan_rembug()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_pencairan_pembiayaan_rembug($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Pencairan Pembiayaan Berdasarkan Rembug");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Nominal");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(40);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;

	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['amount']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['amount'];  
	       			$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['amount']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['cm_code']);
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['cm_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['amount'],0,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.').' ');

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':C'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);

				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_PENCAIRAN_PEMBIAYAAN_BY_REMBUG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	/****************************************************************************************/	
	// END REKAP PENCAIRAN BY REMBUG 	
	/****************************************************************************************/
	
	
	/****************************************************************************************/	
	// BEGIN REKAP PENCAIRAN PEMBIAYAAN BY PETUGAS
	/****************************************************************************************/
		public function export_rekap_pencairan_pembiayaan_petugas()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_pencairan_pembiayaan_petugas($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Pencairan Pembiayaan Berdasarkan Petugas");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Nominal");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(40);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;

	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['amount']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['amount'];  
	       			$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['amount']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['fa_code']);
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['fa_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['amount'],0,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.').' ');

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':C'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);

				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_PENCAIRAN_PEMBIAYAAN_BY_PETUGAS.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	/****************************************************************************************/	
	// END REKAP PENCAIRAN BY PETUGAS 	
	/****************************************************************************************/
		
		
	/****************************************************************************************/	
	// BEGIN REKAP PENCAIRAN PEMBIAYAAN BY PERUNTUKAN
	/****************************************************************************************/
		public function export_rekap_pencairan_pembiayaan_peruntukan()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_pencairan_pembiayaan_peruntukan($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Pencairan Pembiayaan Berdasarkan Peruntukan");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Nominal");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(40);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;

	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['amount']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['amount'];  
	       			$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['amount']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['code_value']);
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['display_text']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['amount'],0,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.').' ');

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':C'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);

				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_PENCAIRAN_PEMBIAYAAN_BY_PERUNTUKAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	/****************************************************************************************/	
	// END REKAP PENCAIRAN BY PERUNTUKAN 	
	/****************************************************************************************/
	
	/****************************************************************************************/	
	// BEGIN REKAP PENCAIRAN PEMBIAYAAN BY PRODUK
	/****************************************************************************************/
		public function export_rekap_pencairan_pembiayaan_produk()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_pencairan_pembiayaan_produk($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Pencairan Pembiayaan Berdasarkan Produk");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Nominal");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(40);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;

	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['amount']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['amount'];  
	       			$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['amount']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['product_code']);
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['product_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['amount'],0,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.').' ');

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':C'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);

				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_PENCAIRAN_PEMBIAYAAN_BY_PRODUK.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	/****************************************************************************************/	
	// END REKAP PENCAIRAN BY PRODUK 	
	/****************************************************************************************/
		
	/****************************************************************************************/	
	// BEGIN REKAP PENCAIRAN PEMBIAYAAN BY NOMINAL
	/****************************************************************************************/
		public function export_rekap_pencairan_pembiayaan_nominal()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_pencairan_pembiayaan_nominal($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Pencairan Pembiayaan Berdasarkan Nominal");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Nominal");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(40);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;

	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['amount']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['amount'];  
	       			$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['amount']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['nominal_code']);
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['nominal_text']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['amount'],0,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.').' ');

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':C'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);

				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_PENCAIRAN_PEMBIAYAAN_BY_NOMINAL.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	/****************************************************************************************/	
	// END REKAP PENCAIRAN BY NOMINAL  	
	/****************************************************************************************/
		
		//BY kecamatan
		public function export_rekap_pencairan_pembiayaan_kecamatan()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	        $kecamatan      = $this->uri->segment(6);
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_pencairan_pembiayaan_kecamatan($cabang,$tanggal1_,$tanggal2_,$kecamatan);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Pencairan Pembiayaan Berdasarkan Kecamatan");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Kecamatan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Droping");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(27);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii = 7;

	      		$total_anggota = 0;
	      		$total_droping = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['amount']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	        		 $total_droping+=$datas[$i]['amount'];  
	        		 $persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['amount']/$sum_pokok*100;   

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['kecamatan_code']);
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['kecamatan']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($datas[$i]['amount'],0,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_anggota,0,',','.').' ');
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_droping,0,',','.').' ');

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':D'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);

				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_PENCAIRAN_PEMBIAYAAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		// ----------------------------------------------------------------------
		// END REPORT PENCAIRAN PEMBIAYAAN
		// ----------------------------------------------------------------------

	/****************************************************************************************/	
	// BEGIN REKAP PENCAIRAN PEMBIAYAAN BY SEKTOR
	/****************************************************************************************/
		public function export_rekap_pencairan_pembiayaan_sektor()
		{
			$tanggal1       = $this->uri->segment(3);
	        $tanggal1__     = substr($tanggal1,0,2).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,4,4);
	        $tanggal1_      = substr($tanggal1,4,4).'-'.substr($tanggal1,2,2).'-'.substr($tanggal1,0,2);
	        $tanggal2       = $this->uri->segment(4);
	        $tanggal2__     = substr($tanggal2,0,2).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,4,4);
	        $tanggal2_      = substr($tanggal2,4,4).'-'.substr($tanggal2,2,2).'-'.substr($tanggal2,0,2);
	        $cabang         = $this->uri->segment(5);       
	            if ($cabang==false) 
	            {
	                $cabang = "0000";
	            } 
	            else 
	            {
	                $cabang =   $cabang;            
	            }

	       if ($tanggal1=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else if ($tanggal2=="")
	        {
	         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
	        }
	        else
	        {
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_pencairan_pembiayaan_sektor($cabang,$tanggal1_,$tanggal2_);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:F2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:F3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Pencairan Pembiayaan Berdasarkan Sektor");
				$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
				$objPHPExcel->getActiveSheet()->getStyle('A4:F4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$tanggal1__.' s/d '.$tanggal2__);
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Nominal");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Nominal");

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(40);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;

	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['amount']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['amount'];  
	       			$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['amount']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['code_value']);
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['display_text']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['amount'],0,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.').' ');

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':C'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':D'.$iii)->getFont()->setSize(10);

				}

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REKAP_PENCAIRAN_PEMBIAYAAN_BY_SEKTOR.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	/****************************************************************************************/	
	// END REKAP PENCAIRAN BY SEKTOR
	/****************************************************************************************/

		/****************************************************************************************/	
		// BEGIN REKAP OUTSTANDING PEMBIAYAAN BY CABANG
		/****************************************************************************************/
		//semua cabang
		public function export_rekap_outstanding_pembiayaan_semua_cabang()
		{
	        $cabang         = $this->uri->segment(3);       
            if ($cabang==false) 
            {
                $cabang = "0000";
            } 
            else
            {
                $cabang =   $cabang;            
            }
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_outstanding_pembiayaan_semua_cabang($cabang);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);


				$objPHPExcel->getActiveSheet()->mergeCells('A1:G1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:G1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:G2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:G2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:G3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:G3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Piutang Berdasarkan Cabang");/*
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Pokok");

				$objPHPExcel->getActiveSheet()->getStyle('A6:G6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:G6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:G6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$total_margin = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
	       			 $total_margin+=$datas[$i]['margin'];  

				 	$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':E'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':E'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':E'.$ii)->getFont()->setSize(10);
		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		//BY cabang
		public function export_rekap_outstanding_pembiayaan_cabang()
		{
	        $cabang         = $this->uri->segment(3);       
            if ($cabang==false) 
            {
                $cabang = "0000";
            } 
            else 
            {
                $cabang =   $cabang;            
            }
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_outstanding_pembiayaan_cabang($cabang);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);


				$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Piutang Berdasarkan Cabang");/*
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
				$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$total_margin = 0;
	      		$total_catab = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
	       			 $total_margin+=$datas[$i]['margin'];  
	       			 $total_catab+=$datas[$i]['catab'];  
	       			 $persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		//BY rembug
		public function export_rekap_outstanding_pembiayaan_rembug()
		{
	        $cabang         = $this->uri->segment(3);       
            if ($cabang==false) 
            {
                $cabang = "0000";
            } 
            else if ($cabang==true) 
            {
                $cabang =   $cabang;            
            }
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_outstanding_pembiayaan_rembug($cabang);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);


				$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Piutang Berdasarkan Rembug");/*
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
				$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);


				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$total_margin = 0;
	      		$total_catab = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
	       			 $total_margin+=$datas[$i]['margin'];  
	       			 $total_catab+=$datas[$i]['catab'];  
	       			$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['cm_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);
		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		//BY Petugas
		public function export_rekap_outstanding_pembiayaan_petugas()
		{
	        $cabang         = $this->uri->segment(3);       
            if ($cabang==false) 
            {
                $cabang = "0000";
            } 
            else if ($cabang==true) 
            {
                $cabang =   $cabang;            
            }
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_outstanding_pembiayaan_petugas($cabang);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Piutang Berdasarkan Petugas");/*
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
				$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				


						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$total_margin = 0;
	      		$total_catab = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
	       			 $total_margin+=$datas[$i]['margin'];  
	       			 $total_catab+=$datas[$i]['catab'];  
				 	$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['fa_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);


		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		//BY Peruntukan
		public function export_rekap_outstanding_pembiayaan_peruntukan()
		{
	        $cabang         = $this->uri->segment(3);       
            if ($cabang==false) 
            {
                $cabang = "0000";
            } 
            else if ($cabang==true) 
            {
                $cabang =   $cabang;            
            }
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_outstanding_pembiayaan_peruntukan($cabang);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Piutang Berdasarkan Peruntukan");/*
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
				$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$total_margin = 0;
	      		$total_catab = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
	       			 $total_margin+=$datas[$i]['margin'];  
	       			 $total_catab+=$datas[$i]['catab'];  
	       			 $persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['display_text']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);


		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		//BY Peruntukan
		public function export_rekap_outstanding_pembiayaan_sektor_usaha()
		{
	        $cabang         = $this->uri->segment(3);       
            if ($cabang==false) 
            {
                $cabang = "0000";
            } 
            else if ($cabang==true) 
            {
                $cabang =   $cabang;            
            }
	        
	                $datas = $this->model_laporan_to_pdf->export_rekap_outstanding_pembiayaan_sektor_usaha($cabang);
			            if ($cabang !='0000') 
			            {
			                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
			            } 
			            else 
			            {
			                $datacabang = "Semua Cabang";
			            }
				
				// ----------------------------------------------------------
		    	// [BEGIN] EXPORT SCRIPT
				// ----------------------------------------------------------

				// Create new PHPExcel object
				$objPHPExcel = $this->phpexcel;
				// Set document properties
				$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
											 ->setLastModifiedBy("MICROFINANCE")
											 ->setTitle("Office 2007 XLSX Test Document")
											 ->setSubject("Office 2007 XLSX Test Document")
											 ->setDescription("REPORT, generated using PHP classes.")
											 ->setKeywords("REPORT")
											 ->setCategory("Test result file");

				$objPHPExcel->setActiveSheetIndex(0); 

				$styleArray = array(
		       		'borders' => array(
				             'outline' => array(
				                    'style' => PHPExcel_Style_Border::BORDER_THIN,
				                    'color' => array('rgb' => '000000'),
				             ),
				       ),
				);

				$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
				$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
				$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
				$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
				$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
				$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Outstanding Piutang Berdasarkan Sektor Usaha");/*
				$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
				$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
				$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
				$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
				$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
				$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
				$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
				$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
				
				$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

				$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
				$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
				$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
						
				$ii = 7;

	      		$total_anggota = 0;
	      		$total_pokok = 0;
	      		$total_margin = 0;
	      		$total_catab = 0;
	      		$sum_anggota = 0;
        		$sum_pokok = 0;

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
	        		$sum_anggota+=$datas[$i]['num'];     
	       			$sum_pokok+=$datas[$i]['pokok']; 
				}

				for( $i = 0 ; $i < count($datas) ; $i++ )
				{ 
	        		 $total_anggota+=$datas[$i]['num'];     
	       			 $total_pokok+=$datas[$i]['pokok'];  
	       			 $total_margin+=$datas[$i]['margin'];  
	       			 $total_catab+=$datas[$i]['catab'];  
	       			 $persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
			        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;


					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['display_text']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

					$ii++;
				
				}//END FOR

				$iii = count($datas)+8;
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);


		
			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="REPORT_REKAP_OUTSTANDING_PIUTANG.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}

		// ----------------------------------------------------------------------
		// END REPORT OUTSTANDING PEMBIAYAAN
		// ----------------------------------------------------------------------


	/****************************************************************************************/	
	// BEGIN LIST SALDO TABUNGAN
	/****************************************************************************************/
	public function export_list_pembukaan_tabungan()
	{
		$produk 		= $this->uri->segment(3);		
		$branch_code 	= $this->uri->segment(4);

		$now = date('Y-m-d');

        if($branch_code=='00000'){
            $branch_name = 'KANTOR PUSAT';
        }else{
            $branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_name = 'KANTOR CABANG '.strtoupper($branch['branch_name']);
        }

		$datas 			= $this->model_laporan->export_list_pembukaan_tabungan($produk,$branch_code);
        
		if($produk == 'all'){
			$produk_name = 'SEMUA PRODUK';
		} else {
			$produk_name = $this->model_laporan->get_produk($produk);
		}
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('C1:I1');
		$objPHPExcel->getActiveSheet()->setCellValue('C1',$branch_name);
		$objPHPExcel->getActiveSheet()->getStyle('C1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('C2:I2');
		$objPHPExcel->getActiveSheet()->setCellValue('C2',"SALDO TABUNGAN");
		$objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('C4:I4');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',"Produk : ".$produk_name);
		$objPHPExcel->getActiveSheet()->getStyle('C4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"No Rekening");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Majelis");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"Nama");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"Produk");
		$objPHPExcel->getActiveSheet()->setCellValue('H6',"Aktif");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"Saldo");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('C1:C4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('C1:C4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C6:I6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C6:I6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:I6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6:G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6:H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6:I6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(25);

			$ii = 7;
			$row_total = count($datas)+8;
	        $total_saldo = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
				$status_rekening = $datas[$i]['status_rekening'];
				if($status_rekening==1){
					$status_rekening = "Aktif";
				}else{
					$status_rekening = "Tidak Aktif";
				}

		        $total_saldo     			+= $datas[$i]['saldo_memo'];

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".$datas[$i]['account_saving_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['cm_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$datas[$i]['product_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$status_rekening);
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".number_format($datas[$i]['saldo_memo'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':I'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':I'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('I'.$row_total," ".number_format($total_saldo,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-SALDO-TABUNGAN-'.$branch_name.'-'.$now.'.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN SALDO TABUNGAN
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LIST BLOKIR TABUNGAN
	/****************************************************************************************/
	public function export_list_blokir_tabungan()
	{
        $from_date  = $this->uri->segment(3);
        $from_date = substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
        $thru_date  = $this->uri->segment(4);   
        $thru_date = substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2); 

		$datas 			= $this->model_laporan_to_pdf->export_list_blokir_tabungan($from_date,$thru_date);
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:G1');
		// $objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('E1',"KANTOR PUSAT");
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:G2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',"Laporan Blokir Saldo Tabungan");
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E4:G4');
		$objPHPExcel->getActiveSheet()->setCellValue('E4',"Tanggal Blokir : ".$from_date." s/d ".$thru_date);
		$objPHPExcel->getActiveSheet()->getStyle('E4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"No Rekening");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Nama");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"Tanggal Blokir");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"Jumlah");
		$objPHPExcel->getActiveSheet()->setCellValue('H6',"Tanggal Buka");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"Keterangan");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C6:I6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C6:I6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:I6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6:G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6:H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6:I6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(25);

			$ii = 7;
			$row_total = count($datas)+8;
	        $total_saldo = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        $total_saldo     			+= $datas[$i]['jumlah'];

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".$datas[$i]['no_rek']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$this->format_date_detail($datas[$i]['tgl_blokir'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['jumlah'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$this->format_date_detail($datas[$i]['tgl_buka'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$datas[$i]['keterangan']);

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':I'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':I'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('G'.$row_total," ".number_format($total_saldo,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-BLOKIR-TABUNGAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN BLOKIR TABUNGAN
	/****************************************************************************************/


	/****************************************************************************************/	
	// BEGIN LIST REKENING TABUNGAN
	/****************************************************************************************/
	public function export_list_rekening_tabungan()
	{
        $cif_no     	 = $this->uri->segment(3);
        $no_rek     	 = $this->uri->segment(4);
        // $produk     	 = $this->uri->segment(5);
        $from_date1  	 = $this->uri->segment(5);
        $from_date  	 = substr($from_date1,4,4).'-'.substr($from_date1,2,2).'-'.substr($from_date1,0,2);
        $thru_date1  	 = $this->uri->segment(6);   
        $thru_date  	 = substr($thru_date1,4,4).'-'.substr($thru_date1,2,2).'-'.substr($thru_date1,0,2);  
 
 		$datas 			 = $this->model_laporan->export_list_statement_tabungan($cif_no,$no_rek,$from_date,$thru_date);
        $produk_name	 = $this->model_laporan->get_produk_saving_by_norek($no_rek);
        $nama			 = $this->model_laporan->get_nama($cif_no);
 
        $awal_debit      = $this->model_laporan->get_saldo_awal_debet($no_rek,$from_date);
        $awal_credit     = $this->model_laporan->get_saldo_awal_credit($no_rek,$from_date);
        $saldo_awal      = $awal_credit['credit']-$awal_debit['debit'];
        $tgl_saldo_akhir = date("Y-m-d",strtotime($from_date.' -1 days'));
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:G1');
		// $objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('E1',"KANTOR PUSAT");
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:G2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',"STATEMENT");
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',"No. Rekening : ".$no_rek);

		$objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
		$objPHPExcel->getActiveSheet()->setCellValue('C5',"Nama : ".$nama);

		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"Produk : ".$produk_name);

		$objPHPExcel->getActiveSheet()->mergeCells('C7:E7');
		$objPHPExcel->getActiveSheet()->setCellValue('C7',"Periode : ".$this->format_date_detail($from_date,'id',false,'-')." s/d ".$this->format_date_detail($thru_date,'id',false,'-'));

		$objPHPExcel->getActiveSheet()->setCellValue('C9',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D9',"Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('E9',"Keterangan");
		$objPHPExcel->getActiveSheet()->setCellValue('F9',"D/C");
		$objPHPExcel->getActiveSheet()->setCellValue('G9',"Jumlah");
		$objPHPExcel->getActiveSheet()->setCellValue('H9',"Saldo");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C9:H9')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C9:H9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C9:H9')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C9:C9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D9:D9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E9:E9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F9:F9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G9:G9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H9:H9')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(35);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(25);

			$objPHPExcel->getActiveSheet()->setCellValue('C10',"1");
			$objPHPExcel->getActiveSheet()->setCellValue('D10'," ".$this->format_date_detail($tgl_saldo_akhir,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->setCellValue('E10',"Saldo Awal");
			$objPHPExcel->getActiveSheet()->setCellValue('F10',"-");
			$objPHPExcel->getActiveSheet()->setCellValue('G10',"-");
			$objPHPExcel->getActiveSheet()->setCellValue('H10'," ".number_format($saldo_awal,0,',','.'));

			$objPHPExcel->getActiveSheet()->getStyle('C10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C10:H10')->getFont()->setSize(9);
			$objPHPExcel->getActiveSheet()->getStyle('C10:F10')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('C10:H10')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

			$ii = 11;
      		$saldo  = $saldo_awal; 
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        if($datas[$i]['flag_debit_credit']=="D") {
		          $saldo -= $datas[$i]['amount'];
		        }else{
		          $saldo += $datas[$i]['amount'];
		        }

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+2));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".$this->format_date_detail($datas[$i]['trx_date'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['description']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['flag_debit_credit']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['amount'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($saldo,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':H'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-REKENING-TABUNGAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN REKENING TABUNGAN
	/****************************************************************************************/


	/****************************************************************************************/	
	// BEGIN LAPORAN LABA RUGI
	/****************************************************************************************/
	public function export_lap_lr()
	{
        $cabang     = $this->uri->segment(3);

        if ($cabang=="") 
        {            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        } 
        else
        {

		$datas 			= $this->model_laporan_to_pdf->getReportItem();
        $branch_name    = $this->model_laporan_to_pdf->get_cabang($cabang);

		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('C1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('C1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('C1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('C2',"LAPORAN LABA RUGI");
		$objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',"Per Tanggal : ".date("Y-m-d"));

		$objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
		$objPHPExcel->getActiveSheet()->setCellValue('C5',"Cabang : ".$branch_name);

		$objPHPExcel->getActiveSheet()->getStyle('C1:C2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('C1')->getFont()->setSize(16);
		$objPHPExcel->getActiveSheet()->getStyle('C2')->getFont()->setSize(14);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(60);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);

			$ii = 7;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				  if($datas[$i]['item_type']=="0")
		          {
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setBold(true);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setSize(12);
		          }
		          else if($datas[$i]['item_type']=="1")
		          {
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setBold(false);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setSize(10);
		          }
		          else if($datas[$i]['item_type']=="2")
		          {
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setBold(false);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setSize(9);
		          }

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['item_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['saldo'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);

				$ii++;
			
			}//END FOR*/

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-LABA-RUGI.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}
	/****************************************************************************************/	
	// END LAPORAN LABA RUGI
	/****************************************************************************************/


	/****************************************************************************************/	
	// BEGIN LAPORAN NERACA
	/****************************************************************************************/
	public function export_neraca_gl()
	{
        $cabang     = $this->uri->segment(3);

        if ($cabang=="") 
        {            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        } 
        else
        {

		$datas 			= $this->model_laporan_to_pdf->export_neraca_gl();
        $branch_name    = $this->model_laporan_to_pdf->get_cabang($cabang);

		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('C1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('C1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('C1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('C2',"LAPORAN NERACA");
		$objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',"Per Tanggal : ".date("Y-m-d"));

		$objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
		$objPHPExcel->getActiveSheet()->setCellValue('C5',"Cabang : ".$branch_name);

		$objPHPExcel->getActiveSheet()->getStyle('C1:C2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('C1')->getFont()->setSize(16);
		$objPHPExcel->getActiveSheet()->getStyle('C2')->getFont()->setSize(14);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(60);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);

			$ii = 7;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				  if($datas[$i]['item_type']=="0")
		          {
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setBold(true);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setSize(12);
		          }
		          else if($datas[$i]['item_type']=="1")
		          {
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setBold(false);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setSize(10);
		          }
		          else if($datas[$i]['item_type']=="2")
		          {
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setBold(false);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->getFont()->setSize(9);
		          }

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['item_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['saldo'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);

				$ii++;
			
			}//END FOR*/

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-NERACA.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}
	/****************************************************************************************/	
	// END LAPORAN NERACA
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LIST PEMBUKAAN DEPOSITO
	/****************************************************************************************/
	public function export_list_pembukaan_deposito()
	{
        $from_date  = $this->uri->segment(3);
        $from_date = substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
        $thru_date  = $this->uri->segment(4);   
        $thru_date = substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2); 

		$datas 			= $this->model_laporan_to_pdf->export_list_pembukaan_deposito($from_date,$thru_date);
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:G1');
		// $objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('E1',"KANTOR PUSAT");
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:G2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',"Laporan Pembukaan Deposito");
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E4:G4');
		$objPHPExcel->getActiveSheet()->setCellValue('E4',"Periode : ".$from_date." s/d ".$thru_date);
		$objPHPExcel->getActiveSheet()->getStyle('E4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"No Rekening");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Nama");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"Nominal");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"Jangka Waktu");
		$objPHPExcel->getActiveSheet()->setCellValue('H6',"Tanggal Buka");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"Tanggal Jto");
		$objPHPExcel->getActiveSheet()->setCellValue('J6',"Aro");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C6:J6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C6:J6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:J6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6:G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6:H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6:I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6:J6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(7);

			$ii = 7;
			$row_total = count($datas)+8;
	        $total_saldo = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        $total_saldo     			+= $datas[$i]['nominal'];

		        if($datas[$i]['automatic_roll_over']==0){
		        	$aro = "T";
		        }else{
		        	$aro = "Y";
		        }

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".$datas[$i]['account_deposit_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['nominal'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$datas[$i]['jangka_waktu']." Bulan");
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$this->format_date_detail($datas[$i]['tanggal_buka'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$this->format_date_detail($datas[$i]['tanggal_jtempo_last'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$aro);

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':J'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':J'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('F'.$row_total," ".number_format($total_saldo,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-PEMBUKAAN-DEPOSITO.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN PEMBUKAAN DEPOSITO
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LIST SALDO DEPOSITO
	/****************************************************************************************/
	public function export_list_saldo_deposito()
	{
        $produk  		= $this->uri->segment(3);
		$datas 	 		= $this->model_laporan->export_list_saldo_deposito($produk);
        $product_name  	= $this->model_laporan->get_produk_deposito($produk);
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('C1:G1');
		// $objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('C1',"KANTOR PUSAT");
		$objPHPExcel->getActiveSheet()->getStyle('C1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('C2:G2');
		$objPHPExcel->getActiveSheet()->setCellValue('C2',"Laporan Saldo Deposito Per Produk");
		$objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('C4:G4');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',"Produk : ".$product_name);
		$objPHPExcel->getActiveSheet()->getStyle('C4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"Kode");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Keterangan");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"Jumlah");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"Nominal");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C6:G6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C6:G6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:G6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6:G6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(35);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);

			$ii = 7;
			$row_total 		= count($datas)+8;
	        $total_saldo 	= 0;
	        $total_anggota 	= 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        $total_saldo     			+= $datas[$i]['nominal'];
		        $total_anggota     			+= $datas[$i]['jumlah'];

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['kode']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['keterangan']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['jumlah']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['nominal'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->getStyle('F'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$row_total,$total_anggota);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$row_total," ".number_format($total_saldo,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-SALDO-DEPOSITO.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN SALDO DEPOSITO
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LIST PENCAIRAN DEPOSITO
	/****************************************************************************************/
	public function export_lap_droping_deposito()
	{
		$from_date 	= $this->uri->segment(3);
		$from_date 	= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(4);	
		$thru_date 	= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);			
		$cabang 	= $this->uri->segment(5);				
		$rembug 	= $this->uri->segment(6);				
			if ($rembug==false) 
			{
				$rembug = "";
			} 
			else 
			{
				$rembug =	$rembug;			
			}

		if ($cabang=="") 
        {            
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        }
        else if ($from_date=="") 
        {            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }
        else if ($thru_date=="") 
        {            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }
        else
        {				
				
				
					$datas = $this->model_laporan_to_pdf->export_lap_droping_deposito($cabang,$rembug,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $data_cabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $data_cabang = "Semua Cabang";
		            }
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:G1');
		// $objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:G2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',"Laporan Pencairan Deposito");
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E4:G4');
		$objPHPExcel->getActiveSheet()->setCellValue('E4',"Periode : ".$from_date." s/d ".$thru_date);
		$objPHPExcel->getActiveSheet()->getStyle('E4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"No Rekening");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Nama");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"Jangka Waktu");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"Tanggal Buka");
		$objPHPExcel->getActiveSheet()->setCellValue('H6',"Tanggal Cair");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"Bagi Hasil");
		$objPHPExcel->getActiveSheet()->setCellValue('J6',"Nominal");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C6:J6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C6:J6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:J6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6:G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6:H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6:I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6:J6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);

			$ii = 7;
			$row_total = count($datas)+8;
	        $total_saldo = 0;
	        $total_bahas = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        $total_saldo     			+= $datas[$i]['nominal'];
		        $total_bahas     			+= $datas[$i]['nilai_bagihasil_last'];

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".$datas[$i]['account_deposit_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['jangka_waktu']." Bulan");
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$this->format_date_detail($datas[$i]['tanggal_buka'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$this->format_date_detail($datas[$i]['trx_date'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".number_format($datas[$i]['nilai_bagihasil_last'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".number_format($datas[$i]['nominal'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':J'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':J'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('I'.$row_total," ".number_format($total_bahas,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$row_total," ".number_format($total_saldo,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-PENCAIRAN-DEPOSITO.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}
	/****************************************************************************************/	
	// END LAPORAN PENCAIRAN DEPOSITO
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LIST REKAP REKENING DEPOSITO
	/****************************************************************************************/
	public function export_rekap_pembukaan_deposito()
	{
        $produk  		= $this->uri->segment(3);
		$from_date 		= $this->uri->segment(4);
		$from_date 		= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 		= $this->uri->segment(5);	
		$thru_date 		= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);	
		$datas 	 		= $this->model_laporan->export_rekap_pembukaan_deposito($produk,$from_date,$thru_date);
        $product_name  	= $this->model_laporan->get_produk_deposito($produk);
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('C1:G1');
		// $objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('C1',"KANTOR PUSAT");
		$objPHPExcel->getActiveSheet()->getStyle('C1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('C2:G2');
		$objPHPExcel->getActiveSheet()->setCellValue('C2',"Laporan Rekap Registrasi Deposito Per Produk");
		$objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('C3:G3');
		$objPHPExcel->getActiveSheet()->setCellValue('C3',"Produk : ".$product_name);
		$objPHPExcel->getActiveSheet()->getStyle('C3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('C4:G4');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',"Tanggal : ".$from_date." s/d ".$thru_date);
		$objPHPExcel->getActiveSheet()->getStyle('C4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"Kode");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Keterangan");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"Jumlah");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"Nominal");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C6:G6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C6:G6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:G6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6:G6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(35);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);

			$ii = 7;
			$row_total 		= count($datas)+8;
	        $total_saldo 	= 0;
	        $total_anggota 	= 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        $total_saldo     			+= $datas[$i]['nominal'];
		        $total_anggota     			+= $datas[$i]['jumlah'];

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['kode']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['keterangan']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['jumlah']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['nominal'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->getStyle('F'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$row_total,$total_anggota);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$row_total," ".number_format($total_saldo,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-REKAP-REGISTRASI-DEPOSITO.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN REKAP REKENING DEPOSITO
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LIST OUTSTANDING DEPOSITO
	/****************************************************************************************/
	public function export_rekap_outstanding_deposito()
	{		
		$tanggal 	= $this->current_date();
		$produk 	= $this->uri->segment(3);				
		$cabang 	= $this->uri->segment(4);				
		$rembug 	= $this->uri->segment(5);	

		if ($rembug==false) 
		{
			$rembug = "";
		} 
		else 
		{
			$rembug =	$rembug;			
		}

		$datas 			= $this->model_laporan_to_pdf->export_rekap_outstanding_deposito($cabang,$rembug,$tanggal,$produk);
        $product_name   = $this->model_laporan->get_produk_deposito($produk);
        
        if ($cabang !='0000') 
        {
            $data_cabang = $this->model_laporan_to_pdf->get_cabang($cabang);
        } 
        else 
        {
            $data_cabang = "Semua Cabang";
        }
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:G1');
		$objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:G2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',"Laporan Outstanding Deposito");
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E3:G3');
		$objPHPExcel->getActiveSheet()->setCellValue('E3',"Produk : ".$product_name);
		$objPHPExcel->getActiveSheet()->getStyle('E3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E4:G4');
		$objPHPExcel->getActiveSheet()->setCellValue('E4',"Tanggal : ".$tanggal);
		$objPHPExcel->getActiveSheet()->getStyle('E4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C7',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D7',"No Rekening");
		$objPHPExcel->getActiveSheet()->setCellValue('E7',"Nama");
		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Tanggal Jto");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Aro");
		$objPHPExcel->getActiveSheet()->setCellValue('H7',"Nominal");
		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Cad. Bagi Hasil");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C7:I7')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C7:I7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C7:I7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C7:C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7:D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7:E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7:F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7:G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7:H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7:I7')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);

			$ii = 7;
			$row_total = count($datas)+8;
	        $total_saldo = 0;
	        $total_bahas = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        $total_saldo     			+= $datas[$i]['nominal'];
		        $total_bahas     			+= $datas[$i]['nilai_cadangan_bagihasil'];

		        if($datas[$i]['automatic_roll_over']==0){
		        	$aro = "T";
		        }else{
		        	$aro = "Y";
		        }

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".$datas[$i]['account_deposit_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$this->format_date_detail($datas[$i]['tanggal_jtempo_last'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$aro);
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['nominal'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".number_format($datas[$i]['nilai_cadangan_bagihasil'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':I'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':I'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('H'.$row_total," ".number_format($total_saldo,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$row_total," ".number_format($total_bahas,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-OUTSTANDING-DEPOSITO.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN OUTSTANDING DEPOSITO
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LIST BAGI HASIL DEPOSITO
	/****************************************************************************************/
	public function export_rekap_bagi_hasil_deposito()
	{	
        $produk  		= $this->uri->segment(3);
		$from_date 		= $this->uri->segment(4);
		$from_date 		= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 		= $this->uri->segment(5);	
		$thru_date 		= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);	
		$datas 	 		= $this->model_laporan->export_rekap_bagi_hasil_deposito($produk,$from_date,$thru_date);
        $product_name  	= $this->model_laporan->get_produk_deposito($produk);
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('C1:I1');
		$objPHPExcel->getActiveSheet()->setCellValue('C1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('C1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('C2:I2');
		$objPHPExcel->getActiveSheet()->setCellValue('C2',"Laporan Outstanding Deposito");
		$objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('C3:I3');
		$objPHPExcel->getActiveSheet()->setCellValue('C3',"Produk : ".$product_name);
		$objPHPExcel->getActiveSheet()->getStyle('C3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('C4:I4');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',"Tanggal : ".$from_date." s/d ".$thru_date);
		$objPHPExcel->getActiveSheet()->getStyle('C4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C7',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D7',"Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('E7',"No Rekening");
		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Nama");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Nominal");
		$objPHPExcel->getActiveSheet()->setCellValue('H7',"Bagi Hasil");
		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Zakat");
		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Pajak");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('C1:C4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('C1:C4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C7:J7')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C7:J7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C7:J7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C7:C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7:D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7:E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7:F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7:G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7:H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7:I7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7:J7')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(16);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);

			$ii = 7;
			$row_total = count($datas)+8;
	        $total_saldo = 0;
	        $total_bahas = 0;
	        $total_pajak = 0;
	        $total_zakat = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        $total_saldo     			+= $datas[$i]['nominal'];
		        $total_bahas     			+= $datas[$i]['nominal_bahas'];
		        $total_pajak     			+= $datas[$i]['pajak_bahas'];
		        $total_zakat     			+= $datas[$i]['zakat_bahas'];

		        if($datas[$i]['automatic_roll_over']==0){
		        	$aro = "T";
		        }else{
		        	$aro = "Y";
		        }

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->format_date_detail($datas[$i]['tanggal'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".$datas[$i]['account_deposit_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['saldo_bahas'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['nominal_bahas'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".number_format($datas[$i]['zakat_bahas'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".number_format($datas[$i]['pajak_bahas'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':J'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':J'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('G'.$row_total," ".number_format($total_saldo,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$row_total," ".number_format($total_bahas,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$row_total," ".number_format($total_zakat,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$row_total," ".number_format($total_pajak,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-BAGIHASIL-DEPOSITO.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN BAGI HASIL DEPOSITO
	/****************************************************************************************/


	/****************************************************************************************/	
	// BEGIN LIST REKENING DEPOSITO
	/****************************************************************************************/
	public function export_list_rekening_deposito()
	{
        $cif_no     	= $this->uri->segment(3);
        $no_rek     	= $this->uri->segment(4);
        $produk     	= $this->uri->segment(5);
        $from_date1  	= $this->uri->segment(6);
        $from_date  	= substr($from_date1,4,4).'-'.substr($from_date1,2,2).'-'.substr($from_date1,0,2);
        $thru_date1  	= $this->uri->segment(7);   
        $thru_date  	= substr($thru_date1,4,4).'-'.substr($thru_date1,2,2).'-'.substr($thru_date1,0,2);  

		$datas 			= $this->model_laporan->export_list_rekening_deposito($cif_no,$no_rek,$produk,$from_date,$thru_date);
        $produk_name	= $this->model_laporan->get_produk_deposito($produk);
        $nama			= $this->model_laporan->get_nama($cif_no);
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:G1');
		$objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:G2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',"History Transaksi Deposito");
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',"No. Rekening : ".$no_rek);

		$objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
		$objPHPExcel->getActiveSheet()->setCellValue('C5',"Nama : ".$nama);

		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"Produk : ".$produk_name);

		$objPHPExcel->getActiveSheet()->mergeCells('C7:E7');
		$objPHPExcel->getActiveSheet()->setCellValue('C7',"Periode : ".$from_date." s/d ".$thru_date);

		$objPHPExcel->getActiveSheet()->mergeCells('C9:C10');
		$objPHPExcel->getActiveSheet()->mergeCells('D9:D10');
		$objPHPExcel->getActiveSheet()->mergeCells('E9:E10');
		$objPHPExcel->getActiveSheet()->mergeCells('F9:G9');
		$objPHPExcel->getActiveSheet()->setCellValue('C9',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D9',"Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('E9',"Keterangan");
		$objPHPExcel->getActiveSheet()->setCellValue('F9',"Jumlah");
		$objPHPExcel->getActiveSheet()->setCellValue('F10',"DB");
		$objPHPExcel->getActiveSheet()->setCellValue('G10',"CR");

		
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C9:G9')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C9:G10')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C9:G10')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C9:C10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D9:D10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E9:E10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F9:F10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F9:F9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G9:G9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G9:G10')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(35);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(25);

			$ii = 11;
	        $total_saldo = 0;
	        $total_bahas = 0;
	        $total_pajak = 0;
	        $total_depo  = 0;
			$row_total = count($datas)+13;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				$total_saldo     			+= $datas[$i]['nominal'];
		        $total_bahas     			+= $datas[$i]['nominal_bahas'];
		        $total_pajak     			+= $datas[$i]['pajak_bahas'];

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".$this->format_date_detail($datas[$i]['trx_date'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['description']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['nominal'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['nominal_bahas'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('E'.$row_total,"Buka Deposito");
				$objPHPExcel->getActiveSheet()->setCellValue('E'.($row_total+1),"Bagi Hasil");
				$objPHPExcel->getActiveSheet()->setCellValue('E'.($row_total+2),"Pajak Bagi Hasil");
				$objPHPExcel->getActiveSheet()->setCellValue('E'.($row_total+3),"Pencairan Deposito");

				$objPHPExcel->getActiveSheet()->setCellValue('F'.$row_total," ".number_format($total_saldo,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.($row_total+1)," ".number_format($total_bahas,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.($row_total+2)," ".number_format($total_pajak,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.($row_total+3)," ".number_format($total_depo,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-HISTORY-TRX-DEPOSITO.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN REKENING DEPOSITO
	/****************************************************************************************/

	/****************************************************************************************/	
	// BEGIN LAPORAN TRANSAKSI TABUNGAN
	/****************************************************************************************/
	public function export_lap_transaksi_tabungan()
	{
		$from_date 	= $this->uri->segment(3);
		$from_date = substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(4);	
		$thru_date = substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);			
		$cabang 	= $this->uri->segment(5);				
		$rembug 	= $this->uri->segment(6);				
			if ($rembug==false) 
			{
				$rembug = "";
			} 
			else 
			{
				$rembug =	$rembug;			
			}

		if ($cabang=="") 
        {            
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        }
        else if ($from_date=="") 
        {            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }
        else if ($thru_date=="") 
        {            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }
        else
        {				
				
				
					$datas = $this->model_laporan_to_pdf->export_lap_transaksi_tabungan($cabang,$rembug,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $data_cabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $data_cabang = "Semua Cabang";
		            }

				
				
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);
		
		$objPHPExcel->getActiveSheet()->mergeCells('D1:H1');
		$objPHPExcel->getActiveSheet()->setCellValue('D1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('D1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('D2:H2');
		$objPHPExcel->getActiveSheet()->setCellValue('D2',$data_cabang);
		$objPHPExcel->getActiveSheet()->getStyle('D2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('D3:H3');
		$objPHPExcel->getActiveSheet()->setCellValue('D3',"Laporan Transaksi Tabungan");
		$objPHPExcel->getActiveSheet()->getStyle('D3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('D4:H4');
		$objPHPExcel->getActiveSheet()->setCellValue('D4',$from_date.' s/d '.$thru_date);
		$objPHPExcel->getActiveSheet()->getStyle('D4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('B6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"TANGGAL");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"NO. REKENING");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"NAMA");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"KODE");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"D/C");
		$objPHPExcel->getActiveSheet()->setCellValue('H6',"JUMLAH");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"KETERANGAN");
		
		$objPHPExcel->getActiveSheet()->getStyle('D1:H4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B6:I6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D1:H4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('B6:I6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('B6:I6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B6:I6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);

					
			$ii = 7;
			$row_total 	 = count($datas)+8;
		    $total_pokok = 0;
		    $debet 		 = 0;
		    $credit 	 = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

		        $total_pokok += $datas[$i]['amount'];

		        if($datas[$i]['flag_debit_credit']=="D"){
		          $debet += $datas[$i]['amount'];
		        }else{
		          $debet = 0;
		        }   
		        if($datas[$i]['flag_debit_credit']=="C"){
		          $credit += $datas[$i]['amount'];
		        }else{
		          $credit = 0;
		        }

				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$this->format_date_detail($datas[$i]['trx_date'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,"'".$datas[$i]['account_saving_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['trx_saving_type']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$datas[$i]['flag_debit_credit']);
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['amount'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$datas[$i]['description']);

				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':I'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':G'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('H'.$row_total," ".number_format($total_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->getStyle('H'.$row_total)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.($row_total+5),"Tunai");
				$objPHPExcel->getActiveSheet()->setCellValue('F'.($row_total+6),"Pinbuk");
				$objPHPExcel->getActiveSheet()->setCellValue('G'.($row_total+4),"Debet");
				$objPHPExcel->getActiveSheet()->setCellValue('H'.($row_total+4),"Credit");

				$objPHPExcel->getActiveSheet()->setCellValue('G'.($row_total+5),number_format($debet,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.($row_total+6),number_format($debet,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.($row_total+5),number_format($credit,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.($row_total+6),number_format($credit,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('F'.($row_total+4))->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.($row_total+5))->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.($row_total+6))->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getStyle('G'.($row_total+4))->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.($row_total+5))->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.($row_total+6))->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getStyle('H'.($row_total+4))->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.($row_total+5))->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.($row_total+6))->applyFromArray($styleArray);

				$objPHPExcel->getActiveSheet()->getStyle('F'.($row_total+4).':F'.($row_total+6))->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('G'.($row_total+4).':G'.($row_total+6))->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('H'.($row_total+4).':H'.($row_total+6))->getFont()->setSize(9);

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-TRANSAKSI-TABUNGAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');
		}

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN TRANSAKSI TABUNGAN
	/****************************************************************************************/


	/****************************************************************************************/	
	// BEGIN LAPORAN TRANSAKSI AKUN
	/****************************************************************************************/
	public function export_lap_transaksi_akun()
	{
		$from_date 	= $this->uri->segment(3);
		$from_date = substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(4);	
		$thru_date = substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);			
		$cabang 	= $this->uri->segment(5);				
		$rembug 	= $this->uri->segment(6);				
			if ($rembug==false) 
			{
				$rembug = "";
			} 
			else 
			{
				$rembug =	$rembug;			
			}

		if ($cabang=="") 
        {            
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        }
        else if ($from_date=="") 
        {            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }
        else if ($thru_date=="") 
        {            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }
        else
        {				
				
				
					$datas = $this->model_laporan_to_pdf->export_lap_transaksi_akun($cabang,$rembug,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $data_cabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $data_cabang = "Semua Cabang";
		            }

				
				
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);
		
		$objPHPExcel->getActiveSheet()->mergeCells('D1:H1');
		$objPHPExcel->getActiveSheet()->setCellValue('D1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('D1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('D2:H2');
		$objPHPExcel->getActiveSheet()->setCellValue('D2',$data_cabang);
		$objPHPExcel->getActiveSheet()->getStyle('D2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('D3:H3');
		$objPHPExcel->getActiveSheet()->setCellValue('D3',"Laporan Transaksi Tabungan");
		$objPHPExcel->getActiveSheet()->getStyle('D3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('D4:H4');
		$objPHPExcel->getActiveSheet()->setCellValue('D4',$from_date.' s/d '.$thru_date);
		$objPHPExcel->getActiveSheet()->getStyle('D4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('B6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"TANGGAL");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"VOUCHER");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"AKUN");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"NAMA");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"D/C");
		$objPHPExcel->getActiveSheet()->setCellValue('H6',"JUMLAH");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"KETERANGAN");
		
		$objPHPExcel->getActiveSheet()->getStyle('D1:H4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B6:I6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D1:H4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('B6:I6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('B6:I6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B6:I6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);

					
			$ii = 7;
			$row_total 	 = count($datas)+8;
		    $total_pokok = 0;
		    $debet 		 = 0;
		    $credit 	 = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

		        $total_pokok += $datas[$i]['amount'];

		        if($datas[$i]['flag_debit_credit']=="D"){
		          $debet += $datas[$i]['amount'];
		        }else{
		          $debet = 0;
		        }   
		        if($datas[$i]['flag_debit_credit']=="C"){
		          $credit += $datas[$i]['amount'];
		        }else{
		          $credit = 0;
		        }

				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$this->format_date_detail($datas[$i]['trx_date'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,"'".$datas[$i]['account_code']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['account_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$datas[$i]['flag_debit_credit']);
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['amount'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$datas[$i]['description']);

				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':I'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':I'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('H'.$row_total," ".number_format($total_pokok,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-TRANSAKSI-AKUN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');
		}

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}
	/****************************************************************************************/	
	// END LAPORAN TRANSAKSI AKUN
	/****************************************************************************************/

	public function export_list_buka_tabungan()
	{
		$produk 		= $this->uri->segment(3);        
        $from_date1 	= $this->uri->segment(4);
        $from_date  	= substr($from_date1,4,4).'-'.substr($from_date1,2,2).'-'.substr($from_date1,0,2);
        $thru_date1 	= $this->uri->segment(5);   
        $thru_date  	= substr($thru_date1,4,4).'-'.substr($thru_date1,2,2).'-'.substr($thru_date1,0,2);
        $cabang 		= $this->uri->segment(6);
		$datas 			= $this->model_laporan->export_list_buka_tabungan($produk,$from_date,$thru_date,$cabang);
        $produk_name	= $this->model_laporan->get_produk($produk);
        if($produk_name!=null){
        	$produk_name = $produk_name;
        }else{
        	$produk_name = "SEMUA PRODUK";
        }
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:I1');
		$objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:I2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',"LAPORAN PEMBUKAAN TABUNGAN");
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E3:I3');
		$objPHPExcel->getActiveSheet()->setCellValue('E3',"Produk : ".$produk_name);
		$objPHPExcel->getActiveSheet()->getStyle('E3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E4:I4');
		$objPHPExcel->getActiveSheet()->setCellValue('E4',"Tanggal Pembukaan : ".$this->format_date_detail($from_date,'id',false,'-')." s/d ".$this->format_date_detail($thru_date,'id',false,'-'));
		$objPHPExcel->getActiveSheet()->getStyle('E4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"No Rekening");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Nama");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"Majelis");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"Produk");
		$objPHPExcel->getActiveSheet()->setCellValue('H6',"Tgl Buka");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"Jangka Waktu");
		$objPHPExcel->getActiveSheet()->setCellValue('J6',"Tgl JTO");
		$objPHPExcel->getActiveSheet()->setCellValue('K6',"Setoran");
		$objPHPExcel->getActiveSheet()->setCellValue('L6',"Status");
		$objPHPExcel->getActiveSheet()->setCellValue('M6',"Saldo");
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C6:K6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C6:K6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:I6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6:G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6:H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6:I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6:J6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K6:K6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L6:L6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M6:M6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(20);

			$ii = 7;
			$row_total = count($datas)+8;
	        $total_saldo = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
				$status_rekening = $datas[$i]['status_rekening'];
				if($status_rekening==1){
					$status_rekening = "Aktif";
				}else{
					$status_rekening = "Tidak Aktif";
				}

		        $total_saldo     			+= $datas[$i]['saldo_memo'];

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".$datas[$i]['account_saving_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['cm_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$datas[$i]['product_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$this->format_date_detail($datas[$i]['tanggal_buka'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$datas[$i]['rencana_jangka_waktu']);
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$datas[$i]['tanggal_jtempo']);
				$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,$datas[$i]['rencana_setoran']);
				$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,$status_rekening);
				$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii," ".number_format($datas[$i]['saldo_memo'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':M'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':M'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('M'.$row_total," ".number_format($total_saldo,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-PEMBUKAAN-TABUNGAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}

	public function export_list_buka_tabungan_jtempo()
	{
		$produk 		= $this->uri->segment(3);        
        $from_date1 	= $this->uri->segment(4);
        $from_date  	= substr($from_date1,4,4).'-'.substr($from_date1,2,2).'-'.substr($from_date1,0,2);
        $thru_date1 	= $this->uri->segment(5);   
        $thru_date  	= substr($thru_date1,4,4).'-'.substr($thru_date1,2,2).'-'.substr($thru_date1,0,2);
        $cabang 		= $this->uri->segment(6);
		$datas 			= $this->model_laporan->export_list_buka_tabungan_jtempo($produk,$from_date,$thru_date,$cabang);
        $produk_name	= $this->model_laporan->get_produk($produk);
        if($produk_name!=null){
        	$produk_name = $produk_name;
        }else{
        	$produk_name = "SEMUA PRODUK";
        }
           
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('E1:J1');
		$objPHPExcel->getActiveSheet()->setCellValue('E1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('E1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E2:J2');
		$objPHPExcel->getActiveSheet()->setCellValue('E2',"LAPORAN PEMBUKAAN TABUNGAN");
		$objPHPExcel->getActiveSheet()->getStyle('E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('E3:J3');
		$objPHPExcel->getActiveSheet()->setCellValue('E3',"Produk : ".$produk_name);
		$objPHPExcel->getActiveSheet()->getStyle('E3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('E4:J4');
		$objPHPExcel->getActiveSheet()->setCellValue('E4',"Tanggal Jatuh Tempo : ".$this->format_date_detail($from_date,'id',false,'-')." s/d ".$this->format_date_detail($thru_date,'id',false,'-'));
		$objPHPExcel->getActiveSheet()->getStyle('E4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('C6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"Tgl Buka");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Tgl Jatuh Tempo");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"No Rekening");
		$objPHPExcel->getActiveSheet()->setCellValue('G6',"Nama");
		$objPHPExcel->getActiveSheet()->setCellValue('H6',"Produk");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"Jangka Waktu");
		$objPHPExcel->getActiveSheet()->setCellValue('J6',"Setoran");
		$objPHPExcel->getActiveSheet()->setCellValue('K6',"Status");
		$objPHPExcel->getActiveSheet()->setCellValue('L6',"Saldo");
		
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E1:E4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('C6:L6')->getFont()->setSize(9);
		$objPHPExcel->getActiveSheet()->getStyle('C6:L6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:J6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6:G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6:H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6:I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6:J6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K6:K6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L6:L6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(7);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(20);

			$ii = 7;
			$row_total = count($datas)+8;
	        $total_saldo = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
				$status_rekening = $datas[$i]['status_rekening'];
				if($status_rekening==1){
					$status_rekening = "Aktif";
				}else{
					$status_rekening = "Tidak Aktif";
				}

		        $total_saldo     			+= $datas[$i]['saldo_memo'];

				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->format_date_detail($datas[$i]['tanggal_buka'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,date('d-m-Y',strtotime($datas[$i]['tanggal_buka'] . ' + '.(7 * $datas[$i]['rencana_jangka_waktu']).' days' )));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".$datas[$i]['account_saving_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$datas[$i]['product_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$datas[$i]['rencana_jangka_waktu']);
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$datas[$i]['rencana_setoran']);
				$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,$status_rekening);
				$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii," ".number_format($datas[$i]['saldo_memo'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':L'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':L'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('L'.$row_total," ".number_format($total_saldo,0,',','.'));

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LIST-PEMBUKAAN-TABUNGAN.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}

	//EXPORT LAPORAN REKAP SALDO ANGGOTA
	public function export_rekap_saldo_anggota_semua_cabang()
	{
        $cabang         = $this->uri->segment(3);     

        if ($cabang==false){
            $cabang = "0000";
        }else{
            $cabang =   $cabang;            
        }
        
        $datas = $this->model_laporan_to_pdf->export_rekap_saldo_anggota($cabang);
        if ($cabang !='0000'){
            $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
        }else{
            $datacabang = "Semua Cabang";
        }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:J1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:J1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:J2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:J2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:J3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:J3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Saldo Anggota Berdasarkan Cabang");

			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah Anggota");
			// $objPHPExcel->getActiveSheet()->setCellValue('D6',"Investasi");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"LWK");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Wajib");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Kelompok");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"Sukarela");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('I6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('J6',"Catab");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

            $total_setoran_lwk  	 = 0;
            $total_simpanan_pokok    = 0;
            $total_tabungan_minggon  = 0;
            $total_tabungan_sukarela = 0;
            $total_tabungan_kelompok = 0;
            $total_saldo_pokok = 0;
            $total_saldo_margin = 0;
            $total_saldo_catab = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_setoran_lwk+=$datas[$i]['setoran_lwk'];     
       			 $total_simpanan_pokok+=$datas[$i]['simpanan_pokok'];  
       			 $total_tabungan_minggon+=$datas[$i]['tabungan_minggon'];  
       			 $total_tabungan_sukarela+=$datas[$i]['tabungan_sukarela'];  
       			 $total_tabungan_kelompok+=$datas[$i]['tabungan_kelompok'];  
       			 $total_saldo_pokok+=$datas[$i]['saldo_pokok'];  
       			 $total_saldo_margin+=$datas[$i]['saldo_margin'];  
       			 $total_saldo_catab+=$datas[$i]['saldo_catab'];  

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah_anggota']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['setoran_lwk'],0,',','.'));
				// $objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['simpanan_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tabungan_minggon'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tabungan_kelompok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['tabungan_sukarela'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['saldo_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".number_format($datas[$i]['saldo_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".number_format($datas[$i]['saldo_catab'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);				
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);				
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_setoran_lwk,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_simpanan_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tabungan_minggon,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tabungan_kelompok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_tabungan_sukarela,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_saldo_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$iii," ".number_format($total_saldo_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$iii," ".number_format($total_saldo_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$iii.':I'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$iii.':J'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getFont()->setSize(10);

	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REKAP SALDO ANGGOTA BY CABANG.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	public function export_rekap_saldo_anggota_cabang()
	{
        $cabang         = $this->uri->segment(3);     

        if ($cabang==false){
            $cabang = "0000";
        }else{
            $cabang =   $cabang;            
        }
        
        $datas = $this->model_laporan_to_pdf->export_rekap_saldo_anggota($cabang);
        if ($cabang !='0000'){
            $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
        }else{
            $datacabang = "Semua Cabang";
        }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:J1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:J1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:J2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:J2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:J3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:J3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Saldo Anggota Berdasarkan Cabang");

			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah Anggota");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"LWK");
			// $objPHPExcel->getActiveSheet()->setCellValue('E6',"Investasi");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Wajib");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Kelompok");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"Sukarela");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('I6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('J6',"Catab");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

            $total_anggota  	 	 = 0;
            $total_setoran_lwk  	 = 0;
            $total_simpanan_pokok    = 0;
            $total_tabungan_minggon  = 0;
            $total_tabungan_sukarela = 0;
            $total_tabungan_kelompok = 0;
            $total_saldo_pokok = 0;
            $total_saldo_margin = 0;
            $total_saldo_catab = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['jumlah_anggota'];     
        		 $total_setoran_lwk+=$datas[$i]['setoran_lwk'];     
       			 $total_simpanan_pokok+=$datas[$i]['simpanan_pokok'];  
       			 $total_tabungan_minggon+=$datas[$i]['tabungan_minggon'];  
       			 $total_tabungan_sukarela+=$datas[$i]['tabungan_sukarela'];  
       			 $total_tabungan_kelompok+=$datas[$i]['tabungan_kelompok'];  
       			 $total_saldo_pokok+=$datas[$i]['saldo_pokok'];  
       			 $total_saldo_margin+=$datas[$i]['saldo_margin'];  
       			 $total_saldo_catab+=$datas[$i]['saldo_catab'];  

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah_anggota']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['setoran_lwk'],0,',','.'));
				// $objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['simpanan_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tabungan_minggon'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tabungan_kelompok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['tabungan_sukarela'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['saldo_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".number_format($datas[$i]['saldo_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".number_format($datas[$i]['saldo_catab'],0,',','.'));

				
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_anggota,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_setoran_lwk,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tabungan_minggon,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tabungan_kelompok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_tabungan_sukarela,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_saldo_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$iii," ".number_format($total_saldo_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$iii," ".number_format($total_saldo_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$iii.':I'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$iii.':J'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getFont()->setSize(10);
	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REKAP SALDO ANGGOTA BY CABANG.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	public function export_rekap_saldo_anggota_rembug()
	{
        $cabang         = $this->uri->segment(3);     

        if ($cabang==false){
            $cabang = "0000";
        }else{
            $cabang =   $cabang;            
        }
        
        $datas = $this->model_laporan_to_pdf->export_rekap_saldo_anggota_rembug($cabang);
        if ($cabang !='0000'){
            $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
        }else{
            $datacabang = "Semua Cabang";
        }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:J1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:J1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:J2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:J2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:J3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:J3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Saldo Anggota Berdasarkan Rembug");

			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah Anggota");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"LWK");
			// $objPHPExcel->getActiveSheet()->setCellValue('E6',"Investasi");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Wajib");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Kelompok");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"Sukarela");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('I6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('J6',"Catab");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

            $total_anggota  	 	 = 0;
            $total_setoran_lwk  	 = 0;
            $total_simpanan_pokok    = 0;
            $total_tabungan_minggon  = 0;
            $total_tabungan_sukarela = 0;
            $total_tabungan_kelompok = 0;
            $total_saldo_pokok = 0;
            $total_saldo_margin = 0;
            $total_saldo_catab = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['jumlah_anggota'];     
        		 $total_setoran_lwk+=$datas[$i]['setoran_lwk'];     
       			 $total_simpanan_pokok+=$datas[$i]['simpanan_pokok'];  
       			 $total_tabungan_minggon+=$datas[$i]['tabungan_minggon'];  
       			 $total_tabungan_sukarela+=$datas[$i]['tabungan_sukarela'];  
       			 $total_tabungan_kelompok+=$datas[$i]['tabungan_kelompok'];   
       			 $total_saldo_pokok+=$datas[$i]['saldo_pokok'];  
       			 $total_saldo_margin+=$datas[$i]['saldo_margin'];  
       			 $total_saldo_catab+=$datas[$i]['saldo_catab'];  


				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['cm_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah_anggota']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['setoran_lwk'],0,',','.'));
				// $objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['simpanan_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tabungan_minggon'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tabungan_kelompok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['tabungan_sukarela'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['saldo_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".number_format($datas[$i]['saldo_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".number_format($datas[$i]['saldo_catab'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_anggota,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_setoran_lwk,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tabungan_minggon,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tabungan_sukarela,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_tabungan_kelompok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_saldo_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$iii," ".number_format($total_saldo_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$iii," ".number_format($total_saldo_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$iii.':I'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$iii.':J'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getFont()->setSize(10);

	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REKAP SALDO ANGGOTA BY REMBUG.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	public function export_rekap_saldo_anggota_petugas()
	{
        $cabang         = $this->uri->segment(3);     

        if ($cabang==false){
            $cabang = "0000";
        }else{
            $cabang =   $cabang;            
        }
        
        $datas = $this->model_laporan_to_pdf->export_rekap_saldo_anggota_petugas($cabang);
        if ($cabang !='0000'){
            $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
        }else{
            $datacabang = "Semua Cabang";
        }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:J1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:J1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:J2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:J2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:J3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:J3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Rekap Saldo Anggota Berdasarkan Petugas");

			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah Anggota");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"LWK");
			// $objPHPExcel->getActiveSheet()->setCellValue('D6',"Investasi");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Minggon");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Kelompok");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"Sukarela");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('I6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('J6',"Catab");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:J6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			
			$ii = 7;

            $total_anggota  	 = 0;
            $total_setoran_lwk  	 = 0;
            $total_simpanan_pokok    = 0;
            $total_tabungan_minggon  = 0;
            $total_tabungan_sukarela = 0;
            $total_tabungan_kelompok = 0;
            $total_saldo_pokok = 0;
            $total_saldo_margin = 0;
            $total_saldo_catab = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['jumlah_anggota'];     
        		 $total_setoran_lwk+=$datas[$i]['setoran_lwk'];     
       			 $total_simpanan_pokok+=$datas[$i]['simpanan_pokok'];  
       			 $total_tabungan_minggon+=$datas[$i]['tabungan_minggon'];  
       			 $total_tabungan_sukarela+=$datas[$i]['tabungan_sukarela'];  
       			 $total_tabungan_kelompok+=$datas[$i]['tabungan_kelompok'];  
       			 $total_saldo_pokok+=$datas[$i]['saldo_pokok'];  
       			 $total_saldo_margin+=$datas[$i]['saldo_margin'];  
       			 $total_saldo_catab+=$datas[$i]['saldo_catab'];  

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['fa_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah_anggota']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['setoran_lwk'],0,',','.'));
				// $objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['simpanan_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tabungan_minggon'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tabungan_kelompok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['tabungan_sukarela'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['saldo_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".number_format($datas[$i]['saldo_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".number_format($datas[$i]['saldo_catab'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':J'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_anggota,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_setoran_lwk,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tabungan_minggon,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tabungan_sukarela,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_tabungan_kelompok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_saldo_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$iii," ".number_format($total_saldo_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$iii," ".number_format($total_saldo_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$iii.':I'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$iii.':J'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':J'.$iii)->getFont()->setSize(10);

	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REKAP SALDO ANGGOTA BY PETUGAS.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	//EXPORT LAPORAN REKAP SALDO ANGGOTA
	

	public function list_jurnal_umum_gl()
	{
		/* (begin) GETTING DATA */
		$branch_code=$this->uri->segment(3);
        $account_code=$this->uri->segment(4);
        $from_date=$this->uri->segment(5);
        $thru_date=$this->uri->segment(6);
        
        $from_date=$this->datepicker_convert(false,$from_date,'');
        $thru_date=$this->datepicker_convert(false,$thru_date,'');

        $branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_name = $branch['branch_name'];

        if($account_code=='-'){
            $account_name = '-';
        }else{
            $account = $this->model_cif->get_gl_account_by_account_code($account_code);
            $account_code = $account['account_code'];
            $account_name = $account['account_name'];
        }

        $datas = $this->model_laporan->get_gl_account_history($branch_code,$account_code,$from_date,$thru_date);
		$saldo = $this->model_laporan->fn_get_saldo_gl_account2($account_code,$from_date,$branch_code);

		$saldo_akhir = $saldo['saldo_awal'];
        $total_debit = 0;
        $total_credit = 0;
        $i = 0;
        for ( $j = 0 ; $j < count($datas)+1 ; $j++ )
        {
            if($j==0)
            {
                $data['data'][$j]['nomor'] = '';
                $data['data'][$j]['trx_date'] = '';
                $data['data'][$j]['description'] = 'Saldo Awal';
                $data['data'][$j]['debit'] = '';
                $data['data'][$j]['credit'] = '';
                $data['data'][$j]['saldo_akhir'] = $saldo_akhir;
                $data['data'][$j]['trx_gl_id'] = '';
            }
            else
            {
                if($datas[$i]['flag_debit_credit']=="C"){
					if($datas[$i]['transaction_flag_default']=='C'){
						$saldo_akhir += $datas[$i]['amount'];
					}else{
						$saldo_akhir -= $datas[$i]['amount'];
					}
				}
				if($datas[$i]['flag_debit_credit']=="D"){
					if($datas[$i]['transaction_flag_default']=='D'){
						$saldo_akhir += $datas[$i]['amount'];
					}else{
						$saldo_akhir -= $datas[$i]['amount'];
					}	
				}
                $data['data'][$j]['nomor'] = $i+1;
                $data['data'][$j]['trx_date'] = $datas[$i]['voucher_date'];
                $data['data'][$j]['description'] = $datas[$i]['description'];
                $data['data'][$j]['debit'] = $datas[$i]['debit'];
                $data['data'][$j]['credit'] = $datas[$i]['credit'];
                $data['data'][$j]['saldo_akhir'] = $saldo_akhir;
                $data['data'][$j]['trx_gl_id'] = $datas[$i]['trx_gl_id'];
                
                $total_debit  += $datas[$i]['debit'];
                $total_credit += $datas[$i]['credit'];

                $i++;
            }
        }
        $data['total_debit'] = $total_debit;
        $data['total_credit'] = $total_credit;

        /* (end) GETTING DATA */

        /* IMPLEMENTATION DATA */

        $objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		/* HEAD */
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang");
		$objPHPExcel->getActiveSheet()->setCellValue('B2',": ".$branch_name);
		$objPHPExcel->getActiveSheet()->setCellValue('A3',"GL Account");
		$objPHPExcel->getActiveSheet()->setCellValue('B3',": ".$account_name);
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('B4',": ".$this->format_date_detail($from_date,'id',false,'/').' s.d '.$this->format_date_detail($thru_date,'id',false,'/'));

		$objPHPExcel->getActiveSheet()->setCellValue('A6',"No.");
		$objPHPExcel->getActiveSheet()->setCellValue('B6',"Tanggal Transaksi");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"Deskripsi");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"Debet");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"Credit");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"Saldo Akhir");
		$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setSize(10);


		$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(12);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);

		$ii = 7;
		for( $i = 0 ; $i < count($data['data']) ; $i++ )
		{ 
			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$data['data'][$i]['nomor']);
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,(($data['data'][$i]['trx_date']=="")?"":$this->format_date_detail($data['data'][$i]['trx_date'],'id',false,'/')));
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$data['data'][$i]['description']);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,' '.(($data['data'][$i]['debit']=="")?"":number_format($data['data'][$i]['debit'],2,',','.')));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,' '.(($data['data'][$i]['credit']=="")?"":number_format($data['data'][$i]['credit'],2,',','.')));
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,' '.number_format($data['data'][$i]['saldo_akhir'],2,',','.'));

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

			$ii++;
		
		}//END FOR

		$iii = count($datas)+8;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,"TOTAL:");
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($data['total_debit'],2,',','.'));
		$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($data['total_credit'],2,',','.'));
		$objPHPExcel->getActiveSheet()->mergeCells('A'.$iii.':C'.$iii);
		$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getFont()->setSize(10);
		$objPHPExcel->getActiveSheet()->getStyle('A'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':A'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B'.$iii.':B'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);


	// Redirect output to a client's web browser (Excel2007)
	// Save Excel 2007 file

	header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
	header('Content-Disposition: attachment;filename="LAPORAN GL INQUIRY.xlsx"');
	header('Cache-Control: max-age=0');

	$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
	$objWriter->save('php://output');
	}

	//LAPORAN REKAP TRANSAKSI ANGGOTA
	public function export_rekap_transaksi_rembug_by_semua_cabang()
	{
        $cabang = $this->uri->segment(3);
        $from_date = ($this->uri->segment(4)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(4),'-');
        $desc_from_date = ($from_date=="")?"":$this->format_date_detail($from_date,'id',false,'/');
        $thru_date = ($this->uri->segment(5)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(5),'-');
        $desc_thru_date = ($thru_date=="")?"":$this->format_date_detail($thru_date,'id',false,'/');
        
        $datas = $this->model_laporan_to_pdf->get_data_rekap_transaksi_rembug_by_semua_cabang($from_date,$thru_date);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAP TRANSAKSI ANGGOTA");
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"SEMUA CABANG");
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Tanggal : ".$desc_from_date.' s.d '.$desc_thru_date);

			$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Keterangan");
			$objPHPExcel->getActiveSheet()->mergeCells('B6:F6');
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"SETORAN");
			$objPHPExcel->getActiveSheet()->setCellValue('B7',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('C7',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('D7',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('E7',"Tabungan Wajib");
			$objPHPExcel->getActiveSheet()->setCellValue('F7',"Tabungan Kelompok");
			$objPHPExcel->getActiveSheet()->mergeCells('G6:H6');
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"PENARIKAN");
			$objPHPExcel->getActiveSheet()->setCellValue('G7',"Droping");
			$objPHPExcel->getActiveSheet()->setCellValue('H7',"Sukarela");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 8;

	        $total_angsuran_pokok = 0;
	        $total_angsuran_margin = 0;
	        $total_angsuran_catab = 0;
	        $total_tab_wajib_cr = 0;
	        $total_tab_sukarela_db = 0;
	        $total_droping = 0;
	        $total_tab_kelompok_cr = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
				$total_angsuran_pokok += $datas[$i]['angsuran_pokok'];
	            $total_angsuran_margin += $datas[$i]['angsuran_margin'];
	            $total_angsuran_catab += $datas[$i]['angsuran_catab'];
	            $total_tab_wajib_cr += $datas[$i]['tab_wajib_cr'];
	            $total_tab_sukarela_db += $datas[$i]['tab_sukarela_db'];
	            $total_droping += $datas[$i]['droping'];
	            $total_tab_kelompok_cr += $datas[$i]['tab_kelompok_cr'];

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['branch_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii," ".number_format($datas[$i]['angsuran_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".number_format($datas[$i]['angsuran_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['angsuran_catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tab_wajib_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tab_kelompok_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['droping'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['tab_sukarela_db'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$iii,"Total : ");
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$iii," ".number_format($total_angsuran_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_angsuran_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_angsuran_catab,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tab_wajib_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tab_kelompok_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_droping,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_tab_sukarela_db,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':A'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$iii.':B'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setSize(10);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setBold(true);
	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN REKAP TRANSAKSI REMBUG FILTERED BY SEMUA CABANG.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	
	public function export_rekap_transaksi_rembug_by_cabang()
	{
        $cabang = $this->uri->segment(3);
        $from_date = ($this->uri->segment(4)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(4),'-');
        $desc_from_date = ($from_date=="")?"":$this->format_date_detail($from_date,'id',false,'/');
        $thru_date = ($this->uri->segment(5)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(5),'-');
        $desc_thru_date = ($thru_date=="")?"":$this->format_date_detail($thru_date,'id',false,'/');
        
        $datas = $this->model_laporan_to_pdf->get_data_rekap_transaksi_rembug_by_cabang($cabang,$from_date,$thru_date);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAP TRANSAKSI ANGGOTA");
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"BY CABANG");
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Tanggal : ".$desc_from_date.' s.d '.$desc_thru_date);

			$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Keterangan");
			$objPHPExcel->getActiveSheet()->mergeCells('B6:F6');
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"SETORAN");
			$objPHPExcel->getActiveSheet()->setCellValue('B7',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('C7',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('D7',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('E7',"Tabungan Wajib");
			$objPHPExcel->getActiveSheet()->setCellValue('F7',"Tabungan Kelompok");
			$objPHPExcel->getActiveSheet()->mergeCells('G6:H6');
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"PENARIKAN");
			$objPHPExcel->getActiveSheet()->setCellValue('G7',"Droping");
			$objPHPExcel->getActiveSheet()->setCellValue('H7',"Sukarela");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 8;

	        $total_angsuran_pokok = 0;
	        $total_angsuran_margin = 0;
	        $total_angsuran_catab = 0;
	        $total_tab_wajib_cr = 0;
	        $total_tab_sukarela_db = 0;
	        $total_droping = 0;
	        $total_tab_kelompok_cr = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
				$total_angsuran_pokok += $datas[$i]['angsuran_pokok'];
	            $total_angsuran_margin += $datas[$i]['angsuran_margin'];
	            $total_angsuran_catab += $datas[$i]['angsuran_catab'];
	            $total_tab_wajib_cr += $datas[$i]['tab_wajib_cr'];
	            $total_tab_sukarela_db += $datas[$i]['tab_sukarela_db'];
	            $total_droping += $datas[$i]['droping'];
	            $total_tab_kelompok_cr += $datas[$i]['tab_kelompok_cr'];

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['branch_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii," ".number_format($datas[$i]['angsuran_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".number_format($datas[$i]['angsuran_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['angsuran_catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tab_wajib_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tab_kelompok_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['droping'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['tab_sukarela_db'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$iii,"Total : ");
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$iii," ".number_format($total_angsuran_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_angsuran_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_angsuran_catab,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tab_wajib_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tab_kelompok_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_droping,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_tab_sukarela_db,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':A'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$iii.':B'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setSize(10);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setBold(true);
	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN REKAP TRANSAKSI REMBUG FILTERED BY CABANG.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	public function export_rekap_transaksi_rembug_by_rembug_semua_cabang()
	{
        $cabang = $this->uri->segment(3);
        $from_date = ($this->uri->segment(4)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(4),'-');
        $desc_from_date = ($from_date=="")?"":$this->format_date_detail($from_date,'id',false,'/');
        $thru_date = ($this->uri->segment(5)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(5),'-');
        $desc_thru_date = ($thru_date=="")?"":$this->format_date_detail($thru_date,'id',false,'/');
        
        $datas = $this->model_laporan_to_pdf->get_data_rekap_transaksi_rembug_by_rembug_semua_cabang($from_date,$thru_date);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAP TRANSAKSI ANGGOTA");
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"BY REMBUG");
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Tanggal : ".$desc_from_date.' s.d '.$desc_thru_date);

			$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Keterangan");
			$objPHPExcel->getActiveSheet()->mergeCells('B6:F6');
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"SETORAN");
			$objPHPExcel->getActiveSheet()->setCellValue('B7',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('C7',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('D7',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('E7',"Tabungan Wajib");
			$objPHPExcel->getActiveSheet()->setCellValue('F7',"Tabungan Kelompok");
			$objPHPExcel->getActiveSheet()->mergeCells('G6:H6');
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"PENARIKAN");
			$objPHPExcel->getActiveSheet()->setCellValue('G7',"Droping");
			$objPHPExcel->getActiveSheet()->setCellValue('H7',"Sukarela");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 8;

	        $total_angsuran_pokok = 0;
	        $total_angsuran_margin = 0;
	        $total_angsuran_catab = 0;
	        $total_tab_wajib_cr = 0;
	        $total_tab_sukarela_db = 0;
	        $total_droping = 0;
	        $total_tab_kelompok_cr = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
				$total_angsuran_pokok += $datas[$i]['angsuran_pokok'];
	            $total_angsuran_margin += $datas[$i]['angsuran_margin'];
	            $total_angsuran_catab += $datas[$i]['angsuran_catab'];
	            $total_tab_wajib_cr += $datas[$i]['tab_wajib_cr'];
	            $total_tab_sukarela_db += $datas[$i]['tab_sukarela_db'];
	            $total_droping += $datas[$i]['droping'];
	            $total_tab_kelompok_cr += $datas[$i]['tab_kelompok_cr'];

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['cm_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii," ".number_format($datas[$i]['angsuran_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".number_format($datas[$i]['angsuran_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['angsuran_catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tab_wajib_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tab_kelompok_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['droping'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['tab_sukarela_db'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$iii,"Total : ");
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$iii," ".number_format($total_angsuran_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_angsuran_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_angsuran_catab,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tab_wajib_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tab_kelompok_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_droping,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_tab_sukarela_db,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':A'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$iii.':B'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setSize(10);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setBold(true);
	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN REKAP TRANSAKSI REMBUG FILTERED BY SEMUA REMBUG.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	public function export_rekap_transaksi_rembug_by_rembug_cabang()
	{
        $cabang = $this->uri->segment(3);
        $from_date = ($this->uri->segment(4)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(4),'-');
        $desc_from_date = ($from_date=="")?"":$this->format_date_detail($from_date,'id',false,'/');
        $thru_date = ($this->uri->segment(5)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(5),'-');
        $desc_thru_date = ($thru_date=="")?"":$this->format_date_detail($thru_date,'id',false,'/');
        
        $datas = $this->model_laporan_to_pdf->get_data_rekap_transaksi_rembug_by_rembug_cabang($cabang,$from_date,$thru_date);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAP TRANSAKSI ANGGOTA");
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"BY REMBUG");
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Tanggal : ".$desc_from_date.' s.d '.$desc_thru_date);

			$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Keterangan");
			$objPHPExcel->getActiveSheet()->mergeCells('B6:F6');
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"SETORAN");
			$objPHPExcel->getActiveSheet()->setCellValue('B7',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('C7',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('D7',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('E7',"Tabungan Wajib");
			$objPHPExcel->getActiveSheet()->setCellValue('F7',"Tabungan Kelompok");
			$objPHPExcel->getActiveSheet()->mergeCells('G6:H6');
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"PENARIKAN");
			$objPHPExcel->getActiveSheet()->setCellValue('G7',"Droping");
			$objPHPExcel->getActiveSheet()->setCellValue('H7',"Sukarela");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 8;

	        $total_angsuran_pokok = 0;
	        $total_angsuran_margin = 0;
	        $total_angsuran_catab = 0;
	        $total_tab_wajib_cr = 0;
	        $total_tab_sukarela_db = 0;
	        $total_droping = 0;
	        $total_tab_kelompok_cr = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
				$total_angsuran_pokok += $datas[$i]['angsuran_pokok'];
	            $total_angsuran_margin += $datas[$i]['angsuran_margin'];
	            $total_angsuran_catab += $datas[$i]['angsuran_catab'];
	            $total_tab_wajib_cr += $datas[$i]['tab_wajib_cr'];
	            $total_tab_sukarela_db += $datas[$i]['tab_sukarela_db'];
	            $total_droping += $datas[$i]['droping'];
	            $total_tab_kelompok_cr += $datas[$i]['tab_kelompok_cr'];

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['cm_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii," ".number_format($datas[$i]['angsuran_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".number_format($datas[$i]['angsuran_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['angsuran_catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tab_wajib_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tab_kelompok_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['droping'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['tab_sukarela_db'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$iii,"Total : ");
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$iii," ".number_format($total_angsuran_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_angsuran_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_angsuran_catab,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tab_wajib_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tab_kelompok_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_droping,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_tab_sukarela_db,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':A'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$iii.':B'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setSize(10);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setBold(true);
	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN REKAP TRANSAKSI REMBUG FILTERED BY REMBUG.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	public function export_rekap_transaksi_rembug_by_petugas_semua_cabang()
	{
        $cabang = $this->uri->segment(3);
        $from_date = ($this->uri->segment(4)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(4),'-');
        $desc_from_date = ($from_date=="")?"":$this->format_date_detail($from_date,'id',false,'/');
        $thru_date = ($this->uri->segment(5)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(5),'-');
        $desc_thru_date = ($thru_date=="")?"":$this->format_date_detail($thru_date,'id',false,'/');
        
        $datas = $this->model_laporan_to_pdf->get_data_rekap_transaksi_rembug_by_petugas_semua_cabang($from_date,$thru_date);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAP TRANSAKSI ANGGOTA");
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"BY REMBUG");
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Tanggal : ".$desc_from_date.' s.d '.$desc_thru_date);

			$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Keterangan");
			$objPHPExcel->getActiveSheet()->mergeCells('B6:F6');
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"SETORAN");
			$objPHPExcel->getActiveSheet()->setCellValue('B7',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('C7',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('D7',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('E7',"Tabungan Wajib");
			$objPHPExcel->getActiveSheet()->setCellValue('F7',"Tabungan Kelompok");
			$objPHPExcel->getActiveSheet()->mergeCells('G6:H6');
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"PENARIKAN");
			$objPHPExcel->getActiveSheet()->setCellValue('G7',"Droping");
			$objPHPExcel->getActiveSheet()->setCellValue('H7',"Sukarela");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 8;

	        $total_angsuran_pokok = 0;
	        $total_angsuran_margin = 0;
	        $total_angsuran_catab = 0;
	        $total_tab_wajib_cr = 0;
	        $total_tab_sukarela_db = 0;
	        $total_droping = 0;
	        $total_tab_kelompok_cr = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
				$total_angsuran_pokok += $datas[$i]['angsuran_pokok'];
	            $total_angsuran_margin += $datas[$i]['angsuran_margin'];
	            $total_angsuran_catab += $datas[$i]['angsuran_catab'];
	            $total_tab_wajib_cr += $datas[$i]['tab_wajib_cr'];
	            $total_tab_sukarela_db += $datas[$i]['tab_sukarela_db'];
	            $total_droping += $datas[$i]['droping'];
	            $total_tab_kelompok_cr += $datas[$i]['tab_kelompok_cr'];

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['fa_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii," ".number_format($datas[$i]['angsuran_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".number_format($datas[$i]['angsuran_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['angsuran_catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tab_wajib_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tab_kelompok_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['droping'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['tab_sukarela_db'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$iii,"Total : ");
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$iii," ".number_format($total_angsuran_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_angsuran_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_angsuran_catab,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tab_wajib_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tab_kelompok_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_droping,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_tab_sukarela_db,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':A'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$iii.':B'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setSize(10);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setBold(true);
	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN REKAP TRANSAKSI REMBUG FILTERED BY SEMUA PETUGAS.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	public function export_rekap_transaksi_rembug_by_petugas_cabang()
	{
        $cabang = $this->uri->segment(3);
        $from_date = ($this->uri->segment(4)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(4),'-');
        $desc_from_date = ($from_date=="")?"":$this->format_date_detail($from_date,'id',false,'/');
        $thru_date = ($this->uri->segment(5)=="-")?"":$this->datepicker_convert(false,$this->uri->segment(5),'-');
        $desc_thru_date = ($thru_date=="")?"":$this->format_date_detail($thru_date,'id',false,'/');
        
        $datas = $this->model_laporan_to_pdf->get_data_rekap_transaksi_rembug_by_petugas_cabang($cabang,$from_date,$thru_date);
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAP TRANSAKSI ANGGOTA");
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"BY REMBUG");
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Tanggal : ".$desc_from_date.' s.d '.$desc_thru_date);

			$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Keterangan");
			$objPHPExcel->getActiveSheet()->mergeCells('B6:F6');
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"SETORAN");
			$objPHPExcel->getActiveSheet()->setCellValue('B7',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('C7',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('D7',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('E7',"Tabungan Wajib");
			$objPHPExcel->getActiveSheet()->setCellValue('F7',"Tabungan Kelompok");
			$objPHPExcel->getActiveSheet()->mergeCells('G6:H6');
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"PENARIKAN");
			$objPHPExcel->getActiveSheet()->setCellValue('G7',"Droping");
			$objPHPExcel->getActiveSheet()->setCellValue('H7',"Sukarela");

			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getFont()->setSize(10);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 8;

	        $total_angsuran_pokok = 0;
	        $total_angsuran_margin = 0;
	        $total_angsuran_catab = 0;
	        $total_tab_wajib_cr = 0;
	        $total_tab_sukarela_db = 0;
	        $total_droping = 0;
	        $total_tab_kelompok_cr = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
				$total_angsuran_pokok += $datas[$i]['angsuran_pokok'];
	            $total_angsuran_margin += $datas[$i]['angsuran_margin'];
	            $total_angsuran_catab += $datas[$i]['angsuran_catab'];
	            $total_tab_wajib_cr += $datas[$i]['tab_wajib_cr'];
	            $total_tab_sukarela_db += $datas[$i]['tab_sukarela_db'];
	            $total_droping += $datas[$i]['droping'];
	            $total_tab_kelompok_cr += $datas[$i]['tab_kelompok_cr'];

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datas[$i]['fa_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii," ".number_format($datas[$i]['angsuran_pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".number_format($datas[$i]['angsuran_margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['angsuran_catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['tab_wajib_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['tab_kelompok_cr'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['droping'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".number_format($datas[$i]['tab_sukarela_db'],0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$iii,"Total : ");
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$iii," ".number_format($total_angsuran_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii," ".number_format($total_angsuran_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_angsuran_catab,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_tab_wajib_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_tab_kelompok_cr,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_droping,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii," ".number_format($total_tab_sukarela_db,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':A'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$iii.':B'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$iii.':H'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setSize(10);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':H'.$iii)->getFont()->setBold(true);
	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN REKAP TRANSAKSI REMBUG FILTERED BY PETUGAS.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	//LAPORAN REKAP TRANSAKSI ANGGOTA


	// LAPORAN JURNAL TRANSAKSI
	public function laporan_jurnal_transaksi()
	{
		$branch_code = $this->uri->segment(3);
		$from_date = $this->uri->segment(4);
		$thru_date = $this->uri->segment(5);

		$from_date = $this->datepicker_convert(false,$from_date);
		$thru_date = $this->datepicker_convert(false,$thru_date);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->setCellValue('A1','LAPORAN JURNAL TRANSAKSI');
		// $objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
		// $objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"Tanggal : ".$from_date.' s.d '.$thru_date);

		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(1.14);
		// $objPHPExcel->getActiveSheet()->getColumnDimension('A4')->setHeight(36);
		$objPHPExcel->getActiveSheet()->getStyle('B4:H4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B4:H4')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B4:H4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B4:B4')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(5);
		$objPHPExcel->getActiveSheet()->setCellValue('B4',"No");
		$objPHPExcel->getActiveSheet()->getStyle('C4:C4')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C4')->getAlignment()->setWrapText(true); 
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(11.14);
		$objPHPExcel->getActiveSheet()->setCellValue('C4',"Tgl Transaksi");
		$objPHPExcel->getActiveSheet()->getStyle('D4:D4')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D4')->getAlignment()->setWrapText(true); 
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(11.14);
		$objPHPExcel->getActiveSheet()->setCellValue('D4',"Voucher Date");
		$objPHPExcel->getActiveSheet()->getStyle('E4:E4')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(28.14);
		$objPHPExcel->getActiveSheet()->setCellValue('E4',"Keterangan");
		$objPHPExcel->getActiveSheet()->getStyle('F4:F4')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(34.29);
		$objPHPExcel->getActiveSheet()->setCellValue('F4',"Account");
		$objPHPExcel->getActiveSheet()->getStyle('G4:G4')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(10.86);
		$objPHPExcel->getActiveSheet()->setCellValue('G4',"Debit");
		$objPHPExcel->getActiveSheet()->getStyle('H4:H4')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(10.86);
		$objPHPExcel->getActiveSheet()->setCellValue('H4',"Credit");

		$trx_gl = $this->model_laporan->get_trx_gl($from_date,$thru_date,$branch_code);
		$no = 0;
		$row_num=5;
		for($i=0;$i<count($trx_gl);$i++){
			$no++;
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$row_num,$no);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$row_num,$trx_gl[$i]['trx_date']);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$row_num,$trx_gl[$i]['voucher_date']);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$row_num,$trx_gl[$i]['description']);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$row_num.':D'.$row_num)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$trx_gl_detail = $this->model_laporan->get_trx_gl_detail_by_trx_gl_id($trx_gl[$i]['trx_gl_id']);
			for($j=0;$j<count($trx_gl_detail);$j++)
			{
				if($j>0) $row_num++;
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$row_num,$trx_gl_detail[$j]['account_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$row_num,number_format($trx_gl_detail[$j]['debit'],2,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$row_num,number_format($trx_gl_detail[$j]['credit'],2,',','.'));
				$objPHPExcel->getActiveSheet()->getStyle('G'.$row_num.':H'.$row_num)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			}
			$row_num++;
		}
		$objPHPExcel->getActiveSheet()->getStyle('B5:B'.($row_num-1))->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C5:C'.($row_num-1))->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D5:D'.($row_num-1))->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E5:E'.($row_num-1))->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F5:F'.($row_num-1))->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G5:G'.($row_num-1))->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H5:H'.($row_num-1))->applyFromArray($styleArray);


		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN JURNAL TRANSAKSI.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	/****************************************************************************************/	
	// BEGIN EXPORT KARTU PENGAWASAN ANGSURAN
	/****************************************************************************************/
	public function export_kartu_pengawasan_angsuran()
	{
		$cif_no = $this->uri->segment(3);
		             
        $datas = $this->model_laporan->get_kartu_pengawasan_angsuran_by_cif_no($cif_no);
        
        if (!isset($datas['nama'])) 
        {
        	echo "<script>alert('Data Tidak Ditemukan !');javascript:window.close();</script>";
        }
        else
        {
					
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");
										 
			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);
			$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',"KARTU PENGAWASAN ANGSURAN ".$cif_no);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Nama");
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Rembug");
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Desa");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Produk");
			$objPHPExcel->getActiveSheet()->setCellValue('A7',"Untuk");
			$objPHPExcel->getActiveSheet()->setCellValue('B3',":  ".$datas['nama']);
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":  ".$datas['cm_name']);
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":  ".$datas['desa']);
			$objPHPExcel->getActiveSheet()->setCellValue('B6',":  ".$datas['product_name']);
			$objPHPExcel->getActiveSheet()->setCellValue('B7',":  ".$datas['untuk']);
			$objPHPExcel->getActiveSheet()->setCellValue('D3',"Plafon");
			$objPHPExcel->getActiveSheet()->setCellValue('D4',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('D5',"Tgl Cair");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Tgl J. Tempo");
			$objPHPExcel->getActiveSheet()->setCellValue('D7',"PYD Ke");
			$objPHPExcel->getActiveSheet()->setCellValue('E3',":  ".number_format($datas['pokok'],0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('E4',":  ".number_format($datas['margin'],0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('E5',":  ".date("d-m-Y", strtotime($datas['droping_date'])));
			$objPHPExcel->getActiveSheet()->setCellValue('E6',":  ".date("d-m-Y", strtotime($datas['tanggal_jtempo'])));
			$objPHPExcel->getActiveSheet()->setCellValue('E7',":  ".$datas['pydke']);
			$objPHPExcel->getActiveSheet()->getStyle('A3:F7')->getFont()->setSize(9);

			$objPHPExcel->getActiveSheet()->mergeCells('A9:B9');
			$objPHPExcel->getActiveSheet()->setCellValue('A9',"TANGGAL");
			$objPHPExcel->getActiveSheet()->mergeCells('C9:D9');
			$objPHPExcel->getActiveSheet()->setCellValue('C9',"ANGSURAN");
			$objPHPExcel->getActiveSheet()->mergeCells('E9:E10');
			$objPHPExcel->getActiveSheet()->setCellValue('E9',"SALDO POKOK");
			$objPHPExcel->getActiveSheet()->mergeCells('F9:F10');
			$objPHPExcel->getActiveSheet()->setCellValue('F9',"VALIDASI");
			$objPHPExcel->getActiveSheet()->setCellValue('A10',"ANGSUR");
			$objPHPExcel->getActiveSheet()->setCellValue('B10',"BAYAR");
			$objPHPExcel->getActiveSheet()->setCellValue('C10',"KE");
			$objPHPExcel->getActiveSheet()->setCellValue('D10',"JUMLAH");

			$objPHPExcel->getActiveSheet()->getStyle('A3:F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A9:B9')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C9:D9')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E9:E10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F9:F10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C10')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D10')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('A1:G1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A9:F10')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A9:F10')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A9:F10')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					
			$ii = 11;
            $data = $this->model_laporan->get_row_pembiayaan_by_cif_no($cif_no);
            $data_trx = $this->model_laporan->get_trx_cm_by_cif_no($cif_no);
            $no=1;
            for($i=0;$i<$data['jangka_waktu'];$i++)
            {
                if($i==0) $tgl_angsur = $data['tanggal_mulai_angsur'];

                if($data['periode_jangka_waktu']==0){
                    $tgl_angsur = date("Y-m-d",strtotime($tgl_angsur." + 1 day"));
                }else if($data['periode_jangka_waktu']==1){
                    $tgl_angsur = date("Y-m-d",strtotime($tgl_angsur." + 7 day"));
                }else if($data['periode_jangka_waktu']==2){
                    $tgl_angsur = date("Y-m-d",strtotime($tgl_angsur." + 1 month"));
                }else if($data['periode_jangka_waktu']==3){
                    $tgl_angsur = $data['tgl_jtempo'];
                }
                $tgl_bayar = (isset($data_trx[$i]['trx_date'])==true)?$data_trx[$i]['trx_date']:'';
                $jumlah_angsur = $data['jumlah_angsuran'];
                $saldo_pokok = ($data['angsuran_pokok']*$data['jangka_waktu'])-($data['angsuran_pokok']*$i);
                
                $tgl_bayar = ($tgl_bayar!='') ? date("d-m-Y", strtotime($tgl_bayar)) : '' ;

                $objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,date("d-m-Y", strtotime($tgl_angsur))." ");
                $objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$tgl_bayar." ");
                $objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$no." ");
                $objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($jumlah_angsur,0,',','.')." ");
                $objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($saldo_pokok,0,',','.')." ");
                $objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ");


				$alphabeth = array( 'A','B','C','D','E','F');
				for ($j=0; $j < count($alphabeth); $j++) { 
					$objPHPExcel->getActiveSheet()->getStyle($alphabeth[$j].$ii.':'.$alphabeth[$j].$ii)->applyFromArray($styleArray);	
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				}
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(9);

                $no++;
                $ii++;
            }
            $objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(12);
            $objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(15);
            $objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(5);
            $objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(15);
            $objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
            $objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

		



			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="kartu_pengawasan_angsuran.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}
	/****************************************************************************************/	
	// END EXPORT KARTU PENGAWASAN ANGSURAN
	/****************************************************************************************/


	function export_rekapitulasi_npl_produk()
	{
		$branch_code = $this->uri->segment(3);	
		$tanggal_hitung = $this->uri->segment(4);
	 	$branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
            case '0':
              $branch_class_name = "Kepala Pusat";
              break;
            case '1':
              $branch_class_name = "Kepala Wilayah";
              break;
            case '2':
              $branch_class_name = "Kepala Cabang";
              break;
            case '3':
              $branch_class_name = "Kepala Unit";
              break;
            default:
              $branch_class_name = "-";
              break;
        }


        if ($branch_code !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($branch_code);
            // if($branch_class=="1"){
            //     $branch_name .= "";
            // }
        }else{
            $branch_name = "PUSAT";
        }
		$datas = $this->model_laporan_to_pdf->export_rekapitulasi_npl_by_produk($branch_code,$tanggal_hitung);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->mergeCells('A2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAPITULASI NPL");
		$objPHPExcel->getActiveSheet()->mergeCells('A4:B4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4','Kantor Cabang');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',':');
		$objPHPExcel->getActiveSheet()->setCellValue('D4',$branch_name);

		$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
		$objPHPExcel->getActiveSheet()->mergeCells('B6:B7');
		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->mergeCells('F6:H6');
		$objPHPExcel->getActiveSheet()->mergeCells('I6:K6');
		$objPHPExcel->getActiveSheet()->mergeCells('L6:N6');
		$objPHPExcel->getActiveSheet()->mergeCells('O6:Q6');
		$objPHPExcel->getActiveSheet()->mergeCells('R6:T6');
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
		$objPHPExcel->getActiveSheet()->setCellValue('B6',"Produk");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"PAR (1 - 30)");
		$objPHPExcel->getActiveSheet()->setCellValue('C7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('D7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('E7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"PAR (31 - 60)");
		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('H7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"PAR (61 - 90)");
		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('K7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('L6',"PAR (90 - 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('L7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('M7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('N7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('O6',"PAR (> 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('O7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('P7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('Q7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('R6',"TOTAL");
		$objPHPExcel->getActiveSheet()->setCellValue('R7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('S7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('T7',"CPP");

		
		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6:T7')->getFont()->setSize(11);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('Q')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('R')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('S')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('T')->setWidth(14);

					
			$ii = 8;
	        $total = 0;
	        $total_saldo = 0;
	        $total_cpp = 0;
	        $total_jumlah1 = 0;
	        $total_jumlah2 = 0;
	        $total_jumlah3 = 0;
	        $total_jumlah4 = 0;
	        $total_jumlah5 = 0;
	        $total_jumlah6 = 0;
	        $total_saldo1 = 0;
	        $total_saldo2 = 0;
	        $total_saldo3 = 0;
	        $total_saldo4 = 0;
	        $total_saldo5 = 0;
	        $total_saldo6 = 0;
	        $total_cpp1 = 0;
	        $total_cpp2 = 0;
	        $total_cpp3 = 0;
	        $total_cpp4 = 0;
	        $total_cpp5 = 0;
	        $total_cpp6 = 0;
			$row_total = count($datas)+8;
			$n=1;
			// $cabang='';
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

		        $total = $datas[$i]['jml1']+$datas[$i]['jml2']+$datas[$i]['jml3']+$datas[$i]['jml4']+$datas[$i]['jml5'];
		        $total_saldo = $datas[$i]['saldo_pokok1']+$datas[$i]['saldo_pokok2']+$datas[$i]['saldo_pokok3']+$datas[$i]['saldo_pokok4']+$datas[$i]['saldo_pokok5'];
		        $total_cpp = $datas[$i]['cpp1']+$datas[$i]['cpp2']+$datas[$i]['cpp3']+$datas[$i]['cpp4']+$datas[$i]['cpp5'];
		       //  if($datas[$i]['branch_class']=='2'){
		          $total_jumlah1 += $datas[$i]['jml1'];
		          $total_jumlah2 += $datas[$i]['jml2'];
		          $total_jumlah3 += $datas[$i]['jml3'];
		          $total_jumlah4 += $datas[$i]['jml4'];
		          $total_jumlah5 += $datas[$i]['jml5'];
		          $total_jumlah6 += $total;
		          $total_saldo1 += $datas[$i]['saldo_pokok1'];
		          $total_saldo2 += $datas[$i]['saldo_pokok2'];
		          $total_saldo3 += $datas[$i]['saldo_pokok3'];
		          $total_saldo4 += $datas[$i]['saldo_pokok4'];
		          $total_saldo5 += $datas[$i]['saldo_pokok5'];
		          $total_saldo6 += $total_saldo;
		          $total_cpp1 += $datas[$i]['cpp1'];
		          $total_cpp2 += $datas[$i]['cpp2'];
		          $total_cpp3 += $datas[$i]['cpp3'];
		          $total_cpp4 += $datas[$i]['cpp4'];
		          $total_cpp5 += $datas[$i]['cpp5'];
		          $total_cpp6 += $total_cpp;
		      	// }
		          
		        if($total>0){ //jika ada data baru ditampilkan

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['product_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,(($datas[$i]['jml1']=='')?'0':$datas[$i]['jml1']));
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,(($datas[$i]['saldo_pokok1']=='')?'0':' '.number_format($datas[$i]['saldo_pokok1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,(($datas[$i]['cpp1']=='')?'0':' '.number_format($datas[$i]['cpp1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,(($datas[$i]['jml2']=='')?'0':$datas[$i]['jml2']));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,(($datas[$i]['saldo_pokok2']=='')?'0':' '.number_format($datas[$i]['saldo_pokok2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,(($datas[$i]['cpp2']=='')?'0':' '.number_format($datas[$i]['cpp2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,(($datas[$i]['jml3']=='')?'0':$datas[$i]['jml3']));
					$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,(($datas[$i]['saldo_pokok3']=='')?'0':' '.number_format($datas[$i]['saldo_pokok3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,(($datas[$i]['cpp3']=='')?'0':' '.number_format($datas[$i]['cpp3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,(($datas[$i]['jml4']=='')?'0':$datas[$i]['jml4']));
					$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,(($datas[$i]['saldo_pokok4']=='')?'0':' '.number_format($datas[$i]['saldo_pokok4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,(($datas[$i]['cpp4']=='')?'0':' '.number_format($datas[$i]['cpp4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,(($datas[$i]['jml5']=='')?'0':$datas[$i]['jml5']));
					$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii,(($datas[$i]['saldo_pokok5']=='')?'0':' '.number_format($datas[$i]['saldo_pokok5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii,(($datas[$i]['cpp5']=='')?'0':' '.number_format($datas[$i]['cpp5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii,$total);
					$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii,' '.number_format($total_saldo,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii,' '.number_format($total_cpp,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':T'.$ii)->getFont()->setSize(10);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

					$ii++;
		        }

				$n++;
			
			}//END FOR*/

			if(count($datas)==0){
					
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				$ii++;
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,"Total");
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".$total_jumlah1);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".' '.number_format($total_saldo1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".' '.number_format($total_cpp1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".$total_jumlah2);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".' '.number_format($total_saldo2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".' '.number_format($total_cpp2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".$total_jumlah3);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".' '.number_format($total_saldo3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii," ".' '.number_format($total_cpp3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii," ".$total_jumlah4);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii," ".' '.number_format($total_saldo4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii," ".' '.number_format($total_cpp4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii," ".$total_jumlah5);
			$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii," ".' '.number_format($total_saldo5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii," ".' '.number_format($total_cpp5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii," ".$total_jumlah6);
			$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii," ".' '.number_format($total_saldo6,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii," ".' '.number_format($total_cpp6,0,',','.'));
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':T'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':T'.$ii)->getFont()->setSize(10);


			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-REKAPITULASI-NPL.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}

	function export_rekapitulasi_npl_peruntukan()
	{
		$branch_code = $this->uri->segment(3);	
		$tanggal_hitung = $this->uri->segment(4);
	 	$branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
            case '0':
              $branch_class_name = "Kepala Pusat";
              break;
            case '1':
              $branch_class_name = "Kepala Wilayah";
              break;
            case '2':
              $branch_class_name = "Kepala Cabang";
              break;
            case '3':
              $branch_class_name = "Kepala Unit";
              break;
            default:
              $branch_class_name = "-";
              break;
        }


        if ($branch_code !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($branch_code);
            // if($branch_class=="1"){
            //     $branch_name .= "";
            // }
        }else{
            $branch_name = "PUSAT";
        }
		$datas = $this->model_laporan_to_pdf->export_rekapitulasi_npl_by_peruntukan($branch_code,$tanggal_hitung);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->mergeCells('A2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAPITULASI NPL");
		$objPHPExcel->getActiveSheet()->mergeCells('A4:B4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4','Kantor Cabang');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',':');
		$objPHPExcel->getActiveSheet()->setCellValue('D4',$branch_name);

		$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
		$objPHPExcel->getActiveSheet()->mergeCells('B6:B7');
		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->mergeCells('F6:H6');
		$objPHPExcel->getActiveSheet()->mergeCells('I6:K6');
		$objPHPExcel->getActiveSheet()->mergeCells('L6:N6');
		$objPHPExcel->getActiveSheet()->mergeCells('O6:Q6');
		$objPHPExcel->getActiveSheet()->mergeCells('R6:T6');
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
		$objPHPExcel->getActiveSheet()->setCellValue('B6',"Peruntukan");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"PAR (1 - 30)");
		$objPHPExcel->getActiveSheet()->setCellValue('C7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('D7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('E7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"PAR (31 - 60)");
		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('H7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"PAR (61 - 90)");
		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('K7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('L6',"PAR (90 - 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('L7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('M7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('N7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('O6',"PAR (> 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('O7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('P7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('Q7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('R6',"TOTAL");
		$objPHPExcel->getActiveSheet()->setCellValue('R7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('S7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('T7',"CPP");

		
		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6:T7')->getFont()->setSize(11);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('Q')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('R')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('S')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('T')->setWidth(14);

					
			$ii = 8;
	        $total = 0;
	        $total_saldo = 0;
	        $total_cpp = 0;
	        $total_jumlah1 = 0;
	        $total_jumlah2 = 0;
	        $total_jumlah3 = 0;
	        $total_jumlah4 = 0;
	        $total_jumlah5 = 0;
	        $total_jumlah6 = 0;
	        $total_saldo1 = 0;
	        $total_saldo2 = 0;
	        $total_saldo3 = 0;
	        $total_saldo4 = 0;
	        $total_saldo5 = 0;
	        $total_saldo6 = 0;
	        $total_cpp1 = 0;
	        $total_cpp2 = 0;
	        $total_cpp3 = 0;
	        $total_cpp4 = 0;
	        $total_cpp5 = 0;
	        $total_cpp6 = 0;
			$row_total = count($datas)+8;
			$n=1;
			// $cabang='';
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

		        $total = $datas[$i]['jml1']+$datas[$i]['jml2']+$datas[$i]['jml3']+$datas[$i]['jml4']+$datas[$i]['jml5'];
		        $total_saldo = $datas[$i]['saldo_pokok1']+$datas[$i]['saldo_pokok2']+$datas[$i]['saldo_pokok3']+$datas[$i]['saldo_pokok4']+$datas[$i]['saldo_pokok5'];
		        $total_cpp = $datas[$i]['cpp1']+$datas[$i]['cpp2']+$datas[$i]['cpp3']+$datas[$i]['cpp4']+$datas[$i]['cpp5'];
		       //  if($datas[$i]['branch_class']=='2'){
		          $total_jumlah1 += $datas[$i]['jml1'];
		          $total_jumlah2 += $datas[$i]['jml2'];
		          $total_jumlah3 += $datas[$i]['jml3'];
		          $total_jumlah4 += $datas[$i]['jml4'];
		          $total_jumlah5 += $datas[$i]['jml5'];
		          $total_jumlah6 += $total;
		          $total_saldo1 += $datas[$i]['saldo_pokok1'];
		          $total_saldo2 += $datas[$i]['saldo_pokok2'];
		          $total_saldo3 += $datas[$i]['saldo_pokok3'];
		          $total_saldo4 += $datas[$i]['saldo_pokok4'];
		          $total_saldo5 += $datas[$i]['saldo_pokok5'];
		          $total_saldo6 += $total_saldo;
		          $total_cpp1 += $datas[$i]['cpp1'];
		          $total_cpp2 += $datas[$i]['cpp2'];
		          $total_cpp3 += $datas[$i]['cpp3'];
		          $total_cpp4 += $datas[$i]['cpp4'];
		          $total_cpp5 += $datas[$i]['cpp5'];
		          $total_cpp6 += $total_cpp;
		      	// }
		          
		        if($total>0){ //jika ada data baru ditampilkan

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['display_text']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,(($datas[$i]['jml1']=='')?'0':$datas[$i]['jml1']));
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,(($datas[$i]['saldo_pokok1']=='')?'0':' '.number_format($datas[$i]['saldo_pokok1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,(($datas[$i]['cpp1']=='')?'0':' '.number_format($datas[$i]['cpp1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,(($datas[$i]['jml2']=='')?'0':$datas[$i]['jml2']));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,(($datas[$i]['saldo_pokok2']=='')?'0':' '.number_format($datas[$i]['saldo_pokok2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,(($datas[$i]['cpp2']=='')?'0':' '.number_format($datas[$i]['cpp2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,(($datas[$i]['jml3']=='')?'0':$datas[$i]['jml3']));
					$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,(($datas[$i]['saldo_pokok3']=='')?'0':' '.number_format($datas[$i]['saldo_pokok3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,(($datas[$i]['cpp3']=='')?'0':' '.number_format($datas[$i]['cpp3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,(($datas[$i]['jml4']=='')?'0':$datas[$i]['jml4']));
					$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,(($datas[$i]['saldo_pokok4']=='')?'0':' '.number_format($datas[$i]['saldo_pokok4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,(($datas[$i]['cpp4']=='')?'0':' '.number_format($datas[$i]['cpp4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,(($datas[$i]['jml5']=='')?'0':$datas[$i]['jml5']));
					$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii,(($datas[$i]['saldo_pokok5']=='')?'0':' '.number_format($datas[$i]['saldo_pokok5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii,(($datas[$i]['cpp5']=='')?'0':' '.number_format($datas[$i]['cpp5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii,$total);
					$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii,' '.number_format($total_saldo,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii,' '.number_format($total_cpp,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':T'.$ii)->getFont()->setSize(10);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

					$ii++;
		        }

				$n++;
			
			}//END FOR*/

			if(count($datas)==0){
					
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				$ii++;
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,"Total");
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".$total_jumlah1);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".' '.number_format($total_saldo1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".' '.number_format($total_cpp1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".$total_jumlah2);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".' '.number_format($total_saldo2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".' '.number_format($total_cpp2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".$total_jumlah3);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".' '.number_format($total_saldo3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii," ".' '.number_format($total_cpp3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii," ".$total_jumlah4);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii," ".' '.number_format($total_saldo4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii," ".' '.number_format($total_cpp4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii," ".$total_jumlah5);
			$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii," ".' '.number_format($total_saldo5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii," ".' '.number_format($total_cpp5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii," ".$total_jumlah6);
			$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii," ".' '.number_format($total_saldo6,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii," ".' '.number_format($total_cpp6,0,',','.'));
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':T'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':T'.$ii)->getFont()->setSize(10);


			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-REKAPITULASI-NPL.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}

	function export_rekapitulasi_npl_rembug()
	{
		$branch_code = $this->uri->segment(3);	
		$tanggal_hitung = $this->uri->segment(4);
	 	$branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
            case '0':
              $branch_class_name = "Kepala Pusat";
              break;
            case '1':
              $branch_class_name = "Kepala Wilayah";
              break;
            case '2':
              $branch_class_name = "Kepala Cabang";
              break;
            case '3':
              $branch_class_name = "Kepala Unit";
              break;
            default:
              $branch_class_name = "-";
              break;
        }


        if ($branch_code !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($branch_code);
            // if($branch_class=="1"){
            //     $branch_name .= "";
            // }
        }else{
            $branch_name = "PUSAT";
        }
		$datas = $this->model_laporan_to_pdf->export_rekapitulasi_npl_by_rembug($branch_code,$tanggal_hitung);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->mergeCells('A2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAPITULASI NPL");
		$objPHPExcel->getActiveSheet()->mergeCells('A4:B4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4','Kantor Cabang');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',':');
		$objPHPExcel->getActiveSheet()->setCellValue('D4',$branch_name);

		$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
		$objPHPExcel->getActiveSheet()->mergeCells('B6:B7');
		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->mergeCells('F6:H6');
		$objPHPExcel->getActiveSheet()->mergeCells('I6:K6');
		$objPHPExcel->getActiveSheet()->mergeCells('L6:N6');
		$objPHPExcel->getActiveSheet()->mergeCells('O6:Q6');
		$objPHPExcel->getActiveSheet()->mergeCells('R6:T6');
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
		$objPHPExcel->getActiveSheet()->setCellValue('B6',"Rembug");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"PAR (1 - 30)");
		$objPHPExcel->getActiveSheet()->setCellValue('C7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('D7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('E7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"PAR (31 - 60)");
		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('H7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"PAR (61 - 90)");
		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('K7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('L6',"PAR (90 - 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('L7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('M7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('N7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('O6',"PAR (> 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('O7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('P7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('Q7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('R6',"TOTAL");
		$objPHPExcel->getActiveSheet()->setCellValue('R7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('S7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('T7',"CPP");

		
		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6:T7')->getFont()->setSize(11);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('Q')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('R')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('S')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('T')->setWidth(14);

					
			$ii = 8;
	        $total = 0;
	        $total_saldo = 0;
	        $total_cpp = 0;
	        $total_jumlah1 = 0;
	        $total_jumlah2 = 0;
	        $total_jumlah3 = 0;
	        $total_jumlah4 = 0;
	        $total_jumlah5 = 0;
	        $total_jumlah6 = 0;
	        $total_saldo1 = 0;
	        $total_saldo2 = 0;
	        $total_saldo3 = 0;
	        $total_saldo4 = 0;
	        $total_saldo5 = 0;
	        $total_saldo6 = 0;
	        $total_cpp1 = 0;
	        $total_cpp2 = 0;
	        $total_cpp3 = 0;
	        $total_cpp4 = 0;
	        $total_cpp5 = 0;
	        $total_cpp6 = 0;
			$row_total = count($datas)+8;
			$n=1;
			// $cabang='';
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

		        $total = $datas[$i]['jml1']+$datas[$i]['jml2']+$datas[$i]['jml3']+$datas[$i]['jml4']+$datas[$i]['jml5'];
		        $total_saldo = $datas[$i]['saldo_pokok1']+$datas[$i]['saldo_pokok2']+$datas[$i]['saldo_pokok3']+$datas[$i]['saldo_pokok4']+$datas[$i]['saldo_pokok5'];
		        $total_cpp = $datas[$i]['cpp1']+$datas[$i]['cpp2']+$datas[$i]['cpp3']+$datas[$i]['cpp4']+$datas[$i]['cpp5'];
		       //  if($datas[$i]['branch_class']=='2'){
		          $total_jumlah1 += $datas[$i]['jml1'];
		          $total_jumlah2 += $datas[$i]['jml2'];
		          $total_jumlah3 += $datas[$i]['jml3'];
		          $total_jumlah4 += $datas[$i]['jml4'];
		          $total_jumlah5 += $datas[$i]['jml5'];
		          $total_jumlah6 += $total;
		          $total_saldo1 += $datas[$i]['saldo_pokok1'];
		          $total_saldo2 += $datas[$i]['saldo_pokok2'];
		          $total_saldo3 += $datas[$i]['saldo_pokok3'];
		          $total_saldo4 += $datas[$i]['saldo_pokok4'];
		          $total_saldo5 += $datas[$i]['saldo_pokok5'];
		          $total_saldo6 += $total_saldo;
		          $total_cpp1 += $datas[$i]['cpp1'];
		          $total_cpp2 += $datas[$i]['cpp2'];
		          $total_cpp3 += $datas[$i]['cpp3'];
		          $total_cpp4 += $datas[$i]['cpp4'];
		          $total_cpp5 += $datas[$i]['cpp5'];
		          $total_cpp6 += $total_cpp;
		      	// }
		          
		        if($total>0){ //jika ada data baru ditampilkan

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name'].' | '.$datas[$i]['cm_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,(($datas[$i]['jml1']=='')?'0':$datas[$i]['jml1']));
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,(($datas[$i]['saldo_pokok1']=='')?'0':' '.number_format($datas[$i]['saldo_pokok1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,(($datas[$i]['cpp1']=='')?'0':' '.number_format($datas[$i]['cpp1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,(($datas[$i]['jml2']=='')?'0':$datas[$i]['jml2']));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,(($datas[$i]['saldo_pokok2']=='')?'0':' '.number_format($datas[$i]['saldo_pokok2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,(($datas[$i]['cpp2']=='')?'0':' '.number_format($datas[$i]['cpp2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,(($datas[$i]['jml3']=='')?'0':$datas[$i]['jml3']));
					$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,(($datas[$i]['saldo_pokok3']=='')?'0':' '.number_format($datas[$i]['saldo_pokok3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,(($datas[$i]['cpp3']=='')?'0':' '.number_format($datas[$i]['cpp3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,(($datas[$i]['jml4']=='')?'0':$datas[$i]['jml4']));
					$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,(($datas[$i]['saldo_pokok4']=='')?'0':' '.number_format($datas[$i]['saldo_pokok4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,(($datas[$i]['cpp4']=='')?'0':' '.number_format($datas[$i]['cpp4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,(($datas[$i]['jml5']=='')?'0':$datas[$i]['jml5']));
					$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii,(($datas[$i]['saldo_pokok5']=='')?'0':' '.number_format($datas[$i]['saldo_pokok5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii,(($datas[$i]['cpp5']=='')?'0':' '.number_format($datas[$i]['cpp5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii,$total);
					$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii,' '.number_format($total_saldo,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii,' '.number_format($total_cpp,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':T'.$ii)->getFont()->setSize(10);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

					$ii++;
		        }

				$n++;
			
			}//END FOR*/

			if(count($datas)==0){
					
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				$ii++;
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,"Total");
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".$total_jumlah1);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".' '.number_format($total_saldo1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".' '.number_format($total_cpp1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".$total_jumlah2);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".' '.number_format($total_saldo2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".' '.number_format($total_cpp2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".$total_jumlah3);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".' '.number_format($total_saldo3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii," ".' '.number_format($total_cpp3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii," ".$total_jumlah4);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii," ".' '.number_format($total_saldo4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii," ".' '.number_format($total_cpp4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii," ".$total_jumlah5);
			$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii," ".' '.number_format($total_saldo5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii," ".' '.number_format($total_cpp5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii," ".$total_jumlah6);
			$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii," ".' '.number_format($total_saldo6,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii," ".' '.number_format($total_cpp6,0,',','.'));
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':T'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':T'.$ii)->getFont()->setSize(10);


			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-REKAPITULASI-NPL.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}

	function export_rekapitulasi_npl_petugas()
	{
		$branch_code = $this->uri->segment(3);	
		$cm_code = $this->uri->segment(4);
		$tanggal_hitung = $this->uri->segment(5);
	 	$branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
            case '0':
              $branch_class_name = "Kepala Pusat";
              break;
            case '1':
              $branch_class_name = "Kepala Wilayah";
              break;
            case '2':
              $branch_class_name = "Kepala Cabang";
              break;
            case '3':
              $branch_class_name = "Kepala Unit";
              break;
            default:
              $branch_class_name = "-";
              break;
        }


        if ($branch_code !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($branch_code);
            // if($branch_class=="1"){
            //     $branch_name .= "";
            // }
        }else{
            $branch_name = "PUSAT";
        }
		$datas = $this->model_laporan_to_pdf->export_rekapitulasi_npl_by_petugas($branch_code,$cm_code,$tanggal_hitung);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->mergeCells('A2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAPITULASI NPL");
		$objPHPExcel->getActiveSheet()->mergeCells('A4:B4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4','Kantor Cabang');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',':');
		$objPHPExcel->getActiveSheet()->setCellValue('D4',$branch_name);

		$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
		$objPHPExcel->getActiveSheet()->mergeCells('B6:B7');
		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->mergeCells('F6:H6');
		$objPHPExcel->getActiveSheet()->mergeCells('I6:K6');
		$objPHPExcel->getActiveSheet()->mergeCells('L6:N6');
		$objPHPExcel->getActiveSheet()->mergeCells('O6:Q6');
		$objPHPExcel->getActiveSheet()->mergeCells('R6:T6');
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
		$objPHPExcel->getActiveSheet()->setCellValue('B6',"Petugas");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"PAR (1 - 30)");
		$objPHPExcel->getActiveSheet()->setCellValue('C7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('D7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('E7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"PAR (31 - 60)");
		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('H7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"PAR (61 - 90)");
		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('K7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('L6',"PAR (90 - 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('L7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('M7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('N7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('O6',"PAR (> 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('O7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('P7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('Q7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('R6',"TOTAL");
		$objPHPExcel->getActiveSheet()->setCellValue('R7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('S7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('T7',"CPP");

		
		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6:T7')->getFont()->setSize(11);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('Q')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('R')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('S')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('T')->setWidth(14);

					
			$ii = 8;
	        $total = 0;
	        $total_saldo = 0;
	        $total_cpp = 0;
	        $total_jumlah1 = 0;
	        $total_jumlah2 = 0;
	        $total_jumlah3 = 0;
	        $total_jumlah4 = 0;
	        $total_jumlah5 = 0;
	        $total_jumlah6 = 0;
	        $total_saldo1 = 0;
	        $total_saldo2 = 0;
	        $total_saldo3 = 0;
	        $total_saldo4 = 0;
	        $total_saldo5 = 0;
	        $total_saldo6 = 0;
	        $total_cpp1 = 0;
	        $total_cpp2 = 0;
	        $total_cpp3 = 0;
	        $total_cpp4 = 0;
	        $total_cpp5 = 0;
	        $total_cpp6 = 0;
			$row_total = count($datas)+8;
			$n=1;
			// $cabang='';
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        
				// if($datas[$i]['branch_class']==2){
				// 	if($cabang!=$datas[$i]['branch_name']){
				// 		$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				// 		$ii++;
				// 	}
				// }

		        $total = $datas[$i]['jml1']+$datas[$i]['jml2']+$datas[$i]['jml3']+$datas[$i]['jml4']+$datas[$i]['jml5'];
		        $total_saldo = $datas[$i]['saldo_pokok1']+$datas[$i]['saldo_pokok2']+$datas[$i]['saldo_pokok3']+$datas[$i]['saldo_pokok4']+$datas[$i]['saldo_pokok5'];
		        $total_cpp = $datas[$i]['cpp1']+$datas[$i]['cpp2']+$datas[$i]['cpp3']+$datas[$i]['cpp4']+$datas[$i]['cpp5'];
		       //  if($datas[$i]['branch_class']=='2'){
		          $total_jumlah1 += $datas[$i]['jml1'];
		          $total_jumlah2 += $datas[$i]['jml2'];
		          $total_jumlah3 += $datas[$i]['jml3'];
		          $total_jumlah4 += $datas[$i]['jml4'];
		          $total_jumlah5 += $datas[$i]['jml5'];
		          $total_jumlah6 += $total;
		          $total_saldo1 += $datas[$i]['saldo_pokok1'];
		          $total_saldo2 += $datas[$i]['saldo_pokok2'];
		          $total_saldo3 += $datas[$i]['saldo_pokok3'];
		          $total_saldo4 += $datas[$i]['saldo_pokok4'];
		          $total_saldo5 += $datas[$i]['saldo_pokok5'];
		          $total_saldo6 += $total_saldo;
		          $total_cpp1 += $datas[$i]['cpp1'];
		          $total_cpp2 += $datas[$i]['cpp2'];
		          $total_cpp3 += $datas[$i]['cpp3'];
		          $total_cpp4 += $datas[$i]['cpp4'];
		          $total_cpp5 += $datas[$i]['cpp5'];
		          $total_cpp6 += $total_cpp;
		      	// }

		        if($total>0){ //jika ada data baru ditampilkan

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name'].' | '.$datas[$i]['cm_name'].' | '.$datas[$i]['fa_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,(($datas[$i]['jml1']=='')?'0':$datas[$i]['jml1']));
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,(($datas[$i]['saldo_pokok1']=='')?'0':' '.number_format($datas[$i]['saldo_pokok1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,(($datas[$i]['cpp1']=='')?'0':' '.number_format($datas[$i]['cpp1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,(($datas[$i]['jml2']=='')?'0':$datas[$i]['jml2']));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,(($datas[$i]['saldo_pokok2']=='')?'0':' '.number_format($datas[$i]['saldo_pokok2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,(($datas[$i]['cpp2']=='')?'0':' '.number_format($datas[$i]['cpp2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,(($datas[$i]['jml3']=='')?'0':$datas[$i]['jml3']));
					$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,(($datas[$i]['saldo_pokok3']=='')?'0':' '.number_format($datas[$i]['saldo_pokok3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,(($datas[$i]['cpp3']=='')?'0':' '.number_format($datas[$i]['cpp3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,(($datas[$i]['jml4']=='')?'0':$datas[$i]['jml4']));
					$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,(($datas[$i]['saldo_pokok4']=='')?'0':' '.number_format($datas[$i]['saldo_pokok4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,(($datas[$i]['cpp4']=='')?'0':' '.number_format($datas[$i]['cpp4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,(($datas[$i]['jml5']=='')?'0':$datas[$i]['jml5']));
					$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii,(($datas[$i]['saldo_pokok5']=='')?'0':' '.number_format($datas[$i]['saldo_pokok5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii,(($datas[$i]['cpp5']=='')?'0':' '.number_format($datas[$i]['cpp5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii,$total);
					$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii,' '.number_format($total_saldo,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii,' '.number_format($total_cpp,0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':T'.$ii)->getFont()->setSize(10);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

					$ii++;
		        }

				// $cabang=$datas[$i]['branch_name'];

				// if($n==count($datas)){
					
				// 	$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				// 	$ii++;
				// }
				$n++;
			
			}//END FOR*/

			if(count($datas)==0){
					
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				$ii++;
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,"Total");
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".$total_jumlah1);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".' '.number_format($total_saldo1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".' '.number_format($total_cpp1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".$total_jumlah2);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".' '.number_format($total_saldo2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".' '.number_format($total_cpp2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".$total_jumlah3);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".' '.number_format($total_saldo3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii," ".' '.number_format($total_cpp3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii," ".$total_jumlah4);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii," ".' '.number_format($total_saldo4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii," ".' '.number_format($total_cpp4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii," ".$total_jumlah5);
			$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii," ".' '.number_format($total_saldo5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii," ".' '.number_format($total_cpp5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii," ".$total_jumlah6);
			$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii," ".' '.number_format($total_saldo6,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii," ".' '.number_format($total_cpp6,0,',','.'));
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':T'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':T'.$ii)->getFont()->setSize(10);


			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-REKAPITULASI-NPL.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}

	function export_rekapitulasi_npl2()
	{
		$branch_code = $this->uri->segment(3);	
		$fa_code = $this->uri->segment(4);
		$cm_code = $this->uri->segment(5);
		$tanggal_hitung = $this->uri->segment(6);
	 	$branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
            case '0':
              $branch_class_name = "Kepala Pusat";
              break;
            case '1':
              $branch_class_name = "Kepala Wilayah";
              break;
            case '2':
              $branch_class_name = "Kepala Cabang";
              break;
            case '3':
              $branch_class_name = "Kepala Unit";
              break;
            default:
              $branch_class_name = "-";
              break;
        }


        if ($branch_code !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($branch_code);
            // if($branch_class=="1"){
            //     $branch_name .= "";
            // }
        }else{
            $branch_name = "PUSAT";
        }
		$datas = $this->model_laporan_to_pdf->export_rekapitulasi_npl2($branch_code,$fa_code,$cm_code,$tanggal_hitung);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->mergeCells('A2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAPITULASI NPL");
		$objPHPExcel->getActiveSheet()->mergeCells('A4:B4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4','Kantor Cabang');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',':');
		$objPHPExcel->getActiveSheet()->setCellValue('D4',$branch_name);

		$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
		$objPHPExcel->getActiveSheet()->mergeCells('B6:B7');
		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->mergeCells('F6:H6');
		$objPHPExcel->getActiveSheet()->mergeCells('I6:K6');
		$objPHPExcel->getActiveSheet()->mergeCells('L6:N6');
		$objPHPExcel->getActiveSheet()->mergeCells('O6:Q6');
		$objPHPExcel->getActiveSheet()->mergeCells('R6:T6');
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
		$objPHPExcel->getActiveSheet()->setCellValue('B6',"Petugas");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"PAR (1 - 30)");
		$objPHPExcel->getActiveSheet()->setCellValue('C7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('D7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('E7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"PAR (31 - 60)");
		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('H7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"PAR (61 - 90)");
		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('K7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('L6',"PAR (90 - 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('L7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('M7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('N7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('O6',"PAR (> 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('O7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('P7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('Q7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('R6',"TOTAL");
		$objPHPExcel->getActiveSheet()->setCellValue('R7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('S7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('T7',"CPP");

		
		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6:T7')->getFont()->setSize(11);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('Q')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('R')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('S')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('T')->setWidth(14);

					
			$ii = 8;
	        $total = 0;
	        $total_saldo = 0;
	        $total_cpp = 0;
	        $total_jumlah1 = 0;
	        $total_jumlah2 = 0;
	        $total_jumlah3 = 0;
	        $total_jumlah4 = 0;
	        $total_jumlah5 = 0;
	        $total_jumlah6 = 0;
	        $total_saldo1 = 0;
	        $total_saldo2 = 0;
	        $total_saldo3 = 0;
	        $total_saldo4 = 0;
	        $total_saldo5 = 0;
	        $total_saldo6 = 0;
	        $total_cpp1 = 0;
	        $total_cpp2 = 0;
	        $total_cpp3 = 0;
	        $total_cpp4 = 0;
	        $total_cpp5 = 0;
	        $total_cpp6 = 0;
			$row_total = count($datas)+8;
			$n=1;
			// $cabang='';
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        
				// if($datas[$i]['branch_class']==2){
				// 	if($cabang!=$datas[$i]['branch_name']){
				// 		$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				// 		$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				// 		$ii++;
				// 	}
				// }

		        $total = $datas[$i]['jml1']+$datas[$i]['jml2']+$datas[$i]['jml3']+$datas[$i]['jml4']+$datas[$i]['jml5'];
		        $total_saldo = $datas[$i]['saldo_pokok1']+$datas[$i]['saldo_pokok2']+$datas[$i]['saldo_pokok3']+$datas[$i]['saldo_pokok4']+$datas[$i]['saldo_pokok5'];
		        $total_cpp = $datas[$i]['cpp1']+$datas[$i]['cpp2']+$datas[$i]['cpp3']+$datas[$i]['cpp4']+$datas[$i]['cpp5'];
		       //  if($datas[$i]['branch_class']=='2'){
		          $total_jumlah1 += $datas[$i]['jml1'];
		          $total_jumlah2 += $datas[$i]['jml2'];
		          $total_jumlah3 += $datas[$i]['jml3'];
		          $total_jumlah4 += $datas[$i]['jml4'];
		          $total_jumlah5 += $datas[$i]['jml5'];
		          $total_jumlah6 += $total;
		          $total_saldo1 += $datas[$i]['saldo_pokok1'];
		          $total_saldo2 += $datas[$i]['saldo_pokok2'];
		          $total_saldo3 += $datas[$i]['saldo_pokok3'];
		          $total_saldo4 += $datas[$i]['saldo_pokok4'];
		          $total_saldo5 += $datas[$i]['saldo_pokok5'];
		          $total_saldo6 += $total_saldo;
		          $total_cpp1 += $datas[$i]['cpp1'];
		          $total_cpp2 += $datas[$i]['cpp2'];
		          $total_cpp3 += $datas[$i]['cpp3'];
		          $total_cpp4 += $datas[$i]['cpp4'];
		          $total_cpp5 += $datas[$i]['cpp5'];
		          $total_cpp6 += $total_cpp;
		      	// }

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['fa_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,(($datas[$i]['jml1']=='')?'0':$datas[$i]['jml1']));
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,(($datas[$i]['saldo_pokok1']=='')?'0':' '.number_format($datas[$i]['saldo_pokok1'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,(($datas[$i]['cpp1']=='')?'0':' '.number_format($datas[$i]['cpp1'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,(($datas[$i]['jml2']=='')?'0':$datas[$i]['jml2']));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,(($datas[$i]['saldo_pokok2']=='')?'0':' '.number_format($datas[$i]['saldo_pokok2'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,(($datas[$i]['cpp2']=='')?'0':' '.number_format($datas[$i]['cpp2'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,(($datas[$i]['jml3']=='')?'0':$datas[$i]['jml3']));
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,(($datas[$i]['saldo_pokok3']=='')?'0':' '.number_format($datas[$i]['saldo_pokok3'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,(($datas[$i]['cpp3']=='')?'0':' '.number_format($datas[$i]['cpp3'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,(($datas[$i]['jml4']=='')?'0':$datas[$i]['jml4']));
				$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,(($datas[$i]['saldo_pokok4']=='')?'0':' '.number_format($datas[$i]['saldo_pokok4'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,(($datas[$i]['cpp4']=='')?'0':' '.number_format($datas[$i]['cpp4'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,(($datas[$i]['jml5']=='')?'0':$datas[$i]['jml5']));
				$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii,(($datas[$i]['saldo_pokok5']=='')?'0':' '.number_format($datas[$i]['saldo_pokok5'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii,(($datas[$i]['cpp5']=='')?'0':' '.number_format($datas[$i]['cpp5'],0,',','.')));
				$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii,$total);
				$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii,' '.number_format($total_saldo,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii,' '.number_format($total_cpp,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':T'.$ii)->getFont()->setSize(10);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

				$ii++;

				// $cabang=$datas[$i]['branch_name'];

				// if($n==count($datas)){
					
				// 	$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				// 	$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				// 	$ii++;
				// }
				$n++;
			
			}//END FOR*/

			if(count($datas)==0){
					
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				$ii++;
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,"Total");
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".$total_jumlah1);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".' '.number_format($total_saldo1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".' '.number_format($total_cpp1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".$total_jumlah2);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".' '.number_format($total_saldo2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".' '.number_format($total_cpp2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".$total_jumlah3);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".' '.number_format($total_saldo3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii," ".' '.number_format($total_cpp3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii," ".$total_jumlah4);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii," ".' '.number_format($total_saldo4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii," ".' '.number_format($total_cpp4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii," ".$total_jumlah5);
			$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii," ".' '.number_format($total_saldo5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii," ".' '.number_format($total_cpp5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii," ".$total_jumlah6);
			$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii," ".' '.number_format($total_saldo6,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii," ".' '.number_format($total_cpp6,0,',','.'));
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':T'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':T'.$ii)->getFont()->setSize(10);


			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-REKAPITULASI-NPL.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}

	function export_rekapitulasi_npl()
	{
		$branch_code = $this->uri->segment(3);	
		$tanggal_hitung = $this->uri->segment(4);	
	 	$branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
            case '0':
              $branch_class_name = "Kepala Pusat";
              break;
            case '1':
              $branch_class_name = "Kepala Wilayah";
              break;
            case '2':
              $branch_class_name = "Kepala Cabang";
              break;
            case '3':
              $branch_class_name = "Kepala Unit";
              break;
            default:
              $branch_class_name = "-";
              break;
        }


        if ($branch_code !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($branch_code);
            // if($branch_class=="1"){
            //     $branch_name .= "";
            // }
        }else{
            $branch_name = "PUSAT";
        }
		$datas = $this->model_laporan_to_pdf->export_rekapitulasi_npl($branch_code,$tanggal_hitung);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->mergeCells('A2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAPITULASI NPL");
		$objPHPExcel->getActiveSheet()->mergeCells('A4:B4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4','Kantor Cabang');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',':');
		$objPHPExcel->getActiveSheet()->setCellValue('D4',$branch_name);

		$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
		$objPHPExcel->getActiveSheet()->mergeCells('B6:B7');
		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->mergeCells('F6:H6');
		$objPHPExcel->getActiveSheet()->mergeCells('I6:K6');
		$objPHPExcel->getActiveSheet()->mergeCells('L6:N6');
		$objPHPExcel->getActiveSheet()->mergeCells('O6:Q6');
		$objPHPExcel->getActiveSheet()->mergeCells('R6:T6');
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
		$objPHPExcel->getActiveSheet()->setCellValue('B6',"Kantor");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"PAR (1 - 30)");
		$objPHPExcel->getActiveSheet()->setCellValue('C7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('D7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('E7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"PAR (31 - 60)");
		$objPHPExcel->getActiveSheet()->setCellValue('F7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('H7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('I6',"PAR (61 - 90)");
		$objPHPExcel->getActiveSheet()->setCellValue('I7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('J7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('K7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('L6',"PAR (90 - 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('L7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('M7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('N7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('O6',"PAR (> 120)");
		$objPHPExcel->getActiveSheet()->setCellValue('O7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('P7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('Q7',"CPP");
		$objPHPExcel->getActiveSheet()->setCellValue('R6',"TOTAL");
		$objPHPExcel->getActiveSheet()->setCellValue('R7',"Jml");
		$objPHPExcel->getActiveSheet()->setCellValue('S7',"Saldo Pokok");
		$objPHPExcel->getActiveSheet()->setCellValue('T7',"CPP");

		
		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:T7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('K7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('L7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('M7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('N7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('O7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('P7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('Q7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('R7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('S7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('T7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6:T7')->getFont()->setSize(11);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('O')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('P')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('Q')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('R')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('S')->setWidth(14);
		$objPHPExcel->getActiveSheet()->getColumnDimension('T')->setWidth(14);

					
			$ii = 8;
	        $total = 0;
	        $total_saldo = 0;
	        $total_cpp = 0;
	        $total_jumlah1 = 0;
	        $total_jumlah2 = 0;
	        $total_jumlah3 = 0;
	        $total_jumlah4 = 0;
	        $total_jumlah5 = 0;
	        $total_jumlah6 = 0;
	        $total_saldo1 = 0;
	        $total_saldo2 = 0;
	        $total_saldo3 = 0;
	        $total_saldo4 = 0;
	        $total_saldo5 = 0;
	        $total_saldo6 = 0;
	        $total_cpp1 = 0;
	        $total_cpp2 = 0;
	        $total_cpp3 = 0;
	        $total_cpp4 = 0;
	        $total_cpp5 = 0;
	        $total_cpp6 = 0;
			$row_total = count($datas)+8;
			$n=1;
			$cabang='';
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        if($branch_class<2)
		        {
					if($datas[$i]['branch_class']==2){
						if($cabang!=$datas[$i]['branch_name']){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
							$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
							$ii++;
						}
					}
				}

		        $total = $datas[$i]['jml1']+$datas[$i]['jml2']+$datas[$i]['jml3']+$datas[$i]['jml4']+$datas[$i]['jml5'];
		        $total_saldo = $datas[$i]['saldo_pokok1']+$datas[$i]['saldo_pokok2']+$datas[$i]['saldo_pokok3']+$datas[$i]['saldo_pokok4']+$datas[$i]['saldo_pokok5'];
		        $total_cpp = $datas[$i]['cpp1']+$datas[$i]['cpp2']+$datas[$i]['cpp3']+$datas[$i]['cpp4']+$datas[$i]['cpp5'];
		        
		        if($datas[$i]['branch_class']=='2'){
		          $total_jumlah1 += $datas[$i]['jml1'];
		          $total_jumlah2 += $datas[$i]['jml2'];
		          $total_jumlah3 += $datas[$i]['jml3'];
		          $total_jumlah4 += $datas[$i]['jml4'];
		          $total_jumlah5 += $datas[$i]['jml5'];
		          $total_jumlah6 += $total;
		          $total_saldo1 += $datas[$i]['saldo_pokok1'];
		          $total_saldo2 += $datas[$i]['saldo_pokok2'];
		          $total_saldo3 += $datas[$i]['saldo_pokok3'];
		          $total_saldo4 += $datas[$i]['saldo_pokok4'];
		          $total_saldo5 += $datas[$i]['saldo_pokok5'];
		          $total_saldo6 += $total_saldo;
		          $total_cpp1 += $datas[$i]['cpp1'];
		          $total_cpp2 += $datas[$i]['cpp2'];
		          $total_cpp3 += $datas[$i]['cpp3'];
		          $total_cpp4 += $datas[$i]['cpp4'];
		          $total_cpp5 += $datas[$i]['cpp5'];
		          $total_cpp6 += $total_cpp;
		      	}
			    
			    if($branch_class<2){
				    
					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,(($datas[$i]['jml1']=='')?'0':$datas[$i]['jml1']));
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,(($datas[$i]['saldo_pokok1']=='')?'0':' '.number_format($datas[$i]['saldo_pokok1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,(($datas[$i]['cpp1']=='')?'0':' '.number_format($datas[$i]['cpp1'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,(($datas[$i]['jml2']=='')?'0':$datas[$i]['jml2']));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,(($datas[$i]['saldo_pokok2']=='')?'0':' '.number_format($datas[$i]['saldo_pokok2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,(($datas[$i]['cpp2']=='')?'0':' '.number_format($datas[$i]['cpp2'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,(($datas[$i]['jml3']=='')?'0':$datas[$i]['jml3']));
					$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,(($datas[$i]['saldo_pokok3']=='')?'0':' '.number_format($datas[$i]['saldo_pokok3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,(($datas[$i]['cpp3']=='')?'0':' '.number_format($datas[$i]['cpp3'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,(($datas[$i]['jml4']=='')?'0':$datas[$i]['jml4']));
					$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,(($datas[$i]['saldo_pokok4']=='')?'0':' '.number_format($datas[$i]['saldo_pokok4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,(($datas[$i]['cpp4']=='')?'0':' '.number_format($datas[$i]['cpp4'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,(($datas[$i]['jml5']=='')?'0':$datas[$i]['jml5']));
					$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii,(($datas[$i]['saldo_pokok5']=='')?'0':' '.number_format($datas[$i]['saldo_pokok5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii,(($datas[$i]['cpp5']=='')?'0':' '.number_format($datas[$i]['cpp5'],0,',','.')));
					$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii,$total);
					$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii,' '.number_format($total_saldo,0,',','.'));
					$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii,' '.number_format($total_cpp,0,',','.'));

				}else{

					if($datas[$i]['branch_class']!=2)
					{
						$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
						$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
						$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,(($datas[$i]['jml1']=='')?'0':$datas[$i]['jml1']));
						$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,(($datas[$i]['saldo_pokok1']=='')?'0':' '.number_format($datas[$i]['saldo_pokok1'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,(($datas[$i]['cpp1']=='')?'0':' '.number_format($datas[$i]['cpp1'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,(($datas[$i]['jml2']=='')?'0':$datas[$i]['jml2']));
						$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,(($datas[$i]['saldo_pokok2']=='')?'0':' '.number_format($datas[$i]['saldo_pokok2'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,(($datas[$i]['cpp2']=='')?'0':' '.number_format($datas[$i]['cpp2'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,(($datas[$i]['jml3']=='')?'0':$datas[$i]['jml3']));
						$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,(($datas[$i]['saldo_pokok3']=='')?'0':' '.number_format($datas[$i]['saldo_pokok3'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii,(($datas[$i]['cpp3']=='')?'0':' '.number_format($datas[$i]['cpp3'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii,(($datas[$i]['jml4']=='')?'0':$datas[$i]['jml4']));
						$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii,(($datas[$i]['saldo_pokok4']=='')?'0':' '.number_format($datas[$i]['saldo_pokok4'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii,(($datas[$i]['cpp4']=='')?'0':' '.number_format($datas[$i]['cpp4'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii,(($datas[$i]['jml5']=='')?'0':$datas[$i]['jml5']));
						$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii,(($datas[$i]['saldo_pokok5']=='')?'0':' '.number_format($datas[$i]['saldo_pokok5'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii,(($datas[$i]['cpp5']=='')?'0':' '.number_format($datas[$i]['cpp5'],0,',','.')));
						$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii,$total);
						$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii,' '.number_format($total_saldo,0,',','.'));
						$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii,' '.number_format($total_cpp,0,',','.'));
					}
				}

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':T'.$ii)->getFont()->setSize(10);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

				$ii++;

				$cabang=$datas[$i]['branch_name'];

				if($n==count($datas)){
					
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
					$ii++;
				}
				$n++;
			
			}//END FOR*/

			if(count($datas)==0){
					
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);
				$ii++;
			}

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,"Total");
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii," ".$total_jumlah1);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".' '.number_format($total_saldo1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".' '.number_format($total_cpp1,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".$total_jumlah2);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".' '.number_format($total_saldo2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii," ".' '.number_format($total_cpp2,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".$total_jumlah3);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii," ".' '.number_format($total_saldo3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('K'.$ii," ".' '.number_format($total_cpp3,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('L'.$ii," ".$total_jumlah4);
			$objPHPExcel->getActiveSheet()->setCellValue('M'.$ii," ".' '.number_format($total_saldo4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('N'.$ii," ".' '.number_format($total_cpp4,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('O'.$ii," ".$total_jumlah5);
			$objPHPExcel->getActiveSheet()->setCellValue('P'.$ii," ".' '.number_format($total_saldo5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('Q'.$ii," ".' '.number_format($total_cpp5,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('R'.$ii," ".$total_jumlah6);
			$objPHPExcel->getActiveSheet()->setCellValue('S'.$ii," ".' '.number_format($total_saldo6,0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('T'.$ii," ".' '.number_format($total_cpp6,0,',','.'));
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':K'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':N'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':Q'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':T'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':T'.$ii)->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':T'.$ii)->getFont()->setSize(10);


			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii.':J'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('K'.$ii.':K'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('L'.$ii.':L'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('M'.$ii.':M'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('N'.$ii.':N'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('O'.$ii.':O'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('P'.$ii.':P'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('Q'.$ii.':Q'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('R'.$ii.':R'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('S'.$ii.':S'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('T'.$ii.':T'.$ii)->applyFromArray($styleArray);

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-REKAPITULASI-NPL.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
	}

	function export_rekapitulasi_kol()
	{
		$branch_code = $this->uri->segment(3);	
		$kol = $this->uri->segment(4);	
		$tanggal_hitung = $this->uri->segment(5);	
	 	$branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
            case '0':
              $branch_class_name = "Kepala Pusat";
              break;
            case '1':
              $branch_class_name = "Kepala Wilayah";
              break;
            case '2':
              $branch_class_name = "Kepala Cabang";
              break;
            case '3':
              $branch_class_name = "Kepala Unit";
              break;
            default:
              $branch_class_name = "-";
              break;
        }


        if ($branch_code !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($branch_code);
            // if($branch_class=="1"){
            //     $branch_name .= "";
            // }
        }else{
            $branch_name = "PUSAT";
        }
		$datas = $this->model_laporan_to_pdf->export_rekapitulasi_kol($branch_code,$kol,$tanggal_hitung);
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->mergeCells('A2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN REKAPITULASI NPL");
		$objPHPExcel->getActiveSheet()->mergeCells('A4:B4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4','Kantor Cabang');
		$objPHPExcel->getActiveSheet()->setCellValue('C4',': '.$branch_name);

		$objPHPExcel->getActiveSheet()->mergeCells('A6:A7');
		$objPHPExcel->getActiveSheet()->mergeCells('B6:B7');
		$objPHPExcel->getActiveSheet()->mergeCells('C6:C7');
		$objPHPExcel->getActiveSheet()->mergeCells('D6:D7');
		$objPHPExcel->getActiveSheet()->mergeCells('E6:E7');
		$objPHPExcel->getActiveSheet()->mergeCells('F6:G6');
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"NO");
		$objPHPExcel->getActiveSheet()->setCellValue('B6',"PORTOFOLIO AT RISK");
		$objPHPExcel->getActiveSheet()->setCellValue('C6',"JUMLAH ANGGOTA");
		$objPHPExcel->getActiveSheet()->setCellValue('D6',"OUTSTANDING");
		$objPHPExcel->getActiveSheet()->setCellValue('E6',"RESIKO");
		$objPHPExcel->getActiveSheet()->setCellValue('F6',"PENYADANGAN TAGIHAN");

		$objPHPExcel->getActiveSheet()->setCellValue('F7',"%");
		$objPHPExcel->getActiveSheet()->setCellValue('G7',"JUMLAH");
		$objPHPExcel->getActiveSheet()->getStyle('C6')->getAlignment()->setWrapText(true); 
		$objPHPExcel->getActiveSheet()->getStyle('E6')->getAlignment()->setWrapText(true); 

		
		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:G7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:G7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A6:G7')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('A6:A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6:B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7:F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:G7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A6:G7')->getFont()->setSize(11);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(4);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(13);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(17);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(8);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);



		$total_outstanding=0;
		for ( $h = 0 ; $h < count($datas) ; $h++ )
		{
			$total_outstanding += $datas[$h]['saldo_pokok'];
		}

						
		$ii = 8;

  		$total = 0;
  		$total_cadangan_piutang = 0;
  		$total_saldo_pokok = 0;
  		$par=0;
  		// $resiko=0;
  		$total_resiko=0;

		for( $i = 0 ; $i < count($datas) ; $i++ )
		{ 
    		$total+=$datas[$i]['jumlah'];     
   			$total_cadangan_piutang+=$datas[$i]['cadangan_piutang'];  
   			$total_saldo_pokok+=$datas[$i]['saldo_pokok'];  
   			$resiko = $datas[$i]['saldo_pokok']/$total_outstanding*100;
   			if($datas[$i]['cpp']>10){
	   			$par += $resiko;
	   		}
	   		$total_resiko+=$resiko;

			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['par_desc']);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['jumlah']);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['saldo_pokok'],0,',','.'));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,round($resiko,2).'%');
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,(int)$datas[$i]['cpp'].'%');
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii," ".number_format($datas[$i]['cadangan_piutang'],0,',','.'));

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getFont()->setSize(10);

			$ii++;
		
		}//END FOR

		$iii = count($datas)+8;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total);
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_saldo_pokok,0,',','.'));
		$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii,round($total_resiko,2).'%');
		$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii," ".number_format($total_cadangan_piutang,0,',','.'));

		$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G'.$iii.':G'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':G'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':G'.$iii)->getFont()->setSize(10);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':G'.$iii)->getFont()->setBold(true);

		$iii++;
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii,"PAR");
		$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii,round($par,2).'%');

		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':E'.$iii)->getFont()->setSize(10);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':E'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':E'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN-REKAPITULASI-NPL-PAR.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	/*
	| EXPORT NERACA GL
	| by sayyid
	*/
	public function export_neraca_gl2()
	{
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        // $from_date = $this->get_from_trx_date();
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;
        if ($cabang==""){            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        }else if ($periode_bulan=="" && $periode_tahun=="") {
            echo "<script>alert('Periode Belum Dipilih !');javascript:window.close();</script>";
        }else{

            $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_class = $branch['branch_class'];

            switch ($branch_class) {
				case '0':
				  $branch_class_name = "Kepala Pusat";
				  break;
				case '1':
				  $branch_class_name = "Kepala Wilayah";
				  break;
				case '2':
				  $branch_class_name = "Kepala Cabang";
				  break;
				case '3':
				  $branch_class_name = "Kepala Capem";
				  break;
				default:
				  $branch_class_name = "-";
				  break;
			}

            // $from_periode = $periode_tahun.'-'.$periode_bulan.'-01';
			$datas = $this->model_laporan_to_pdf->export_neraca_gl2($cabang,$last_date);
            if ($cabang !='00000'){
                $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
                if($branch_class=="1"){
                    $branch_name .= "";
                }
            }else{
                $branch_name = "PUSAT";
            }

			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN NERACA");
			// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

			// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

			$cCA = createColumnsArray('XFD');

			if($branch_class=='0'){
				$branch_class_output='1';
			}else if($branch_class=='1'){
				$branch_class_output='2';
			}else if($branch_class=='2'){
				$branch_class_output='3';
			}else{
				$branch_class_output='';
			}
			$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

			$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
			$objPHPExcel->getActiveSheet()->getStyle('D7:D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
			for($h=0;$h<count($branch_child_data);$h++)
			{
				$branchColumn=$cCA[($h+4)];
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn.'7')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
			}

			$ii = 8;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				/*
				| BEGIN SET OPTION
				*/
				if($datas[$i]['item_type']=="0") // TITLE
				{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else if($datas[$i]['posisi']=='1'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
				}
				else if($datas[$i]['item_type']=="1") // SUMMARY
				{
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				else if($datas[$i]['item_type']=="2") // FORMULA
				{
					if($datas[$i]['formula_text_bold']==0){
						if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
						}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}else if($datas[$i]['formula_text_bold']==1){
						if($datas[$i]['posisi']=='0'){
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
						}else{
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
					}
				}
				else if($datas[$i]['item_type']=="3") // TOTAL
				{
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}

		        $item_name = $datas[$i]['item_name'];
		        $item_name = str_replace('&nbsp;',' ',$item_name);
		        $item_name = str_replace('<b>','',$item_name);
		        $item_name = str_replace('</b>','',$item_name);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(10);
		        if($datas[$i]['item_type']=='0'){ // title
		        	$saldo='';
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
		        	}
		        }else if($datas[$i]['item_type']=='3'){ // total
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setBold(true);
		        	}
		        }else{
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        }
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
				/*
				| END SET OPTION
				*/

		        // CELL VALUE
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
				if(count($branch_child_data)==0){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
				}

				if($saldo!='')
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$saldo_per_item = $this->model_laporan_to_pdf->get_saldo_report_by_item_code('10',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$periode_bulan,$periode_tahun,$periode_hari);
						
						$branchColumn=$cCA[($j+4)];
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(10);
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldo_per_item,2,',','.').' ');
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(11);
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setBold(true);
						}
						
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
					}	
				}
				else
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$branchColumn=$cCA[($j+4)];
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					}
				}
				$ii++;
			
			}//END FOR*/
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-NERACA.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}

	function export_keuangan_neraca_bulanan(){
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        $report_code = $this->uri->segment(7);
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;

        $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
			case '0':
			  $branch_class_name = "Kepala Pusat";
			  break;
			case '1':
			  $branch_class_name = "Kepala Wilayah";
			  break;
			case '2':
			  $branch_class_name = "Kepala Cabang";
			  break;
			case '3':
			  $branch_class_name = "Kepala Capem";
			  break;
			default:
			  $branch_class_name = "-";
			  break;
		}

		$datas = $this->model_laporan_to_pdf->export_keuangan_neraca_bulanan($cabang,$last_date,$report_code);
        if ($cabang !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
            if($branch_class=="1"){
                $branch_name .= "";
            }
        }else{
            $branch_name = "PUSAT";
        }

        if($report_code == '10'){
            $jenis = 'neraca';
            $judul = 'LAPORAN NERACA BULANAN';
        } else if($report_code == '11'){
            $jenis = 'neraca_rinci';
            $judul = 'LAPORAN NERACA RINCI BULANAN';
        }

		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('A2',$judul);
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

		$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
		$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

		$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

		$cCA = createColumnsArray('XFD');

		if($branch_class=='0'){
			$branch_class_output='1';
		}else if($branch_class=='1'){
			$branch_class_output='2';
		}else if($branch_class=='2'){
			$branch_class_output='3';
		}else{
			$branch_class_output='';
		}
		$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

		$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
		$objPHPExcel->getActiveSheet()->getStyle('D7:D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
		for($h=0;$h<count($branch_child_data);$h++)
		{
			$branchColumn=$cCA[($h+4)];
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn.'7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
		}

		$ii = 8;
		$row_total = count($datas)+8;
		for( $i = 0 ; $i < count($datas) ; $i++ )
		{

			/*
			| BEGIN SET OPTION
			*/
			if($datas[$i]['item_type']=="0") // TITLE
			{
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				if($datas[$i]['posisi']=='0'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
				}else if($datas[$i]['posisi']=='1'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
			}
			else if($datas[$i]['item_type']=="1") // SUMMARY
			{
				if($datas[$i]['posisi']=='0'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}else{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
				}
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
			}
			else if($datas[$i]['item_type']=="2") // FORMULA
			{
				if($datas[$i]['formula_text_bold']==0){
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}else if($datas[$i]['formula_text_bold']==1){
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
				}
			}
			else if($datas[$i]['item_type']=="3") // TOTAL
			{
				if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
				}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
			}

	        $item_name = $datas[$i]['item_name'];
	        $item_name = str_replace('&nbsp;',' ',$item_name);
	        $item_name = str_replace('<b>','',$item_name);
	        $item_name = str_replace('</b>','',$item_name);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(10);
	        if($datas[$i]['item_type']=='0'){ // title
	        	$saldo='';
	        	if($datas[$i]['posisi']=='0'){
	        		$item_name = trim($item_name);
	        	}
	        }else if($datas[$i]['item_type']=='3'){ // total
	        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
	        	if($datas[$i]['posisi']=='0'){
	        		$item_name = trim($item_name);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(11);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setBold(true);
	        	}
	        }else{
	        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
	        }
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
			/*
			| END SET OPTION
			*/

	        // CELL VALUE
			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
			if(count($branch_child_data)==0){
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
			}

			if($saldo!='')
			{
				for($j=0;$j<count($branch_child_data);$j++)
				{
					$saldo_per_item = $this->model_laporan_to_pdf->get_saldo_report_by_item_code_bulanan($report_code,$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$periode_bulan,$periode_tahun,$periode_hari);
					
					$branchColumn=$cCA[($j+4)];
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(10);
					$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldo_per_item,2,',','.').' ');
					$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

	        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setBold(true);
					}
					
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
				}	
			}
			else
			{
				for($j=0;$j<count($branch_child_data);$j++)
				{
					$branchColumn=$cCA[($j+4)];
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
				}
			}
			$ii++;
		
		}//END FOR*/
		$ii++;
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="'.$judul.' '.$branch_name.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	function export_neraca_temp(){

        $cabang = $this->uri->segment(3);
        $tanggal = $this->uri->segment(4);
        $periode_tahun = substr($tanggal,4,4);
        $periode_bulan = substr($tanggal,2,2);       
        $periode_hari = substr($tanggal,0,2);
        $tanggal = $this->datepicker_convert(true,$tanggal,'/');
        $report_code = $this->uri->segment(5);
        $user_id = $this->session->userdata('user_id');

	    $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
	    $branch = $this->model_cif->get_branch_by_branch_id($branch_id);

	    $branch_class = $branch['branch_class'];

	    switch ($branch_class) {
			case '0':
			  $branch_class_name = "Kepala Pusat";
			  break;
			case '1':
			  $branch_class_name = "Kepala Wilayah";
			  break;
			case '2':
			  $branch_class_name = "Kepala Cabang";
			  break;
			case '3':
			  $branch_class_name = "Kepala Capem";
			  break;
			default:
			  $branch_class_name = "-";
			  break;
		}

        $startGetClosing = substr($tanggal,0,7).'-01';
        $startClosing = date('Y-m-d',strtotime($startGetClosing . ' - 1 MONTH'));
        $getClosing = $this->model_laporan_to_pdf->getClosing($cabang);

        $fromlm = $startClosing;
        $from = $startGetClosing;
        $thru = $tanggal;

        $insert_temp = $this->model_laporan_to_pdf->insert_temp($cabang,$fromlm,$from,$thru,$user_id);

		$datas = $this->model_laporan_to_pdf->export_neraca_temp($cabang,$report_code);
	    if ($cabang !='00000'){
	        $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
	        if($branch_class=="1"){
	            $branch_name .= "";
	        }
	    }else{
	        $branch_name = "PUSAT";
	    }

		// ----------------------------------------------------------
		// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
	   		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN NERACA");
		// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($tanggal,'id',false,'-'));

		// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
		$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
		$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

		$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

		$cCA = createColumnsArray('XFD');

		if($branch_class=='0'){
			$branch_class_output='1';
		}else if($branch_class=='1'){
			$branch_class_output='2';
		}else if($branch_class=='2'){
			$branch_class_output='3';
		}else{
			$branch_class_output='';
		}
		$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

		$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
		$objPHPExcel->getActiveSheet()->getStyle('D7:D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
		for($h=0;$h<count($branch_child_data);$h++)
		{
			$branchColumn=$cCA[($h+4)];
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn.'7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
		}

		$ii = 8;
		$row_total = count($datas)+8;
		for( $i = 0 ; $i < count($datas) ; $i++ )
		{

			/*
			| BEGIN SET OPTION
			*/
			if($datas[$i]['item_type']=="0") // TITLE
			{
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				if($datas[$i]['posisi']=='0'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
				}else if($datas[$i]['posisi']=='1'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
			}
			else if($datas[$i]['item_type']=="1") // SUMMARY
			{
				if($datas[$i]['posisi']=='0'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}else{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
				}
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
			}
			else if($datas[$i]['item_type']=="2") // FORMULA
			{
				if($datas[$i]['formula_text_bold']==0){
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}else if($datas[$i]['formula_text_bold']==1){
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
				}
			}
			else if($datas[$i]['item_type']=="3") // TOTAL
			{
				if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
				}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
			}

	        $item_name = $datas[$i]['item_name'];
	        $item_name = str_replace('&nbsp;',' ',$item_name);
	        $item_name = str_replace('<b>','',$item_name);
	        $item_name = str_replace('</b>','',$item_name);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(10);
	        if($datas[$i]['item_type']=='0'){ // title
	        	$saldo='';
	        	if($datas[$i]['posisi']=='0'){
	        		$item_name = trim($item_name);
	        	}
	        }else if($datas[$i]['item_type']=='3'){ // total
	        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
	        	if($datas[$i]['posisi']=='0'){
	        		$item_name = trim($item_name);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(11);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setBold(true);
	        	}
	        }else{
	        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
	        }
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
			/*
			| END SET OPTION
			*/

	        // CELL VALUE
			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
			if(count($branch_child_data)==0){
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
			}

			if($saldo!='')
			{
				for($j=0;$j<count($branch_child_data);$j++)
				{
					$saldo_per_item = $this->model_laporan_to_pdf->get_saldo_report_by_item_code('10',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$periode_bulan,$periode_tahun,$periode_hari);
					
					$branchColumn=$cCA[($j+4)];
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(10);
					$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldo_per_item,2,',','.').' ');
					$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

	        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setBold(true);
					}
					
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
				}	
			}
			else
			{
				for($j=0;$j<count($branch_child_data);$j++)
				{
					$branchColumn=$cCA[($j+4)];
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
				}
			}
			$ii++;
		
		}//END FOR*/
		$ii++;
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN-NERACA.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	public function neraca_saldo_gl()
	{
		$periode1 = $this->datepicker_convert(true,$this->uri->segment(3),'/');
        $periode2 = $this->datepicker_convert(true,$this->uri->segment(4),'/');
        $branch_code = $this->uri->segment(5);
        $branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_name = $branch['branch_name'];
        $datas = $this->model_laporan->get_neraca_saldo_gl2($branch_code,$periode1,$periode2);
        $total_debit = 0;
        $total_credit = 0;
		$ii=0;
		$group_name='';
        for ( $i = 0 ; $i < count($datas) ; $i++ )
        {
            $group = $this->model_laporan->get_account_group_by_code($datas[$i]['account_group_code']);
			if(count($group)>0){
				if($group_name!=$group['group_name']){
					$group_name=$group['group_name'];
					$data['data'][$ii]['nomor'] = '';
					$data['data'][$ii]['saldo_awal'] = '';
					$data['data'][$ii]['account'] = $group_name;
					$data['data'][$ii]['debit'] = '';
					$data['data'][$ii]['credit'] = '';
					$data['data'][$ii]['saldo_akhir'] = '';
					$ii++;
				}
			}else{
				$group_name='';
			}

			$data['data'][$ii]['nomor'] = $i+1;
			$data['data'][$ii]['saldo_awal'] = $datas[$i]['saldo_awal'];
			$data['data'][$ii]['account'] = $datas[$i]['account_code'].' - '.$datas[$i]['account_name'];
			$data['data'][$ii]['debit'] = $datas[$i]['debit'];
			$data['data'][$ii]['credit'] = $datas[$i]['credit'];
			$data['data'][$ii]['saldo_akhir'] = $datas[$i]['saldo_awal']+$datas[$i]['debit']-$datas[$i]['credit'];
			
			$total_debit  += $datas[$i]['debit'];
			$total_credit += $datas[$i]['credit'];
			if(count($group)>0){
				$group_name=$group['group_name'];
			}
			$ii++;

        }
        $data['total_debit'] = $total_debit;
        $data['total_credit'] = $total_credit;


    	// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',$branch_name);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
		$objPHPExcel->getActiveSheet()->setCellValue('A3',"NERACA SALDO");
		$objPHPExcel->getActiveSheet()->getStyle('A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('d-m-Y',strtotime($periode1))." s.d ".date('d-m-Y',strtotime($periode2)));

		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(16);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(14);
		$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setSize(14);

		$objPHPExcel->getActiveSheet()->setCellValue('A6','No');
		$objPHPExcel->getActiveSheet()->setCellValue('B6','Account');
		$objPHPExcel->getActiveSheet()->setCellValue('C6','Saldo Awal');
		$objPHPExcel->getActiveSheet()->setCellValue('D6','Debit');
		$objPHPExcel->getActiveSheet()->setCellValue('E6','Credit');
		$objPHPExcel->getActiveSheet()->setCellValue('F6','Saldo Akhir');
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(60);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6:B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6:E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6:F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A6:F6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$ii = 7;
		for( $i = 0 ; $i < count($data['data']) ; $i++ )
		{
			$datax = $data['data'];
			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datax[$i]['nomor']);
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datax[$i]['account']);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,(($datax[$i]['saldo_awal']=='')?'':number_format($datax[$i]['saldo_awal'],2,',','.')));
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,(($datax[$i]['debit']=='')?'':number_format($datax[$i]['debit'],2,',','.')));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,(($datax[$i]['credit']=='')?'':number_format($datax[$i]['credit'],2,',','.')));
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,(($datax[$i]['saldo_akhir']=='')?'':number_format($datax[$i]['saldo_akhir'],2,',','.')));

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
			
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$ii++;
		
		}//END FOR*/
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($data['total_debit'],2,',','.'));
		$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($data['total_credit'],2,',','.'));
		$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="Trial_Balance_'.date('YmdHis').'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	
	public function rekap_mutasi_gl()
	{
		$from_date = $this->uri->segment(3);
        $thru_date = $this->uri->segment(4);
        $branch_code = $this->uri->segment(5);

        $from_date = str_replace('/', '', $from_date);
        $from_date = substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
        $thru_date = str_replace('/', '', $thru_date);
        $thru_date = substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);

        $branch_id = $this->model_cif->get_branch_id_by_branch_code($branch_code);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_name = $branch['branch_name'];
        $datas = $this->model_laporan->get_rekap_mutasi_gl($branch_code,$from_date,$thru_date);
        $total_debit = 0;
        $total_credit = 0;
		$ii=0;
		$group_name='';
		$data['data'][$ii]['nomor'] = '';			
		$data['data'][$ii]['account'] = '';
		$data['data'][$ii]['debit'] = 0;
		$data['data'][$ii]['credit'] = 0;
        for ( $i = 0 ; $i < count($datas) ; $i++ )
        {
			$data['data'][$ii]['nomor'] = $i+1;
			$data['data'][$ii]['account'] = $datas[$i]['account_code'].' - '.$datas[$i]['account_name'];
			$data['data'][$ii]['debit'] = $datas[$i]['debit'];
			$data['data'][$ii]['credit'] = $datas[$i]['credit'];
			
			$total_debit  += $datas[$i]['debit'];
			$total_credit += $datas[$i]['credit'];
			
			$ii++;

        }
        $data['total_debit'] = $total_debit;
        $data['total_credit'] = $total_credit;


    	// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:F1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('A2:F2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',$branch_name);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('A3:F3');
		$objPHPExcel->getActiveSheet()->setCellValue('A3',"REKAP MUTASI GL ");
		$objPHPExcel->getActiveSheet()->getStyle('A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('A4:F4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".$from_date." - ".$thru_date);

		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(16);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(14);
		$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setSize(14);

		$objPHPExcel->getActiveSheet()->setCellValue('A6','No');
		$objPHPExcel->getActiveSheet()->setCellValue('B6','Account');
		$objPHPExcel->getActiveSheet()->setCellValue('C6','Debit');
		$objPHPExcel->getActiveSheet()->setCellValue('D6','Credit');
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(5);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(60);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A6:A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6:B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6:C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6:D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A6:D6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$ii = 7;
		for( $i = 0 ; $i < count($data['data']) ; $i++ )
		{
			$datax = $data['data'];
			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$datax[$i]['nomor']);
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datax[$i]['account']);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,(($datax[$i]['debit']=='')?'':number_format($datax[$i]['debit'],2,',','.')));
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,(($datax[$i]['credit']=='')?'':number_format($datax[$i]['credit'],2,',','.')));

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$ii++;
		
		}//END FOR*/
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,number_format($data['total_debit'],2,',','.'));
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,number_format($data['total_credit'],2,',','.'));
		$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="Rekap_Mutasi_GL_'.date('YmdHis').'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	/*
	| EXPORT LABA RUGI GL
	| by sayyid
	*/
	public function export_lap_lr2()
	{
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        // $from_date=$this->get_from_trx_date();
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;

        if ($cabang==""){            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        }else if ($periode_bulan=="" && $periode_tahun=="") {
            echo "<script>alert('Periode Belum Dipilih !');javascript:window.close();</script>";
        }else{

            $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_class = $branch['branch_class'];

            switch ($branch_class) {
				case '0':
				  $branch_class_name = "Kepala Pusat";
				  break;
				case '1':
				  $branch_class_name = "Kepala Wilayah";
				  break;
				case '2':
				  $branch_class_name = "Kepala Cabang";
				  break;
				case '3':
				  $branch_class_name = "Kepala Capem";
				  break;
				default:
				  $branch_class_name = "-";
				  break;
			}

            
			$datas = $this->model_laporan_to_pdf->export_lap_laba_rugi($cabang,$from_date,$last_date);
            if ($cabang !='00000'){
                $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
                if($branch_class=="1"){
                    $branch_name .= "";
                }
            }else{
                $branch_name = "PUSAT";
            }

			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN LABA RUGI");
			// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

			// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

			$cCA = createColumnsArray('XFD');

			if($branch_class=='0'){
				$branch_class_output='1';
			}else if($branch_class=='1'){
				$branch_class_output='2';
			}else if($branch_class=='2'){
				$branch_class_output='3';
			}else{
				$branch_class_output='';
			}
			$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

			$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
			$objPHPExcel->getActiveSheet()->mergeCells('D7:F7');
			$objPHPExcel->getActiveSheet()->getStyle('D7:F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
			
			$objPHPExcel->getActiveSheet()->setCellValue('D8','sd Bulan Lalu');
			$objPHPExcel->getActiveSheet()->setCellValue('E8','Bulan Ini');
			$objPHPExcel->getActiveSheet()->setCellValue('F8','Akumulasi');
			$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setSize(12);

			for($h=0;$h<count($branch_child_data);$h++)
			{
				$branchColumn_idx=$h+6;
				$branchColumn_idx2=$h+7;
				$branchColumn_idx3=$h+8;
				$branchColumn=$cCA[$branchColumn_idx];
				$branchColumn2=$cCA[$branchColumn_idx2];
				$branchColumn3=$cCA[$branchColumn_idx3];
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn3.'7')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
				$objPHPExcel->getActiveSheet()->mergeCells($branchColumn.'7:'.$branchColumn3.'7');
			
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'8','sd Bulan Lalu');
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.'8','Bulan Ini');
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.'8','Akumulasi');
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setSize(12);
			}

			$ii = 9;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				/*
				| BEGIN SET OPTION
				*/
				if($datas[$i]['item_type']=="0") // TITLE
				{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else if($datas[$i]['posisi']=='1'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
				}
				else if($datas[$i]['item_type']=="1") // SUMMARY
				{
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				else if($datas[$i]['item_type']=="2") // FORMULA
				{
					if($datas[$i]['formula_text_bold']==0){
						if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
						}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}else if($datas[$i]['formula_text_bold']==1){
						if($datas[$i]['posisi']=='0'){
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
						}else{
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
					}
				}
				else if($datas[$i]['item_type']=="3") // TOTAL
				{
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}

		        $item_name = $datas[$i]['item_name'];
		        $item_name = str_replace('&nbsp;',' ',$item_name);
		        $item_name = str_replace('<b>','',$item_name);
		        $item_name = str_replace('</b>','',$item_name);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(10);
		        if($datas[$i]['item_type']=='0'){ // title
		        	$saldo='';
		        	$saldo_mutasi='';
		        	$total_saldo='';
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
		        	}
		        }else if($datas[$i]['item_type']=='3'){ // total
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
		        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],0,',','.');
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setBold(true);
		        	}
		        }else{
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
		        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],2,',','.');
		        }
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
				/*
				| END SET OPTION
				*/

		        // CELL VALUE
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$saldo_mutasi.' ');
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$total_saldo.' ');
				if(count($branch_child_data)==0){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
				}

				if($saldo!='')
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$saldoarr = $this->model_laporan_to_pdf->get_saldo_report_by_item_code2('20',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$from_date,$last_date);
						$total_saldo=$saldoarr['saldo']+$saldoarr['saldo_mutasi'];

						$branchColumn_idx=$j+6;
						$branchColumn_idx2=$j+7;
						$branchColumn_idx3=$j+8;
						$branchColumn=$cCA[$branchColumn_idx];
						$branchColumn2=$cCA[$branchColumn_idx2];
						$branchColumn3=$cCA[$branchColumn_idx3];
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(10);
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldoarr['saldo'],2,',','.').' ');
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.$ii,number_format($saldoarr['saldo_mutasi'],2,',','.').' ');
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.$ii,number_format($total_saldo,2,',','.').' ');
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn2)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn3)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.$ii.':'.$branchColumn2.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(11);
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setBold(true);
						}
						
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
					}	
				}
				else
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$branchColumn_idx3=$j+8;
						$branchColumn3=$cCA[$branchColumn_idx3];
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
					}
				}
				$ii++;
			
			}//END FOR*/
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-LABA-RUGI.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}

	function export_keuangan_labarugi_bulanan(){
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        $report_code = $this->uri->segment(7);
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;

        $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
			case '0':
			  $branch_class_name = "Kepala Pusat";
			  break;
			case '1':
			  $branch_class_name = "Kepala Wilayah";
			  break;
			case '2':
			  $branch_class_name = "Kepala Cabang";
			  break;
			case '3':
			  $branch_class_name = "Kepala Capem";
			  break;
			default:
			  $branch_class_name = "-";
			  break;
		}

        if ($cabang !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
            if($branch_class=="1"){
                $branch_name .= "";
            }
        }else{
            $branch_name = "PUSAT";
        }
        
		$datas = $this->model_laporan_to_pdf->export_keuangan_labarugi_bulanan($cabang,$last_date,$report_code);

        if($report_code == '20'){
            $jenis = 'Laba Rugi';
            $judul = 'LAPORAN LABA RUGI';
        } else {
            $jenis = 'Laba Rugi Rinci';
            $judul = 'LAPORAN LABA RUGI RINCI';
        }

		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('A2',$judul);
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

		$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
		$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

		$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

		$cCA = createColumnsArray('XFD');

		if($branch_class=='0'){
			$branch_class_output='1';
		}else if($branch_class=='1'){
			$branch_class_output='2';
		}else if($branch_class=='2'){
			$branch_class_output='3';
		}else{
			$branch_class_output='';
		}
		$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

		$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
		$objPHPExcel->getActiveSheet()->mergeCells('D7:F7');
		$objPHPExcel->getActiveSheet()->getStyle('D7:F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
		
		$objPHPExcel->getActiveSheet()->setCellValue('D8','sd Bulan Lalu');
		$objPHPExcel->getActiveSheet()->setCellValue('E8','Bulan Ini');
		$objPHPExcel->getActiveSheet()->setCellValue('F8','Akumulasi');
		$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setSize(12);

		for($h=0;$h<count($branch_child_data);$h++)
		{
			$branchColumn_idx=$h+6;
			$branchColumn_idx2=$h+7;
			$branchColumn_idx3=$h+8;
			$branchColumn=$cCA[$branchColumn_idx];
			$branchColumn2=$cCA[$branchColumn_idx2];
			$branchColumn3=$cCA[$branchColumn_idx3];
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn3.'7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->mergeCells($branchColumn.'7:'.$branchColumn3.'7');
		
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'8','sd Bulan Lalu');
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.'8','Bulan Ini');
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.'8','Akumulasi');
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setSize(12);
		}

		$ii = 9;
		$row_total = count($datas)+8;
		for( $i = 0 ; $i < count($datas) ; $i++ )
		{

			/*
			| BEGIN SET OPTION
			*/
			if($datas[$i]['item_type']=="0") // TITLE
			{
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				if($datas[$i]['posisi']=='0'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
				}else if($datas[$i]['posisi']=='1'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
			}
			else if($datas[$i]['item_type']=="1") // SUMMARY
			{
				if($datas[$i]['posisi']=='0'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}else{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
				}
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
			}
			else if($datas[$i]['item_type']=="2") // FORMULA
			{
				if($datas[$i]['formula_text_bold']==0){
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}else if($datas[$i]['formula_text_bold']==1){
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
				}
			}
			else if($datas[$i]['item_type']=="3") // TOTAL
			{
				if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
				}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
			}

	        $item_name = $datas[$i]['item_name'];
	        $item_name = str_replace('&nbsp;',' ',$item_name);
	        $item_name = str_replace('<b>','',$item_name);
	        $item_name = str_replace('</b>','',$item_name);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(10);
	        if($datas[$i]['item_type']=='0'){ // title
	        	$saldo='';
	        	$saldo_mutasi='';
	        	$total_saldo='';
	        	if($datas[$i]['posisi']=='0'){
	        		$item_name = trim($item_name);
	        	}
	        }else if($datas[$i]['item_type']=='3'){ // total
	        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
	        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
	        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],0,',','.');
	        	if($datas[$i]['posisi']=='0'){
	        		$item_name = trim($item_name);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(11);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setBold(true);
	        	}
	        }else{
	        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
	        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
	        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],2,',','.');
	        }
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(24);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(24);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
			/*
			| END SET OPTION
			*/

	        // CELL VALUE
			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$saldo_mutasi.' ');
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$total_saldo.' ');
			if(count($branch_child_data)==0){
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
			}

			if($saldo!='')
			{
				for($j=0;$j<count($branch_child_data);$j++)
				{
					$saldoarr = $this->model_laporan_to_pdf->get_saldo_report_by_item_code2_bulanan($report_code,$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$from_date,$last_date);
					$total_saldo=$saldoarr['saldo']+$saldoarr['saldo_mutasi'];

					$branchColumn_idx=$j+6;
					$branchColumn_idx2=$j+7;
					$branchColumn_idx3=$j+8;
					$branchColumn=$cCA[$branchColumn_idx];
					$branchColumn2=$cCA[$branchColumn_idx2];
					$branchColumn3=$cCA[$branchColumn_idx3];
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(10);
					$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldoarr['saldo'],2,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.$ii,number_format($saldoarr['saldo_mutasi'],2,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.$ii,number_format($total_saldo,2,',','.').' ');
					$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
					$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn2)->setWidth(24);
					$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn3)->setWidth(24);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.$ii.':'.$branchColumn2.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

	        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setBold(true);
					}
					
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
				}	
			}
			else
			{
				for($j=0;$j<count($branch_child_data);$j++)
				{
					$branchColumn_idx3=$j+8;
					$branchColumn3=$cCA[$branchColumn_idx3];
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
				}
			}
			$ii++;
		
		}//END FOR*/
		$ii++;
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="'.$judul.' '.$branch_name.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	function export_keuangan_trial_balance(){
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        $report_code = $this->uri->segment(7);
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;

        $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = $branch['branch_class'];

        switch ($branch_class) {
			case '0':
			  $branch_class_name = "Kepala Pusat";
			  break;
			case '1':
			  $branch_class_name = "Kepala Wilayah";
			  break;
			case '2':
			  $branch_class_name = "Kepala Cabang";
			  break;
			case '3':
			  $branch_class_name = "Kepala Capem";
			  break;
			default:
			  $branch_class_name = "-";
			  break;
		}

        
        $datas = $this->model_laporan_to_pdf->export_keuangan_trial_balance($cabang,$from_date,$last_date);
        if ($cabang !='00000'){
            $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
            if($branch_class=="1"){
                $branch_name .= "";
            }
        }else{
            $branch_name = "PUSAT";
        }

        if($report_code == '30'){
            $jenis = 'Trial Balance';
            $judul = 'LAPORAN TRIAL BALANCE';
        } //else {
           // $jenis = 'Laba Rugi Rinci';
            //$judul = 'LAPORAN LABA RUGI RINCI';
        //}

		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('A2',$judul);
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('B4',":  ".$this->format_date_detail($last_date,'id',false,'-'));

		$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
		$objPHPExcel->getActiveSheet()->setCellValue('B5',":  ".$branch_name);

		$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(51);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

		$cCA = createColumnsArray('XFD');

		if($branch_class=='0'){
			$branch_class_output='1';
		}else if($branch_class=='1'){
			$branch_class_output='2';
		}else if($branch_class=='2'){
			$branch_class_output='3';
		}else{
			$branch_class_output='';
		}
		$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

		$objPHPExcel->getActiveSheet()->setCellValue('A7', 'Acc. Code');
		$objPHPExcel->getActiveSheet()->setCellValue('B7', 'Acc. Name');
		$objPHPExcel->getActiveSheet()->setCellValue('C7', 'Saldo Awal');
		$objPHPExcel->getActiveSheet()->setCellValue('D7', 'Debet');
		$objPHPExcel->getActiveSheet()->setCellValue('E7', 'Credit');
		$objPHPExcel->getActiveSheet()->setCellValue('F7', 'Saldo');
		$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->getFont()->setBold(true);

		$n = 8;
    	for($i = 0; $i < count($datas); $i++)
    	{
    		$objPHPExcel->getActiveSheet()->setCellValue('A'.$n, $datas[$i]['account_code']);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('B'.$n, $datas[$i]['account_name']);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('C'.$n, $datas[$i]['saldo_awal']);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('D'.$n, $datas[$i]['total_mutasi_debet']);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('E'.$n, $datas[$i]['total_mutasi_credit']);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('F'.$n, $datas[$i]['saldo']);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$n)->applyFromArray($styleArray);

    		$n++;
    	}

    	$n++;
    	$n++;

		$objPHPExcel->getActiveSheet()->setCellValue('B'.$n,'Mengetahui');
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$branch_name.', '.date('d-m-Y'));

    	$n++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,'dibuat');

    	$n++;
    	$n++;
    	$n++;
    	$n++;
    	$n++;
		$objPHPExcel->getActiveSheet()->setCellValue('B'.$n,$branch_class_name);
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$this->session->userdata('fullname'));

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="'.$judul.' '.$branch_name.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}
	
	function export_lr_temp2(){
        $cabang = $this->uri->segment(3);
        $tanggal = $this->uri->segment(4);
        $tanggal = $this->datepicker_convert(true,$tanggal,'/');
        $report_code = $this->uri->segment(5);
        $user_id = $this->session->userdata('user_id');

		$branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
		$branch = $this->model_cif->get_branch_by_branch_id($branch_id);
		$branch_class = $branch['branch_class'];

		switch($branch_class){
			case '0' :
				$branch_class_name = "Kepala Pusat";
				break;
			case '1' :
				$branch_class_name = "Kepala Wilayah";
				break;
			case '2' :
				$branch_class_name = "Kepala Cabang";
				break;
			case '3' :
				$branch_class_name = "Kepala Capem";
				break;
			default :
				$branch_class_name = "-";
				break;
		}

        $startGetClosing = substr($tanggal,0,7).'-01';
        $startClosing = date('Y-m-d',strtotime($startGetClosing . ' - 1 MONTH'));
        $getClosing = $this->model_laporan_to_pdf->getClosing($cabang);

        $fromlm = $startClosing;
        $from = $startGetClosing;
        $thru = $tanggal;

		//$insert_temp = $this->model_laporan_to_pdf->insert_temp($cabang,$fromlm,$from,$thru,$user_id);

		//$datas = $this->model_laporan_to_pdf->export_lr_temp($cabang,$report_code);

		if($cabang != '00000'){
			$branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
			if($branch_class == '1'){
				$branch_name .= '';
			}
		} else {
			$branch_name = 'PUSAT';
		}

		// ----------------------------------------------------------
		// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0);

		$styleArray = array(
			'borders' => array(
					 'outline' => array(
							'style' => PHPExcel_Style_Border::BORDER_THIN,
							'color' => array('rgb' => '000000'),
					 ),
			   ),
		);

		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN LABA RUGI");
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($from,'id',false,'-'));
		$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
		$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

		$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

		$cCA = createColumnsArray('XFD');

		if($branch_class == '0'){
			$branch_class_output = '1';
		} else if($branch_class == '1'){
			$branch_class_output = '2';
		} else if($branch_class == '2'){
			$branch_class_output = '3';
		} else {
			$branch_class_output = '';
		}

		$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

		$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
		$objPHPExcel->getActiveSheet()->mergeCells('D7:F7');
		$objPHPExcel->getActiveSheet()->getStyle('D7:F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);

		$objPHPExcel->getActiveSheet()->setCellValue('D8','sd Bulan Lalu');
		$objPHPExcel->getActiveSheet()->setCellValue('E8','Bulan Ini');
		$objPHPExcel->getActiveSheet()->setCellValue('F8','Akumulasi');

		$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getStyle('D8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setBold(true);

		$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setSize(12);

		$hitung_kolom = count($branch_child_data) * 3;
		
		for($h = 0; $h < $hitung_kolom; $h++){
			$branchColumn_idx = $h + 6;
			$branchColumn_idx2 = $h + 7;
			$branchColumn_idx3 = $h + 8;
			
			$c = $h / 3;

			if($h == 0){
				$first = $c;
				$second = $c + 1;
				$third = $c + 2;
			}
			
			$branchColumn = $cCA[$branchColumn_idx];
			$branchColumn2 = $cCA[$branchColumn_idx2];
			$branchColumn3 = $cCA[$branchColumn_idx3];
			
			$kolom_bulan_lalu = $cCA[$first];
			$kolom_bulan_ini = $cCA[$second];
			$akumulasi = $cCA[$third];

			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn3.'7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->mergeCells($branchColumn.'7:'.$branchColumn3.'7');
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$c]['branch_name']);

			$objPHPExcel->getActiveSheet()->setCellValue($kolom_bulan_lalu.'8','sd Bulan Lalu');
			$objPHPExcel->getActiveSheet()->setCellValue($kolom_bulan_ini.'8','sd Bulan Ini');
			$objPHPExcel->getActiveSheet()->setCellValue($akumulasi.'8','Akumulasi');

			/*
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setSize(12);
			*/

		}

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN-LABA-RUGI.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');
	}

	function export_lr_temp(){
        $cabang = $this->uri->segment(3);
        $tanggal = $this->uri->segment(4);
        $tanggal = $this->datepicker_convert(true,$tanggal,'/');
        $report_code = $this->uri->segment(5);
        $user_id = $this->session->userdata('user_id');

		$branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
		$branch = $this->model_cif->get_branch_by_branch_id($branch_id);
		$branch_class = $branch['branch_class'];

		switch ($branch_class) {
			case '0':
			  $branch_class_name = "Kepala Pusat";
			  break;
			case '1':
			  $branch_class_name = "Kepala Wilayah";
			  break;
			case '2':
			  $branch_class_name = "Kepala Cabang";
			  break;
			case '3':
			  $branch_class_name = "Kepala Capem";
			  break;
			default:
			  $branch_class_name = "-";
			  break;
		}

        $startGetClosing = substr($tanggal,0,7).'-01';
        $startClosing = date('Y-m-d',strtotime($startGetClosing . ' - 1 MONTH'));
        $getClosing = $this->model_laporan_to_pdf->getClosing($cabang);

        $fromlm = $startClosing;
        $from = $startGetClosing;
        $thru = $tanggal;

		$insert_temp = $this->model_laporan_to_pdf->insert_temp($cabang,$fromlm,$from,$thru,$user_id);

		$datas = $this->model_laporan_to_pdf->export_lr_temp($cabang,$report_code);
		if ($cabang !='00000'){
			$branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
			if($branch_class=="1"){
				$branch_name .= "";
			}
		}else{
			$branch_name = "PUSAT";
		}

		// ----------------------------------------------------------
		// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
			'borders' => array(
					 'outline' => array(
							'style' => PHPExcel_Style_Border::BORDER_THIN,
							'color' => array('rgb' => '000000'),
					 ),
			   ),
		);

		// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
		// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN LABA RUGI");
		// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
		$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
		$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($from,'id',false,'-'));

		// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
		$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
		$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
		$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

		$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

		$cCA = createColumnsArray('XFD');

		if($branch_class=='0'){
			$branch_class_output='1';
		}else if($branch_class=='1'){
			$branch_class_output='2';
		}else if($branch_class=='2'){
			$branch_class_output='3';
		}else{
			$branch_class_output='';
		}
		$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

		$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
		$objPHPExcel->getActiveSheet()->mergeCells('D7:F7');
		$objPHPExcel->getActiveSheet()->getStyle('D7:F7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
		
		$objPHPExcel->getActiveSheet()->setCellValue('D8','sd Bulan Lalu');
		$objPHPExcel->getActiveSheet()->setCellValue('E8','Bulan Ini');
		$objPHPExcel->getActiveSheet()->setCellValue('F8','Akumulasi');
		$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setSize(12);

		$hitung_kolom = count($branch_child_data);

		for($h=0;$h<$hitung_kolom;$h++)
		{
			$branchColumn_idx=$h+6;
			$branchColumn_idx2=$h+7;
			$branchColumn_idx3=$h+8;
			$branchColumn=$cCA[$branchColumn_idx];
			$branchColumn2=$cCA[$branchColumn_idx2];
			$branchColumn3=$cCA[$branchColumn_idx3];
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn3.'7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->mergeCells($branchColumn.'7:'.$branchColumn3.'7');

			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'8','sd Bulan Lalu');
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.'8','Bulan Ini');
			$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.'8','Akumulasi');
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setSize(12);
		}

		$ii = 9;
		$row_total = count($datas)+8;
		for( $i = 0 ; $i < count($datas) ; $i++ )
		{

			/*
			| BEGIN SET OPTION
			*/
			if($datas[$i]['item_type']=="0") // TITLE
			{
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				if($datas[$i]['posisi']=='0'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
				}else if($datas[$i]['posisi']=='1'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
			}
			else if($datas[$i]['item_type']=="1") // SUMMARY
			{
				if($datas[$i]['posisi']=='0'){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}else{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
				}
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
			}
			else if($datas[$i]['item_type']=="2") // FORMULA
			{
				if($datas[$i]['formula_text_bold']==0){
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}else if($datas[$i]['formula_text_bold']==1){
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
				}
			}
			else if($datas[$i]['item_type']=="3") // TOTAL
			{
				if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
				}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
			}

			$item_name = $datas[$i]['item_name'];
			$item_name = str_replace('&nbsp;',' ',$item_name);
			$item_name = str_replace('<b>','',$item_name);
			$item_name = str_replace('</b>','',$item_name);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(10);
			if($datas[$i]['item_type']=='0'){ // title
				$saldo='';
				$saldo_mutasi='';
				$total_saldo='';
				if($datas[$i]['posisi']=='0'){
					$item_name = trim($item_name);
				}
			}else if($datas[$i]['item_type']=='3'){ // total
				$saldo=number_format($datas[$i]['saldo'],2,',','.');
				$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
				$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],0,',','.');
				if($datas[$i]['posisi']=='0'){
					$item_name = trim($item_name);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(11);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setBold(true);
				}
			}else{
				$saldo=number_format($datas[$i]['saldo'],2,',','.');
				$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
				$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],2,',','.');
			}
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(24);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(24);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
			/*
			| END SET OPTION
			*/

			// CELL VALUE
			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$saldo_mutasi.' ');
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$total_saldo.' ');
			if(count($branch_child_data)==0){
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
			}

			if($saldo!='')
			{
				for($j=0;$j<count($branch_child_data);$j++)
				{
					$saldoarr = $this->model_laporan_to_pdf->get_saldo_report_by_item_code2('20',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$from,$thru);
					$total_saldo=$saldoarr['saldo']+$saldoarr['saldo_mutasi'];

					$branchColumn_idx=$j+6;
					$branchColumn_idx2=$j+7;
					$branchColumn_idx3=$j+8;
					$branchColumn=$cCA[$branchColumn_idx];
					$branchColumn2=$cCA[$branchColumn_idx2];
					$branchColumn3=$cCA[$branchColumn_idx3];
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(10);
					$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldoarr['saldo'],2,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.$ii,number_format($saldoarr['saldo_mutasi'],2,',','.').' ');
					$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.$ii,number_format($total_saldo,2,',','.').' ');
					$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
					$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn2)->setWidth(24);
					$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn3)->setWidth(24);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.$ii.':'.$branchColumn2.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

					if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setBold(true);
					}
					
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
				}	
			}
			else
			{
				for($j=0;$j<count($branch_child_data);$j++)
				{
					$branchColumn_idx3=$j+8;
					$branchColumn3=$cCA[$branchColumn_idx3];
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
				}
			}
			$ii++;
		
		}//END FOR*/
		$ii++;
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$ii++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN-LABA-RUGI.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	// EXPORT TRIAL BALANCE TEMP //
	// --------------------------------- //

	function export_trial_balance_temp()
	{
        $cabang = $this->uri->segment(3);
        $from = $this->uri->segment(4);
        $from = $this->datepicker_convert(true,$from,'/');
        $report_code = $this->uri->segment(5);

        $start = substr($from,0,7).'-01';
        $fromlm = date('Y-m-d',strtotime($start .'- 1 MONTH'));

        if ($cabang==""){            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        }else{

            $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_class = $branch['branch_class'];

            switch ($branch_class) {
				case '0':
				  $branch_class_name = "Kepala Pusat";
				  break;
				case '1':
				  $branch_class_name = "Kepala Wilayah";
				  break;
				case '2':
				  $branch_class_name = "Kepala Cabang";
				  break;
				case '3':
				  $branch_class_name = "Kepala Capem";
				  break;
				default:
				  $branch_class_name = "-";
				  break;
			}

	        $start = substr($from,0,7).'-01';

        	$datas = $this->model_laporan_to_pdf->export_trial_balance_temp($cabang, $fromlm, $start, $from, $report_code);
            if ($cabang !='00000'){
                $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
                if($branch_class=="1"){
                    $branch_name .= "";
                }
            }else{
                $branch_name = "PUSAT";
            }

	        if($report_code == '30'){
	            $jenis = 'Trial Balance';
	            $judul = 'LAPORAN TRIAL BALANCE';
	        }

			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);
			$date = $this->format_date_detail($from,'id',false,'-');

			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->setCellValue('A2', $judul);
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":  ".$date."");

			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":  ".$branch_name."");

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(11);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(51);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);

			$cCA = createColumnsArray('XFD');

			if($branch_class=='0'){
				$branch_class_output='1';
			}else if($branch_class=='1'){
				$branch_class_output='2';
			}else if($branch_class=='2'){
				$branch_class_output='3';
			}else{
				$branch_class_output='';
			}
			$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

			$objPHPExcel->getActiveSheet()->setCellValue('A7', 'Acc. Code');
			$objPHPExcel->getActiveSheet()->setCellValue('B7', 'Acc. Name');
			$objPHPExcel->getActiveSheet()->setCellValue('C7', 'Saldo Awal');
			$objPHPExcel->getActiveSheet()->setCellValue('D7', 'Debet');
			$objPHPExcel->getActiveSheet()->setCellValue('E7', 'Credit');
			$objPHPExcel->getActiveSheet()->setCellValue('F7', 'Saldo');
			$objPHPExcel->getActiveSheet()->getStyle('A7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('B7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('C7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('E7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('B7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('C7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('E7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('F7')->getFont()->setBold(true);

		$n = 8;
    	for($i = 0; $i < count($datas); $i++)
    	{

    		$saldo_awal = number_format($datas[$i]['saldo_awal']);
    		$total_mutasi_debet = number_format($datas[$i]['total_mutasi_debet']);
    		$total_mutasi_credit = number_format($datas[$i]['total_mutasi_credit']);
    		$saldo = number_format($datas[$i]['saldo_awal'] + $datas[$i]['total_mutasi_debet'] - $datas[$i]['total_mutasi_credit']);

    		$objPHPExcel->getActiveSheet()->setCellValue('A'.$n, $datas[$i]['account_code']);
			$objPHPExcel->getActiveSheet()->getStyle('A'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('B'.$n, $datas[$i]['account_name']);
			$objPHPExcel->getActiveSheet()->getStyle('B'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('C'.$n, $saldo_awal);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('D'.$n, $total_mutasi_debet);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('E'.$n, $total_mutasi_credit);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$n)->applyFromArray($styleArray);
    		$objPHPExcel->getActiveSheet()->setCellValue('F'.$n, $saldo);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$n)->applyFromArray($styleArray);

    		$n++;
    	}

    	$n++;
    	$n++;

		$objPHPExcel->getActiveSheet()->setCellValue('B'.$n,'Mengetahui');
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$branch_name.', '.date('d-m-Y'));

    	$n++;
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,'dibuat');

    	$n++;
    	$n++;
    	$n++;
    	$n++;
    	$n++;
		$objPHPExcel->getActiveSheet()->setCellValue('B'.$n,$branch_class_name);
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$n,$this->session->userdata('fullname'));


			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="'.$judul.' '.$branch_name.'.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}

	// FINISH //

	public function export_lap_lr_rinci()
	{
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        // $from_date=$this->get_from_trx_date();
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;

        if ($cabang==""){            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        }else if ($periode_bulan=="" && $periode_tahun=="") {
            echo "<script>alert('Periode Belum Dipilih !');javascript:window.close();</script>";
        }else{

            $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_class = $branch['branch_class'];

            switch ($branch_class) {
				case '0':
				  $branch_class_name = "Kepala Pusat";
				  break;
				case '1':
				  $branch_class_name = "Kepala Wilayah";
				  break;
				case '2':
				  $branch_class_name = "Kepala Cabang";
				  break;
				case '3':
				  $branch_class_name = "Kepala Capem";
				  break;
				default:
				  $branch_class_name = "-";
				  break;
			}

            
			$datas = $this->model_laporan_to_pdf->export_lap_laba_rugi_rinci($cabang,$from_date,$last_date);
            if ($cabang !='00000'){
                $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
                if($branch_class=="1"){
                    $branch_name .= "";
                }
            }else{
                $branch_name = "PUSAT";
            }

			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN LABA RUGI RINCI");
			// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

			// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

			$cCA = createColumnsArray('XFD');

			if($branch_class=='0'){
				$branch_class_output='1';
			}else if($branch_class=='1'){
				$branch_class_output='2';
			}else if($branch_class=='2'){
				$branch_class_output='3';
			}else{
				$branch_class_output='';
			}
			$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

			$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
			$objPHPExcel->getActiveSheet()->mergeCells('D7:F7');
			$objPHPExcel->getActiveSheet()->getStyle('D7:F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
			
			$objPHPExcel->getActiveSheet()->setCellValue('D8','sd Bulan Lalu');
			$objPHPExcel->getActiveSheet()->setCellValue('E8','Bulan Ini');
			$objPHPExcel->getActiveSheet()->setCellValue('F8','Akumulasi');
			$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setSize(12);

			for($h=0;$h<count($branch_child_data);$h++)
			{
				$branchColumn_idx=$h+6;
				$branchColumn_idx2=$h+7;
				$branchColumn_idx3=$h+8;
				$branchColumn=$cCA[$branchColumn_idx];
				$branchColumn2=$cCA[$branchColumn_idx2];
				$branchColumn3=$cCA[$branchColumn_idx3];
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn3.'7')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
				$objPHPExcel->getActiveSheet()->mergeCells($branchColumn.'7:'.$branchColumn3.'7');
			
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'8','sd Bulan Lalu');
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.'8','Bulan Ini');
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.'8','Akumulasi');
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setSize(12);
			}

			$ii = 9;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				/*
				| BEGIN SET OPTION
				*/
				if($datas[$i]['item_type']=="0") // TITLE
				{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else if($datas[$i]['posisi']=='1'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
				}
				else if($datas[$i]['item_type']=="1") // SUMMARY
				{
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				else if($datas[$i]['item_type']=="2") // FORMULA
				{
					if($datas[$i]['formula_text_bold']==0){
						if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
						}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}else if($datas[$i]['formula_text_bold']==1){
						if($datas[$i]['posisi']=='0'){
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
						}else{
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
					}
				}
				else if($datas[$i]['item_type']=="3") // TOTAL
				{
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}

		        $item_name = $datas[$i]['item_name'];
		        $item_name = str_replace('&nbsp;',' ',$item_name);
		        $item_name = str_replace('<b>','',$item_name);
		        $item_name = str_replace('</b>','',$item_name);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(10);
		        if($datas[$i]['item_type']=='0'){ // title
		        	$saldo='';
		        	$saldo_mutasi='';
		        	$total_saldo='';
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
		        	}
		        }else if($datas[$i]['item_type']=='3'){ // total
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
		        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],0,',','.');
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setBold(true);
		        	}
		        }else{
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
		        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],2,',','.');
		        }
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
				/*
				| END SET OPTION
				*/

		        // CELL VALUE
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$saldo_mutasi.' ');
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$total_saldo.' ');
				if(count($branch_child_data)==0){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
				}

				if($saldo!='')
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$saldoarr = $this->model_laporan_to_pdf->get_saldo_report_by_item_code2('21',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$from_date,$last_date);
						$total_saldo=$saldoarr['saldo']+$saldoarr['saldo_mutasi'];

						$branchColumn_idx=$j+6;
						$branchColumn_idx2=$j+7;
						$branchColumn_idx3=$j+8;
						$branchColumn=$cCA[$branchColumn_idx];
						$branchColumn2=$cCA[$branchColumn_idx2];
						$branchColumn3=$cCA[$branchColumn_idx3];
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(10);
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldoarr['saldo'],2,',','.').' ');
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.$ii,number_format($saldoarr['saldo_mutasi'],2,',','.').' ');
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.$ii,number_format($total_saldo,2,',','.').' ');
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn2)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn3)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.$ii.':'.$branchColumn2.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(11);
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setBold(true);
						}
						
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
					}	
				}
				else
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$branchColumn_idx3=$j+8;
						$branchColumn3=$cCA[$branchColumn_idx3];
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
					}
				}
				$ii++;
			
			}//END FOR*/
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-LABA-RUGI-RINCI.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}
	public function export_neraca_rinci_gl()
	{
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        // $from_date = $this->get_from_trx_date();
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;
        if ($cabang==""){            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        }else if ($periode_bulan=="" && $periode_tahun=="") {
            echo "<script>alert('Periode Belum Dipilih !');javascript:window.close();</script>";
        }else{

            $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_class = $branch['branch_class'];

            switch ($branch_class) {
				case '0':
				  $branch_class_name = "Kepala Pusat";
				  break;
				case '1':
				  $branch_class_name = "Kepala Wilayah";
				  break;
				case '2':
				  $branch_class_name = "Kepala Cabang";
				  break;
				case '3':
				  $branch_class_name = "Kepala Capem";
				  break;
				default:
				  $branch_class_name = "-";
				  break;
			}

			$datas = $this->model_laporan_to_pdf->export_neraca_rinci_gl2($cabang,$last_date);
            if ($cabang !='00000'){
                $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
            }else{
                $branch_name = "PUSAT";
            }

			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN NERACA RINCI");
			// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

			// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

			$cCA = createColumnsArray('XFD');

			if($branch_class=='0'){
				$branch_class_output='1';
			}else if($branch_class=='1'){
				$branch_class_output='2';
			}else if($branch_class=='2'){
				$branch_class_output='3';
			}else{
				$branch_class_output='';
			}
			$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

			$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
			$objPHPExcel->getActiveSheet()->getStyle('D7:D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
			for($h=0;$h<count($branch_child_data);$h++)
			{
				$branchColumn=$cCA[($h+4)];
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn.'7')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
			}

			$ii = 8;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				/*
				| BEGIN SET OPTION
				*/
				if($datas[$i]['item_type']=="0") // TITLE
				{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else if($datas[$i]['posisi']=='1'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
				}
				else if($datas[$i]['item_type']=="1") // SUMMARY
				{
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				else if($datas[$i]['item_type']=="2") // FORMULA
				{
					if($datas[$i]['formula_text_bold']==0){
						if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
						}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}else if($datas[$i]['formula_text_bold']==1){
						if($datas[$i]['posisi']=='0'){
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
						}else{
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
					}
				}
				else if($datas[$i]['item_type']=="3") // TOTAL
				{
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}

		        $item_name = $datas[$i]['item_name'];
		        $item_name = str_replace('&nbsp;',' ',$item_name);
		        $item_name = str_replace('<b>','',$item_name);
		        $item_name = str_replace('</b>','',$item_name);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(10);
		        if($datas[$i]['item_type']=='0'){ // title
		        	$saldo='';
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
		        	}
		        }else if($datas[$i]['item_type']=='3'){ // total
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setBold(true);
		        	}
		        }else{
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        }
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
				/*
				| END SET OPTION
				*/

		        // CELL VALUE
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
				if(count($branch_child_data)==0){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
				}

				if($saldo!='')
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$saldo_per_item = $this->model_laporan_to_pdf->get_saldo_report_by_item_code('11',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$periode_bulan,$periode_tahun,$periode_hari);
						
						$branchColumn=$cCA[($j+4)];
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(10);
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldo_per_item,2,',','.').' ');
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(11);
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setBold(true);
						}
						
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
					}	
				}
				else
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$branchColumn=$cCA[($j+4)];
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					}
				}
				$ii++;
			
			}//END FOR*/
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-NERACA-RINCI.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}

	function export_list_angsuran_pembiayaan(){
        $from = $this->uri->segment(3);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(4);
        $thru = $this->datepicker_convert(true,$thru,'/');
        $cabang = $this->uri->segment(5);
        $majelis = $this->uri->segment(6);
        $pembiayaan = $this->uri->segment(7);
        $petugas = $this->uri->segment(8);
        $produk = $this->uri->segment(9);

        if($pembiayaan == 1){
            $jenis = 'Individu';
            $jenis2 = strtoupper($jenis);
            $majelis = '00000';
            //$petugas = '00000';
        } else if($pembiayaan == 0) {
            $jenis = 'Kelompok';
            $jenis2 = strtoupper($jenis);
        } else {
            $jenis = 'Semua';
            $jenis2 = strtoupper($jenis);
        }

        if($petugas == '00000'){
            $fa = 'SEMUA PETUGAS';
        } else {
            $getPetugas = $this->model_cif->get_fa_by_fa_code($petugas);
            $fa = $getPetugas['fa_name'];
        }

            $datas = $this->model_laporan_to_pdf->export_list_angsuran_pembiayaan_kelompok($from,$thru,$cabang,$majelis,$petugas,$produk);
        // if($pembiayaan == 0){
        // } else {
        // 	$datas = $this->model_laporan_to_pdf->export_list_angsuran_pembiayaan_individu($from,$thru,$cabang,$majelis,$petugas,$produk);
            
        // }

        if($cabang != '00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }
       
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$sheet = $objPHPExcel->getActiveSheet();

		$sheet->mergeCells('B2:M2');
		$sheet->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));
		$sheet->getStyle('B2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('B3:M3');
		$sheet->setCellValue('B3',$data_cabang);
		$sheet->getStyle('B3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('B4:M4');
		$sheet->setCellValue('B4','LAPORAN ANGSURAN PEMBIAYAAN');
		$sheet->getStyle('B4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$sheet->mergeCells('B5:M5');
		$sheet->setCellValue('B5','TANGGAL : '.$this->format_date_detail($from,'id',false,'-').' s.d '.$this->format_date_detail($thru,'id',false,'-'));
		$sheet->getStyle('B5')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('B6:M6');
		$sheet->setCellValue('B6','PETUGAS : '.$fa);
		$sheet->getStyle('B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		
		$sheet->setCellValue('B8','No');
		$sheet->setCellValue('C8','No Rekening');
		$sheet->setCellValue('D8','Nama');
		$sheet->setCellValue('E8','Tgl Transaksi');
		$sheet->setCellValue('F8','Majelis');
		$sheet->setCellValue('G8','Pokok');
		$sheet->setCellValue('H8','Margin');
		$sheet->setCellValue('I8','Jangka Waktu');
		$sheet->setCellValue('J8','Periode Jangka Waktu');
		$sheet->setCellValue('K8','Tgl Jtempo');
		$sheet->setCellValue('L8','Saldo Pokok');
		$sheet->setCellValue('M8','Saldo Margin');
		$sheet->setCellValue('N8','Produk');
		$sheet->setCellValue('O8','Jumlah Angsuran');
		$sheet->setCellValue('P8','Angsuran Pokok');
		$sheet->setCellValue('Q8','Angsuran Margin');
		$sheet->setCellValue('R8','Jumlah Bayar');

			

		$sheet->getStyle('B2:B6')->getFont()->setBold(true);
		$sheet->getStyle('B8:R8')->getFont()->setBold(true);
		$sheet->getStyle('R9')->getFont()->setBold(true);

		$sheet->getStyle('B2:B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('B8:R8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('M9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('B8:R8')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		
		$sheet->getStyle('B8')->applyFromArray($styleArray);
		$sheet->getStyle('C8')->applyFromArray($styleArray);
		$sheet->getStyle('D8')->applyFromArray($styleArray);
		$sheet->getStyle('E8')->applyFromArray($styleArray);
		$sheet->getStyle('F8')->applyFromArray($styleArray);
		$sheet->getStyle('G8')->applyFromArray($styleArray);
		$sheet->getStyle('H8')->applyFromArray($styleArray);
		$sheet->getStyle('I8')->applyFromArray($styleArray);
		$sheet->getStyle('J8')->applyFromArray($styleArray);
		$sheet->getStyle('K8')->applyFromArray($styleArray);
		$sheet->getStyle('L8')->applyFromArray($styleArray);
		$sheet->getStyle('M8')->applyFromArray($styleArray);
		$sheet->getStyle('N8')->applyFromArray($styleArray);
		$sheet->getStyle('O8')->applyFromArray($styleArray);
		$sheet->getStyle('P8')->applyFromArray($styleArray);
		$sheet->getStyle('Q8')->applyFromArray($styleArray);
		$sheet->getStyle('R8')->applyFromArray($styleArray);
		
		
		$sheet->getColumnDimension('B')->setWidth(10);
		$sheet->getColumnDimension('C')->setWidth(15);
		$sheet->getColumnDimension('D')->setWidth(30);
		$sheet->getColumnDimension('E')->setWidth(30);
		$sheet->getColumnDimension('F')->setWidth(25);
		$sheet->getColumnDimension('G')->setWidth(10);
		$sheet->getColumnDimension('H')->setWidth(15);
		$sheet->getColumnDimension('I')->setWidth(15);
		$sheet->getColumnDimension('J')->setWidth(15);
		$sheet->getColumnDimension('K')->setWidth(15);
		$sheet->getColumnDimension('L')->setWidth(17);
		$sheet->getColumnDimension('M')->setWidth(15);
		$sheet->getColumnDimension('N')->setWidth(15);
		$sheet->getColumnDimension('N')->setWidth(15);
		$sheet->getColumnDimension('P')->setWidth(15);
		$sheet->getColumnDimension('Q')->setWidth(15);
		$sheet->getColumnDimension('R')->setWidth(10);

		$ii = 10;
		$row_total = count($datas) + $ii;

	    $total_bayar = 0;

		for($i = 0; $i < count($datas); $i++){
			$trx_date = $datas[$i]['trx_date'];
			$trx_date = $this->format_date_detail($trx_date,'id',false,'-');
			$rekening = $datas[$i]['account_financing_no'];
			$nama = $datas[$i]['nama'];
			$majelis = $datas[$i]['cm_name'];
			$produk = $datas[$i]['nick_name'];
			$pokok = $datas[$i]['pokok'];
			$margin = $datas[$i]['margin'];
			$jangka_waktu = $datas[$i]['jangka_waktu'];
			$angsuran_pokok = $datas[$i]['angsuran_pokok'];
			$angsuran_margin = $datas[$i]['angsuran_margin'];
			$jml_bayar = $datas[$i]['jml_bayar'];
			$saldo_pokok = $datas[$i]['saldo_pokok'];
			$saldo_margin = $datas[$i]['saldo_margin'];
			$periode_jangka_waktu = $datas[$i]['periode_jangka_waktu'];
			$jtempo_angsuran_last = $datas[$i]['jtempo_angsuran_last'];
			$jml_angsuran = $datas[$i]['jml_angsuran'];

			$total_bayar += $jml_bayar;

			$sheet->setCellValue('B'.$ii,($i+1));
			$sheet->setCellValue('C'.$ii,"'".$rekening);
			$sheet->setCellValue('D'.$ii,$trx_date);
			$sheet->setCellValue('E'.$ii,$nama);
			$sheet->setCellValue('F'.$ii,$majelis);
			$sheet->setCellValue('G'.$ii,$pokok);
			$sheet->setCellValue('H'.$ii,$margin);
			$sheet->setCellValue('I'.$ii,$jangka_waktu);
			$sheet->setCellValue('J'.$ii,$periode_jangka_waktu);
			$sheet->setCellValue('K'.$ii,$jtempo_angsuran_last);
			$sheet->setCellValue('L'.$ii,$saldo_pokok);
			$sheet->setCellValue('M'.$ii,$saldo_margin);
			$sheet->setCellValue('N'.$ii,$produk);
			$sheet->setCellValue('O'.$ii,$jml_angsuran);
			$sheet->setCellValue('P'.$ii,$angsuran_pokok);
			$sheet->setCellValue('Q'.$ii,$angsuran_margin);
			$sheet->setCellValue('R'.$ii,$jml_bayar);

			$sheet->getStyle('B'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('C'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('D'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('E'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('F'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('G'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('H'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('I'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('J'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('K'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('L'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('M'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('N'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('O'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('P'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('Q'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('R'.$ii)->applyFromArray($styleArray);

			$sheet->getStyle('A'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('H'.$ii.':I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('J'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('K'.$ii.':R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$ii++;
		}

		$sheet->getStyle('R'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('R'.$row_total)->getFont()->setBold(true);
		$sheet->getStyle('R'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$sheet->setCellValue('R'.$row_total,$total_bayar);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN ANGSURAN PEMBIAYAAN ('.$jenis2.') '.$from.' - '.$thru.' '.$data_cabang.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	function export_list_angsuran_pembiayaan_individu(){
        $from = $this->uri->segment(3);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(4);
        $thru = $this->datepicker_convert(true,$thru,'/');
        $cabang = $this->uri->segment(5);
        $majelis = $this->uri->segment(6);
        $pembiayaan = $this->uri->segment(7);
        $petugas = $this->uri->segment(8);
        $produk = $this->uri->segment(9);

        if($pembiayaan == 1){
            $jenis = 'Individu';
            $jenis2 = strtoupper($jenis);
            $majelis = '00000';
            //$petugas = '00000';
        } else if($pembiayaan == 0) {
            $jenis = 'Kelompok';
            $jenis2 = strtoupper($jenis);
        } else {
            $jenis = 'Semua';
            $jenis2 = strtoupper($jenis);
        }

        if($petugas == '00000'){
            $fa = 'SEMUA PETUGAS';
        } else {
            $getPetugas = $this->model_cif->get_fa_by_fa_code($petugas);
            $fa = $getPetugas['fa_name'];
        }

        // if($pembiayaan == 0){
        //     //$datas = $this->model_laporan_to_pdf->export_list_angsuran_pembiayaan_kelompok($from,$thru,$cabang,$majelis,$petugas,$produk);
        // } else {
            
        // }
        	$datas = $this->model_laporan_to_pdf->export_list_angsuran_pembiayaan_individu($from,$thru,$cabang,$majelis,$petugas,$produk);

        if($cabang != '00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }
       
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$sheet = $objPHPExcel->getActiveSheet();

		$sheet->mergeCells('B2:M2');
		$sheet->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));
		$sheet->getStyle('B2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('B3:M3');
		$sheet->setCellValue('B3',$data_cabang);
		$sheet->getStyle('B3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('B4:M4');
		$sheet->setCellValue('B4','LAPORAN ANGSURAN PEMBIAYAAN');
		$sheet->getStyle('B4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$sheet->mergeCells('B5:M5');
		$sheet->setCellValue('B5','TANGGAL : '.$this->format_date_detail($from,'id',false,'-').' s.d '.$this->format_date_detail($thru,'id',false,'-'));
		$sheet->getStyle('B5')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('B6:M6');
		$sheet->setCellValue('B6','PETUGAS : '.$fa);
		$sheet->getStyle('B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		
		$sheet->setCellValue('B8','No');
		$sheet->setCellValue('C8','No Rekening');
		$sheet->setCellValue('D8','Nama');
		$sheet->setCellValue('E8','Tgl Transaksi');
		$sheet->setCellValue('F8','Majelis');
		$sheet->setCellValue('G8','Pokok');
		$sheet->setCellValue('H8','Margin');
		$sheet->setCellValue('I8','Jangka Waktu');
		$sheet->setCellValue('J8','Periode Jangka Waktu');
		$sheet->setCellValue('K8','Tgl Jtempo');
		$sheet->setCellValue('L8','Saldo Pokok');
		$sheet->setCellValue('M8','Saldo Margin');
		$sheet->setCellValue('N8','Produk');
		$sheet->setCellValue('O8','Angsuran Pokok');
		$sheet->setCellValue('P8','Angsuran Margin');
		$sheet->setCellValue('Q8','Angsuran Catab');
		$sheet->setCellValue('R8','Jumlah Bayar');

			

		$sheet->getStyle('B2:B6')->getFont()->setBold(true);
		$sheet->getStyle('B8:R8')->getFont()->setBold(true);
		$sheet->getStyle('R9')->getFont()->setBold(true);

		$sheet->getStyle('B2:B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('B8:R8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('M9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('B8:R8')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		
		$sheet->getStyle('B8')->applyFromArray($styleArray);
		$sheet->getStyle('C8')->applyFromArray($styleArray);
		$sheet->getStyle('D8')->applyFromArray($styleArray);
		$sheet->getStyle('E8')->applyFromArray($styleArray);
		$sheet->getStyle('F8')->applyFromArray($styleArray);
		$sheet->getStyle('G8')->applyFromArray($styleArray);
		$sheet->getStyle('H8')->applyFromArray($styleArray);
		$sheet->getStyle('I8')->applyFromArray($styleArray);
		$sheet->getStyle('J8')->applyFromArray($styleArray);
		$sheet->getStyle('K8')->applyFromArray($styleArray);
		$sheet->getStyle('L8')->applyFromArray($styleArray);
		$sheet->getStyle('M8')->applyFromArray($styleArray);
		$sheet->getStyle('N8')->applyFromArray($styleArray);
		$sheet->getStyle('O8')->applyFromArray($styleArray);
		$sheet->getStyle('P8')->applyFromArray($styleArray);
		$sheet->getStyle('Q8')->applyFromArray($styleArray);
		$sheet->getStyle('R8')->applyFromArray($styleArray);
		
		
		$sheet->getColumnDimension('B')->setWidth(10);
		$sheet->getColumnDimension('C')->setWidth(15);
		$sheet->getColumnDimension('D')->setWidth(30);
		$sheet->getColumnDimension('E')->setWidth(30);
		$sheet->getColumnDimension('F')->setWidth(25);
		$sheet->getColumnDimension('G')->setWidth(10);
		$sheet->getColumnDimension('H')->setWidth(15);
		$sheet->getColumnDimension('I')->setWidth(15);
		$sheet->getColumnDimension('J')->setWidth(15);
		$sheet->getColumnDimension('K')->setWidth(15);
		$sheet->getColumnDimension('L')->setWidth(17);
		$sheet->getColumnDimension('M')->setWidth(15);
		$sheet->getColumnDimension('N')->setWidth(15);
		$sheet->getColumnDimension('N')->setWidth(15);
		$sheet->getColumnDimension('P')->setWidth(15);
		$sheet->getColumnDimension('Q')->setWidth(15);
		$sheet->getColumnDimension('R')->setWidth(10);

		$ii = 10;
		$row_total = count($datas) + $ii;

	    $total_bayar = 0;

		for($i = 0; $i < count($datas); $i++){
			$trx_date 				= $datas[$i]['trx_date'];
			$trx_date 				= $this->format_date_detail($trx_date,'id',false,'-');
			$rekening 				= $datas[$i]['account_financing_no'];
			$nama 					= $datas[$i]['nama'];
			$majelis 				= $datas[$i]['cm_name'];
			$produk 				= $datas[$i]['nick_name'];
			$pokok 					= $datas[$i]['pokok'];
			$margin 				= $datas[$i]['margin'];
			$jangka_waktu 			= $datas[$i]['jangka_waktu'];
			$angsuran_pokok 		= $datas[$i]['angsuran_pokok'];
			$angsuran_margin 		= $datas[$i]['angsuran_margin'];
			$jml_bayar 				= $datas[$i]['jml_bayar'];
			$saldo_pokok 			= $datas[$i]['saldo_pokok'];
			$saldo_margin 			= $datas[$i]['saldo_margin'];
			$periode_jangka_waktu 	= $datas[$i]['periode_jangka_waktu'];
			$jtempo_angsuran_last 	= $datas[$i]['jtempo_angsuran_last'];
			$angsuran_catab 		= $datas[$i]['angsuran_catab'];

			$total_bayar 			+= $jml_bayar;

			$sheet->setCellValue('B'.$ii,($i+1));
			$sheet->setCellValue('C'.$ii,"'".$rekening);
			$sheet->setCellValue('D'.$ii,$trx_date);
			$sheet->setCellValue('E'.$ii,$nama);
			$sheet->setCellValue('F'.$ii,$majelis);
			$sheet->setCellValue('G'.$ii,$pokok);
			$sheet->setCellValue('H'.$ii,$margin);
			$sheet->setCellValue('I'.$ii,$jangka_waktu);
			$sheet->setCellValue('J'.$ii,$periode_jangka_waktu);
			$sheet->setCellValue('K'.$ii,$jtempo_angsuran_last);
			$sheet->setCellValue('L'.$ii,$saldo_pokok);
			$sheet->setCellValue('M'.$ii,$saldo_margin);
			$sheet->setCellValue('N'.$ii,$produk);
			$sheet->setCellValue('O'.$ii,$angsuran_pokok);
			$sheet->setCellValue('P'.$ii,$angsuran_margin);
			$sheet->setCellValue('Q'.$ii,$angsuran_catab);
			$sheet->setCellValue('R'.$ii,$jml_bayar);

			$sheet->getStyle('B'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('C'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('D'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('E'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('F'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('G'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('H'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('I'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('J'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('K'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('L'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('M'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('N'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('O'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('P'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('Q'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('R'.$ii)->applyFromArray($styleArray);

			$sheet->getStyle('A'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('H'.$ii.':I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('J'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('K'.$ii.':R'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$ii++;
		}

		$sheet->getStyle('R'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('R'.$row_total)->getFont()->setBold(true);
		$sheet->getStyle('R'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$sheet->setCellValue('R'.$row_total,$total_bayar);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN ANGSURAN PEMBIAYAAN ('.$jenis2.') '.$from.' - '.$thru.' '.$data_cabang.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	function export_list_proyeksi_realisasi_angsuran(){
        $from = $this->uri->segment(3);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(4);
        $thru = $this->datepicker_convert(true,$thru,'/');
        $cabang = $this->uri->segment(5);
        $majelis = $this->uri->segment(6);
        $produk = $this->uri->segment(7);

        $produk_name = $this->model_laporan->get_produk_name($produk);
        $cm_name = $this->model_laporan->get_cm_name_by_cm_code($majelis);
        $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
        $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
        $branch_class = isset($branch['branch_class'])?$branch['branch_class']:'';

		$datas = $this->model_laporan_to_pdf->export_list_proyeksi_realisasi_angsuran($from,$thru,$cabang,$produk,$majelis);

        if($cabang != '00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }
       
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

			// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$sheet = $objPHPExcel->getActiveSheet();

		$sheet->mergeCells('B2:P2');
		$sheet->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));
		$sheet->getStyle('B2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('B3:P3');
		$sheet->setCellValue('B3',$data_cabang);
		$sheet->getStyle('B3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$sheet->mergeCells('B4:P4');
		$sheet->setCellValue('B4','LAPORAN PROYEKSI REALISASI ANGSURAN');
		$sheet->getStyle('B4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$sheet->mergeCells('B5:P5');
		$sheet->setCellValue('B5','PRODUK : '.$produk_name);
		$sheet->getStyle('B5')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$sheet->mergeCells('B6:P6');
		$sheet->setCellValue('B6','PERIODE : '.$this->format_date_detail($from,'id',false,'-').' s/d '.$this->format_date_detail($thru,'id',false,'-'));
		$sheet->getStyle('B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$sheet->mergeCells('B8:B9');
		$sheet->setCellValue('B8','No');

		$sheet->mergeCells('C8:D8');
		$sheet->setCellValue('C8','Anggota');
		$sheet->setCellValue('C9','No. Rekening');
		$sheet->setCellValue('D9','Nama');

		$sheet->mergeCells('E8:E9');
		$sheet->setCellValue('E8','Majelis');

		$sheet->mergeCells('F8:F9');
		$sheet->setCellValue('F8','Produk');

		$sheet->mergeCells('G8:G9');
		$sheet->setCellValue('G8','Plafon');

		$sheet->mergeCells('H8:H9');
		$sheet->setCellValue('H8','Margin');

		$sheet->mergeCells('I8:I9');
		$sheet->setCellValue('I8','Tanggal Droping');

		$sheet->mergeCells('J8:K8');
		$sheet->setCellValue('J8','Proyeksi Angsuran');
		$sheet->setCellValue('J9','Ang. Pokok');
		$sheet->setCellValue('K9','Ang. Margin');

		$sheet->mergeCells('L8:M8');
		$sheet->setCellValue('L8','Realisasi Angsuran');
		$sheet->setCellValue('L9','Angs. Pokok');
		$sheet->setCellValue('M9','Angs. Margin');

		$sheet->mergeCells('N8:N9');
		$sheet->setCellValue('N8','Saldo Pokok');

		$sheet->mergeCells('O8:O9');
		$sheet->setCellValue('O8','Saldo Margin');

		$sheet->mergeCells('P8:P9');
		$sheet->setCellValue('P8','Saldo Hutang');

		$sheet->getStyle('B2:B6')->getFont()->setBold(true);
		$sheet->getStyle('B2:B6')->getFont()->setSize(13);

		$sheet->getStyle('B8:P8')->getFont()->setBold(true);
		$sheet->getStyle('B8:P8')->getFont()->setSize(11);

		$sheet->getStyle('B9:P9')->getFont()->setBold(true);
		$sheet->getStyle('B9:P9')->getFont()->setSize(11);

		$sheet->getStyle('B8:P8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('B9:P9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$sheet->getStyle('B8:P8')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$sheet->getStyle('B9:P9')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

		$sheet->getStyle('B8')->applyFromArray($styleArray);
		$sheet->getStyle('B9')->applyFromArray($styleArray);
		$sheet->getStyle('C8')->applyFromArray($styleArray);
		$sheet->getStyle('D8')->applyFromArray($styleArray);
		$sheet->getStyle('C9')->applyFromArray($styleArray);
		$sheet->getStyle('D9')->applyFromArray($styleArray);
		$sheet->getStyle('E8')->applyFromArray($styleArray);
		$sheet->getStyle('E9')->applyFromArray($styleArray);
		$sheet->getStyle('F8')->applyFromArray($styleArray);
		$sheet->getStyle('F9')->applyFromArray($styleArray);
		$sheet->getStyle('G8')->applyFromArray($styleArray);
		$sheet->getStyle('G9')->applyFromArray($styleArray);
		$sheet->getStyle('H8')->applyFromArray($styleArray);
		$sheet->getStyle('H9')->applyFromArray($styleArray);
		$sheet->getStyle('I8')->applyFromArray($styleArray);
		$sheet->getStyle('I9')->applyFromArray($styleArray);
		$sheet->getStyle('J8')->applyFromArray($styleArray);
		$sheet->getStyle('K8')->applyFromArray($styleArray);
		$sheet->getStyle('J9')->applyFromArray($styleArray);
		$sheet->getStyle('K9')->applyFromArray($styleArray);
		$sheet->getStyle('L8')->applyFromArray($styleArray);
		$sheet->getStyle('M8')->applyFromArray($styleArray);
		$sheet->getStyle('L9')->applyFromArray($styleArray);
		$sheet->getStyle('M9')->applyFromArray($styleArray);
		$sheet->getStyle('N8')->applyFromArray($styleArray);
		$sheet->getStyle('N9')->applyFromArray($styleArray);
		$sheet->getStyle('O8')->applyFromArray($styleArray);
		$sheet->getStyle('O9')->applyFromArray($styleArray);
		$sheet->getStyle('P8')->applyFromArray($styleArray);
		$sheet->getStyle('P9')->applyFromArray($styleArray);
		
		$sheet->getColumnDimension('B')->setWidth(10);
		$sheet->getColumnDimension('C')->setWidth(30);
		$sheet->getColumnDimension('D')->setWidth(30);
		$sheet->getColumnDimension('E')->setWidth(25);
		$sheet->getColumnDimension('F')->setWidth(20);
		$sheet->getColumnDimension('G')->setWidth(20);
		$sheet->getColumnDimension('H')->setWidth(20);
		$sheet->getColumnDimension('I')->setWidth(20);
		$sheet->getColumnDimension('J')->setWidth(20);
		$sheet->getColumnDimension('K')->setWidth(20);
		$sheet->getColumnDimension('L')->setWidth(20);
		$sheet->getColumnDimension('M')->setWidth(20);
		$sheet->getColumnDimension('N')->setWidth(20);
		$sheet->getColumnDimension('O')->setWidth(20);
		$sheet->getColumnDimension('P')->setWidth(20);

		$ii = 10;

		$row_total = count($datas) + $ii;

	    $total_pokok = 0;
	    $total_margin = 0;
	    $total_angsuran_pokok = 0;
	    $total_angsuran_margin = 0;
	    $total_saldo_pokok = 0;
	    $total_saldo_margin = 0;
	    $total_saldo_hutang = 0;

		for($i = 0; $i < count($datas); $i++){
			$rekening = $datas[$i]['account_financing_no'];
			$rembug = $datas[$i]['cm_name'];
			$nick = $datas[$i]['nick_name'];
			$nama = $datas[$i]['nama'];
			$pokok = $datas[$i]['pokok'];
			$margin = $datas[$i]['margin'];
			$tanggal_akad = $datas[$i]['tanggal_akad'];
			$angsuran_pokok = $datas[$i]['angsuran_pokok'];
			$angsuran_margin = $datas[$i]['angsuran_margin'];
			$saldo_pokok = $datas[$i]['saldo_pokok'];
			$saldo_margin = $datas[$i]['saldo_margin'];

			$saldo_hutang = $saldo_pokok + $saldo_margin;

			$total_pokok += $pokok;
			$total_margin += $margin;
			$total_angsuran_pokok += $angsuran_pokok;
			$total_angsuran_margin += $angsuran_margin;
			$total_saldo_pokok += $saldo_pokok;
			$total_saldo_margin += $saldo_margin;
			$total_saldo_hutang += $saldo_hutang;

			$sheet->setCellValue('B'.$ii,($i+1));
			$sheet->setCellValue('C'.$ii,"'".$rekening);
			$sheet->setCellValue('D'.$ii,$nama);
			$sheet->setCellValue('E'.$ii,$rembug);
			$sheet->setCellValue('F'.$ii,$nick);
			$sheet->setCellValue('G'.$ii,$pokok);
			$sheet->setCellValue('H'.$ii,$margin);
			$sheet->setCellValue('I'.$ii,$tanggal_akad);
			$sheet->setCellValue('J'.$ii,'0');
			$sheet->setCellValue('K'.$ii,'0');
			$sheet->setCellValue('L'.$ii,$angsuran_pokok);
			$sheet->setCellValue('M'.$ii,$angsuran_margin);
			$sheet->setCellValue('N'.$ii,$saldo_pokok);
			$sheet->setCellValue('O'.$ii,$saldo_margin);
			$sheet->setCellValue('P'.$ii,$saldo_hutang);

			$sheet->getStyle('B'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('C'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('D'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('E'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('F'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('G'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('H'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('I'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('J'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('K'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('L'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('M'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('N'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('O'.$ii)->applyFromArray($styleArray);
			$sheet->getStyle('P'.$ii)->applyFromArray($styleArray);

			$sheet->getStyle('B'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$sheet->getStyle('G'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
			$sheet->getStyle('J'.$ii.':P'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$ii++;
		}

		$sheet->getStyle('G'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('H'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('J'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('K'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('L'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('M'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('N'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('O'.$row_total)->applyFromArray($styleArray);
		$sheet->getStyle('P'.$row_total)->applyFromArray($styleArray);

		$sheet->getStyle('G'.$row_total.':H'.$row_total)->getFont()->setBold(true);
		$sheet->getStyle('G'.$row_total.':H'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
		$sheet->getStyle('J'.$row_total.':P'.$row_total)->getFont()->setBold(true);
		$sheet->getStyle('J'.$row_total.':P'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		$sheet->setCellValue('G'.$row_total,$total_pokok);
		$sheet->setCellValue('H'.$row_total,$total_margin);
		$sheet->setCellValue('J'.$row_total,'0');
		$sheet->setCellValue('K'.$row_total,$total_angsuran_pokok);
		$sheet->setCellValue('L'.$row_total,$total_angsuran_margin);
		$sheet->setCellValue('M'.$row_total,$total_saldo_pokok);
		$sheet->setCellValue('N'.$row_total,$total_saldo_margin);
		$sheet->setCellValue('O'.$row_total,$total_saldo_hutang);
		$sheet->setCellValue('P'.$row_total,$total_saldo_hutang);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN PROYEKSI REALISASI ANGSURAN '.$data_cabang.' '.$from.' - '.$thru.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	public function export_list_anggota_keluar()
	{
        $branch_code = $this->uri->segment(3);
        $cm_code = $this->uri->segment(4);		
		$from_date1 = $this->uri->segment(5);
        $from_date  = substr($from_date1,4,4).'-'.substr($from_date1,2,2).'-'.substr($from_date1,0,2);
        $thru_date1 = $this->uri->segment(6);   
        $thru_date  = substr($thru_date1,4,4).'-'.substr($thru_date1,2,2).'-'.substr($thru_date1,0,2);  
        $alasan = $this->uri->segment(7);   
      
        if ($branch_code=="") 
        {            
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        } 
        else
        {
        	$datas = $this->model_laporan->export_list_anggota_keluar($branch_code,$cm_code,$from_date,$thru_date,$alasan);

            if ($branch_code !='0000') 
            {
                $cabang = $this->model_laporan_to_pdf->get_cabang($branch_code);
            } 
            else 
            {
                $cabang = "Semua Data";
            }
		
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");
										 
			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:I1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',"LIST ANGGOTA KELUAR");
			$objPHPExcel->getActiveSheet()->mergeCells('A2:I2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',strtoupper($cabang));
			$objPHPExcel->getActiveSheet()->mergeCells('A3:I3');
			$objPHPExcel->getActiveSheet()->setCellValue('A3'," ");
			$objPHPExcel->getActiveSheet()->mergeCells('A5:B5');
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Anggota");
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"ID");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Nama");
			$objPHPExcel->getActiveSheet()->mergeCells('C5:C6');
			$objPHPExcel->getActiveSheet()->setCellValue('C5',"Rembug Pusat");
			$objPHPExcel->getActiveSheet()->mergeCells('D5:D6');
			$objPHPExcel->getActiveSheet()->setCellValue('D5',"Tanggal Gabung");
			$objPHPExcel->getActiveSheet()->mergeCells('E5:E6');
			$objPHPExcel->getActiveSheet()->setCellValue('E5',"Tanggal Keluar");
			$objPHPExcel->getActiveSheet()->mergeCells('F5:H5');
			$objPHPExcel->getActiveSheet()->setCellValue('F5',"Pembiayaan Terakhir");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"PYD Ke");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"Tanggal Droping");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"Plafon");
			$objPHPExcel->getActiveSheet()->mergeCells('I5:I6');
			$objPHPExcel->getActiveSheet()->setCellValue('I5',"Alasan Keluar");
			$objPHPExcel->getActiveSheet()->mergeCells('J5:J6');
			$objPHPExcel->getActiveSheet()->setCellValue('J5',"Keterangan Keluar");
		
			$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A5:J6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A5:J6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A5:J6')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A5')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B5')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C5')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D5')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E5')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F5')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G5')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H5')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I5')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J5:J6')->applyFromArray($styleArray);
			
			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(35);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(12);
			$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);

					
			$ii = 7;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
				// $objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii," ".$datas[$i]['cif_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['cm_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->format_date_detail($datas[$i]['tgl_gabung'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$this->format_date_detail($datas[$i]['tanggal_mutasi'],'id',false,'-'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($datas[$i]['pembiayaan_ke_last'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,isset($datas[$i]['tanggal_akad_last'])?$this->format_date_detail($datas[$i]['tanggal_akad_last'],'id',false,'-'):"-");
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($datas[$i]['pokok_last'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$datas[$i]['alasan']);
				$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$datas[$i]['alasan_keluar']);

				// $objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->applyFromArray($styleArray);
				// $objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
				// $objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
				// $objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
				// $objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
				// $objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
				// $objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->applyFromArray($styleArray);
				// $objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->applyFromArray($styleArray);
				// $objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->applyFromArray($styleArray);
				// $objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				// $objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				// $objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				// $objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				// $objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				// $objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':I'.$ii)->getFont()->setSize(9);

				$ii++;
			
			}//END FOR

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="export_list_anggota_keluar_'.$cabang.'.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}

	// BEGIN LIST ANGGOTA MASUK
	function export_list_anggota_masuk(){
        $cabang = $this->uri->segment(3);
        $majelis = $this->uri->segment(4);
        $from = $this->uri->segment(5);
        $from = $this->datepicker_convert(true,$from,'/');
        $thru = $this->uri->segment(6);
        $thru = $this->datepicker_convert(true,$thru,'/');
      
    	$datas = $this->model_laporan->export_list_anggota_masuk($cabang,$majelis,$from,$thru);

        if ($cabang !='0000') 
        {
            $data_cabang = $this->model_laporan_to_pdf->get_cabang($cabang);
        } 
        else 
        {
            $data_cabang = "Semua Data";
        }
	
		// ----------------------------------------------------------
    	// [BEGIN] EXPORT SCRIPT
		// ----------------------------------------------------------

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");
									 
		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('A1:I1');
		$objPHPExcel->getActiveSheet()->setCellValue('A1',"LIST ANGGOTA MASUK");
		$objPHPExcel->getActiveSheet()->mergeCells('A2:I2');
		$objPHPExcel->getActiveSheet()->setCellValue('A2',strtoupper($data_cabang));
		$objPHPExcel->getActiveSheet()->mergeCells('A3:I3');
		$objPHPExcel->getActiveSheet()->setCellValue('A3'," ");
		$objPHPExcel->getActiveSheet()->mergeCells('A5:B5');
		$objPHPExcel->getActiveSheet()->setCellValue('A5',"Anggota");
		$objPHPExcel->getActiveSheet()->setCellValue('A6',"ID");
		$objPHPExcel->getActiveSheet()->setCellValue('B6',"Nama");
		$objPHPExcel->getActiveSheet()->mergeCells('C5:C6');
		$objPHPExcel->getActiveSheet()->setCellValue('C5',"Majelis");
		$objPHPExcel->getActiveSheet()->mergeCells('D5:D6');
		$objPHPExcel->getActiveSheet()->setCellValue('D5',"Tanggal Gabung");
		$objPHPExcel->getActiveSheet()->mergeCells('E5:E6');
		$objPHPExcel->getActiveSheet()->setCellValue('E5',"Jenis Kelamin");
		$objPHPExcel->getActiveSheet()->mergeCells('F5:F6');
		$objPHPExcel->getActiveSheet()->setCellValue('F5',"Ibu Kandung");
		$objPHPExcel->getActiveSheet()->mergeCells('G5:G6');
		$objPHPExcel->getActiveSheet()->setCellValue('G5',"Tempat Lahir");
		$objPHPExcel->getActiveSheet()->mergeCells('H5:H6');
		$objPHPExcel->getActiveSheet()->setCellValue('H5',"Tanggal Lahir");
		$objPHPExcel->getActiveSheet()->mergeCells('I5:I6');
		$objPHPExcel->getActiveSheet()->setCellValue('I5',"Usia");
		$objPHPExcel->getActiveSheet()->mergeCells('J5:J6');
		$objPHPExcel->getActiveSheet()->setCellValue('J5',"Alamat");

		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A1:A3')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A5:J6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A5:J6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('A5:J6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('A5:B5')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C5')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D5')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E5')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F5')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G5')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H5')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I5')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J5')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J6')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(35);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(12);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);

				
		$ii = 7;

		for( $i = 0 ; $i < count($datas) ; $i++ ){
			$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii," ".$datas[$i]['cif_no']);
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['nama']);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['cm_name']);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->format_date_detail($datas[$i]['tgl_gabung'],'id',false,'-'));
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,'Perempuan');
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$datas[$i]['ibu_kandung']);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$datas[$i]['tmp_lahir']);
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$this->format_date_detail($datas[$i]['tgl_lahir'],'id',false,'-'));
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$datas[$i]['usia']);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$datas[$i]['alamat']);

			$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':I'.$ii)->getFont()->setSize(9);
			$ii++;
		}

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="export_list_anggota_masuk_'.$data_cabang.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	/*
	| Pencairan Tabungan Berencana
	| ujangirawan - 29 April 2015
	*/
	public function export_lap_pencairan_tabungan_berencana()
	{
		$produk    = $this->uri->segment(3);
		$from_date = $this->uri->segment(4);
		$from_date = substr($from_date,4,5).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date = $this->uri->segment(5);	
		$thru_date = substr($thru_date,4,5).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);			
		$cabang = $this->uri->segment(6);				
		$rembug = $this->uri->segment(7);	

		// if ($rembug==false){
		// 	$rembug = "";
		// }else{
		// 	$rembug =	$rembug;			
		// }

		if ($cabang==""){            
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        }else if ($from_date==""){            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }else if ($thru_date==""){            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }else{				
				
			$datas = $this->model_laporan_to_pdf->export_lap_pencairan_tabungan_berencana($produk,$cabang,$rembug,$from_date,$thru_date);
	        if ($cabang !='0000'){
	            $data_cabang = $this->model_laporan_to_pdf->get_cabang($cabang);
	        } else {
	            $data_cabang = "Semua Cabang";
	        }

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);
			
			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',$data_cabang);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Laporan Pencairan Tabungan Berencana");
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',$from_date.' s/d '.$thru_date);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->setCellValue('A6',"No.");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"ID Anggota");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Nama");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Majelis");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Produk");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Tanggal Buka");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"Jangka Waktu");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"Tanggal Cair");
			$objPHPExcel->getActiveSheet()->setCellValue('I6',"Pencairan");
			
			$objPHPExcel->getActiveSheet()->getStyle('A1:I4')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1:I4')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A6:I6')->getFont()->setSize(9);
			$objPHPExcel->getActiveSheet()->getStyle('A6:I6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:I6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I6')->applyFromArray($styleArray);
			
			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);

				$ii = 7;
				$row_total = count($datas)+8;
			    $total_pencairan = 0;
				for( $i = 0 ; $i < count($datas) ; $i++ )
				{
			        $total_pencairan += $datas[$i]['pencairan'];

					$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
					$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii," ".$datas[$i]['id_anggota']);
					$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['nama']);
					$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['majelis']);
					$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$datas[$i]['product_name']);
					$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$this->format_date_detail($datas[$i]['tanggal_buka'],'id',false,'-'));
					$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$datas[$i]['jangka_waktu']." Minggu");
					$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$this->format_date_detail($datas[$i]['tanggal_cair'],'id',false,'-'));
					$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii," ".number_format($datas[$i]['pencairan'],0,',','.'));

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$ii.':I'.$ii)->applyFromArray($styleArray);

					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':I'.$ii)->getFont()->setSize(9);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':B'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
					$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':I'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

					$ii++;
				
				}//END FOR*/

					$objPHPExcel->getActiveSheet()->setCellValue('I'.$row_total," ".number_format($total_pencairan,0,',','.'));
					$objPHPExcel->getActiveSheet()->getStyle('I'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
					$objPHPExcel->getActiveSheet()->getStyle('I'.$row_total)->getFont()->setSize(9);

				// Redirect output to a client's web browser (Excel2007)
				// Save Excel 2007 file

				header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
				header('Content-Disposition: attachment;filename="LIST-PENCAIRAN-TABUNGAN-BERENCANA.xlsx"');
				header('Cache-Control: max-age=0');

				$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
				$objWriter->save('php://output');
		}

	}

	function export_laporan_bagihasil()
	{
		$from_date = $this->uri->segment(3);
		$from_date = substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date = $this->uri->segment(4);	
		$thru_date = substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);			
		$branch_code = $this->uri->segment(5);				


		if ($branch_code==""){            
         echo "<script>alert('Parameter Bulum Lengkap !');javascript:window.close();</script>";
        }else if ($from_date==""){            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }else if ($thru_date==""){            
         echo "<script>alert('Tanggal Belum Diisi !');javascript:window.close();</script>";
        }else{				
				
			$datas = $this->model_laporan->get_data_bahas($branch_code,$from_date,$thru_date);
	        if ($branch_code !='0000'){
	            $data_cabang = $this->model_laporan_to_pdf->get_cabang($branch_code);
	        } else {
	            $data_cabang = "Semua Cabang";
	        }

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);
			
			$objPHPExcel->getActiveSheet()->mergeCells('A1:E1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->mergeCells('A2:E2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',$data_cabang);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			$objPHPExcel->getActiveSheet()->mergeCells('A3:E3');
			$objPHPExcel->getActiveSheet()->setCellValue('A3',"Laporan Bagihasil (SHU)");
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			$objPHPExcel->getActiveSheet()->mergeCells('A4:E4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',$from_date.' s/d '.$thru_date);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->setCellValue('A6',"No.");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"ID Anggota");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Nama");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Majelis");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Jumlah");
			
			$objPHPExcel->getActiveSheet()->getStyle('A1:E4')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1:E4')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getFont()->setSize(9);
			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:E6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			
			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(15);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(25);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);

			$ii = 7;
			$row_total = count($datas)+8;
		    $total_amount = 0;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
		        $total_amount += $datas[$i]['amount'];

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii," ".$datas[$i]['cif_no']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['nama']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$datas[$i]['majelis']);
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,number_format($datas[$i]['amount']));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':E'.$ii)->getFont()->setSize(9);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':B'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':E'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);

				$ii++;
			
			}//END FOR*/

				$objPHPExcel->getActiveSheet()->setCellValue('E'.$row_total," ".number_format($total_amount,0,',','.'));
				$objPHPExcel->getActiveSheet()->getStyle('E'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$row_total)->getFont()->setSize(9);

			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-BAGIHASIL-SHU.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');
		}
	}

	/****************************************************************************************/	
	// BEGIN REKAP ANGSURAN
	/****************************************************************************************/
	//semua cabang
	public function export_rekap_angsuran_semua_cabang()
	{
        $cabang         = $this->uri->segment(3);      
        $from_date 	= $this->uri->segment(4);	
        $from_date 	= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(5);	
		$thru_date 	= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2); 
        if ($cabang==false) 
        {
            $cabang = "0000";
        } 
        else
        {
            $cabang =   $cabang;            
        }
        
                $datas = $this->model_laporan_to_pdf->export_rekap_angsuran_semua_cabang($cabang,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $datacabang = "Semua Cabang";
		            }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);


			$objPHPExcel->getActiveSheet()->mergeCells('A1:G1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:G1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:G2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:G2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:G3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:G3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',$this->format_date_detail($from_date,'id',false,'-').' s/d '.$this->format_date_detail($thru_date,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->mergeCells('A4:G4');
			$objPHPExcel->getActiveSheet()->getStyle('A4:G4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Rekap Angsuran Berdasarkan Cabang");/*
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"% Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Pokok");

			$objPHPExcel->getActiveSheet()->getStyle('A6:G6')->getFont()->setSize(10);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:G6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:G6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

      		$total_anggota = 0;
      		$total_pokok = 0;
      		$total_margin = 0;
      		$sum_anggota = 0;
    		$sum_pokok = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
        		$sum_anggota+=$datas[$i]['num'];     
       			$sum_pokok+=$datas[$i]['pokok']; 
			}

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['num'];     
       			 $total_pokok+=$datas[$i]['pokok'];  
       			 $total_margin+=$datas[$i]['margin'];  

			 	$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
		        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,number_format($persen_jumlah,2,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_nominal,2,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':G'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':E'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':E'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':E'.$ii)->getFont()->setSize(10);
	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_ANGSURAN.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	//BY cabang
	public function export_rekap_angsuran_cabang()
	{
        $cabang         = $this->uri->segment(3);   
		$from_date 	= $this->uri->segment(4);	
        $from_date 	= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(5);	
		$thru_date 	= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);
        if ($cabang==false) 
        {
            $cabang = "0000";
        } 
        else 
        {
            $cabang =   $cabang;            
        }
        
                $datas = $this->model_laporan_to_pdf->export_rekap_angsuran_cabang($cabang,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $datacabang = "Semua Cabang";
		            }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);


			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',$this->format_date_detail($from_date,'id',false,'-').' s/d '.$this->format_date_detail($thru_date,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->getStyle('A4:H4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Rekap Angsuran Berdasarkan Cabang");/*
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

      		$total_anggota = 0;
      		$total_pokok = 0;
      		$total_margin = 0;
      		$total_catab = 0;
      		$sum_anggota = 0;
    		$sum_pokok = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
        		$sum_anggota+=$datas[$i]['num'];     
       			$sum_pokok+=$datas[$i]['pokok']; 
			}

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['num'];     
       			 $total_pokok+=$datas[$i]['pokok'];  
       			 $total_margin+=$datas[$i]['margin'];  
       			 $total_catab+=$datas[$i]['catab'];  
       			 $persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
		        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['branch_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);

	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_ANGSURAN.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	//BY rembug
	public function export_rekap_angsuran_rembug()
	{
        $cabang         = $this->uri->segment(3);    
        $from_date 	= $this->uri->segment(4);	
        $from_date 	= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(5);	
		$thru_date 	= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);   
        if ($cabang==false) 
        {
            $cabang = "0000";
        } 
        else if ($cabang==true) 
        {
            $cabang =   $cabang;            
        }
        
                $datas = $this->model_laporan_to_pdf->export_rekap_angsuran_rembug($cabang,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $datacabang = "Semua Cabang";
		            }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);


			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',$this->format_date_detail($from_date,'id',false,'-').' s/d '.$this->format_date_detail($thru_date,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->getStyle('A4:H4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Rekap Angsuran Berdasarkan Rembug");/*
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);


			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

      		$total_anggota = 0;
      		$total_pokok = 0;
      		$total_margin = 0;
      		$total_catab = 0;
      		$sum_anggota = 0;
    		$sum_pokok = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
        		$sum_anggota+=$datas[$i]['num'];     
       			$sum_pokok+=$datas[$i]['pokok']; 
			}

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['num'];     
       			 $total_pokok+=$datas[$i]['pokok'];  
       			 $total_margin+=$datas[$i]['margin'];  
       			 $total_catab+=$datas[$i]['catab'];  
       			$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
		        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['cm_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);
	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_ANGSURAN.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	//BY Petugas
	public function export_rekap_angsuran_petugas()
	{
        $cabang         = $this->uri->segment(3);     
        $from_date 	= $this->uri->segment(4);	
        $from_date 	= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(5);	
		$thru_date 	= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);  
        if ($cabang==false) 
        {
            $cabang = "0000";
        } 
        else if ($cabang==true) 
        {
            $cabang =   $cabang;            
        }
        
                $datas = $this->model_laporan_to_pdf->export_rekap_angsuran_petugas($cabang,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $datacabang = "Semua Cabang";
		            }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',$this->format_date_detail($from_date,'id',false,'-').' s/d '.$this->format_date_detail($thru_date,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->getStyle('A4:H4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Rekap Angsuran Berdasarkan Petugas");/*
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
			


					
			$ii = 7;

      		$total_anggota = 0;
      		$total_pokok = 0;
      		$total_margin = 0;
      		$total_catab = 0;
      		$sum_anggota = 0;
    		$sum_pokok = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
        		$sum_anggota+=$datas[$i]['num'];     
       			$sum_pokok+=$datas[$i]['pokok']; 
			}

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['num'];     
       			 $total_pokok+=$datas[$i]['pokok'];  
       			 $total_margin+=$datas[$i]['margin'];  
       			 $total_catab+=$datas[$i]['catab'];  
			 	$persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
		        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['fa_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);


	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_ANGSURAN.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	//BY Peruntukan
	public function export_rekap_angsuran_peruntukan()
	{
        $cabang         = $this->uri->segment(3);       
        $from_date 	= $this->uri->segment(4);	
        $from_date 	= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(5);	
		$thru_date 	= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);
        if ($cabang==false) 
        {
            $cabang = "0000";
        } 
        else if ($cabang==true) 
        {
            $cabang =   $cabang;            
        }
        
                $datas = $this->model_laporan_to_pdf->export_rekap_angsuran_peruntukan($cabang,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $datacabang = "Semua Cabang";
		            }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',$this->format_date_detail($from_date,'id',false,'-').' s/d '.$this->format_date_detail($thru_date,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->getStyle('A4:H4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Rekap Angsuran Berdasarkan Peruntukan");/*
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 7;

      		$total_anggota = 0;
      		$total_pokok = 0;
      		$total_margin = 0;
      		$total_catab = 0;
      		$sum_anggota = 0;
    		$sum_pokok = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
        		$sum_anggota+=$datas[$i]['num'];     
       			$sum_pokok+=$datas[$i]['pokok']; 
			}

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['num'];     
       			 $total_pokok+=$datas[$i]['pokok'];  
       			 $total_margin+=$datas[$i]['margin'];  
       			 $total_catab+=$datas[$i]['catab'];  
       			 $persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
		        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;

				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['display_text']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);


	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_ANGSURAN.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	//BY Peruntukan
	public function export_rekap_angsuran_sektor_usaha()
	{
        $cabang         = $this->uri->segment(3);       
        $from_date 	= $this->uri->segment(4);	
        $from_date 	= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(5);	
		$thru_date 	= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);
        if ($cabang==false) 
        {
            $cabang = "0000";
        } 
        else if ($cabang==true) 
        {
            $cabang =   $cabang;            
        }
        
                $datas = $this->model_laporan_to_pdf->export_rekap_angsuran_sektor_usaha($cabang,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $datacabang = "Semua Cabang";
		            }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',$this->format_date_detail($from_date,'id',false,'-').' s/d '.$this->format_date_detail($thru_date,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->getStyle('A4:H4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Rekap Angsuran Berdasarkan Sektor Usaha");/*
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 7;

      		$total_anggota = 0;
      		$total_pokok = 0;
      		$total_margin = 0;
      		$total_catab = 0;
      		$sum_anggota = 0;
    		$sum_pokok = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
        		$sum_anggota+=$datas[$i]['num'];     
       			$sum_pokok+=$datas[$i]['pokok']; 
			}

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['num'];     
       			 $total_pokok+=$datas[$i]['pokok'];  
       			 $total_margin+=$datas[$i]['margin'];  
       			 $total_catab+=$datas[$i]['catab'];  
       			 $persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
		        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;


				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['display_text']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);


	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_ANGSURAN.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	public function export_rekap_angsuran_produk()
	{
        $cabang         = $this->uri->segment(3);       
        $from_date 	= $this->uri->segment(4);	
        $from_date 	= substr($from_date,4,4).'-'.substr($from_date,2,2).'-'.substr($from_date,0,2);
		$thru_date 	= $this->uri->segment(5);	
		$thru_date 	= substr($thru_date,4,4).'-'.substr($thru_date,2,2).'-'.substr($thru_date,0,2);
        if ($cabang==false) 
        {
            $cabang = "0000";
        } 
        else if ($cabang==true) 
        {
            $cabang =   $cabang;            
        }
        
                $datas = $this->model_laporan_to_pdf->export_rekap_angsuran_produk($cabang,$from_date,$thru_date);
		            if ($cabang !='0000') 
		            {
		                $datacabang = $this->model_laporan_to_pdf->get_cabang($cabang);
		            } 
		            else 
		            {
		                $datacabang = "Semua Cabang";
		            }
			
			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			$objPHPExcel->getActiveSheet()->mergeCells('A1:H1');
			$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			$objPHPExcel->getActiveSheet()->mergeCells('A2:H2');
			$objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"Cabang : ".$datacabang);
			$objPHPExcel->getActiveSheet()->mergeCells('A3:H3');
			$objPHPExcel->getActiveSheet()->getStyle('A3:H3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A3',$this->format_date_detail($from_date,'id',false,'-').' s/d '.$this->format_date_detail($thru_date,'id',false,'-'));
			$objPHPExcel->getActiveSheet()->mergeCells('A4:H4');
			$objPHPExcel->getActiveSheet()->getStyle('A4:H4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Rekap Angsuran Berdasarkan Produk");/*
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Periode : ".date('Y-m-d'));*/
			$objPHPExcel->getActiveSheet()->setCellValue('A6',"Kode");
			$objPHPExcel->getActiveSheet()->setCellValue('B6',"Keterangan");
			$objPHPExcel->getActiveSheet()->setCellValue('C6',"Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('D6',"Pokok");
			$objPHPExcel->getActiveSheet()->setCellValue('E6',"Margin");
			$objPHPExcel->getActiveSheet()->setCellValue('F6',"Catab");
			$objPHPExcel->getActiveSheet()->setCellValue('G6',"% Jumlah");
			$objPHPExcel->getActiveSheet()->setCellValue('H6',"% Pokok");

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getFont()->setSize(10);
			
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A3')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A4')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A5')->getFont()->setBold(true);

			$objPHPExcel->getActiveSheet()->getStyle('A6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G6')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('H6')->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
			$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(20);
			$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(20);

			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('A6:H6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
					
			$ii = 7;

      		$total_anggota = 0;
      		$total_pokok = 0;
      		$total_margin = 0;
      		$total_catab = 0;
      		$sum_anggota = 0;
    		$sum_pokok = 0;

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{
        		$sum_anggota+=$datas[$i]['num'];     
       			$sum_pokok+=$datas[$i]['pokok']; 
			}

			for( $i = 0 ; $i < count($datas) ; $i++ )
			{ 
        		 $total_anggota+=$datas[$i]['num'];     
       			 $total_pokok+=$datas[$i]['pokok'];  
       			 $total_margin+=$datas[$i]['margin'];  
       			 $total_catab+=$datas[$i]['catab'];  
       			 $persen_jumlah = $datas[$i]['num']/$sum_anggota*100;
		        $persen_nominal = $datas[$i]['pokok']/$sum_pokok*100;


				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,($i+1));
				$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$datas[$i]['product_name']);
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$datas[$i]['num']);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii," ".number_format($datas[$i]['pokok'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii," ".number_format($datas[$i]['margin'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii," ".number_format($datas[$i]['catab'],0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,number_format($persen_jumlah,2,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,number_format($persen_nominal,2,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':A'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('G'.$ii.':G'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('H'.$ii.':H'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':H'.$ii)->getFont()->setSize(10);

				$ii++;
			
			}//END FOR

			$iii = count($datas)+8;
				$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_anggota);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii," ".number_format($total_pokok,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii," ".number_format($total_margin,0,',','.'));
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii," ".number_format($total_catab,0,',','.'));

				$objPHPExcel->getActiveSheet()->getStyle('C'.$iii.':C'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$iii.':D'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$iii.':E'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$iii.':F'.$iii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$iii.':F'.$iii)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':F'.$ii)->getFont()->setSize(10);


	
		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_ANGSURAN.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');

		// ----------------------------------------------------------------------
		// [END] EXPORT SCRIPT
		// ----------------------------------------------------------------------
	}

	// ----------------------------------------------------------------------
	// END REPORT ANGSURAN
	// ----------------------------------------------------------------------

	// START EXPORT REKAP CASHFLOW TRANSAKSI REMBUG
	function export_rekap_cashflow_transaksi_rembug(){
		$cabang = $this->uri->segment(3);
		$awal = $this->uri->segment(4);
		$akhir = $this->uri->segment(5);

		$from = $this->datepicker_convert(FALSE,$awal);
		$thru = $this->datepicker_convert(FALSE,$akhir);

		$data = $this->model_laporan->export_rekap_cashflow_transaksi_rembug($cabang,$from,$thru);
		
		if($cabang == '00000'){
			$office = 'SEMUA CABANG';
		} else {
			$office = 'KANTOR CABANG ';
			$office .= $this->model_laporan_to_pdf->get_cabang($cabang);
		}

		$objPHPExcel = $this->phpexcel;
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);
		
		$objPHPExcel->getActiveSheet()->mergeCells('B2:J2');
		$objPHPExcel->getActiveSheet()->getStyle('B2')->getFont()->setSize(18);
		$objPHPExcel->getActiveSheet()->getStyle('B2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B2:J2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));

		$objPHPExcel->getActiveSheet()->mergeCells('B3:J3');
		$objPHPExcel->getActiveSheet()->getStyle('B3')->getFont()->setSize(16);
		$objPHPExcel->getActiveSheet()->getStyle('B3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B3:J3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('B3','REKAP CASHFLOW TRANSAKSI MAJELIS');

		$objPHPExcel->getActiveSheet()->mergeCells('B4:J4');
		$objPHPExcel->getActiveSheet()->getStyle('B4')->getFont()->setSize(14);
		$objPHPExcel->getActiveSheet()->getStyle('B4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B4:J4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('B4',strtoupper($office));
		
		$objPHPExcel->getActiveSheet()->setCellValue('B6','Tanggal');
		$objPHPExcel->getActiveSheet()->setCellValue('B7','Rekap By');
		
		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->setCellValue('C6',': '.$this->format_date_detail($from,'id',false,'-').' s.d '.$this->format_date_detail($thru,'id',false,'-'));
		
		$objPHPExcel->getActiveSheet()->mergeCells('C7:E7');
		$objPHPExcel->getActiveSheet()->setCellValue('C7',': Majelis');
		
		$objPHPExcel->getActiveSheet()->mergeCells('B9:B10');
		$objPHPExcel->getActiveSheet()->getStyle('B9:J9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B10:J10')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B9')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('B9','Nama');
		
		$objPHPExcel->getActiveSheet()->mergeCells('C9:G9');
		$objPHPExcel->getActiveSheet()->getStyle('C9:G9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C9')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C9','Cash In');

		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);

		$objPHPExcel->getActiveSheet()->mergeCells('H9:J9');
		$objPHPExcel->getActiveSheet()->getStyle('H9:J9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('H9')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('H9','Cash Out');

		$objPHPExcel->getActiveSheet()->getStyle('C10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C10','Angs Pokok');

		$objPHPExcel->getActiveSheet()->getStyle('D10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('D10','Angs Margin');

		$objPHPExcel->getActiveSheet()->getStyle('E10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('E10','Angs Catab');

		$objPHPExcel->getActiveSheet()->getStyle('F10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('F10','Tab Wajib');

		$objPHPExcel->getActiveSheet()->getStyle('G10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('G10','Tab Kelompok');

		$objPHPExcel->getActiveSheet()->getStyle('H10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('H10','Wajib');

		$objPHPExcel->getActiveSheet()->getStyle('I10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('I10','Sukarela');

		$objPHPExcel->getActiveSheet()->getStyle('J10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('J10','Droping');
		
		$objPHPExcel->getActiveSheet()->setCellValue('B11','');
		$objPHPExcel->getActiveSheet()->setCellValue('C11','');
		$objPHPExcel->getActiveSheet()->setCellValue('D11','');
		$objPHPExcel->getActiveSheet()->setCellValue('E11','');
		$objPHPExcel->getActiveSheet()->setCellValue('F11','');
		$objPHPExcel->getActiveSheet()->setCellValue('G11','');
		$objPHPExcel->getActiveSheet()->setCellValue('H11','');
		$objPHPExcel->getActiveSheet()->setCellValue('I11','');
		$objPHPExcel->getActiveSheet()->setCellValue('J11','');
		
		$objPHPExcel->getActiveSheet()->getStyle('B9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J9')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getStyle('B10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J10')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getStyle('B11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J11')->applyFromArray($styleArray);

		$ii = 12;
		
		$total_angsuran_pokok = 0;
		$total_angsuran_margin = 0;
		$total_angsuran_catab = 0;
		$total_tabungan_wajib = 0;
		$total_tabungan_kelompok = 0;
		
		$total_wajib = 0;
		$total_sukarela = 0;
		$total_droping = 0;
		
		for($i = 0; $i < count($data); $i++){
			$majelis = $data[$i]['cm_name'];
			$angsuran_pokok = $data[$i]['angsuran_pokok'];
			$angsuran_margin = $data[$i]['angsuran_margin'];
			$angsuran_catab = $data[$i]['angsuran_catab'];
			$tabungan_wajib = $data[$i]['tab_wajib_cr'];
			$tabungan_kelompok = $data[$i]['tab_kelompok_cr'];
			
			$wajib = $data[$i]['tab_wajib_db'];
			$sukarela = $data[$i]['tab_sukarela_db'];
			$droping = $data[$i]['droping'];
			
			$total_angsuran_pokok += $angsuran_pokok;
			$total_angsuran_margin += $angsuran_margin;
			$total_angsuran_catab += $angsuran_catab;
			$total_tabungan_wajib += $tabungan_wajib;
			$total_tabungan_kelompok += $tabungan_kelompok;
			
			$total_wajib += $wajib;
			$total_sukarela += $sukarela;
			$total_droping += $droping;
			
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$majelis);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$angsuran_pokok);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$angsuran_margin);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$angsuran_catab);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$tabungan_wajib);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$tabungan_kelompok);
			
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$wajib);
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$sukarela);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$droping);
			
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii)->applyFromArray($styleArray);
			
			$ii++;
		}
		
		$iii = $ii;
		
		$objPHPExcel->getActiveSheet()->getStyle('B'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('B'.$iii,'JUMLAH');

		$objPHPExcel->getActiveSheet()->getStyle('C'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_angsuran_pokok);

		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii,$total_angsuran_margin);

		$objPHPExcel->getActiveSheet()->getStyle('E'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii,$total_angsuran_catab);

		$objPHPExcel->getActiveSheet()->getStyle('F'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii,$total_tabungan_wajib);

		$objPHPExcel->getActiveSheet()->getStyle('G'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii,$total_tabungan_kelompok);
		
		$objPHPExcel->getActiveSheet()->getStyle('H'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii,$total_wajib);

		$objPHPExcel->getActiveSheet()->getStyle('I'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('I'.$iii,$total_sukarela);

		$objPHPExcel->getActiveSheet()->getStyle('J'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('J'.$iii,$total_droping);
		
		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_CASHFLOW_TRANSAKSI_REMBUG.xlsx"');
		header('Cache-Control: max-age=0');
		
		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');
	}

	function export_rekap_cashflow_transaksi_petugas(){
		$cabang = $this->uri->segment(3);
		$awal = $this->uri->segment(4);
		$akhir = $this->uri->segment(5);

		$from = $this->datepicker_convert(FALSE,$awal);
		$thru = $this->datepicker_convert(FALSE,$akhir);

		$data = $this->model_laporan->export_rekap_cashflow_transaksi_petugas($cabang,$from,$thru);
		
		if($cabang == '00000'){
			$office = 'SEMUA CABANG';
		} else {
			$office = 'KANTOR CABANG ';
			$office .= $this->model_laporan_to_pdf->get_cabang($cabang);
		}

		$objPHPExcel = $this->phpexcel;
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);
		
		$objPHPExcel->getActiveSheet()->mergeCells('B2:J2');
		$objPHPExcel->getActiveSheet()->getStyle('B2')->getFont()->setSize(18);
		$objPHPExcel->getActiveSheet()->getStyle('B2')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B2:J2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));

		$objPHPExcel->getActiveSheet()->mergeCells('B3:J3');
		$objPHPExcel->getActiveSheet()->getStyle('B3')->getFont()->setSize(16);
		$objPHPExcel->getActiveSheet()->getStyle('B3')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B3:J3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('B3','REKAP CASHFLOW TRANSAKSI MAJELIS');

		$objPHPExcel->getActiveSheet()->mergeCells('B4:J4');
		$objPHPExcel->getActiveSheet()->getStyle('B4')->getFont()->setSize(14);
		$objPHPExcel->getActiveSheet()->getStyle('B4')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B4:J4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('B4',strtoupper($office));
		
		$objPHPExcel->getActiveSheet()->setCellValue('B6','Tanggal');
		$objPHPExcel->getActiveSheet()->setCellValue('B7','Rekap By');
		
		$objPHPExcel->getActiveSheet()->mergeCells('C6:E6');
		$objPHPExcel->getActiveSheet()->setCellValue('C6',': '.$this->format_date_detail($from,'id',false,'-').' s.d '.$this->format_date_detail($thru,'id',false,'-'));
		
		$objPHPExcel->getActiveSheet()->mergeCells('C7:E7');
		$objPHPExcel->getActiveSheet()->setCellValue('C7',': Petugas');
		
		$objPHPExcel->getActiveSheet()->mergeCells('B9:B10');
		$objPHPExcel->getActiveSheet()->getStyle('B9:J9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B10:J10')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B9')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('B9','Nama');
		
		$objPHPExcel->getActiveSheet()->mergeCells('C9:G9');
		$objPHPExcel->getActiveSheet()->getStyle('C9:G9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('C9')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C9','Cash In');

		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(15);
		$objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(15);

		$objPHPExcel->getActiveSheet()->mergeCells('H9:J9');
		$objPHPExcel->getActiveSheet()->getStyle('H9:J9')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('H9')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('H9','Cash Out');

		$objPHPExcel->getActiveSheet()->getStyle('C10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C10','Angs Pokok');

		$objPHPExcel->getActiveSheet()->getStyle('D10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('D10','Angs Margin');

		$objPHPExcel->getActiveSheet()->getStyle('E10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('E10','Angs Catab');

		$objPHPExcel->getActiveSheet()->getStyle('F10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('F10','Tab Wajib');

		$objPHPExcel->getActiveSheet()->getStyle('G10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('G10','Tab Kelompok');

		$objPHPExcel->getActiveSheet()->getStyle('H10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('H10','Wajib');

		$objPHPExcel->getActiveSheet()->getStyle('I10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('I10','Sukarela');

		$objPHPExcel->getActiveSheet()->getStyle('J10')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('J10','Droping');
		
		$objPHPExcel->getActiveSheet()->setCellValue('B11','');
		$objPHPExcel->getActiveSheet()->setCellValue('C11','');
		$objPHPExcel->getActiveSheet()->setCellValue('D11','');
		$objPHPExcel->getActiveSheet()->setCellValue('E11','');
		$objPHPExcel->getActiveSheet()->setCellValue('F11','');
		$objPHPExcel->getActiveSheet()->setCellValue('G11','');
		$objPHPExcel->getActiveSheet()->setCellValue('H11','');
		$objPHPExcel->getActiveSheet()->setCellValue('I11','');
		$objPHPExcel->getActiveSheet()->setCellValue('J11','');
		
		$objPHPExcel->getActiveSheet()->getStyle('B9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I9')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J9')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getStyle('B10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I10')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J10')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getStyle('B11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I11')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J11')->applyFromArray($styleArray);

		$ii = 12;
		
		$total_angsuran_pokok = 0;
		$total_angsuran_margin = 0;
		$total_angsuran_catab = 0;
		$total_tabungan_wajib = 0;
		$total_tabungan_kelompok = 0;
		
		$total_wajib = 0;
		$total_sukarela = 0;
		$total_droping = 0;
		
		for($i = 0; $i < count($data); $i++){
			$petugas = $data[$i]['fa_name'];
			$angsuran_pokok = $data[$i]['angsuran_pokok'];
			$angsuran_margin = $data[$i]['angsuran_margin'];
			$angsuran_catab = $data[$i]['angsuran_catab'];
			$tabungan_wajib = $data[$i]['tab_wajib_cr'];
			$tabungan_kelompok = $data[$i]['tab_kelompok_cr'];
			
			$wajib = $data[$i]['tab_wajib_db'];
			$sukarela = $data[$i]['tab_sukarela_db'];
			$droping = $data[$i]['droping'];
			
			$total_angsuran_pokok += $angsuran_pokok;
			$total_angsuran_margin += $angsuran_margin;
			$total_angsuran_catab += $angsuran_catab;
			$total_tabungan_wajib += $tabungan_wajib;
			$total_tabungan_kelompok += $tabungan_kelompok;
			
			$total_wajib += $wajib;
			$total_sukarela += $sukarela;
			$total_droping += $droping;
			
			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$petugas);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$angsuran_pokok);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$angsuran_margin);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$angsuran_catab);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$tabungan_wajib);
			$objPHPExcel->getActiveSheet()->setCellValue('G'.$ii,$tabungan_kelompok);
			
			$objPHPExcel->getActiveSheet()->setCellValue('H'.$ii,$wajib);
			$objPHPExcel->getActiveSheet()->setCellValue('I'.$ii,$sukarela);
			$objPHPExcel->getActiveSheet()->setCellValue('J'.$ii,$droping);
			
			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('G'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('H'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('I'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('J'.$ii)->applyFromArray($styleArray);
			
			$ii++;
		}
		
		$iii = $ii;
		
		$objPHPExcel->getActiveSheet()->getStyle('B'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('B'.$iii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->getStyle('B'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('B'.$iii,'JUMLAH');

		$objPHPExcel->getActiveSheet()->getStyle('C'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C'.$iii,$total_angsuran_pokok);

		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('D'.$iii,$total_angsuran_margin);

		$objPHPExcel->getActiveSheet()->getStyle('E'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('E'.$iii,$total_angsuran_catab);

		$objPHPExcel->getActiveSheet()->getStyle('F'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('F'.$iii,$total_tabungan_wajib);

		$objPHPExcel->getActiveSheet()->getStyle('G'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('G'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('G'.$iii,$total_tabungan_kelompok);
		
		$objPHPExcel->getActiveSheet()->getStyle('H'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('H'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('H'.$iii,$total_wajib);

		$objPHPExcel->getActiveSheet()->getStyle('I'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('I'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('I'.$iii,$total_sukarela);

		$objPHPExcel->getActiveSheet()->getStyle('J'.$iii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('J'.$iii)->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('J'.$iii,$total_droping);
		
		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_CASHFLOW_TRANSAKSI_REMBUG.xlsx"');
		header('Cache-Control: max-age=0');
		
		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');
	}
	// END EXPORT REKAP CASHFLOW TRANSAKSI REMBUG

	function export_rekap_saldo_tabungan(){
        $cabang = $this->uri->segment(3);

        if($cabang==false){
            $cabang = "0000";
        } else {
            $cabang =   $cabang;
        }

        if($cabang !='0000'){
            $branch = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $branch = "SEMUA CABANG";
        }

        $data = $this->model_laporan_to_pdf->export_rekap_saldo_tabungan($cabang);

		$objPHPExcel = $this->phpexcel;
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
									 ->setLastModifiedBy("MICROFINANCE")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("REPORT, generated using PHP classes.")
									 ->setKeywords("REPORT")
									 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
       		'borders' => array(
		             'outline' => array(
		                    'style' => PHPExcel_Style_Border::BORDER_THIN,
		                    'color' => array('rgb' => '000000'),
		             ),
		       ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('B2:E2');
		$objPHPExcel->getActiveSheet()->getStyle('B2')->getFont()->setSize(16);
		$objPHPExcel->getActiveSheet()->getStyle('B2:E2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));

		$objPHPExcel->getActiveSheet()->mergeCells('B3:E3');
		$objPHPExcel->getActiveSheet()->getStyle('B3')->getFont()->setSize(14);
		$objPHPExcel->getActiveSheet()->getStyle('B3:E3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('B3',$branch);

		$objPHPExcel->getActiveSheet()->mergeCells('B4:E4');
		$objPHPExcel->getActiveSheet()->getStyle('B4')->getFont()->setSize(12);
		$objPHPExcel->getActiveSheet()->getStyle('B4:E4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		$objPHPExcel->getActiveSheet()->setCellValue('B4','Rekap Saldo Tabungan');

		$objPHPExcel->getActiveSheet()->getStyle('B6:E6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D6')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E6')->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getStyle('B6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('B6','No');
		$objPHPExcel->getActiveSheet()->getStyle('C6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('C6','Produk');
		$objPHPExcel->getActiveSheet()->getStyle('D6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('D6','Jumlah');
		$objPHPExcel->getActiveSheet()->getStyle('E6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->setCellValue('E6','Nominal');

		$ii = 7;
		$no = 1;
		$total_anggota = 0;
		$total_nominal = 0;

		for($i = 0; $i < count($data); $i++){
			$product = $data[$i]['product_name'];
			$jumlah = $data[$i]['jumlah'];
			$nominal = $data[$i]['nominal'];

			$total_anggota += $jumlah;
			$total_nominal += $nominal;

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,$no);
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$product);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$jumlah);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$nominal);

			$no++;
			$ii++;
		}

		$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$total_anggota);
		$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$total_nominal);

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="REPORT_REKAP_SALDO_TABUNGAN.xlsx"');
		header('Cache-Control: max-age=0');
		
		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');
	}



	public function export_neraca_gl_v2()
	{
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        // $from_date = $this->get_from_trx_date();
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;
        if ($cabang==""){            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        }else if ($periode_bulan=="" && $periode_tahun=="") {
            echo "<script>alert('Periode Belum Dipilih !');javascript:window.close();</script>";
        }else{

            $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_class = $branch['branch_class'];

            switch ($branch_class) {
				case '0':
				  $branch_class_name = "Kepala Pusat";
				  break;
				case '1':
				  $branch_class_name = "Kepala Wilayah";
				  break;
				case '2':
				  $branch_class_name = "Kepala Cabang";
				  break;
				case '3':
				  $branch_class_name = "Kepala Capem";
				  break;
				default:
				  $branch_class_name = "-";
				  break;
			}

            // $from_periode = $periode_tahun.'-'.$periode_bulan.'-01';
			$datas = $this->model_laporan_to_pdf->export_neraca_gl_v2($cabang,$last_date);
            if ($cabang !='00000'){
                $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
                if($branch_class=="1"){
                    $branch_name .= "";
                }
            }else{
                $branch_name = "PUSAT";
            }

			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN NERACA");
			// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

			// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

			$cCA = createColumnsArray('XFD');

			if($branch_class=='0'){
				$branch_class_output='1';
			}else if($branch_class=='1'){
				$branch_class_output='2';
			}else if($branch_class=='2'){
				$branch_class_output='3';
			}else{
				$branch_class_output='';
			}
			$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

			$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
			$objPHPExcel->getActiveSheet()->getStyle('D7:D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
			for($h=0;$h<count($branch_child_data);$h++)
			{
				$branchColumn=$cCA[($h+4)];
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn.'7')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
			}

			$ii = 8;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				/*
				| BEGIN SET OPTION
				*/
				if($datas[$i]['item_type']=="0") // TITLE
				{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else if($datas[$i]['posisi']=='1'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
				}
				else if($datas[$i]['item_type']=="1") // SUMMARY
				{
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				else if($datas[$i]['item_type']=="2") // FORMULA
				{
					if($datas[$i]['formula_text_bold']==0){
						if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
						}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}else if($datas[$i]['formula_text_bold']==1){
						if($datas[$i]['posisi']=='0'){
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
						}else{
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
					}
				}
				else if($datas[$i]['item_type']=="3") // TOTAL
				{
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}

		        $item_name = $datas[$i]['item_name'];
		        $item_name = str_replace('&nbsp;',' ',$item_name);
		        $item_name = str_replace('<b>','',$item_name);
		        $item_name = str_replace('</b>','',$item_name);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(10);
		        if($datas[$i]['item_type']=='0'){ // title
		        	$saldo='';
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
		        	}
		        }else if($datas[$i]['item_type']=='3'){ // total
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setBold(true);
		        	}
		        }else{
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        }
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
				/*
				| END SET OPTION
				*/

		        // CELL VALUE
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
				if(count($branch_child_data)==0){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
				}

				if($saldo!='')
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$saldo_per_item = $this->model_laporan_to_pdf->get_saldo_report_by_item_code_v2('10',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$periode_bulan,$periode_tahun,$periode_hari);
						
						$branchColumn=$cCA[($j+4)];
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(10);
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldo_per_item,2,',','.').' ');
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(11);
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setBold(true);
						}
						
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
					}	
				}
				else
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$branchColumn=$cCA[($j+4)];
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					}
				}
				$ii++;
			
			}//END FOR*/
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-NERACA.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}


	public function export_neraca_rinci_gl_v2()
	{
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        // $from_date = $this->get_from_trx_date();
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;
        if ($cabang==""){            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        }else if ($periode_bulan=="" && $periode_tahun=="") {
            echo "<script>alert('Periode Belum Dipilih !');javascript:window.close();</script>";
        }else{

            $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_class = $branch['branch_class'];

            switch ($branch_class) {
				case '0':
				  $branch_class_name = "Kepala Pusat";
				  break;
				case '1':
				  $branch_class_name = "Kepala Wilayah";
				  break;
				case '2':
				  $branch_class_name = "Kepala Cabang";
				  break;
				case '3':
				  $branch_class_name = "Kepala Capem";
				  break;
				default:
				  $branch_class_name = "-";
				  break;
			}

			$datas = $this->model_laporan_to_pdf->export_neraca_rinci_gl_v2($cabang,$last_date);
            if ($cabang !='00000'){
                $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
            }else{
                $branch_name = "PUSAT";
            }

			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN NERACA RINCI");
			// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

			// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

			$cCA = createColumnsArray('XFD');

			if($branch_class=='0'){
				$branch_class_output='1';
			}else if($branch_class=='1'){
				$branch_class_output='2';
			}else if($branch_class=='2'){
				$branch_class_output='3';
			}else{
				$branch_class_output='';
			}
			$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

			$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
			$objPHPExcel->getActiveSheet()->getStyle('D7:D7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
			for($h=0;$h<count($branch_child_data);$h++)
			{
				$branchColumn=$cCA[($h+4)];
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn.'7')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
			}

			$ii = 8;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				/*
				| BEGIN SET OPTION
				*/
				if($datas[$i]['item_type']=="0") // TITLE
				{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else if($datas[$i]['posisi']=='1'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
				}
				else if($datas[$i]['item_type']=="1") // SUMMARY
				{
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				else if($datas[$i]['item_type']=="2") // FORMULA
				{
					if($datas[$i]['formula_text_bold']==0){
						if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
						}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}else if($datas[$i]['formula_text_bold']==1){
						if($datas[$i]['posisi']=='0'){
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
						}else{
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
					}
				}
				else if($datas[$i]['item_type']=="3") // TOTAL
				{
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}

		        $item_name = $datas[$i]['item_name'];
		        $item_name = str_replace('&nbsp;',' ',$item_name);
		        $item_name = str_replace('<b>','',$item_name);
		        $item_name = str_replace('</b>','',$item_name);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(10);
		        if($datas[$i]['item_type']=='0'){ // title
		        	$saldo='';
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
		        	}
		        }else if($datas[$i]['item_type']=='3'){ // total
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getFont()->setBold(true);
		        	}
		        }else{
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        }
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
				/*
				| END SET OPTION
				*/

		        // CELL VALUE
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
				if(count($branch_child_data)==0){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
				}

				if($saldo!='')
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$saldo_per_item = $this->model_laporan_to_pdf->get_saldo_report_by_item_code_v2('11',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$periode_bulan,$periode_tahun,$periode_hari);
						
						$branchColumn=$cCA[($j+4)];
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(10);
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldo_per_item,2,',','.').' ');
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setSize(11);
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii)->getFont()->setBold(true);
						}
						
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
					}	
				}
				else
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$branchColumn=$cCA[($j+4)];
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
					}
				}
				$ii++;
			
			}//END FOR*/
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-NERACA-RINCI.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}


	public function export_lap_lr_v2()
	{
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        // $from_date=$this->get_from_trx_date();
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;

        if ($cabang==""){            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        }else if ($periode_bulan=="" && $periode_tahun=="") {
            echo "<script>alert('Periode Belum Dipilih !');javascript:window.close();</script>";
        }else{

            $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_class = $branch['branch_class'];

            switch ($branch_class) {
				case '0':
				  $branch_class_name = "Kepala Pusat";
				  break;
				case '1':
				  $branch_class_name = "Kepala Wilayah";
				  break;
				case '2':
				  $branch_class_name = "Kepala Cabang";
				  break;
				case '3':
				  $branch_class_name = "Kepala Capem";
				  break;
				default:
				  $branch_class_name = "-";
				  break;
			}

            
			$datas = $this->model_laporan_to_pdf->export_lap_laba_rugi_v2($cabang,$from_date,$last_date);
            if ($cabang !='00000'){
                $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
                if($branch_class=="1"){
                    $branch_name .= "";
                }
            }else{
                $branch_name = "PUSAT";
            }

			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN LABA RUGI");
			// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

			// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

			$cCA = createColumnsArray('XFD');

			if($branch_class=='0'){
				$branch_class_output='1';
			}else if($branch_class=='1'){
				$branch_class_output='2';
			}else if($branch_class=='2'){
				$branch_class_output='3';
			}else{
				$branch_class_output='';
			}
			$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

			$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
			$objPHPExcel->getActiveSheet()->mergeCells('D7:F7');
			$objPHPExcel->getActiveSheet()->getStyle('D7:F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
			
			$objPHPExcel->getActiveSheet()->setCellValue('D8','sd Bulan Lalu');
			$objPHPExcel->getActiveSheet()->setCellValue('E8','Bulan Ini');
			$objPHPExcel->getActiveSheet()->setCellValue('F8','Akumulasi');
			$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setSize(12);

			for($h=0;$h<count($branch_child_data);$h++)
			{
				$branchColumn_idx=$h+6;
				$branchColumn_idx2=$h+7;
				$branchColumn_idx3=$h+8;
				$branchColumn=$cCA[$branchColumn_idx];
				$branchColumn2=$cCA[$branchColumn_idx2];
				$branchColumn3=$cCA[$branchColumn_idx3];
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn3.'7')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
				$objPHPExcel->getActiveSheet()->mergeCells($branchColumn.'7:'.$branchColumn3.'7');
			
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'8','sd Bulan Lalu');
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.'8','Bulan Ini');
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.'8','Akumulasi');
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setSize(12);
			}

			$ii = 9;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				/*
				| BEGIN SET OPTION
				*/
				if($datas[$i]['item_type']=="0") // TITLE
				{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else if($datas[$i]['posisi']=='1'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
				}
				else if($datas[$i]['item_type']=="1") // SUMMARY
				{
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				else if($datas[$i]['item_type']=="2") // FORMULA
				{
					if($datas[$i]['formula_text_bold']==0){
						if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
						}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}else if($datas[$i]['formula_text_bold']==1){
						if($datas[$i]['posisi']=='0'){
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
						}else{
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
					}
				}
				else if($datas[$i]['item_type']=="3") // TOTAL
				{
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}

		        $item_name = $datas[$i]['item_name'];
		        $item_name = str_replace('&nbsp;',' ',$item_name);
		        $item_name = str_replace('<b>','',$item_name);
		        $item_name = str_replace('</b>','',$item_name);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(10);
		        if($datas[$i]['item_type']=='0'){ // title
		        	$saldo='';
		        	$saldo_mutasi='';
		        	$total_saldo='';
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
		        	}
		        }else if($datas[$i]['item_type']=='3'){ // total
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
		        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],0,',','.');
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setBold(true);
		        	}
		        }else{
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
		        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],2,',','.');
		        }
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
				/*
				| END SET OPTION
				*/

		        // CELL VALUE
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$saldo_mutasi.' ');
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$total_saldo.' ');
				if(count($branch_child_data)==0){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
				}

				if($saldo!='')
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$saldoarr = $this->model_laporan_to_pdf->get_saldo_report_by_item_code_v2('20',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$from_date,$last_date);
						$total_saldo=$saldoarr['saldo']+$saldoarr['saldo_mutasi'];

						$branchColumn_idx=$j+6;
						$branchColumn_idx2=$j+7;
						$branchColumn_idx3=$j+8;
						$branchColumn=$cCA[$branchColumn_idx];
						$branchColumn2=$cCA[$branchColumn_idx2];
						$branchColumn3=$cCA[$branchColumn_idx3];
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(10);
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldoarr['saldo'],2,',','.').' ');
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.$ii,number_format($saldoarr['saldo_mutasi'],2,',','.').' ');
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.$ii,number_format($total_saldo,2,',','.').' ');
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn2)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn3)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.$ii.':'.$branchColumn2.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(11);
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setBold(true);
						}
						
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
					}	
				}
				else
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$branchColumn_idx3=$j+8;
						$branchColumn3=$cCA[$branchColumn_idx3];
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
					}
				}
				$ii++;
			
			}//END FOR*/
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-LABA-RUGI.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}

	public function export_lap_lr_rinci_v2()
	{
        $cabang = $this->uri->segment(3);
        $periode_bulan = $this->uri->segment(4);
        $periode_tahun = $this->uri->segment(5);
        $periode_hari = $this->uri->segment(6);
        // $from_date=$this->get_from_trx_date();
        $from_date = $periode_tahun.'-'.$periode_bulan.'-01';
        $last_date = $periode_tahun.'-'.$periode_bulan.'-'.$periode_hari;

        if ($cabang==""){            
         echo "<script>alert('Mohon pilih kantor cabang terlebih dahulu !');javascript:window.close();</script>";
        }else if ($periode_bulan=="" && $periode_tahun=="") {
            echo "<script>alert('Periode Belum Dipilih !');javascript:window.close();</script>";
        }else{

            $branch_id = $this->model_cif->get_branch_id_by_branch_code($cabang);
            $branch = $this->model_cif->get_branch_by_branch_id($branch_id);
            $branch_class = $branch['branch_class'];

            switch ($branch_class) {
				case '0':
				  $branch_class_name = "Kepala Pusat";
				  break;
				case '1':
				  $branch_class_name = "Kepala Wilayah";
				  break;
				case '2':
				  $branch_class_name = "Kepala Cabang";
				  break;
				case '3':
				  $branch_class_name = "Kepala Capem";
				  break;
				default:
				  $branch_class_name = "-";
				  break;
			}

            
			$datas = $this->model_laporan_to_pdf->export_lap_laba_rugi_rinci_v2($cabang,$from_date,$last_date);
            if ($cabang !='00000'){
                $branch_name = $this->model_laporan_to_pdf->get_cabang($cabang);
                if($branch_class=="1"){
                    $branch_name .= "";
                }
            }else{
                $branch_name = "PUSAT";
            }

			// ----------------------------------------------------------
	    	// [BEGIN] EXPORT SCRIPT
			// ----------------------------------------------------------

			// Create new PHPExcel object
			$objPHPExcel = $this->phpexcel;
			// Set document properties
			$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
										 ->setLastModifiedBy("MICROFINANCE")
										 ->setTitle("Office 2007 XLSX Test Document")
										 ->setSubject("Office 2007 XLSX Test Document")
										 ->setDescription("REPORT, generated using PHP classes.")
										 ->setKeywords("REPORT")
										 ->setCategory("Test result file");

			$objPHPExcel->setActiveSheetIndex(0); 

			$styleArray = array(
	       		'borders' => array(
			             'outline' => array(
			                    'style' => PHPExcel_Style_Border::BORDER_THIN,
			                    'color' => array('rgb' => '000000'),
			             ),
			       ),
			);

			// $objPHPExcel->getActiveSheet()->mergeCells('A1:D1');
			$objPHPExcel->getActiveSheet()->setCellValue('A1',strtoupper($this->session->userdata('institution_name')));
			// $objPHPExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			// $objPHPExcel->getActiveSheet()->mergeCells('C2:D2');
			$objPHPExcel->getActiveSheet()->setCellValue('A2',"LAPORAN LABA RUGI RINCI");
			// $objPHPExcel->getActiveSheet()->getStyle('C2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
			// $objPHPExcel->getActiveSheet()->mergeCells('C4:E4');
			$objPHPExcel->getActiveSheet()->setCellValue('A4',"Per Tanggal");
			$objPHPExcel->getActiveSheet()->setCellValue('B4',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C4',$this->format_date_detail($last_date,'id',false,'-'));

			// $objPHPExcel->getActiveSheet()->mergeCells('C5:E5');
			$objPHPExcel->getActiveSheet()->setCellValue('A5',"Cabang");
			$objPHPExcel->getActiveSheet()->setCellValue('B5',":");
			$objPHPExcel->getActiveSheet()->setCellValue('C5',$branch_name);

			$objPHPExcel->getActiveSheet()->getStyle('A1:A2')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('A2')->getFont()->setSize(12);

			$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(17);
			$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(3);
			$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(51);

			$cCA = createColumnsArray('XFD');

			if($branch_class=='0'){
				$branch_class_output='1';
			}else if($branch_class=='1'){
				$branch_class_output='2';
			}else if($branch_class=='2'){
				$branch_class_output='3';
			}else{
				$branch_class_output='';
			}
			$branch_child_data = $this->model_laporan_to_pdf->get_branch_by_branch_induk($cabang,$branch_class_output);

			$objPHPExcel->getActiveSheet()->setCellValue('D7','JUMLAH');
			$objPHPExcel->getActiveSheet()->mergeCells('D7:F7');
			$objPHPExcel->getActiveSheet()->getStyle('D7:F7')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D7')->getFont()->setSize(12);
			
			$objPHPExcel->getActiveSheet()->setCellValue('D8','sd Bulan Lalu');
			$objPHPExcel->getActiveSheet()->setCellValue('E8','Bulan Ini');
			$objPHPExcel->getActiveSheet()->setCellValue('F8','Akumulasi');
			$objPHPExcel->getActiveSheet()->getStyle('D8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setBold(true);
			$objPHPExcel->getActiveSheet()->getStyle('D8')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('E8')->getFont()->setSize(12);
			$objPHPExcel->getActiveSheet()->getStyle('F8')->getFont()->setSize(12);

			for($h=0;$h<count($branch_child_data);$h++)
			{
				$branchColumn_idx=$h+6;
				$branchColumn_idx2=$h+7;
				$branchColumn_idx3=$h+8;
				$branchColumn=$cCA[$branchColumn_idx];
				$branchColumn2=$cCA[$branchColumn_idx2];
				$branchColumn3=$cCA[$branchColumn_idx3];
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'7',$branch_child_data[$h]['branch_name']);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7'.':'.$branchColumn3.'7')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'7')->getFont()->setSize(12);
				$objPHPExcel->getActiveSheet()->mergeCells($branchColumn.'7:'.$branchColumn3.'7');
			
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.'8','sd Bulan Lalu');
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.'8','Bulan Ini');
				$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.'8','Akumulasi');
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.'8')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setBold(true);
				$objPHPExcel->getActiveSheet()->getStyle($branchColumn.'8'.':'.$branchColumn3.'8')->getFont()->setSize(12);
			}

			$ii = 9;
			$row_total = count($datas)+8;
			for( $i = 0 ; $i < count($datas) ; $i++ )
			{

				/*
				| BEGIN SET OPTION
				*/
				if($datas[$i]['item_type']=="0") // TITLE
				{
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else if($datas[$i]['posisi']=='1'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
				}
				else if($datas[$i]['item_type']=="1") // SUMMARY
				{
					if($datas[$i]['posisi']=='0'){
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
					}else{
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
				}
				else if($datas[$i]['item_type']=="2") // FORMULA
				{
					if($datas[$i]['formula_text_bold']==0){
						if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
						}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(false);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}else if($datas[$i]['formula_text_bold']==1){
						if($datas[$i]['posisi']=='0'){
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
						}else{
								$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
						}
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);		
					}
				}
				else if($datas[$i]['item_type']=="3") // TOTAL
				{
					if($datas[$i]['posisi']=='0'){
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(12);
					}else{
							$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setSize(10);
					}
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii)->getFont()->setBold(true);
				}

		        $item_name = $datas[$i]['item_name'];
		        $item_name = str_replace('&nbsp;',' ',$item_name);
		        $item_name = str_replace('<b>','',$item_name);
		        $item_name = str_replace('</b>','',$item_name);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(10);
		        if($datas[$i]['item_type']=='0'){ // title
		        	$saldo='';
		        	$saldo_mutasi='';
		        	$total_saldo='';
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
		        	}
		        }else if($datas[$i]['item_type']=='3'){ // total
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
		        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],0,',','.');
		        	if($datas[$i]['posisi']=='0'){
		        		$item_name = trim($item_name);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setSize(11);
						$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getFont()->setBold(true);
		        	}
		        }else{
		        	$saldo=number_format($datas[$i]['saldo'],2,',','.');
		        	$saldo_mutasi=number_format($datas[$i]['saldo_mutasi'],2,',','.');
		        	$total_saldo=number_format($datas[$i]['saldo']+$datas[$i]['saldo_mutasi'],2,',','.');
		        }
				$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(24);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('E'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->applyFromArray($styleArray);
				$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);
				$objPHPExcel->getActiveSheet()->mergeCells('A'.$ii.':C'.$ii);
				/*
				| END SET OPTION
				*/

		        // CELL VALUE
				$objPHPExcel->getActiveSheet()->setCellValue('A'.$ii,$item_name);
				$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$saldo.' ');
				$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$saldo_mutasi.' ');
				$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$total_saldo.' ');
				if(count($branch_child_data)==0){
					$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':C'.$ii)->applyFromArray($styleArray);
				}

				if($saldo!='')
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$saldoarr = $this->model_laporan_to_pdf->get_saldo_report_by_item_code2_v2('21',$datas[$i]['item_code'],$branch_child_data[$j]['branch_code'],$from_date,$last_date);
						$total_saldo=$saldoarr['saldo']+$saldoarr['saldo_mutasi'];

						$branchColumn_idx=$j+6;
						$branchColumn_idx2=$j+7;
						$branchColumn_idx3=$j+8;
						$branchColumn=$cCA[$branchColumn_idx];
						$branchColumn2=$cCA[$branchColumn_idx2];
						$branchColumn3=$cCA[$branchColumn_idx3];
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(10);
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn.$ii,number_format($saldoarr['saldo'],2,',','.').' ');
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn2.$ii,number_format($saldoarr['saldo_mutasi'],2,',','.').' ');
						$objPHPExcel->getActiveSheet()->setCellValue($branchColumn3.$ii,number_format($total_saldo,2,',','.').' ');
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn2)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getColumnDimension($branchColumn3)->setWidth(24);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn2.$ii.':'.$branchColumn2.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn3.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
						$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		        		if($datas[$i]['item_type']=='3' && $datas[$i]['posisi']=='0'){ // total
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setSize(11);
							$objPHPExcel->getActiveSheet()->getStyle($branchColumn.$ii.':'.$branchColumn3.$ii)->getFont()->setBold(true);
						}
						
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn.$ii)->applyFromArray($styleArray);
						// echo '('.$datas[$i]['item_code'].'|'.$periode_bulan.'|'.$periode_tahun.')';
					}	
				}
				else
				{
					for($j=0;$j<count($branch_child_data);$j++)
					{
						$branchColumn_idx3=$j+8;
						$branchColumn3=$cCA[$branchColumn_idx3];
						$objPHPExcel->getActiveSheet()->getStyle('A'.$ii.':'.$branchColumn3.$ii)->applyFromArray($styleArray);
					}
				}
				$ii++;
			
			}//END FOR*/
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,'Mengetahui');
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$branch_name.', '.date('d-m-Y'));
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,'dibuat');
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$ii++;
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,$branch_class_name);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$this->session->userdata('fullname'));


			// Redirect output to a client's web browser (Excel2007)
			// Save Excel 2007 file

			header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
			header('Content-Disposition: attachment;filename="LAPORAN-LABA-RUGI-RINCI.xlsx"');
			header('Cache-Control: max-age=0');

			$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
			$objWriter->save('php://output');

			// ----------------------------------------------------------------------
			// [END] EXPORT SCRIPT
			// ----------------------------------------------------------------------
		}
	}

	/* BEGIN LAPORAN LIST BAGI HASIL */
	function export_lap_list_bagihasil(){
        $cabang = $this->uri->segment(3);
        $majelis = $this->uri->segment(4);
        $petugas = $this->uri->segment(5);
        $periode = $this->uri->segment(6);

        if($petugas == '00000'){
            $fa = 'SEMUA PETUGAS';
        } else {
            $getPetugas = $this->model_cif->get_fa_by_fa_code($petugas);
            $fa = $getPetugas['fa_name'];
        }

        $datas = $this->model_laporan_to_pdf->export_lap_list_bagihasil($majelis,$petugas,$periode);

        if($cabang != '00000'){
            $data_cabang = 'CABANG '.strtoupper($this->model_laporan_to_pdf->get_cabang($cabang));
        } else {
            $data_cabang = 'SEMUA CABANG';
        }

		// Create new PHPExcel object
		$objPHPExcel = $this->phpexcel;
		// Set document properties
		$objPHPExcel->getProperties()->setCreator("MICROFINANCE")
								 ->setLastModifiedBy("MICROFINANCE")
								 ->setTitle("Office 2007 XLSX Test Document")
								 ->setSubject("Office 2007 XLSX Test Document")
								 ->setDescription("REPORT, generated using PHP classes.")
								 ->setKeywords("REPORT")
								 ->setCategory("Test result file");

		$objPHPExcel->setActiveSheetIndex(0); 

		$styleArray = array(
			'borders' => array(
		         'outline' => array(
		                'style' => PHPExcel_Style_Border::BORDER_THIN,
		                'color' => array('rgb' => '000000'),
		         ),
		   ),
		);

		$objPHPExcel->getActiveSheet()->mergeCells('B2:F2');
		$objPHPExcel->getActiveSheet()->setCellValue('B2',strtoupper($this->session->userdata('institution_name')));
		$objPHPExcel->getActiveSheet()->getStyle('B2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B3:F3');
		$objPHPExcel->getActiveSheet()->setCellValue('B3',$data_cabang);
		$objPHPExcel->getActiveSheet()->getStyle('B3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B4:F4');
		$objPHPExcel->getActiveSheet()->setCellValue('B4','LAPORAN BAGI HASIL');
		$objPHPExcel->getActiveSheet()->getStyle('B4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
		
		$objPHPExcel->getActiveSheet()->mergeCells('B5:F5');
		$objPHPExcel->getActiveSheet()->setCellValue('B5','TANGGAL : '.$periode.'-01-01 s.d '.$periode.'-12-31');
		$objPHPExcel->getActiveSheet()->getStyle('B5')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->mergeCells('B6:F6');
		$objPHPExcel->getActiveSheet()->setCellValue('B6','PETUGAS : '.$fa);
		$objPHPExcel->getActiveSheet()->getStyle('B6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->setCellValue('B7','No');
		$objPHPExcel->getActiveSheet()->setCellValue('C7','No. Anggota');
		$objPHPExcel->getActiveSheet()->setCellValue('D7','Nama');
		$objPHPExcel->getActiveSheet()->setCellValue('E7','Majelis');
		$objPHPExcel->getActiveSheet()->setCellValue('F7','Bagi Hasil');

		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B2:B6')->getFont()->setSize(13);
		$objPHPExcel->getActiveSheet()->getStyle('B7:F7')->getFont()->setBold(true);
		$objPHPExcel->getActiveSheet()->getStyle('B7:F7')->getFont()->setSize(11);
		$objPHPExcel->getActiveSheet()->getStyle('B7:F7')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

		$objPHPExcel->getActiveSheet()->getStyle('B7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('C7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('D7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('E7')->applyFromArray($styleArray);
		$objPHPExcel->getActiveSheet()->getStyle('F7')->applyFromArray($styleArray);
		
		$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(10);
		$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(25);
		$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);
		$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(20);
				
		$ii = 8;
		$row_total = count($datas)+8;

	    $total_bahas = 0;

		for($i = 0; $i < count($datas); $i++){
			$result = $datas[$i];

			$cif_no = $result['cif_no'];
			$nama = $result['nama'];
			$majelis = $result['cm_name'];
			$bahas = $result['tab_sukarela_cr'];

			$total_bahas += $bahas;

			$objPHPExcel->getActiveSheet()->setCellValue('B'.$ii,($i+1));
			$objPHPExcel->getActiveSheet()->setCellValue('C'.$ii,"'".$cif_no);
			$objPHPExcel->getActiveSheet()->setCellValue('D'.$ii,$nama);
			$objPHPExcel->getActiveSheet()->setCellValue('E'.$ii,$majelis);
			$objPHPExcel->getActiveSheet()->setCellValue('F'.$ii,$bahas);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':B'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('C'.$ii.':C'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('D'.$ii.':D'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('E'.$ii.':E'.$ii)->applyFromArray($styleArray);
			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii.':F'.$ii)->applyFromArray($styleArray);

			$objPHPExcel->getActiveSheet()->getStyle('B'.$ii.':E'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);

			$objPHPExcel->getActiveSheet()->getStyle('F'.$ii)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

			$ii++;
		}

		$objPHPExcel->getActiveSheet()->getStyle('F'.$row_total)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);

		$objPHPExcel->getActiveSheet()->getStyle('F'.$row_total)->applyFromArray($styleArray);

		$objPHPExcel->getActiveSheet()->getStyle('F'.$row_total)->getFont()->setBold(true);

		$objPHPExcel->getActiveSheet()->setCellValue('F'.$row_total,$total_bahas);

		// Redirect output to a client's web browser (Excel2007)
		// Save Excel 2007 file

		header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
		header('Content-Disposition: attachment;filename="LAPORAN BAGI HASIL '.$data_cabang.' PERIODE '.$periode.'.xlsx"');
		header('Cache-Control: max-age=0');

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
		$objWriter->save('php://output');
	}
	/* END LAPORAN LIST BAGI HASIL */
}
